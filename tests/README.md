# tests/ - æš—å·é€šè²¨è‡ªå‹•å–å¼•ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ

## ğŸ“‹ æ¦‚è¦

**Cryptocurrency Trading Bot Test Suite**  
crypto-bot ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã§ã™ã€‚ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã€çµ±åˆãƒ†ã‚¹ãƒˆã€ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆã‚’é€šã˜ã¦ã€ã‚·ã‚¹ãƒ†ãƒ ã®å“è³ªã¨ä¿¡é ¼æ€§ã‚’ä¿è¨¼ã—ã¾ã™ã€‚

## ğŸ¯ ãƒ†ã‚¹ãƒˆæ§‹é€ 

```
tests/
â”œâ”€â”€ unit/                   # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å˜ä½ï¼‰
â”‚   â”œâ”€â”€ backtest/          # ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆ4ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”œâ”€â”€ data/              # ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»å‡¦ç†ï¼ˆ2ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”œâ”€â”€ drift_detection/   # ãƒ‰ãƒªãƒ•ãƒˆæ¤œå‡ºï¼ˆ3ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”œâ”€â”€ execution/         # å–å¼•å®Ÿè¡Œï¼ˆ8ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”œâ”€â”€ ha/                # é«˜å¯ç”¨æ€§ï¼ˆ1ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”œâ”€â”€ indicator/         # ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ï¼ˆ1ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”œâ”€â”€ main/              # ãƒ¡ã‚¤ãƒ³æ©Ÿèƒ½ï¼ˆ2ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”œâ”€â”€ ml/                # æ©Ÿæ¢°å­¦ç¿’ï¼ˆ6ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”œâ”€â”€ online_learning/   # ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å­¦ç¿’ï¼ˆ4ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”œâ”€â”€ risk/              # ãƒªã‚¹ã‚¯ç®¡ç†ï¼ˆ1ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”œâ”€â”€ scripts/           # ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆ3ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”œâ”€â”€ strategy/          # å–å¼•æˆ¦ç•¥ï¼ˆ10ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â””â”€â”€ utils/             # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆ2ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”œâ”€â”€ integration/            # çµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ bitbank/           # Bitbankçµ±åˆï¼ˆ1ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”œâ”€â”€ bitFlyer/          # bitFlyerçµ±åˆï¼ˆ1ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”œâ”€â”€ bybit/             # Bybitçµ±åˆï¼ˆ1ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”œâ”€â”€ main/              # ãƒ¡ã‚¤ãƒ³çµ±åˆï¼ˆ1ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â””â”€â”€ okcoinjp/          # OKCoinJPçµ±åˆï¼ˆ1ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â””â”€â”€ deprecated/             # ä¸è¦ãƒ»å¤ã„ãƒ†ã‚¹ãƒˆï¼ˆæ•´ç†æ¸ˆã¿ï¼‰
```

## ğŸ“Š ãƒ†ã‚¹ãƒˆçµ±è¨ˆ

- **ç·ãƒ†ã‚¹ãƒˆæ•°**: ç´„694å€‹ã®ãƒ†ã‚¹ãƒˆé–¢æ•°
- **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ**: 45ãƒ•ã‚¡ã‚¤ãƒ«
- **çµ±åˆãƒ†ã‚¹ãƒˆ**: 7ãƒ•ã‚¡ã‚¤ãƒ«
- **ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™**: 33%ä»¥ä¸Šï¼ˆCI/CDè¨­å®šï¼‰

## ğŸ§ª ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè©³ç´°

### **backtest/** - ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³
- `test_analysis.py` - ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆåˆ†ææ©Ÿèƒ½
- `test_engine.py` - ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³æœ¬ä½“
- `test_metrics.py` - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™è¨ˆç®—
- `test_optimizer.py` - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–

### **data/** - ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»å‡¦ç†
- `test_fetcher.py` - ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿å–å¾—
- `test_streamer.py` - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°

### **drift_detection/** - ãƒ‰ãƒªãƒ•ãƒˆæ¤œå‡º
- `test_detectors.py` - ãƒ‰ãƒªãƒ•ãƒˆæ¤œå‡ºã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
- `test_ensemble.py` - ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ãƒ‰ãƒªãƒ•ãƒˆæ¤œå‡º
- `test_monitor.py` - ãƒ‰ãƒªãƒ•ãƒˆç›£è¦–

### **execution/** - å–å¼•å®Ÿè¡Œ
- `test_execution_base.py` - åŸºåº•ã‚¯ãƒ©ã‚¹ãƒ†ã‚¹ãƒˆ
- `test_execution_engine.py` - å®Ÿè¡Œã‚¨ãƒ³ã‚¸ãƒ³
- `test_factory.py` - ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³
- `test_bitbank_client.py` - Bitbankã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
- `test_bitbank_margin.py` - Bitbankä¿¡ç”¨å–å¼•
- `test_bitflyer_client.py` - bitFlyerã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
- `test_bybit_client.py` - Bybitã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
- `test_okcoinjp_client.py` - OKCoinJPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

### **ha/** - é«˜å¯ç”¨æ€§
- `test_state_manager.py` - çŠ¶æ…‹ç®¡ç†

### **indicator/** - ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™
- `test_calculator.py` - æŒ‡æ¨™è¨ˆç®—

### **main/** - ãƒ¡ã‚¤ãƒ³æ©Ÿèƒ½
- `test_main_cli.py` - CLIã‚³ãƒãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
- `test_main_train.py` - å­¦ç¿’ã‚³ãƒãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ

### **ml/** - æ©Ÿæ¢°å­¦ç¿’
- `test_model.py` - MLãƒ¢ãƒ‡ãƒ«ãƒ©ãƒƒãƒ‘ãƒ¼
- `test_preprocessor.py` - å‰å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
- `test_ensemble.py` - ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«å­¦ç¿’
- `test_ml_optimizer.py` - MLæœ€é©åŒ–
- `test_target.py` - ã‚¿ãƒ¼ã‚²ãƒƒãƒˆç”Ÿæˆ
- `test_feature_consistency.py` - ç‰¹å¾´é‡ä¸€è²«æ€§æ¤œè¨¼

### **online_learning/** - ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å­¦ç¿’
- `test_base.py` - åŸºåº•ã‚¯ãƒ©ã‚¹
- `test_models.py` - ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å­¦ç¿’ãƒ¢ãƒ‡ãƒ«
- `test_monitoring.py` - å­¦ç¿’ç›£è¦–
- `test_scheduler.py` - ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼

### **risk/** - ãƒªã‚¹ã‚¯ç®¡ç†
- `test_manager.py` - ãƒªã‚¹ã‚¯ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

### **scripts/** - ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- `test_plot_equity.py` - ã‚¨ã‚¯ã‚¤ãƒ†ã‚£ã‚«ãƒ¼ãƒ–æç”»
- `test_walk_forward.py` - ã‚¦ã‚©ãƒ¼ã‚¯ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰åˆ†æ
- `test_walk_forward_extra.py` - æ‹¡å¼µã‚¦ã‚©ãƒ¼ã‚¯ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰

### **strategy/** - å–å¼•æˆ¦ç•¥
- `test_base.py` - åŸºåº•æˆ¦ç•¥ã‚¯ãƒ©ã‚¹
- `test_simple_ma.py` - ç§»å‹•å¹³å‡æˆ¦ç•¥
- `test_ml_strategy.py` - MLæˆ¦ç•¥
- `test_ensemble_ml_strategy.py` - ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«MLæˆ¦ç•¥
- `test_multi_timeframe_ensemble.py` - ãƒãƒ«ãƒã‚¿ã‚¤ãƒ ãƒ•ãƒ¬ãƒ¼ãƒ 
- `test_composite.py` - è¤‡åˆæˆ¦ç•¥
- `test_registry.py` - æˆ¦ç•¥ãƒ¬ã‚¸ã‚¹ãƒˆãƒª
- `test_strategy_factory.py` - æˆ¦ç•¥ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼
- `test_bitbank_btc_jpy_strategy.py` - Bitbank BTC/JPYæˆ¦ç•¥
- `test_bitbank_xrp_jpy_strategy.py` - Bitbank XRP/JPYæˆ¦ç•¥

### **utils/** - ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- `test_config_validator.py` - è¨­å®šæ¤œè¨¼
- `test_status.py` - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†

## ğŸ”„ çµ±åˆãƒ†ã‚¹ãƒˆè©³ç´°

### **å–å¼•æ‰€åˆ¥çµ±åˆãƒ†ã‚¹ãƒˆ**
- `bitbank/test_bitbank_e2e.py` - Bitbankã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰
- `bitFlyer/test_bitflyer_e2e_real.py` - bitFlyerå®Ÿç’°å¢ƒãƒ†ã‚¹ãƒˆ
- `bybit/test_bybit_e2e.py` - Bybitã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰
- `okcoinjp/test_okcoinjp_e2e_real.py` - OKCoinJPå®Ÿç’°å¢ƒãƒ†ã‚¹ãƒˆ

### **ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ†ã‚¹ãƒˆ**
- `main/test_main_e2e.py` - ãƒ¡ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ E2E
- `test_bitbank_fee_optimization_integration.py` - æ‰‹æ•°æ–™æœ€é©åŒ–
- `test_multi_exchange_flow.py` - ãƒãƒ«ãƒå–å¼•æ‰€ãƒ•ãƒ­ãƒ¼

## ğŸš€ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ–¹æ³•

### **å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**
```bash
# å“è³ªãƒã‚§ãƒƒã‚¯ã¨å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
bash scripts/checks.sh

# pytestã§å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
python -m pytest tests/
```

### **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ã¿**
```bash
# ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
python -m pytest tests/unit/

# ç‰¹å®šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ†ã‚¹ãƒˆ
python -m pytest tests/unit/ml/
python -m pytest tests/unit/strategy/
```

### **çµ±åˆãƒ†ã‚¹ãƒˆã®ã¿**
```bash
# çµ±åˆãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
python -m pytest tests/integration/

# ç‰¹å®šã®å–å¼•æ‰€ãƒ†ã‚¹ãƒˆ
python -m pytest tests/integration/bitbank/
```

### **ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š**
```bash
# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
python -m pytest --cov=crypto_bot --cov-report=html tests/

# ã‚«ãƒãƒ¬ãƒƒã‚¸é–¾å€¤ãƒã‚§ãƒƒã‚¯ï¼ˆCI/CDç”¨ï¼‰
python -m pytest --cov=crypto_bot --cov-fail-under=33 tests/
```

### **ç‰¹å®šã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**
```bash
# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
python -m pytest tests/unit/ml/test_ensemble.py

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆé–¢æ•°
python -m pytest tests/unit/ml/test_ensemble.py::TestEnsemble::test_predict

# ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§ãƒ•ã‚£ãƒ«ã‚¿
python -m pytest -k "ensemble" tests/
```

## âš ï¸ æ³¨æ„äº‹é …

### **ãƒ†ã‚¹ãƒˆä½œæˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³**
1. **å‘½åè¦å‰‡**: `test_*.py`ã¾ãŸã¯`*_test.py`
2. **é…ç½®å ´æ‰€**: å¯¾å¿œã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨åŒã˜æ§‹é€ 
3. **ãƒ¢ãƒƒã‚¯ä½¿ç”¨**: å¤–éƒ¨ä¾å­˜ã¯å¿…ãšãƒ¢ãƒƒã‚¯åŒ–
4. **ç‹¬ç«‹æ€§**: å„ãƒ†ã‚¹ãƒˆã¯ç‹¬ç«‹ã—ã¦å®Ÿè¡Œå¯èƒ½ã«

### **é™¤å¤–ã•ã‚Œã¦ã„ã‚‹ãƒ†ã‚¹ãƒˆ**
- `tests/unit/test_monitor.py` - Streamlitãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¾å­˜ï¼ˆchecks.shã§é™¤å¤–ï¼‰
- `tests/integration/` - CIç’°å¢ƒã§ã¯ä¸€éƒ¨ã‚¹ã‚­ãƒƒãƒ—

### **ãƒ†ã‚¹ãƒˆç’°å¢ƒ**
- **Python**: 3.9ä»¥ä¸Š
- **ä¾å­˜é–¢ä¿‚**: `requirements-dev.txt`ã‹ã‚‰è‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- **CI/CD**: GitHub Actionsã§è‡ªå‹•å®Ÿè¡Œ

### **æ•´ç†ã«ã‚ˆã‚‹åŠ¹æœ**
- **æ§‹é€ æ˜ç¢ºåŒ–**: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ¥ã«æ•´ç†
- **ä¸è¦ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤**: Phaseé–¢é€£ã®å¤ã„ãƒ†ã‚¹ãƒˆå‰Šé™¤
- **é…ç½®æœ€é©åŒ–**: test_feature_consistency.pyã‚’é©åˆ‡ãªå ´æ‰€ã¸
- **ä¿å®ˆæ€§å‘ä¸Š**: æ˜ç¢ºãªå‘½åã¨é…ç½®

## ğŸ“ ä»Šå¾Œã®è¿½åŠ ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

1. **æ–°è¦ãƒ†ã‚¹ãƒˆè¿½åŠ æ™‚**
   - å¯¾å¿œã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã«é…ç½®
   - docstringã§ãƒ†ã‚¹ãƒˆã®ç›®çš„ã‚’æ˜è¨˜
   - å¤–éƒ¨ä¾å­˜ã¯ãƒ¢ãƒƒã‚¯åŒ–

2. **ãƒ†ã‚¹ãƒˆä¿®æ­£æ™‚**
   - é–¢é€£ã™ã‚‹ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’ç¢ºèª
   - ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒä½ä¸‹ã—ãªã„ã‚ˆã†æ³¨æ„

3. **çµ±åˆãƒ†ã‚¹ãƒˆè¿½åŠ æ™‚**
   - å®Ÿç’°å¢ƒä¾å­˜ã‚’æœ€å°é™ã«
   - CIç’°å¢ƒã§ã‚‚å‹•ä½œã™ã‚‹ã‚ˆã†è¨­è¨ˆ

---

*Testsæ§‹é€ ã¯2025å¹´8æœˆ7æ—¥ã«æ•´ç†ãƒ»æœ€é©åŒ–ã•ã‚Œã¾ã—ãŸ*