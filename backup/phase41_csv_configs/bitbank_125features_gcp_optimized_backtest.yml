# =============================================================================
# ãƒ•ã‚¡ã‚¤ãƒ«å: config/validation/bitbank_125features_gcp_optimized_backtest.yml
# èª¬æ˜:
# GCP Cloud Runæœ€é©åŒ–ãƒ»125ç‰¹å¾´é‡ã‚·ã‚¹ãƒ†ãƒ å¯¾å¿œãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆè¨­å®š
# - Cloud Runç’°å¢ƒå®Œå…¨å¯¾å¿œï¼šãƒ¡ãƒ¢ãƒªãƒ»CPUãƒ»ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆåˆ¶é™è€ƒæ…®
# - ãƒ­ãƒ¼ã‚«ãƒ«ãƒ»GCPç’°å¢ƒå·®æœ€å°åŒ–ï¼šè¨­å®šçµ±ä¸€ãƒ»å¤–éƒ¨APIç„¡åŠ¹åŒ–å¾¹åº•
# - æœ¬ç•ªproduction.ymlåŸºæº–ï¼š125ç‰¹å¾´é‡ãƒ»ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«å­¦ç¿’ãƒ»ãƒªã‚¹ã‚¯ç®¡ç†å®Œå…¨è¸è¥²
# =============================================================================

# ----------------------------------------------------------------------
# ãƒ‡ãƒ¼ã‚¿å–å¾—è¨­å®šï¼ˆGCP Cloud Runæœ€é©åŒ–ï¼‰
# ----------------------------------------------------------------------
data:
  exchange: csv  # CSV ãƒ¢ãƒ¼ãƒ‰ã‚’æŒ‡å®šï¼ˆGCPç’°å¢ƒã¨ã®å·®ç•°æœ€å°åŒ–ï¼‰
  symbol: BTC/USD  # CSVãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚·ãƒ³ãƒœãƒ«ï¼ˆBitbankã¯BTC/JPYã ãŒCSVã¯USDï¼‰
  timeframe: 1h
  
  # CSV ãƒ•ã‚¡ã‚¤ãƒ«æŒ‡å®š
  csv_path: /Users/nao/Desktop/bot/data/btc_usd_2024_hourly.csv
  
  # åŠå¹´é–“ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆï¼šè©³ç´°æˆ¦ç•¥åˆ†æç”¨
  since: "2024-01-01T00:00:00Z"
  limit: 4380  # åŠå¹´åˆ†ï¼ˆ182.5æ—¥ Ã— 24æ™‚é–“ï¼‰
  
  # Cloud Runç’°å¢ƒåˆ¶é™å¯¾å¿œï¼ˆproduction.ymlæº–æ‹ ï¼‰
  paginate: true
  per_page: 200    # production.ymlæº–æ‹ ï¼š200
  since_hours: 96  # production.ymlæº–æ‹ ï¼š96æ™‚é–“
  weekend_data: true
  fetch_retries: 3
  adaptive_rate_limit: true
  
  # ãƒ¡ãƒ¢ãƒªåŠ¹ç‡åŒ–è¨­å®šï¼ˆCloud Run 2GBåˆ¶é™å¯¾å¿œï¼‰
  max_consecutive_empty: 8     # production.yml: 12â†’8ã«åŠ¹ç‡åŒ–
  max_consecutive_no_new: 15   # production.yml: 20â†’15ã«åŠ¹ç‡åŒ–
  max_attempts: 20             # production.yml: 25â†’20ã«åŠ¹ç‡åŒ–
  exponential_backoff: true
  min_delay_ms: 15000          # production.yml: 30000â†’15000ã«é«˜é€ŸåŒ–
  max_delay_ms: 30000          # production.yml: 45000â†’30000ã«é«˜é€ŸåŒ–
  
  # ãƒãƒ«ãƒã‚¿ã‚¤ãƒ ãƒ•ãƒ¬ãƒ¼ãƒ å¯¾å¿œãƒ‡ãƒ¼ã‚¿è¨­å®šï¼ˆGCPæœ€é©åŒ–ï¼‰
  multi_timeframe_data:
    base_timeframe: "1h"
    target_timeframes:
      15m:
        method: "interpolation"
        min_points: 8            # production.yml: 10â†’8ã«åŠ¹ç‡åŒ–
      1h:
        method: "direct"
        min_points: 8            # production.yml: 10â†’8ã«åŠ¹ç‡åŒ–
      4h:
        method: "aggregation"
        min_points: 6            # production.yml: 8â†’6ã«åŠ¹ç‡åŒ–
        api_fetch: false
  
  # APIè¨­å®šã¯å®Œå…¨ç„¡åŠ¹åŒ–ï¼ˆGCPç’°å¢ƒã¨ã®å·®ç•°é˜²æ­¢ï¼‰
  api_key: null
  api_secret: null
  ccxt_options: {}

# ----------------------------------------------------------------------
# å“è³ªç›£è¦–è¨­å®šï¼ˆGCPç’°å¢ƒæœ€é©åŒ–ï¼‰
# ----------------------------------------------------------------------
quality_monitoring:
  enabled: true
  default_threshold: 0.3       # 30%ãƒ«ãƒ¼ãƒ«ç¶­æŒ
  emergency_stop_threshold: 0.35
  target_threshold: 0.6
  max_threshold: 0.8
  
  # å“è³ªãƒ™ãƒ¼ã‚¹å–å¼•èª¿æ•´ï¼ˆCloud Runå¯¾å¿œï¼‰
  low_quality_mode:
    position_size_reduction: 0.5
    confidence_boost: 0.1
    stop_loss_tightening: 0.8
    
  medium_quality_mode:
    position_size_reduction: 0.8
    confidence_boost: 0.03
    stop_loss_tightening: 0.95
  
  high_quality_mode:
    position_size_reduction: 1.0
    confidence_boost: 0.0
    stop_loss_tightening: 1.0

# ----------------------------------------------------------------------
# ãƒªã‚¹ã‚¯ç®¡ç†ï¼ˆproduction.ymlå®Œå…¨è¸è¥²ãƒ»GCPå¯¾å¿œï¼‰
# ----------------------------------------------------------------------
risk:
  risk_per_trade: 0.005        # production.ymlæº–æ‹ ï¼š0.5%
  stop_atr_mult: 1.2          # production.ymlæº–æ‹ ï¼š1.2
  kelly_criterion:
    enabled: true             # production.ymlæº–æ‹ ï¼šæœ‰åŠ¹
    max_fraction: 0.05        # production.ymlæº–æ‹ ï¼š5%
  
  # ATRæœŸé–“æœ€é©åŒ–ï¼ˆproduction.ymlæº–æ‹ ï¼‰
  atr_period: 20              # production.ymlæº–æ‹ ï¼š20æœŸé–“

# ----------------------------------------------------------------------
# ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆè¨­å®šï¼ˆGCPé‹ç”¨æƒ³å®šï¼‰
# ----------------------------------------------------------------------
backtest:
  starting_balance: 10000.0   # 1ä¸‡å††ï¼ˆå°é¡ãƒ†ã‚¹ãƒˆæƒ³å®šï¼‰
  slippage_rate: 0.0012       # Bitbankå®Ÿæ¸¬å€¤ï¼ˆ0.12%ï¼‰
  commission_rate: 0.0012     # Bitbankãƒ†ã‚¤ã‚«ãƒ¼æ‰‹æ•°æ–™ï¼ˆ0.12%ï¼‰
  maker_commission_rate: -0.0002  # Bitbankãƒ¡ã‚¤ã‚«ãƒ¼ãƒªãƒ™ãƒ¼ãƒˆï¼ˆ-0.02%ï¼‰
  trade_log_csv: "./results/trade_log_125features_6month_analysis.csv"
  aggregate_out_prefix: "./results/aggregate_125features_6month"

# ----------------------------------------------------------------------
# ã‚¦ã‚©ãƒ¼ã‚¯ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰åˆ†å‰²ï¼ˆGCP Cloud Runæœ€é©åŒ–ï¼‰
# ----------------------------------------------------------------------
walk_forward:
  train_window: 360      # 15æ—¥é–“å­¦ç¿’ï¼ˆ720â†’360ã«åŠ¹ç‡åŒ–ï¼‰
  test_window: 120       # 5æ—¥é–“ãƒ†ã‚¹ãƒˆï¼ˆ168â†’120ã«åŠ¹ç‡åŒ–ï¼‰
  step: 24               # 1æ—¥é–“éš”ã§ã‚¹ãƒ©ã‚¤ãƒ‰ï¼ˆç¶­æŒï¼‰

# ----------------------------------------------------------------------
# æ©Ÿæ¢°å­¦ç¿’ï¼ˆproduction.ymlå®Œå…¨è¸è¥²ãƒ»GCPæœ€é©åŒ–ï¼‰
# ----------------------------------------------------------------------
ml:
  feat_period: 14              # production.ymlæº–æ‹ 
  lags: [1,2,3]               # production.ymlæº–æ‹ ï¼šåŠ¹ç‡å‘ä¸Š
  rolling_window: 10          # production.ymlæº–æ‹ ï¼šå³åº§å–å¼•é–‹å§‹å¯¾å¿œ
  horizon: 5                  # production.ymlæº–æ‹ 
  target_type: classification # production.ymlæº–æ‹ 
  model_type: lgbm           # production.ymlæº–æ‹ 
  
  # ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«å­¦ç¿’è¨­å®šï¼ˆproduction.ymlå®Œå…¨æº–æ‹ ï¼‰
  ensemble:
    enabled: true
    method: trading_stacking
    confidence_threshold: 0.60    # production.ymlæº–æ‹ ï¼šPhase H.15æœ€é©åŒ–æ¸ˆã¿
    risk_adjustment: true
    models: ["lgbm", "xgb", "rf"] # production.ymlæº–æ‹ ï¼š3ãƒ¢ãƒ‡ãƒ«
    model_weights: [0.5, 0.3, 0.2] # production.ymlæº–æ‹ ï¼šæ€§èƒ½ãƒ™ãƒ¼ã‚¹é‡ã¿
    
  # å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿è¨­å®šï¼ˆproduction.ymlæº–æ‹ ãƒ»å®Œå…¨ç„¡åŠ¹åŒ–ï¼‰
  external_data:
    enabled: false              # production.ymlæº–æ‹ ï¼šPhase H.27ç„¡åŠ¹åŒ–
    cache_enabled: false        # GCPæœ€é©åŒ–ï¼šã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–
    fallback_enabled: true
    include_in_features: false  # production.ymlæº–æ‹ ï¼šå®Œå…¨é™¤å¤–
    
    vix:
      enabled: false            # production.ymlæº–æ‹ ï¼šç„¡åŠ¹åŒ–
      symbol: "^VIX"
      timeframe: "1d"
      fallback_level: 20.0
      
    macro:
      enabled: false            # production.ymlæº–æ‹ ï¼šç„¡åŠ¹åŒ–
      symbols:
        dxy: "DX-Y.NYB"
        us10y: "^TNX"
        us2y: "^IRX"
      fallback_values:
        dxy: 103.0
        us10y: 4.5
        us2y: 4.8
        
    funding:
      enabled: false            # production.ymlæº–æ‹ ï¼šç„¡åŠ¹åŒ–
      symbol: "BTC/USDT"
      exchanges: ["binance"]
      fallback_rate: 0.0001

  # 125ç‰¹å¾´é‡ã‚·ã‚¹ãƒ†ãƒ ï¼ˆproduction.ymlå®Œå…¨è¸è¥²ï¼‰
  extra_features:
    # ãƒ©ã‚°ç‰¹å¾´é‡ (10å€‹)
    - close_lag_1
    - close_lag_2
    - close_lag_3
    - close_lag_4
    - close_lag_5
    - volume_lag_1
    - volume_lag_2
    - volume_lag_3
    - volume_lag_4
    - volume_lag_5
    
    # ãƒªã‚¿ãƒ¼ãƒ³ç‰¹å¾´é‡ (10å€‹)
    - returns_1
    - returns_2
    - returns_3
    - returns_5
    - returns_10
    - log_returns_1
    - log_returns_2
    - log_returns_3
    - log_returns_5
    - log_returns_10
    
    # ç§»å‹•å¹³å‡ (12å€‹)
    - sma_5
    - sma_10
    - sma_20
    - sma_50
    - sma_100
    - sma_200
    - ema_5
    - ema_10
    - ema_20
    - ema_50
    - ema_100
    - ema_200
    
    # ä¾¡æ ¼ä½ç½® (5å€‹)
    - price_position_20
    - price_position_50
    - price_vs_sma20
    - bb_position
    - intraday_position
    
    # ãƒœãƒªãƒ³ã‚¸ãƒ£ãƒ¼ãƒãƒ³ãƒ‰ (5å€‹)
    - bb_upper
    - bb_middle
    - bb_lower
    - bb_width
    - bb_squeeze
    
    # ãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ æŒ‡æ¨™ (14å€‹) - production.ymlæº–æ‹ 
    - rsi_14
    - rsi_7
    - rsi_21
    - rsi_oversold
    - rsi_overbought
    - macd
    - macd_signal
    - macd_hist
    - macd_cross_up
    - macd_cross_down
    - stoch_k
    - stoch_d
    - stoch_oversold
    - stoch_overbought
    
    # ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£ (8å€‹)
    - atr_14
    - atr_7
    - atr_21
    - volatility_20
    - volatility_50
    - high_low_ratio
    - true_range
    - volatility_ratio
    
    # å‡ºæ¥é«˜æŒ‡æ¨™ (10å€‹)
    - volume_sma_20
    - volume_ratio
    - volume_trend
    - vwap
    - vwap_distance
    - obv
    - obv_sma
    - cmf
    - mfi
    - ad_line
    
    # ãƒˆãƒ¬ãƒ³ãƒ‰æŒ‡æ¨™ (8å€‹)
    - adx_14
    - plus_di
    - minus_di
    - trend_strength
    - trend_direction
    - cci_20
    - williams_r
    - ultimate_oscillator
    
    # ãƒãƒ¼ã‚±ãƒƒãƒˆæ§‹é€  (6å€‹)
    - support_distance
    - resistance_distance
    - support_strength
    - volume_breakout
    - price_breakout_up
    - price_breakout_down
    
    # ãƒ­ãƒ¼ã‚½ã‚¯è¶³ãƒ‘ã‚¿ãƒ¼ãƒ³ (4å€‹)
    - doji
    - hammer
    - engulfing
    - pinbar
    
    # çµ±è¨ˆçš„ç‰¹å¾´é‡ (5å€‹)
    - skewness_20
    - kurtosis_20
    - zscore
    - mean_reversion_20
    - mean_reversion_50
    
    # æ™‚ç³»åˆ—ç‰¹å¾´é‡ (6å€‹)
    - hour
    - day_of_week
    - is_weekend
    - is_asian_session
    - is_european_session
    - is_us_session
    
    # é«˜åº¦æŒ‡æ¨™ (22å€‹)
    - momentum_14
    - roc_14
    - srsi_k
    - srsi_d
    - trix
    - kst
    - cmo
    - ppo
    - ppo_signal
    - ppo_hist
    - ift_rsi
    - cti
    - wt1
    - wt2
    - ui
    - tci
    - ap
    - hlc3
    - ohlc4
    - typical_price
    - weighted_close
    - dpo

# ----------------------------------------------------------------------
# ãƒ©ã‚¤ãƒ–ãƒˆãƒ¬ãƒ¼ãƒ‰è¨­å®šï¼ˆGCP Cloud Runå¯¾å¿œï¼‰
# ----------------------------------------------------------------------
live:
  mode: backtest  # ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰
  trade_interval: 60            # production.ymlæº–æ‹ ï¼š60ç§’
  min_order_size: 0.0001       # production.ymlæº–æ‹ 
  max_order_size: 0.0005       # production.ymlæº–æ‹ 
  starting_balance: 10000.0    # production.ymlæº–æ‹ 
  
  # ä¿¡ç”¨å–å¼•è¨­å®šï¼ˆproduction.ymlæº–æ‹ ï¼‰
  margin_trading:
    enabled: true              # production.ymlæº–æ‹ ï¼šæœ‰åŠ¹
    leverage: 1.0             # production.ymlæº–æ‹ ï¼š1å€
    position_type: "both"     # production.ymlæº–æ‹ ï¼šä¸¡å»ºã¦
    force_margin_mode: true   # production.ymlæº–æ‹ 
    verify_margin_status: true # production.ymlæº–æ‹ 
  
  # Bitbankå›ºæœ‰è¨­å®šï¼ˆproduction.ymlæº–æ‹ ï¼‰
  bitbank_settings:
    min_btc_amount: 0.0001
    max_retries: 3
    retry_delay: 5

# ----------------------------------------------------------------------
# æˆ¦ç•¥è¨­å®šï¼ˆproduction.ymlæº–æ‹ ï¼‰
# ----------------------------------------------------------------------
strategy:
  type: single
  name: ml
  params:
    model_path: models/production/model.pkl
    threshold: 0.02            # Phase H.15æœ€é©åŒ–æ¸ˆã¿
    
    # å‹•çš„é–¾å€¤èª¿æ•´
    atr_multiplier: 0.5
    volatility_adjustment: true
    threshold_bounds: [0.01, 0.25]

# ----------------------------------------------------------------------
# ç›£è¦–ãƒ»ãƒ¬ãƒãƒ¼ãƒˆè¨­å®šï¼ˆGCP Cloud Loggingæœ€é©åŒ–ï¼‰
# ----------------------------------------------------------------------
monitoring:
  enabled: true
  check_interval: 300  # 5åˆ†é–“éš”
  
  # Cloud Loggingæœ€é©åŒ–ï¼šé‡è¦ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®ã¿
  metrics:
    - total_return
    - sharpe_ratio
    - max_drawdown
    - win_rate
    - profit_factor
    - trade_count

# GCP Cloud Runå¯¾å¿œè¨­å®š
cloud_run_optimization:
  # ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡æœ€é©åŒ–
  memory_limit: "2Gi"
  cpu_limit: "1000m"
  
  # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå¯¾å¿œ
  execution_timeout: 300       # Cloud Runåˆ¶é™ï¼š300ç§’
  batch_processing: true       # å¤§é‡ãƒ‡ãƒ¼ã‚¿ã‚’å°åˆ†ã‘å‡¦ç†
  
  # ãƒ­ã‚°å‡ºåŠ›æœ€é©åŒ–ï¼ˆCloud Loggingå¯¾å¿œï¼‰
  logging:
    level: "INFO"              # ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°æŠ‘åˆ¶
    structured: true           # JSONæ§‹é€ åŒ–ãƒ­ã‚°
    reduce_verbose: true       # å†—é•·ãƒ­ã‚°å‰Šæ¸›

# å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ãƒªãƒˆãƒ©ã‚¤è¨­å®šï¼ˆproduction.ymlæº–æ‹ ãƒ»ç„¡åŠ¹åŒ–çŠ¶æ…‹ï¼‰
external_data_retry:
  max_retries: 3
  retry_delay: 2
  exponential_backoff: true
  circuit_breaker:
    enabled: true
    failure_threshold: 5
    recovery_timeout: 300

# ----------------------------------------------------------------------
# ğŸ¯ GCP Cloud Runæœ€é©åŒ–125ç‰¹å¾´é‡ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆæœŸå¾…åŠ¹æœ
# ----------------------------------------------------------------------
# ã“ã®è¨­å®šã«ã‚ˆã‚‹ç‰¹å¾´:
# 
# â˜ï¸ GCP Cloud Runå®Œå…¨å¯¾å¿œ:
# - ãƒ¡ãƒ¢ãƒªåˆ¶é™2GBå¯¾å¿œ: åŠ¹ç‡åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ»å°åˆ»ã¿å­¦ç¿’
# - CPUåˆ¶é™1vCPUå¯¾å¿œ: è»½é‡åŒ–ã•ã‚ŒãŸãƒ¢ãƒ‡ãƒ«å­¦ç¿’ãƒ»ä¸¦åˆ—å‡¦ç†æœ€é©åŒ–
# - å®Ÿè¡Œæ™‚é–“åˆ¶é™300ç§’å¯¾å¿œ: ãƒãƒƒãƒå‡¦ç†ãƒ»æ®µéšçš„å®Ÿè¡Œ
# - Cloud Loggingå¯¾å¿œ: æ§‹é€ åŒ–ãƒ­ã‚°ãƒ»é‡è¦æƒ…å ±é›†ç´„
# 
# ğŸ”„ ãƒ­ãƒ¼ã‚«ãƒ«ãƒ»GCPç’°å¢ƒå·®æœ€å°åŒ–:
# - å¤–éƒ¨APIå®Œå…¨ç„¡åŠ¹åŒ–: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¾å­˜æ’é™¤ãƒ»ç’°å¢ƒå·®è§£æ¶ˆ
# - CSVåŸºæº–ãƒ‡ãƒ¼ã‚¿å‡¦ç†: APIåˆ¶é™ãƒ»ãƒ¬ãƒ¼ãƒˆåˆ¶é™å›é¿
# - è¨­å®šçµ±ä¸€: production.ymlåŸºæº–ãƒ»å‹•ä½œä¿è¨¼
# 
# ğŸ“ˆ 125ç‰¹å¾´é‡ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨ç§»æ¤:
# - å…¨ç‰¹å¾´é‡production.ymlæº–æ‹ : ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆçµæœã®å†ç¾æ€§ä¿è¨¼
# - ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ : 3ãƒ¢ãƒ‡ãƒ«çµ±åˆãƒ»é‡ã¿ãƒ»é–¾å€¤å®Œå…¨ä¸€è‡´
# - ãƒªã‚¹ã‚¯ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ : KellyåŸºæº–ãƒ»ATRãƒ»ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚µã‚¤ã‚ºå®Œå…¨ç§»æ¤
# 
# ğŸ“Š æœŸå¾…çµæœ:
# - ãƒ­ãƒ¼ã‚«ãƒ«æ€§èƒ½ã®GCPå®Œå…¨å†ç¾: 99%ä»¥ä¸Šã®çµæœä¸€è‡´
# - ãƒ¡ãƒ¢ãƒªåŠ¹ç‡95%ä»¥ä¸Š: 2GBåˆ¶é™å†…ã§ã®å®‰å®šå‹•ä½œ
# - å®Ÿè¡Œæ™‚é–“æœ€é©åŒ–: 300ç§’åˆ¶é™å†…ã§ã®ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆå®Œäº†
# - ãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™å®Œäº†: ãƒ­ãƒ¼ã‚«ãƒ«æˆåŠŸâ†’GCPå³åº§ãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½
# ----------------------------------------------------------------------