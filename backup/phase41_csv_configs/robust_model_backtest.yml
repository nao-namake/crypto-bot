# =============================================================================
# ãƒ•ã‚¡ã‚¤ãƒ«å: config/validation/robust_model_backtest.yml
# èª¬æ˜:
# 99.2%ç²¾åº¦å …ç‰¢ãƒ¢ãƒ‡ãƒ«å°‚ç”¨ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆè¨­å®š
# - robust_profitable_model.pklä½¿ç”¨
# - 30é¸æŠç‰¹å¾´é‡å¯¾å¿œ
# - -Â¥35,964æå¤±æ”¹å–„æ¤œè¨¼
# =============================================================================

# ----------------------------------------------------------------------
# ãƒ‡ãƒ¼ã‚¿å–å¾—è¨­å®šï¼ˆCSVç‰ˆï¼‰
# ----------------------------------------------------------------------
data:
  exchange: csv  # CSV ãƒ¢ãƒ¼ãƒ‰ã‚’æŒ‡å®š
  symbol: BTC/USD  # CSVãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚·ãƒ³ãƒœãƒ«
  timeframe: 1h
  
  # CSV ãƒ•ã‚¡ã‚¤ãƒ«æŒ‡å®š
  csv_path: /Users/nao/Desktop/bot/data/btc_usd_2024_hourly.csv
  
  # å­¦ç¿’ç”¨ãƒ‡ãƒ¼ã‚¿æœŸé–“ï¼ˆ1å¹´é–“ãƒ•ãƒ«ï¼‰
  since: "2024-01-01T00:00:00Z"
  limit: 8760  # 1å¹´åˆ†ï¼ˆ365æ—¥ Ã— 24æ™‚é–“ï¼‰
  
  # APIè¨­å®šã¯ç„¡åŠ¹åŒ–
  api_key: null
  api_secret: null
  ccxt_options: {}

# ----------------------------------------------------------------------
# æˆ¦ç•¥è¨­å®šï¼ˆ99.2%ç²¾åº¦ãƒ¢ãƒ‡ãƒ«å¯¾å¿œï¼‰
# ----------------------------------------------------------------------
strategy:
  type: single
  name: ml
  params:
    model_path: models/production/robust_profitable_model.pkl  # æ–°ã—ã„é«˜ç²¾åº¦ãƒ¢ãƒ‡ãƒ«
    threshold: 0.5  # ãƒã‚¤ãƒŠãƒªåˆ†é¡ç”¨é–¾å€¤
    
    # å‹•çš„é–¾å€¤èª¿æ•´ï¼ˆåˆ©ç›Šæœ€é©åŒ–ï¼‰
    atr_multiplier: 0.3
    volatility_adjustment: true
    threshold_bounds: [0.3, 0.7]
    
    thresholds_to_test:
      - 0.3
      - 0.4
      - 0.5
      - 0.6
      - 0.7

# ----------------------------------------------------------------------
# ãƒªã‚¹ã‚¯ç®¡ç†ï¼ˆåˆ©ç›Šæœ€é©åŒ–ï¼‰
# ----------------------------------------------------------------------
risk:
  risk_per_trade: 0.02   # 2%ãƒªã‚¹ã‚¯
  stop_atr_mult: 2.0     # ã‚¹ãƒˆãƒƒãƒ—ãƒ­ã‚¹
  dynamic_position_sizing:
    enabled: true
    formula: linear
  
  # KellyåŸºæº–
  kelly_criterion:
    enabled: true
    lookback_window: 50
    max_fraction: 0.25
    min_trades_required: 10

# ----------------------------------------------------------------------
# ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆè¨­å®šï¼ˆåˆ©ç›Šæ¤œè¨¼ï¼‰
# ----------------------------------------------------------------------
backtest:
  starting_balance: 10000.0   # 1ä¸‡å††
  slippage_rate: 0.001        
  commission_rate: 0.0005     
  trade_log_csv: "./results/robust_model_trade_log.csv"
  aggregate_out_prefix: "./results/robust_model_backtest"

# ----------------------------------------------------------------------
# ã‚¦ã‚©ãƒ¼ã‚¯ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰åˆ†å‰²
# ----------------------------------------------------------------------
walk_forward:
  train_window: 720      # 30æ—¥é–“å­¦ç¿’
  test_window: 168       # 1é€±é–“ãƒ†ã‚¹ãƒˆ
  step: 24               # 1æ—¥é–“éš”

# ----------------------------------------------------------------------
# æ©Ÿæ¢°å­¦ç¿’ï¼ˆ30é¸æŠç‰¹å¾´é‡å¯¾å¿œï¼‰
# ----------------------------------------------------------------------
ml:
  feat_period: 14
  lags: [1,2,3,4,5]  # è»½é‡åŒ–
  rolling_window: 20
  horizon: 5
  target_type: classification
  model_type: lgbm

  # é¸æŠã•ã‚ŒãŸ30ç‰¹å¾´é‡ï¼ˆrobust_model_features.jsonã‹ã‚‰ï¼‰
  extra_features:
    # åŸºæœ¬ãƒªã‚¿ãƒ¼ãƒ³ãƒ»ä¾¡æ ¼ç‰¹å¾´é‡
    - returns_2
    - returns_3
    - returns_5
    - returns_10
    - log_returns_2
    - log_returns_3
    - log_returns_5
    - log_returns_10
    - price_position_20
    - price_position_50
    - price_vs_sma20
    
    # RSIãƒ»ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™
    - rsi_14
    - rsi_7
    - rsi_21
    
    # ã‚¹ãƒˆã‚­ãƒ£ã‚¹ãƒ†ã‚£ã‚¯ã‚¹
    - stoch_k
    - stoch_d
    - stoch_oversold
    - stoch_overbought
    
    # ãã®ä»–é‡è¦æŒ‡æ¨™
    - mfi
    - trend_direction
    - cci_20
    - williams_r
    - ultimate_oscillator
    - support_distance
    - resistance_distance
    - support_strength
    - zscore
    - mean_reversion_20
    - mean_reversion_50
    - roc_10

  # ãƒ¢ãƒ‡ãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆLightGBMæœ€é©åŒ–ï¼‰
  model_params:
    objective: binary
    metric: binary_logloss
    boosting_type: gbdt
    num_leaves: 31
    learning_rate: 0.1
    feature_fraction: 0.8
    bagging_fraction: 0.8
    bagging_freq: 5
    min_child_samples: 20
    random_state: 42

# ----------------------------------------------------------------------
# ç›£è¦–ãƒ»ãƒ¬ãƒãƒ¼ãƒˆè¨­å®š
# ----------------------------------------------------------------------
monitoring:
  enabled: true
  check_interval: 300
  
  metrics:
    - total_return
    - sharpe_ratio
    - max_drawdown
    - win_rate
    - profit_factor
    - calmar_ratio

# ----------------------------------------------------------------------
# ğŸ¯ æœŸå¾…åŠ¹æœ: -Â¥35,964æå¤± â†’ æ­£ã®P&Lé”æˆ
# ----------------------------------------------------------------------
# ã“ã®99.2%ç²¾åº¦ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹æ”¹å–„ç›®æ¨™:
# 
# ğŸ“ˆ ç²¾åº¦æ”¹å–„åŠ¹æœ:
# - å­¦ç¿’ç²¾åº¦: 99.2%
# - F1ã‚¹ã‚³ã‚¢: 99.2%
# - 2ã‚¯ãƒ©ã‚¹åˆ†é¡ï¼ˆBUY/SELLï¼‰æ˜ç¢ºåŒ–
# - 30é¸æŠç‰¹å¾´é‡ã«ã‚ˆã‚‹åŠ¹ç‡åŒ–
# 
# ğŸ’° åç›Šæ”¹å–„æœŸå¾…:
# - ç¾çŠ¶: -Â¥35,964æå¤±
# - ç›®æ¨™: æ­£ã®P&Lé”æˆ
# - å‹ç‡æ”¹å–„: 0% â†’ 50%ä»¥ä¸Š
# - å–å¼•ç²¾åº¦å‘ä¸Šã«ã‚ˆã‚‹æå¤±å‰Šæ¸›
# ----------------------------------------------------------------------