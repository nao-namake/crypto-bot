# models/training/ - æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«å­¦ç¿’ãƒ»ç®¡ç†ï¼ˆPhase 49å®Œäº†æ™‚ç‚¹ï¼‰

## ğŸ¯ å½¹å‰²ãƒ»è²¬ä»»

å€‹åˆ¥ã®æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã®å­¦ç¿’ã€æ¤œè¨¼ã€ç®¡ç†ã‚’æ‹…å½“ã—ã¾ã™ã€‚LightGBMã€XGBoostã€RandomForestã®3ã¤ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’å€‹åˆ¥ã«å­¦ç¿’ãƒ»æœ€é©åŒ–ã—ã€55ç‰¹å¾´é‡Strategy-Aware MLãƒ»é€±æ¬¡è‡ªå‹•å­¦ç¿’ã«ã‚ˆã‚‹æœ¬ç•ªç’°å¢ƒã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ãƒ¢ãƒ‡ãƒ«ã®æ§‹æˆè¦ç´ ã‚’æä¾›ã—ã¾ã™ã€‚

## ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆï¼ˆPhase 49å®Œäº†ç‰ˆï¼‰

```
models/training/
â”œâ”€â”€ README.md                    # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆPhase 49å®Œäº†ç‰ˆï¼‰
â”œâ”€â”€ lightgbm_model.pkl          # LightGBMå€‹åˆ¥å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ï¼ˆ45KBï¼‰
â”œâ”€â”€ xgboost_model.pkl           # XGBoostå€‹åˆ¥å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ï¼ˆ371KBï¼‰
â”œâ”€â”€ random_forest_model.pkl     # RandomForestå€‹åˆ¥å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ï¼ˆ1.0MBï¼‰
â””â”€â”€ training_metadata.json      # å­¦ç¿’çµæœã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆ2.5KBï¼‰
```

## ğŸ“‹ ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ•ã‚©ãƒ«ãƒ€ã®å½¹å‰²

### **lightgbm_model.pkl**ï¼ˆPhase 49å®Œäº†ï¼‰
LightGBMã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§å­¦ç¿’ã•ã‚ŒãŸå€‹åˆ¥ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚
- é«˜é€Ÿãªäºˆæ¸¬å‡¦ç†ã¨åŠ¹ç‡çš„ãªãƒ¡ãƒ¢ãƒªä½¿ç”¨ãŒç‰¹å¾´
- å‹¾é…ãƒ–ãƒ¼ã‚¹ãƒ†ã‚£ãƒ³ã‚°æ‰‹æ³•ã«ã‚ˆã‚‹é«˜ç²¾åº¦äºˆæ¸¬
- ç´„45KBã®ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãªãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼ˆPhase 49æ™‚ç‚¹ï¼‰
- ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ãƒ¢ãƒ‡ãƒ«ã§ã®40%é‡ã¿ä»˜ã‘
- GCPç’°å¢ƒã§ã®1Giåˆ¶ç´„ã«é©åˆã—ãŸè»½é‡è¨­è¨ˆ

### **xgboost_model.pkl**ï¼ˆPhase 49å®Œäº†ï¼‰
XGBoostã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§å­¦ç¿’ã•ã‚ŒãŸå€‹åˆ¥ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚
- é«˜ç²¾åº¦äºˆæ¸¬ã‚’é‡è¦–ã—ãŸã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è¨­è¨ˆ
- éå­¦ç¿’é˜²æ­¢æ©Ÿèƒ½ã¨å®‰å®šã—ãŸæ€§èƒ½
- ç´„371KBã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼ˆPhase 49æ™‚ç‚¹ï¼‰
- ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ãƒ¢ãƒ‡ãƒ«ã§ã®40%é‡ã¿ä»˜ã‘
- é‡‘èæ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã«æœ€é©åŒ–ã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

### **random_forest_model.pkl**ï¼ˆPhase 49å®Œäº†ï¼‰
RandomForestã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§å­¦ç¿’ã•ã‚ŒãŸå€‹åˆ¥ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚
- ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«å­¦ç¿’ã«ã‚ˆã‚‹å®‰å®šæ€§ã¨è§£é‡ˆæ€§
- éå­¦ç¿’ã«å¯¾ã™ã‚‹é«˜ã„è€æ€§
- ç´„1.0MBã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼ˆPhase 49æ™‚ç‚¹ï¼‰
- ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ãƒ¢ãƒ‡ãƒ«ã§ã®20%é‡ã¿ä»˜ã‘
- åŸºç›¤çš„ãªå®‰å®šæ€§ã‚’æä¾›ã™ã‚‹å½¹å‰²

### **training_metadata.json**ï¼ˆPhase 49å®Œäº†ï¼‰
å­¦ç¿’çµæœã®è©³ç´°æƒ…å ±ã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚
- å„ãƒ¢ãƒ‡ãƒ«ã®æ€§èƒ½æŒ‡æ¨™ï¼ˆF1ã‚¹ã‚³ã‚¢ã€ç²¾åº¦ã€å†ç¾ç‡ãªã©ï¼‰
- **55ç‰¹å¾´é‡å®šç¾©**: 50åŸºæœ¬ç‰¹å¾´é‡ + 5æˆ¦ç•¥ä¿¡å·ç‰¹å¾´é‡ï¼ˆPhase 41.8å®Ÿè£…ï¼‰
- äº¤å·®æ¤œè¨¼çµæœã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹æ³•ï¼ˆTimeSeriesSplit n_splits=5ï¼‰
- å­¦ç¿’å®Ÿè¡Œæ—¥æ™‚ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±
- Gitæƒ…å ±ã¨ãƒ¢ãƒ‡ãƒ«ãƒãƒƒã‚·ãƒ¥
- Phase 40ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–çµæœï¼ˆ79ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
- å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã®ã‚µãƒ³ãƒ—ãƒ«æ•°ã¨æœŸé–“
- æ¬¡å›å­¦ç¿’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æƒ…å ±

## ğŸ“ ä½¿ç”¨æ–¹æ³•ãƒ»ä¾‹

### **ãƒ¢ãƒ‡ãƒ«å­¦ç¿’ãƒ»ç®¡ç†ã®åŸºæœ¬æ“ä½œ**
```bash
# Phase 39å®Œäº†ç‰ˆMLãƒ¢ãƒ‡ãƒ«å­¦ç¿’
python3 scripts/ml/create_ml_models.py

# è©³ç´°å­¦ç¿’ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œï¼ˆPhase 39å¯¾å¿œï¼‰
python3 scripts/ml/create_ml_models.py --verbose --days 365

# Phase 39.5: Optunaãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–å®Ÿè¡Œ
python3 scripts/ml/create_ml_models.py --optimize --n-trials 50

# å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆPhase 39å®Œäº†ç‰ˆï¼‰
bash scripts/testing/checks.sh

# è‡ªå‹•å­¦ç¿’ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ç¢ºèª
gh run list --workflow=weekly-retrain.yml --limit 5
```

### **å€‹åˆ¥ãƒ¢ãƒ‡ãƒ«æ€§èƒ½ç¢ºèª**
```python
import json
import pickle

# ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æ€§èƒ½æŒ‡æ¨™ç¢ºèª
with open('models/training/training_metadata.json', 'r') as f:
    metadata = json.load(f)

print("=== å€‹åˆ¥ãƒ¢ãƒ‡ãƒ«æ€§èƒ½ ===")
for model_name, metrics in metadata['model_metrics'].items():
    print(f"{model_name}:")
    print(f"  F1ã‚¹ã‚³ã‚¢: {metrics['f1_score']:.3f}")
    print(f"  ç²¾åº¦: {metrics['accuracy']:.3f}")
    print(f"  é©åˆç‡: {metrics['precision']:.3f}")
    print(f"  å†ç¾ç‡: {metrics['recall']:.3f}")
    print()

print(f"å­¦ç¿’ã‚µãƒ³ãƒ—ãƒ«æ•°: {metadata['training_samples']}")
print(f"æœ€çµ‚å­¦ç¿’æ—¥æ™‚: {metadata['training_info']['last_retrain']}")
```

### **å€‹åˆ¥ãƒ¢ãƒ‡ãƒ«ã§ã®äºˆæ¸¬ãƒ†ã‚¹ãƒˆ**
```python
from src.features.feature_manager import FeatureManager
import numpy as np

# ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
feature_manager = FeatureManager()

# å€‹åˆ¥ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿
models = {}
model_names = ['lightgbm', 'xgboost', 'random_forest']

for model_name in model_names:
    with open(f'models/training/{model_name}_model.pkl', 'rb') as f:
        models[model_name] = pickle.load(f)

# äºˆæ¸¬ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
def test_individual_models():
    # ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿéš›ã¯å¸‚å ´ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ï¼‰
    sample_data = generate_sample_market_data()
    features = feature_manager.generate_features(sample_data)
    
    print("=== å€‹åˆ¥ãƒ¢ãƒ‡ãƒ«äºˆæ¸¬ãƒ†ã‚¹ãƒˆ ===")
    for model_name, model in models.items():
        prediction = model.predict(features)
        probabilities = model.predict_proba(features)
        print(f"{model_name}: äºˆæ¸¬={prediction[0]}, ç¢ºç‡={probabilities[0][1]:.3f}")

test_individual_models()
```

### **ãƒ¢ãƒ‡ãƒ«å“è³ªç›£è¦–**
```python
def check_model_quality():
    """ãƒ¢ãƒ‡ãƒ«å“è³ªã®ç›£è¦–ã¨è­¦å‘Š"""
    with open('models/training/training_metadata.json', 'r') as f:
        metadata = json.load(f)
    
    quality_threshold = 0.6
    quality_issues = []
    
    for model_name, metrics in metadata['model_metrics'].items():
        f1_score = metrics['f1_score']
        if f1_score < quality_threshold:
            quality_issues.append(f"{model_name}: F1={f1_score:.3f} < {quality_threshold}")
    
    if quality_issues:
        print("âš ï¸ ãƒ¢ãƒ‡ãƒ«å“è³ªåŠ£åŒ–æ¤œçŸ¥:")
        for issue in quality_issues:
            print(f"  - {issue}")
        print("å†å­¦ç¿’ã¾ãŸã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´ã‚’æ¨å¥¨")
    else:
        print("âœ… å…¨ãƒ¢ãƒ‡ãƒ«ãŒå“è³ªåŸºæº–ã‚’ã‚¯ãƒªã‚¢")

check_model_quality()
```

## âš ï¸ æ³¨æ„äº‹é …ãƒ»åˆ¶ç´„

### **å­¦ç¿’ãƒ—ãƒ­ã‚»ã‚¹è¦ä»¶**ï¼ˆPhase 39å®Œäº†ï¼‰
- **ç‰¹å¾´é‡çµ±ä¸€ç®¡ç†**: feature_managerã‚·ã‚¹ãƒ†ãƒ ã¨ã®çµ±åˆãŒå¿…é ˆ
- **å®Ÿãƒ‡ãƒ¼ã‚¿å­¦ç¿’**ï¼ˆPhase 39.1ï¼‰: CSVå®Ÿãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ»éå»180æ—¥åˆ†15åˆ†è¶³ãƒ‡ãƒ¼ã‚¿ï¼ˆ17,271ä»¶ï¼‰
- **3ã‚¯ãƒ©ã‚¹åˆ†é¡**ï¼ˆPhase 39.2ï¼‰: BUY/HOLD/SELLåˆ†é¡ãƒ»é–¾å€¤0.5%ï¼ˆãƒã‚¤ã‚ºå‰Šæ¸›æœ€é©åŒ–ï¼‰
- **TimeSeriesSplit**ï¼ˆPhase 39.3ï¼‰: n_splits=5ã«ã‚ˆã‚‹é‡‘èæ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã«é©ã—ãŸCV
- **Early Stopping**ï¼ˆPhase 39.3ï¼‰: rounds=20ã§éå­¦ç¿’é˜²æ­¢ãƒ»LightGBM/XGBoostå¯¾å¿œ
- **Train/Val/Teståˆ†å‰²**ï¼ˆPhase 39.3ï¼‰: 70/15/15æ¯”ç‡ãƒ»å³æ ¼ãªè©•ä¾¡ä½“ç³»
- **å“è³ªåŸºæº–**: F1ã‚¹ã‚³ã‚¢0.6ä»¥ä¸Šã‚’ç¶­æŒã™ã‚‹å¿…è¦æ€§
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: Gitæƒ…å ±ã¨ãƒ¢ãƒ‡ãƒ«ãƒãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹å³å¯†ãªç®¡ç†

### **ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹åˆ¶ç´„**
- **è¨ˆç®—ãƒªã‚½ãƒ¼ã‚¹**: GCP 1Giãƒ»1CPUã®åˆ¶ç´„ä¸‹ã§ã®å­¦ç¿’æœ€é©åŒ–
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: å­¦ç¿’æ™‚ã®å¤§å®¹é‡ãƒ¡ãƒ¢ãƒªä½¿ç”¨ã«æ³¨æ„
- **ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º**: RandomForestãŒæœ€å¤§ï¼ˆ4.3MBï¼‰ã€é©åˆ‡ãªå®¹é‡ç®¡ç†ãŒå¿…è¦
- **å­¦ç¿’æ™‚é–“**: è‡ªå‹•å­¦ç¿’ã¯45åˆ†ä»¥å†…ã§ã®å®Œäº†ãŒç›®æ¨™

### **å“è³ªä¿è¨¼è¦ä»¶**ï¼ˆPhase 39å®Œäº†ï¼‰
- **ç¶™ç¶šç›£è¦–**: å®šæœŸçš„ãªæ€§èƒ½è©•ä¾¡ã¨å“è³ªãƒã‚§ãƒƒã‚¯
- **ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯é˜²æ­¢**: TimeSeriesSplit n_splits=5ã«ã‚ˆã‚‹é©åˆ‡ãªåˆ†å‰²
- **éå­¦ç¿’å¯¾ç­–**ï¼ˆPhase 39.3ï¼‰: Early Stopping rounds=20ãƒ»æ­£å‰‡åŒ–ã«ã‚ˆã‚‹æ±åŒ–æ€§èƒ½ç¢ºä¿
- **ã‚¯ãƒ©ã‚¹ä¸å‡è¡¡å¯¾å¿œ**ï¼ˆPhase 39.4ï¼‰: SMOTE + class_weight='balanced'
- **ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–**ï¼ˆPhase 39.5ï¼‰: Optuna TPESamplerã«ã‚ˆã‚‹è‡ªå‹•æœ€é©åŒ–
- **ãƒ†ã‚¹ãƒˆçµ±åˆ**: å˜ä½“ãƒ†ã‚¹ãƒˆã¨çµ±åˆãƒ†ã‚¹ãƒˆã®å®Œå‚™

## ğŸ”— é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ä¾å­˜é–¢ä¿‚

### **æ©Ÿæ¢°å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ **
- `src/features/feature_manager.py`: ç‰¹å¾´é‡ç”Ÿæˆãƒ»ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
- `src/ml/ensemble.py`: ProductionEnsembleæ§‹ç¯‰ï¼ˆã“ã‚Œã‚‰ã®ãƒ¢ãƒ‡ãƒ«ã‚’çµ±åˆï¼‰
- `scripts/ml/create_ml_models.py`: ãƒ¢ãƒ‡ãƒ«å­¦ç¿’ãƒ»ä½œæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

### **ãƒ¢ãƒ‡ãƒ«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ **
- `models/production/`: æœ¬ç•ªç”¨ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ãƒ¢ãƒ‡ãƒ«ï¼ˆçµ±åˆå…ˆï¼‰
- `models/archive/`: éå»ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¿å­˜ãƒ»å±¥æ­´ç®¡ç†
- `scripts/testing/checks.sh`: å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆPhase 39å®Œäº†ç‰ˆï¼‰
- `scripts/ml/create_ml_models.py`: ãƒ¢ãƒ‡ãƒ«å­¦ç¿’ãƒ»ä½œæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

### **è¨­å®šãƒ»å“è³ªä¿è¨¼**
- `config/core/unified.yaml`: çµ±ä¸€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå­¦ç¿’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ»ã‚·ã‚¹ãƒ†ãƒ è¨­å®šãƒ»å…¨ç’°å¢ƒå¯¾å¿œï¼‰
- `config/core/thresholds.yaml`: æ€§èƒ½é–¾å€¤ãƒ»å“è³ªåŸºæº–è¨­å®š
- `tests/unit/ml/`: æ©Ÿæ¢°å­¦ç¿’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ

### **CI/CDã‚·ã‚¹ãƒ†ãƒ **
- `.github/workflows/`: è‡ªå‹•å­¦ç¿’ãƒ»å“è³ªãƒã‚§ãƒƒã‚¯ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
- é€±æ¬¡è‡ªå‹•å†å­¦ç¿’ã«ã‚ˆã‚‹ç¶™ç¶šçš„ãƒ¢ãƒ‡ãƒ«æ›´æ–°
- å“è³ªã‚²ãƒ¼ãƒˆã«ã‚ˆã‚‹è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤åˆ¶å¾¡

### **å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¾å­˜**
- **scikit-learn**: æ©Ÿæ¢°å­¦ç¿’ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãƒ»äº¤å·®æ¤œè¨¼
- **LightGBM, XGBoost**: å‹¾é…ãƒ–ãƒ¼ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- **imbalanced-learn**ï¼ˆPhase 39.4ï¼‰: SMOTE oversamplingã«ã‚ˆã‚‹ã‚¯ãƒ©ã‚¹ä¸å‡è¡¡å¯¾å¿œ
- **optuna**ï¼ˆPhase 39.5ï¼‰: TPESamplerãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–
- **pandas, numpy**: ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ»ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°
- **joblib, pickle**: ãƒ¢ãƒ‡ãƒ«ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ä¸¦åˆ—å‡¦ç†