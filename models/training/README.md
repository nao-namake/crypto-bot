# models/training/ - æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«å­¦ç¿’ãƒ»ç®¡ç†

**Phase 52.4**

**æœ€çµ‚æ›´æ–°**: 2025å¹´11æœˆ15æ—¥

## ğŸ¯ å½¹å‰²ãƒ»è²¬ä»»

å€‹åˆ¥ã®æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã®å­¦ç¿’ã€æ¤œè¨¼ã€ç®¡ç†ã‚’æ‹…å½“ã—ã¾ã™ã€‚LightGBMã€XGBoostã€RandomForestã®3ã¤ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’å€‹åˆ¥ã«å­¦ç¿’ãƒ»æœ€é©åŒ–ã—ã€Strategy-Aware MLãƒ»é€±æ¬¡è‡ªå‹•å­¦ç¿’ã«ã‚ˆã‚‹æœ¬ç•ªç’°å¢ƒã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ãƒ¢ãƒ‡ãƒ«ã®æ§‹æˆè¦ç´ ã‚’æä¾›ã—ã¾ã™ã€‚

## ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
models/training/
â”œâ”€â”€ README.md                    # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ lightgbm_model.pkl          # LightGBMå€‹åˆ¥å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ï¼ˆè¨“ç·´æ™‚è‡ªå‹•ç”Ÿæˆï¼‰
â”œâ”€â”€ xgboost_model.pkl           # XGBoostå€‹åˆ¥å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ï¼ˆè¨“ç·´æ™‚è‡ªå‹•ç”Ÿæˆï¼‰
â”œâ”€â”€ random_forest_model.pkl     # RandomForestå€‹åˆ¥å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ï¼ˆè¨“ç·´æ™‚è‡ªå‹•ç”Ÿæˆï¼‰
â””â”€â”€ training_metadata.json      # å­¦ç¿’çµæœã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆè¨“ç·´æ™‚è‡ªå‹•ç”Ÿæˆï¼‰
```

**æ³¨**: ç‰¹å¾´é‡æ•°ãƒ»æˆ¦ç•¥æ•°ã¯`config/core/feature_order.json`ãƒ»`config/core/strategies.yaml`ã‚’å‚ç…§

## ğŸ“‹ ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ•ã‚©ãƒ«ãƒ€ã®å½¹å‰²

### **lightgbm_model.pkl**
LightGBMã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§å­¦ç¿’ã•ã‚ŒãŸå€‹åˆ¥ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚
- é«˜é€Ÿãªäºˆæ¸¬å‡¦ç†ã¨åŠ¹ç‡çš„ãªãƒ¡ãƒ¢ãƒªä½¿ç”¨ãŒç‰¹å¾´
- å‹¾é…ãƒ–ãƒ¼ã‚¹ãƒ†ã‚£ãƒ³ã‚°æ‰‹æ³•ã«ã‚ˆã‚‹é«˜ç²¾åº¦äºˆæ¸¬
- ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ãƒ¢ãƒ‡ãƒ«ã§ã®40%é‡ã¿ä»˜ã‘
- è¨“ç·´æ™‚è‡ªå‹•ç”Ÿæˆï¼ˆ`scripts/ml/create_ml_models.py`ï¼‰

### **xgboost_model.pkl**
XGBoostã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§å­¦ç¿’ã•ã‚ŒãŸå€‹åˆ¥ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚
- é«˜ç²¾åº¦äºˆæ¸¬ã‚’é‡è¦–ã—ãŸã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è¨­è¨ˆ
- éå­¦ç¿’é˜²æ­¢æ©Ÿèƒ½ã¨å®‰å®šã—ãŸæ€§èƒ½
- ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ãƒ¢ãƒ‡ãƒ«ã§ã®40%é‡ã¿ä»˜ã‘
- é‡‘èæ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã«æœ€é©åŒ–ã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

### **random_forest_model.pkl**
RandomForestã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§å­¦ç¿’ã•ã‚ŒãŸå€‹åˆ¥ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚
- ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«å­¦ç¿’ã«ã‚ˆã‚‹å®‰å®šæ€§ã¨è§£é‡ˆæ€§
- éå­¦ç¿’ã«å¯¾ã™ã‚‹é«˜ã„è€æ€§
- ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ãƒ¢ãƒ‡ãƒ«ã§ã®20%é‡ã¿ä»˜ã‘
- åŸºç›¤çš„ãªå®‰å®šæ€§ã‚’æä¾›ã™ã‚‹å½¹å‰²

### **training_metadata.json**
å­¦ç¿’çµæœã®è©³ç´°æƒ…å ±ã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚
- å„ãƒ¢ãƒ‡ãƒ«ã®æ€§èƒ½æŒ‡æ¨™ï¼ˆF1ã‚¹ã‚³ã‚¢ã€ç²¾åº¦ã€å†ç¾ç‡ãªã©ï¼‰
- ç‰¹å¾´é‡å®šç¾©ï¼ˆfeature_order.jsonã¨åŒæœŸï¼‰
- äº¤å·®æ¤œè¨¼çµæœã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹æ³•ï¼ˆTimeSeriesSplit n_splits=5ï¼‰
- å­¦ç¿’å®Ÿè¡Œæ—¥æ™‚ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±
- Gitæƒ…å ±ã¨ãƒ¢ãƒ‡ãƒ«ãƒãƒƒã‚·ãƒ¥
- Optunaãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–çµæœï¼ˆ`thresholds.yaml:optuna_optimized`å‚ç…§ï¼‰
- å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã®ã‚µãƒ³ãƒ—ãƒ«æ•°ã¨æœŸé–“
- æ¬¡å›å­¦ç¿’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æƒ…å ±

## ğŸ“ ä½¿ç”¨æ–¹æ³•ãƒ»ä¾‹

### **ãƒ¢ãƒ‡ãƒ«å­¦ç¿’ãƒ»ç®¡ç†ã®åŸºæœ¬æ“ä½œ**
```bash
# æ¨™æº–ã‚³ãƒãƒ³ãƒ‰ï¼ˆFull + Basicä¸¡æ–¹ç”Ÿæˆï¼‰
python3 scripts/ml/create_ml_models.py \
  --n-classes 3 \
  --threshold 0.005 \
  --optimize \
  --n-trials 50

# è©³ç´°ãƒ­ã‚°å‡ºåŠ›
python3 scripts/ml/create_ml_models.py --verbose

# å“è³ªãƒã‚§ãƒƒã‚¯
bash scripts/testing/checks.sh

# è‡ªå‹•å­¦ç¿’ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ç¢ºèª
gh run list --workflow=model-training.yml --limit 5
```

### **å€‹åˆ¥ãƒ¢ãƒ‡ãƒ«æ€§èƒ½ç¢ºèª**
```python
import json

# ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æ€§èƒ½æŒ‡æ¨™ç¢ºèª
with open('models/training/training_metadata.json', 'r') as f:
    metadata = json.load(f)

print("=== å€‹åˆ¥ãƒ¢ãƒ‡ãƒ«æ€§èƒ½ ===")
for model_name, metrics in metadata.get('model_metrics', {}).items():
    print(f"{model_name}:")
    print(f"  F1ã‚¹ã‚³ã‚¢: {metrics.get('f1_score', 'N/A'):.3f}")
    print(f"  ç²¾åº¦: {metrics.get('accuracy', 'N/A'):.3f}")
    print(f"  é©åˆç‡: {metrics.get('precision', 'N/A'):.3f}")
    print(f"  å†ç¾ç‡: {metrics.get('recall', 'N/A'):.3f}")
    print()

print(f"ç‰¹å¾´é‡æ•°: {len(metadata.get('feature_names', []))}")
print(f"æœ€çµ‚å­¦ç¿’æ—¥æ™‚: {metadata.get('created_at', 'N/A')}")
```

### **å€‹åˆ¥ãƒ¢ãƒ‡ãƒ«ã§ã®äºˆæ¸¬ãƒ†ã‚¹ãƒˆ**
```python
from src.features.feature_manager import FeatureManager
import pickle

# ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
feature_manager = FeatureManager()

# å€‹åˆ¥ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿
models = {}
model_names = ['lightgbm', 'xgboost', 'random_forest']

for model_name in model_names:
    with open(f'models/training/{model_name}_model.pkl', 'rb') as f:
        models[model_name] = pickle.load(f)

# äºˆæ¸¬ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
def test_individual_models(market_data):
    features = feature_manager.generate_features(market_data)

    print("=== å€‹åˆ¥ãƒ¢ãƒ‡ãƒ«äºˆæ¸¬ãƒ†ã‚¹ãƒˆ ===")
    for model_name, model in models.items():
        prediction = model.predict(features)
        probabilities = model.predict_proba(features)
        print(f"{model_name}: äºˆæ¸¬={prediction[0]}, ç¢ºç‡={probabilities[0][1]:.3f}")

# test_individual_models(your_market_data)
```

## âš ï¸ æ³¨æ„äº‹é …ãƒ»åˆ¶ç´„

### **å­¦ç¿’ãƒ—ãƒ­ã‚»ã‚¹è¦ä»¶**
- **ç‰¹å¾´é‡çµ±ä¸€ç®¡ç†**: feature_managerã‚·ã‚¹ãƒ†ãƒ ã¨ã®çµ±åˆãŒå¿…é ˆ
- **å®Ÿãƒ‡ãƒ¼ã‚¿å­¦ç¿’**: CSVå®Ÿãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ»éå»ãƒ‡ãƒ¼ã‚¿15åˆ†è¶³
- **3ã‚¯ãƒ©ã‚¹åˆ†é¡**: BUY/HOLD/SELLåˆ†é¡ãƒ»é–¾å€¤Â±0.5%
- **TimeSeriesSplit**: n_splits=5ã«ã‚ˆã‚‹é‡‘èæ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã«é©ã—ãŸCV
- **Early Stopping**: rounds=20ã§éå­¦ç¿’é˜²æ­¢ãƒ»LightGBM/XGBoostå¯¾å¿œ
- **Train/Val/Teståˆ†å‰²**: 70/15/15æ¯”ç‡ãƒ»å³æ ¼ãªè©•ä¾¡ä½“ç³»
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: Gitæƒ…å ±ã¨ãƒ¢ãƒ‡ãƒ«ãƒãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹å³å¯†ãªç®¡ç†

### **å“è³ªä¿è¨¼è¦ä»¶**
- **ç¶™ç¶šç›£è¦–**: å®šæœŸçš„ãªæ€§èƒ½è©•ä¾¡ã¨å“è³ªãƒã‚§ãƒƒã‚¯
- **ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯é˜²æ­¢**: TimeSeriesSplit n_splits=5ã«ã‚ˆã‚‹é©åˆ‡ãªåˆ†å‰²
- **éå­¦ç¿’å¯¾ç­–**: Early Stopping rounds=20ãƒ»æ­£å‰‡åŒ–ã«ã‚ˆã‚‹æ±åŒ–æ€§èƒ½ç¢ºä¿
- **ã‚¯ãƒ©ã‚¹ä¸å‡è¡¡å¯¾å¿œ**: SMOTE + class_weight='balanced'
- **ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–**: Optuna TPESamplerã«ã‚ˆã‚‹è‡ªå‹•æœ€é©åŒ–ï¼ˆ`thresholds.yaml:optuna_optimized`å‚ç…§ï¼‰
- **ãƒ†ã‚¹ãƒˆçµ±åˆ**: å˜ä½“ãƒ†ã‚¹ãƒˆã¨çµ±åˆãƒ†ã‚¹ãƒˆã®å®Œå‚™

### **ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†è¦ä»¶**
- **è‡ªå‹•ç”Ÿæˆ**: å…¨ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã¯è¨“ç·´æ™‚è‡ªå‹•ç”Ÿæˆ
- **èª­ã¿å–ã‚Šå°‚ç”¨**: æœ¬ç•ªç’°å¢ƒã§ã¯åŸºæœ¬çš„ã«èª­ã¿å–ã‚Šå°‚ç”¨
- **é€±æ¬¡æ›´æ–°**: GitHub Actionsè‡ªå‹•å­¦ç¿’ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«ã‚ˆã‚‹å®šæœŸæ›´æ–°
- **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: models/archive/ãƒ•ã‚©ãƒ«ãƒ€ã¸è‡ªå‹•ä¿å­˜ï¼ˆ7æ—¥é–“ä¿æŒï¼‰

## ğŸ”— é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ä¾å­˜é–¢ä¿‚

### **æ©Ÿæ¢°å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ **
- `src/features/feature_manager.py`: ç‰¹å¾´é‡ç”Ÿæˆãƒ»ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
- `src/ml/ensemble.py`: ProductionEnsembleæ§‹ç¯‰ï¼ˆã“ã‚Œã‚‰ã®ãƒ¢ãƒ‡ãƒ«ã‚’çµ±åˆï¼‰
- `scripts/ml/create_ml_models.py`: ãƒ¢ãƒ‡ãƒ«å­¦ç¿’ãƒ»ä½œæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

### **ãƒ¢ãƒ‡ãƒ«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ **
- `models/production/`: æœ¬ç•ªç”¨ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ãƒ¢ãƒ‡ãƒ«ï¼ˆçµ±åˆå…ˆï¼‰
- `models/archive/`: éå»ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¿å­˜ãƒ»å±¥æ­´ç®¡ç†ï¼ˆ7æ—¥é–“ä¿æŒï¼‰
- `scripts/testing/checks.sh`: å“è³ªãƒã‚§ãƒƒã‚¯

### **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**
- `config/core/feature_order.json`: ç‰¹å¾´é‡å®šç¾©ï¼ˆSingle Source of Truthï¼‰
- `config/core/strategies.yaml`: æˆ¦ç•¥å®šç¾©ï¼ˆSingle Source of Truthï¼‰
- `config/core/unified.yaml`: çµ±ä¸€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
- `config/core/thresholds.yaml`: æ€§èƒ½é–¾å€¤ãƒ»Optunaæœ€é©åŒ–çµæœ

### **CI/CDã‚·ã‚¹ãƒ†ãƒ **
- `.github/workflows/model-training.yml`: è‡ªå‹•å­¦ç¿’ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆé€±æ¬¡å®Ÿè¡Œï¼‰
- é€±æ¬¡è‡ªå‹•å†å­¦ç¿’ã«ã‚ˆã‚‹ç¶™ç¶šçš„ãƒ¢ãƒ‡ãƒ«æ›´æ–°
- å“è³ªã‚²ãƒ¼ãƒˆã«ã‚ˆã‚‹è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤åˆ¶å¾¡

### **å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¾å­˜**
- **scikit-learn**: æ©Ÿæ¢°å­¦ç¿’ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãƒ»äº¤å·®æ¤œè¨¼
- **LightGBM, XGBoost**: å‹¾é…ãƒ–ãƒ¼ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- **imbalanced-learn**: SMOTE oversamplingã«ã‚ˆã‚‹ã‚¯ãƒ©ã‚¹ä¸å‡è¡¡å¯¾å¿œ
- **optuna**: TPESamplerãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–
- **pandas, numpy**: ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ»ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°
- **joblib, pickle**: ãƒ¢ãƒ‡ãƒ«ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ä¸¦åˆ—å‡¦ç†

---

**æœ€çµ‚æ›´æ–°**: Phase 52.4å®Œäº†ï¼ˆ2025å¹´11æœˆ15æ—¥ï¼‰
