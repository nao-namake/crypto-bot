# utils/ - ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ»å…±é€šæ©Ÿèƒ½

## ğŸ“‹ æ¦‚è¦

**Utility Functions & Common Features**  
æœ¬ãƒ•ã‚©ãƒ«ãƒ€ã¯ crypto-bot å…¨ä½“ã§ä½¿ç”¨ã•ã‚Œã‚‹å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£æ©Ÿèƒ½ã‚’æä¾›ã—ã€ã‚¨ãƒ©ãƒ¼å‡¦ç†ã€ãƒ­ã‚°ç®¡ç†ã€è¨­å®šæ¤œè¨¼ã€ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãªã©ã®æ¨ªæ–­çš„æ©Ÿèƒ½ã‚’æ‹…å½“ã—ã¾ã™ã€‚

## ğŸ¯ ä¸»è¦æ©Ÿèƒ½

### **ã‚¨ãƒ©ãƒ¼å‡¦ç†ãƒ»è€æ€§**
- ã‚¨ãƒ©ãƒ¼ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½
- ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼å®Ÿè£…
- åŒ…æ‹¬çš„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- è‡ªå‹•ãƒªã‚«ãƒãƒªæ©Ÿèƒ½

### **ãƒ­ã‚°ãƒ»çŠ¶æ…‹ç®¡ç†**
- çµ±ä¸€ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ 
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†
- é€²æ—è¿½è·¡
- ãƒ‡ãƒãƒƒã‚°æ”¯æ´

### **è¨­å®šãƒ»æ¤œè¨¼**
- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼
- ç’°å¢ƒå¤‰æ•°ç®¡ç†
- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¤œè¨¼
- å‹ãƒã‚§ãƒƒã‚¯

### **ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ»æœ€é©åŒ–**
- ãƒ‡ãƒ¼ã‚¿å¤‰æ›ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†
- HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæœ€é©åŒ–
- çµ±è¨ˆè¨ˆç®—

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
utils/
â”œâ”€â”€ __init__.py                      # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åˆæœŸåŒ–
â”œâ”€â”€ config.py                        # Phase 16.5-C: CLIé‡è¦ä¾å­˜è¨­å®šç®¡ç†
â”œâ”€â”€ init_enhanced.py                 # Phase 16.5-D: æ‹¡å¼µINITã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç®¡ç†
â”œâ”€â”€ error_resilience.py             # ã‚¨ãƒ©ãƒ¼è€æ€§ã‚·ã‚¹ãƒ†ãƒ 
â”œâ”€â”€ api_retry.py                    # APIãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½
â”œâ”€â”€ logger.py                       # ãƒ­ã‚°ç®¡ç†
â”œâ”€â”€ logging.py                      # ãƒ­ã‚°è¨­å®š
â”œâ”€â”€ status.py                       # ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†
â”œâ”€â”€ enhanced_status_manager.py      # æ‹¡å¼µã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†
â”œâ”€â”€ config_validator.py             # è¨­å®šæ¤œè¨¼
â”œâ”€â”€ config_state.py                 # è¨­å®šçŠ¶æ…‹ç®¡ç†
â”œâ”€â”€ data.py                         # ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ file.py                         # ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ
â”œâ”€â”€ model.py                        # ãƒ¢ãƒ‡ãƒ«é–¢é€£ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ chart.py                        # ãƒãƒ£ãƒ¼ãƒˆç”Ÿæˆ
â”œâ”€â”€ pre_computed_cache.py           # äº‹å‰è¨ˆç®—ã‚­ãƒ£ãƒƒã‚·ãƒ¥
â”œâ”€â”€ ensemble_confidence.py          # ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ä¿¡é ¼åº¦è¨ˆç®—
â”œâ”€â”€ http_client_optimizer.py        # HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæœ€é©åŒ–
â”œâ”€â”€ japanese_market.py              # æ—¥æœ¬å¸‚å ´ç‰¹æœ‰å‡¦ç†
â”œâ”€â”€ cloud_run_api_diagnostics.py    # Cloud Runè¨ºæ–­
â”œâ”€â”€ trading_integration_service.py  # å–å¼•çµ±åˆã‚µãƒ¼ãƒ“ã‚¹
â”œâ”€â”€ trading_statistics_manager.py   # å–å¼•çµ±è¨ˆç®¡ç†
â””â”€â”€ system/                         # ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ logging_system.py           # ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ç®¡ç†
    â””â”€â”€ status_manager.py            # ã‚·ã‚¹ãƒ†ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†
```

## ğŸ” å„ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²

### **error_resilience.py**
- `ErrorResilienceManager`ã‚¯ãƒ©ã‚¹ - ã‚¨ãƒ©ãƒ¼è€æ€§ç®¡ç†
- `CircuitBreaker`å®Ÿè£… - é€£ç¶šã‚¨ãƒ©ãƒ¼æ™‚ã®è‡ªå‹•é®æ–­
- ã‚¨ãƒ©ãƒ¼è¨˜éŒ²ãƒ»åˆ†æ
- è‡ªå‹•ãƒªã‚«ãƒãƒªæˆ¦ç•¥
- Phase H.8.3å®Ÿè£…

### **api_retry.py**
- `retry_with_backoff`ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ - æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•
- APIå‘¼ã³å‡ºã—ãƒªãƒˆãƒ©ã‚¤
- ã‚«ã‚¹ã‚¿ãƒ ãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥
- ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥åˆ¤å®š

### **logger.py / logging.py**
- çµ±ä¸€ãƒ­ã‚°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
- ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ç®¡ç†
- ãƒ•ã‚¡ã‚¤ãƒ«/ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›
- æ§‹é€ åŒ–ãƒ­ã‚°å¯¾å¿œ

### **config.pyï¼ˆPhase 16.5-Cç§»å‹•ï¼‰**
- `load_config()`é–¢æ•° - YAMLè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
- `deep_merge()`é–¢æ•° - è¨­å®šãƒ‡ãƒ¼ã‚¿çµ±åˆ
- **7å€‹CLIãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¾å­˜**: backtest/live/optimize/validateç­‰
- æ—§crypto_bot/config.pyã‹ã‚‰çµ±åˆé…ç½®ã§ç§»å‹•

### **init_enhanced.pyï¼ˆPhase 16.5-Dç§»å‹•ï¼‰**
- `enhanced_init_sequence()`é–¢æ•° - æ‹¡å¼µåˆæœŸåŒ–ã‚·ãƒ¼ã‚±ãƒ³ã‚¹
- `enhanced_init_5_fetch_price_data()`é–¢æ•° - INIT-5ã‚¹ãƒ†ãƒ¼ã‚¸å‡¦ç†
- **Phase 12.2åŒ…æ‹¬ä¿®æ­£**: éƒ¨åˆ†ãƒ‡ãƒ¼ã‚¿æ•‘æ¸ˆã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…
- æ—§crypto_bot/init_enhanced.pyã‹ã‚‰ç§»å‹•ï¼ˆ866è¡Œï¼‰

### **config_validator.py**
- `ConfigValidator`ã‚¯ãƒ©ã‚¹ - è¨­å®šæ¤œè¨¼
- ã‚¹ã‚­ãƒ¼ãƒãƒ™ãƒ¼ã‚¹æ¤œè¨¼
- å¿…é ˆé …ç›®ãƒã‚§ãƒƒã‚¯
- å€¤ç¯„å›²æ¤œè¨¼

### **pre_computed_cache.py**
- `PreComputedCache`ã‚¯ãƒ©ã‚¹ - äº‹å‰è¨ˆç®—çµæœã‚­ãƒ£ãƒƒã‚·ãƒ¥
- ãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„ãªä¿å­˜
- TTLç®¡ç†
- ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•å®Ÿè£…

### **trading_statistics_manager.py**
- `TradingStatisticsManager`ã‚¯ãƒ©ã‚¹ - å–å¼•çµ±è¨ˆ
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¨ˆç®—
- æœŸé–“åˆ¥é›†è¨ˆ
- ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

### **japanese_market.py**
- æ—¥æœ¬å¸‚å ´å–¶æ¥­æ™‚é–“åˆ¤å®š
- ç¥æ—¥ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼çµ±åˆ
- ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å‡¦ç†
- å¸‚å ´å›ºæœ‰ãƒ«ãƒ¼ãƒ«

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### **ã‚¨ãƒ©ãƒ¼è€æ€§å®Ÿè£…**
```python
from crypto_bot.utils.error_resilience import get_resilience_manager, with_resilience

# ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ä½¿ç”¨
@with_resilience(max_retries=3, backoff_factor=2)
def risky_api_call():
    return external_api.fetch_data()

# ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ç›´æ¥ä½¿ç”¨
resilience_mgr = get_resilience_manager()
circuit_breaker = resilience_mgr.get_circuit_breaker("api_service")
if circuit_breaker.is_open():
    # ã‚µãƒ¼ãƒ“ã‚¹ä¸€æ™‚åœæ­¢
    return cached_data
```

### **Phase 16.5-C,Dç§»å‹•æ©Ÿèƒ½ä½¿ç”¨ä¾‹**
```python
# CLIãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã®è¨­å®šèª­ã¿è¾¼ã¿ï¼ˆPhase 16.5-Cï¼‰
from crypto_bot.utils.config import load_config, deep_merge

# 7å€‹CLIãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ä½¿ç”¨ä¸­ï¼šbacktest/live/optimize/validateç­‰
cfg = load_config(config_path)
merged_cfg = deep_merge(base_config, user_config)

# æ‹¡å¼µåˆæœŸåŒ–å‡¦ç†ï¼ˆPhase 16.5-Dï¼‰
from crypto_bot.utils.init_enhanced import enhanced_init_5_fetch_price_data

# INIT-5ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã®ãƒ‡ãƒ¼ã‚¿å–å¾—å¼·åŒ–
result = enhanced_init_5_fetch_price_data(config, exchange)
```

### **è¨­å®šæ¤œè¨¼**
```python
from crypto_bot.utils.config_validator import ConfigValidator

validator = ConfigValidator()
errors = validator.validate_config(config_dict)
if errors:
    for error in errors:
        logger.error(f"Config error: {error}")
```

### **å–å¼•çµ±è¨ˆç®¡ç†**
```python
from crypto_bot.utils.trading_statistics_manager import TradingStatisticsManager

stats_mgr = TradingStatisticsManager()
stats_mgr.record_trade(trade_result)

# çµ±è¨ˆå–å¾—
daily_stats = stats_mgr.get_daily_statistics()
print(f"æœ¬æ—¥ã®å‹ç‡: {daily_stats['win_rate']:.2%}")
```

## âš ï¸ èª²é¡Œãƒ»æ”¹å–„ç‚¹

### **Phase 16.5-C,Dæ•´ç†åŠ¹æœ**
- **é‡è¦ä¾å­˜æ©Ÿèƒ½é›†ç´„**: config.pyï¼ˆ7å€‹CLIä¾å­˜ï¼‰ã¨init_enhanced.pyé›†ç´„
- **crypto_botç›´ä¸‹æ•´ç†**: æ©Ÿèƒ½åˆ¥é©åˆ‡é…ç½®ã§æ§‹é€ æœ€é©åŒ–å®Ÿç¾
- **importäº’æ›æ€§100%**: æ—¢å­˜CLIã‚³ãƒ¼ãƒ‰å½±éŸ¿ã‚¼ãƒ­ã§ç§»å‹•å®Œäº†
- **system/ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€å­˜åœ¨**: ã‚·ã‚¹ãƒ†ãƒ ãƒ¬ãƒ™ãƒ«æ©Ÿèƒ½ã®çµ„ç¹”åŒ–é€²å±•

### **é‡è¤‡æ©Ÿèƒ½**
- status.pyã¨enhanced_status_manager.pyã®çµ±åˆ
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥é–¢é€£æ©Ÿèƒ½ã®ä¸€å…ƒåŒ–
- ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®æ¨™æº–åŒ–

### **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸è¶³**
- å„ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ä½¿ç”¨ä¾‹
- ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚¬ã‚¤ãƒ‰
- ä¾å­˜é–¢ä¿‚å›³

### **ãƒ†ã‚¹ãƒˆä¸è¶³**
- ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸
- ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

## ğŸ“ ä»Šå¾Œã®å±•é–‹

1. **Phase 16.5æ•´ç†å®Œäº†å¾Œã®æ§‹é€ æœ€é©åŒ–**
   ```
   utils/
   â”œâ”€â”€ config.py ğŸ†•        # Phase 16.5-C: CLIé‡è¦ä¾å­˜
   â”œâ”€â”€ init_enhanced.py ğŸ†•   # Phase 16.5-D: INITå¼·åŒ–ç³»
   â”œâ”€â”€ error/             # ã‚¨ãƒ©ãƒ¼å‡¦ç†é–¢é€£çµ±åˆ
   â”œâ”€â”€ logging/           # ãƒ­ã‚°é–¢é€£çµ±åˆ
   â”œâ”€â”€ config/            # è¨­å®šé–¢é€£çµ±åˆï¼ˆconfig.pyé€£æºï¼‰
   â”œâ”€â”€ data/              # ãƒ‡ãƒ¼ã‚¿å‡¦ç†çµ±åˆ
   â”œâ”€â”€ trading/           # å–å¼•é–¢é€£çµ±åˆ
   â””â”€â”€ system/ âœ“          # ã‚·ã‚¹ãƒ†ãƒ é–¢é€£ï¼ˆæ—¢å­˜ï¼‰
   ```

2. **æ©Ÿèƒ½æ‹¡å¼µ**
   - ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ãƒ„ãƒ¼ãƒ«
   - ãƒ¡ãƒ¢ãƒªæœ€é©åŒ–ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
   - ä¸¦åˆ—å‡¦ç†ãƒ˜ãƒ«ãƒ‘ãƒ¼
   - ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚·ã‚¹ãƒ†ãƒ 

3. **æ¨™æº–åŒ–**
   - ã‚¨ãƒ©ãƒ¼å‡¦ç†ãƒ‘ã‚¿ãƒ¼ãƒ³çµ±ä¸€
   - ãƒ­ã‚°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¨™æº–åŒ–
   - è¨­å®šã‚¹ã‚­ãƒ¼ãƒå®šç¾©
   - å‹å®šç¾©å¼·åŒ–

4. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**
   - Cythonå®Ÿè£…
   - ãƒ¡ãƒ¢ãƒªãƒ—ãƒ¼ãƒ«
   - é…å»¶è©•ä¾¡
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–