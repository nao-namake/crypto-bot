# backtest - ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ 

## ğŸ¯ å½¹å‰²ãƒ»è²¬ä»»

æœ¬ç•ªç’°å¢ƒã«å½±éŸ¿ã‚’ä¸ãˆãšã«ç‹¬ç«‹ã—ãŸãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆç’°å¢ƒã§æˆ¦ç•¥ã®æ€§èƒ½è©•ä¾¡ãƒ»æ¤œè¨¼ã‚’æä¾›ã™ã‚‹ã€‚Phase 19 MLOpsçµ±åˆã«ã‚ˆã‚Šã€feature_manager 12ç‰¹å¾´é‡çµ±ä¸€ãƒ»ProductionEnsemble 3ãƒ¢ãƒ‡ãƒ«çµ±åˆãƒ»654ãƒ†ã‚¹ãƒˆå“è³ªä¿è¨¼ãƒ»é€±æ¬¡è‡ªå‹•å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ ã®ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆæ¤œè¨¼ã‚’å®Ÿç¾ã€‚

## ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
src/backtest/
â”œâ”€â”€ __init__.py             # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆæœŸåŒ–ãƒ»å…¬é–‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©
â”œâ”€â”€ engine.py               # BacktestEngine - ãƒ¡ã‚¤ãƒ³ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆ605è¡Œï¼‰
â”œâ”€â”€ evaluator.py            # BacktestEvaluator - æ€§èƒ½è©•ä¾¡ãƒ»çµ±è¨ˆåˆ†æï¼ˆ535è¡Œï¼‰
â”œâ”€â”€ reporter.py             # BacktestReporter - çµ±åˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆï¼ˆ916è¡Œï¼‰
â””â”€â”€ README.md               # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»Phase 19 MLOpsçµ±åˆå¯¾å¿œ
```

## ğŸ”§ ä¸»è¦æ©Ÿèƒ½ãƒ»å®Ÿè£…

### **engine.py - ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³**
- **ç‹¬ç«‹å®Ÿè¡Œç’°å¢ƒ** - æœ¬ç•ªè¨­å®šã«å½±éŸ¿ã—ãªã„å®Œå…¨åˆ†é›¢ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
- **æˆ¦ç•¥çµ±åˆå®Ÿè¡Œ** - 4æˆ¦ç•¥ï¼ˆATRBased/MochipoyAlert/MultiTimeframe/FibonacciRetracementï¼‰
- **ãƒªã‚¹ã‚¯ç®¡ç†çµ±åˆ** - KellyåŸºæº–ãƒ»ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚µã‚¤ã‚¸ãƒ³ã‚°ãƒ»ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³åˆ¶å¾¡
- **ãƒ‡ãƒ¼ã‚¿å“è³ªç®¡ç†** - è‡ªå‹•è£œå®Œãƒ»ç•°å¸¸å€¤é™¤å»ãƒ»æœ€å°ãƒ‡ãƒ¼ã‚¿ç‚¹æ•°ãƒã‚§ãƒƒã‚¯

### **evaluator.py - æ€§èƒ½è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ **
- **åŸºæœ¬æŒ‡æ¨™** - ç·å–å¼•æ•°ãƒ»å‹ç‡ãƒ»ç·æç›Šãƒ»ãƒªã‚¿ãƒ¼ãƒ³ç‡ãƒ»CAGR
- **ãƒªã‚¹ã‚¯æŒ‡æ¨™** - æœ€å¤§ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³ãƒ»ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ»ã‚·ãƒ£ãƒ¼ãƒ—ãƒ¬ã‚·ã‚ªãƒ»ã‚½ãƒ«ãƒ†ã‚£ãƒ¼ãƒæ¯”ç‡
- **å–å¼•åˆ†æ** - å¹³å‡å–å¼•æ™‚é–“ãƒ»æœ€å¤§é€£å‹/é€£æ•—ãƒ»æœˆæ¬¡ãƒªã‚¿ãƒ¼ãƒ³åˆ†æ
- **çµ±è¨ˆæ¤œå®š** - ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—ãƒ»ä¿¡é ¼åŒºé–“ãƒ»çµ±è¨ˆçš„æœ‰æ„æ€§æ¤œå®š

### **reporter.py - çµ±åˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ**
- **å¤šå½¢å¼å‡ºåŠ›** - CSVãƒ»JSONãƒ»HTMLãƒ»ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ»Discordé€šçŸ¥
- **å¯è¦–åŒ–ãƒ¬ãƒãƒ¼ãƒˆ** - ã‚¨ã‚¯ã‚¤ãƒ†ã‚£ã‚«ãƒ¼ãƒ–ãƒ»ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³ãƒãƒ£ãƒ¼ãƒˆãƒ»å–å¼•åˆ†å¸ƒ
- **æ¯”è¼ƒåˆ†æ** - è¤‡æ•°æˆ¦ç•¥æ¯”è¼ƒãƒ»æœŸé–“åˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»çµ±è¨ˆã‚µãƒãƒªãƒ¼
- **è‡ªå‹•ä¿å­˜** - logs/backtest_reports/é…ä¸‹ã«æ—¥æ™‚ä»˜ããƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜

## ğŸ“ ä½¿ç”¨æ–¹æ³•ãƒ»ä¾‹

### **åŸºæœ¬çš„ãªãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**
```python
import asyncio
from datetime import datetime, timedelta
from src.backtest import BacktestEngine, BacktestEvaluator, BacktestReporter

async def run_basic_backtest():
    # 1. ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–
    engine = BacktestEngine(
        initial_balance=1000000,    # åˆæœŸæ®‹é«˜ï¼ˆ100ä¸‡å††ï¼‰
        slippage_rate=0.0005,      # ã‚¹ãƒªãƒƒãƒšãƒ¼ã‚¸0.05%
        commission_rate=0.0012     # æ‰‹æ•°æ–™0.12%ï¼ˆBitbankï¼‰
    )
    
    # 2. ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆæœŸé–“è¨­å®š
    end_date = datetime.now()
    start_date = end_date - timedelta(days=30)  # 30æ—¥é–“
    
    # 3. ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    results = await engine.run_backtest(
        start_date=start_date,
        end_date=end_date,
        symbol="BTC/JPY"
    )
    
    # 4. æ€§èƒ½è©•ä¾¡
    evaluator = BacktestEvaluator()
    metrics = evaluator.evaluate_performance(
        trade_records=results["trade_records"],
        equity_curve=results["equity_curve"],
        initial_balance=1000000
    )
    
    print(f"âœ… ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆå®Œäº†: å‹ç‡{metrics.win_rate:.1%}, ãƒªã‚¿ãƒ¼ãƒ³{metrics.total_return:.2%}")
    return results

# å®Ÿè¡Œ
asyncio.run(run_basic_backtest())
```

### **çµ±åˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ**
```python
# ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
reporter = BacktestReporter()
generated_files = await reporter.generate_full_report(
    test_name="btc_strategy_test",
    trade_records=results["trade_records"],
    performance_metrics=metrics,
    equity_curve=results["equity_curve"]
)

print(f"ğŸ“ ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«: {list(generated_files.keys())}")
# ['csv', 'json', 'html'] å½¢å¼ã§ç”Ÿæˆ
```

### **ã‚¹ã‚¯ãƒªãƒ—ãƒˆçµŒç”±å®Ÿè¡Œ**
```bash
# ãƒ¡ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œï¼ˆæ¨å¥¨ï¼‰
python scripts/backtest/run_backtest.py

# ã‚«ã‚¹ã‚¿ãƒ æœŸé–“ãƒ»è©³ç´°ãƒ­ã‚°
python scripts/backtest/run_backtest.py --days 60 --verbose
```

## âš ï¸ æ³¨æ„äº‹é …ãƒ»åˆ¶ç´„

### **å®Ÿè¡Œç’°å¢ƒåˆ¶ç´„**
- **Python 3.8+å¿…é ˆ** - async/awaitæ§‹æ–‡ãƒ»å‹ãƒ’ãƒ³ãƒˆãƒ»dataclasså¯¾å¿œ
- **ãƒ¡ãƒ¢ãƒªè¦ä»¶** - å¤§é‡ãƒ‡ãƒ¼ã‚¿å‡¦ç†æ™‚2GBä»¥ä¸Šæ¨å¥¨ï¼ˆ6ãƒ¶æœˆãƒ‡ãƒ¼ã‚¿ï¼‰
- **å‡¦ç†æ™‚é–“** - 30æ—¥é–“ï¼š30ç§’ã€œ2åˆ†ã€180æ—¥é–“ï¼š2ã€œ10åˆ†ï¼ˆãƒ‡ãƒ¼ã‚¿é‡ãƒ»æˆ¦ç•¥ã«ã‚ˆã‚‹ï¼‰

### **ãƒ‡ãƒ¼ã‚¿åˆ¶ç´„**
- **APIåˆ¶é™è€ƒæ…®** - Bitbank APIåˆ¶é™ï¼ˆ35ç§’é–“éš”ï¼‰ãƒ»æœ¬ç•ªãƒˆãƒ¬ãƒ¼ãƒ‰ã¨ã®ç«¶åˆå›é¿
- **15åˆ†è¶³åˆ¶é™** - çŸ­æœŸé–“ãƒ‡ãƒ¼ã‚¿ã®ã¿å–å¾—å¯èƒ½ãƒ»é•·æœŸãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆã«ã¯4hè¶³æ¨å¥¨
- **æœ€å°æœŸé–“** - 7æ—¥æœªæº€ã¯æ¨å¥¨ã—ãªã„ï¼ˆãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™è¨ˆç®—ä¸è¶³ï¼‰
- **ãƒ‡ãƒ¼ã‚¿å“è³ª** - 50æœŸé–“æœªæº€ãƒ»æ¬ æå€¤5%è¶…éæ™‚ã¯å‡¦ç†åœæ­¢

### **ãƒ¢ãƒ‡ãƒ«ãƒ»è¨­å®šåˆ¶ç´„**
- **ProductionEnsembleå¿…é ˆ** - models/production/é…ä¸‹ã«3ãƒ¢ãƒ‡ãƒ«ï¼ˆLightGBM/XGBoost/RandomForestï¼‰å¿…è¦
- **12ç‰¹å¾´é‡çµ±ä¸€** - feature_managerçµ±åˆãƒ»ç‰¹å¾´é‡é †åºãƒ»å‹æ•´åˆæ€§å¿…é ˆ
- **è¨­å®šåˆ†é›¢** - config/backtest/base.yamlã§ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆå°‚ç”¨è¨­å®šä½¿ç”¨

### **æœ¬ç•ªç’°å¢ƒåˆ†é›¢**
- **å®Œå…¨ç‹¬ç«‹å®Ÿè¡Œ** - æœ¬ç•ªè¨­å®šï¼ˆconfig/production/ï¼‰ã«ä¸€åˆ‡å½±éŸ¿ãªã—
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ†é›¢** - ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆçµæœã¯ç‹¬ç«‹ä¿å­˜ãƒ»æœ¬ç•ªãƒ‡ãƒ¼ã‚¿å½±éŸ¿ãªã—
- **ãƒ­ã‚°åˆ†é›¢** - logs/backtest_reports/é…ä¸‹ã«ç‹¬ç«‹ä¿å­˜

## ğŸ”— é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ä¾å­˜é–¢ä¿‚

### **è¨­å®šãƒ»å®Ÿè¡ŒåŸºç›¤**
- **`config/backtest/base.yaml`** - ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆå°‚ç”¨è¨­å®šãƒ»ãƒ¢ãƒ¼ãƒ‰ãƒ»æˆ¦ç•¥ãƒ»ãƒªã‚¹ã‚¯ç®¡ç†
- **`scripts/backtest/run_backtest.py`** - å®Ÿè¡Œã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆãƒ»CLIå¯¾å¿œãƒ»çµæœè¡¨ç¤º
- **`src/core/config/feature_manager.py`** - 12ç‰¹å¾´é‡çµ±ä¸€ç®¡ç†ãƒ»ç‰¹å¾´é‡é †åºä¿è¨¼

### **ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ¢ãƒ‡ãƒ«åŸºç›¤**
- **`src/data/data_fetcher.py`** - Bitbank APIãƒ»ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½
- **`models/production/`** - ProductionEnsemble 3ãƒ¢ãƒ‡ãƒ«ï¼ˆLightGBM/XGBoost/RandomForestï¼‰
- **`src/features/feature_generator.py`** - 12ç‰¹å¾´é‡ç”Ÿæˆãƒ»feature_manageré€£æº

### **æˆ¦ç•¥ãƒ»å–å¼•ã‚·ã‚¹ãƒ†ãƒ **
- **`src/strategies/implementations/`** - 4æˆ¦ç•¥å®Ÿè£…ï¼ˆATRBased/MochipoyAlert/MultiTimeframe/FibonacciRetracementï¼‰
- **`src/trading/risk_manager.py`** - KellyåŸºæº–ãƒ»ãƒªã‚¹ã‚¯ç®¡ç†ãƒ»ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚µã‚¤ã‚¸ãƒ³ã‚°
- **`src/core/orchestration/orchestrator.py`** - ã‚·ã‚¹ãƒ†ãƒ çµ±åˆåˆ¶å¾¡ãƒ»ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆç›´æ¥å®Ÿè¡Œ

### **ç›£è¦–ãƒ»å“è³ªä¿è¨¼**
- **`src/monitoring/`** - Discordé€šçŸ¥ãƒ»ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
- **`scripts/testing/checks.sh`** - 654ãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒ»å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆå®Ÿè¡Œå‰æ¨å¥¨ï¼‰
- **`tests/unit/backtest/`** - ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½å˜ä½“ãƒ†ã‚¹ãƒˆãƒ»çµ±åˆãƒ†ã‚¹ãƒˆ

### **ãƒ­ã‚°ãƒ»ãƒ¬ãƒãƒ¼ãƒˆ**
- **`src/core/logger.py`** - JSTå¯¾å¿œãƒ­ã‚°ãƒ»æ§‹é€ åŒ–å‡ºåŠ›ãƒ»Discordçµ±åˆ
- **`logs/backtest_reports/`** - CSVãƒ»JSONãƒ»HTMLãƒ»ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ¬ãƒãƒ¼ãƒˆä¿å­˜å…ˆ