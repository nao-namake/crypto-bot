# src/trading/position/ - ãƒã‚¸ã‚·ãƒ§ãƒ³ç®¡ç†å±¤ ğŸš€ Phase 46å®Œäº†

## ğŸ¯ å½¹å‰²ãƒ»è²¬ä»»

ãƒã‚¸ã‚·ãƒ§ãƒ³è¿½è·¡ãƒ»åˆ¶é™ç®¡ç†ãƒ»ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãƒ»ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³åˆ¶å¾¡ã‚’æ‹…å½“ã—ã¾ã™ã€‚Phase 38ã§tradingãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ä¸€éƒ¨ã¨ã—ã¦åˆ†é›¢ã€Phase 42ã§å¹³å‡ä¾¡æ ¼è¿½è·¡æ©Ÿèƒ½ã€Phase 42.2ã§ãƒˆãƒ¬ãƒ¼ãƒªãƒ³ã‚°SL/TPä¾¡æ ¼ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€Phase 42.4ã§çµ±åˆTP/SLçŠ¶æ…‹æ°¸ç¶šåŒ–ã‚’å®Ÿè£…ã€**Phase 46ã§ãƒ‡ã‚¤ãƒˆãƒ¬ãƒ¼ãƒ‰ç‰¹åŒ–ãƒ»å€‹åˆ¥TP/SLç®¡ç†ã«å›å¸°**ã—ã¾ã—ãŸã€‚

## ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
position/
â”œâ”€â”€ tracker.py       # ãƒã‚¸ã‚·ãƒ§ãƒ³è¿½è·¡ï¼ˆPhase 46: å€‹åˆ¥TP/SLç®¡ç†ãƒ»å¹³å‡ä¾¡æ ¼çµ±è¨ˆã®ã¿ï¼‰
â”œâ”€â”€ limits.py        # ãƒã‚¸ã‚·ãƒ§ãƒ³åˆ¶é™ç®¡ç†
â”œâ”€â”€ cleanup.py       # å­¤å…ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆPhase 37.5.3ï¼‰
â”œâ”€â”€ cooldown.py      # ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ç®¡ç†ï¼ˆPhase 31.1ï¼‰
â”œâ”€â”€ __init__.py      # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆæœŸåŒ–
â””â”€â”€ README.md        # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

## ğŸ“ˆ Phase 46å®Œäº†ï¼ˆ2025å¹´10æœˆ22æ—¥ï¼‰

**ğŸ¯ Phase 46: ãƒ‡ã‚¤ãƒˆãƒ¬ãƒ¼ãƒ‰ç‰¹åŒ–ãƒ»å€‹åˆ¥TP/SLç®¡ç†å›å¸°ãƒ»çµ±åˆæ©Ÿèƒ½å‰Šé™¤**

### âœ… Phase 46.2.4 çµ±åˆTP/SLç®¡ç†å‰Šé™¤æˆæœï¼ˆ-173è¡Œã®ã‚³ãƒ¼ãƒ‰å‰Šæ¸›ï¼‰

**èƒŒæ™¯**: Phase 42-42.4ã§å®Ÿè£…ã—ãŸã‚¹ã‚¤ãƒ³ã‚°ãƒˆãƒ¬ãƒ¼ãƒ‰å‘ã‘ã®çµ±åˆTP/SLç®¡ç†æ©Ÿèƒ½ï¼ˆè¤‡æ•°ãƒã‚¸ã‚·ãƒ§ãƒ³åŠ é‡å¹³å‡ãƒ»çµ±åˆæ³¨æ–‡IDç®¡ç†ãƒ»çŠ¶æ…‹æ°¸ç¶šåŒ–ï¼‰ãŒã€ãƒ‡ã‚¤ãƒˆãƒ¬ãƒ¼ãƒ‰ç‰¹åŒ–æˆ¦ç•¥ã§ã¯ä¸è¦ãªè¤‡é›‘æ€§ã‚’ç”Ÿã¿å‡ºã—ã¦ã„ã¾ã—ãŸã€‚Phase 46ã§å€‹åˆ¥TP/SLç®¡ç†ã«å›å¸°ã—ã€ã‚·ãƒ³ãƒ—ãƒ«æ€§ã‚’æœ€å„ªå…ˆã—ã¾ã—ãŸã€‚

**å‰Šé™¤å†…å®¹**:
- **tracker.py**: çµ±åˆTP/SL IDç®¡ç†å‰Šé™¤ï¼ˆLine 366-469ã€-104è¡Œï¼‰
  - `get_consolidated_tp_sl_ids()` å‰Šé™¤
  - `set_consolidated_tp_sl_ids()` å‰Šé™¤
  - `get_consolidated_position_info()` å‰Šé™¤
  - `clear_consolidated_tp_sl()` å‰Šé™¤
- **tracker.py**: çŠ¶æ…‹æ°¸ç¶šåŒ–æ©Ÿèƒ½å‰Šé™¤ï¼ˆLine 489-538ã€-50è¡Œï¼‰
  - `_save_state()` å‰Šé™¤ï¼ˆJSONä¿å­˜æ©Ÿèƒ½ï¼‰
  - `_load_state()` å‰Šé™¤ï¼ˆèµ·å‹•æ™‚å¾©å…ƒæ©Ÿèƒ½ï¼‰
  - `src/core/state/consolidated_tp_sl_state.json` å‰Šé™¤
- **tracker.py**: çµ±åˆç”¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å‰Šé™¤ï¼ˆLine 34-41ã€-8è¡Œï¼‰
  - `_consolidated_tp_order_id` å‰Šé™¤
  - `_consolidated_sl_order_id` å‰Šé™¤
  - `_consolidated_tp_price` å‰Šé™¤
  - `_consolidated_sl_price` å‰Šé™¤
  - `_side` å‰Šé™¤
- **ã‚³ãƒ¡ãƒ³ãƒˆæ•´ç†**: Phase 42-42.4é–¢é€£ã‚³ãƒ¡ãƒ³ãƒˆå‰Šé™¤ï¼ˆ-11è¡Œï¼‰
- **åˆè¨ˆ**: -173è¡Œå‰Šé™¤ï¼ˆPhase 42-42.4ãƒ¬ã‚¬ã‚·ãƒ¼ã‚³ãƒ¼ãƒ‰å®Œå…¨å‰Šé™¤ï¼‰

**åŠ¹æœ**:
- ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹å¤§å¹…ç°¡ç•¥åŒ–ï¼ˆtracker.py: 538è¡Œ â†’ 373è¡Œã€-30.7%ï¼‰
- å€‹åˆ¥TP/SLç®¡ç†ã«å›å¸°ï¼ˆã‚¨ãƒ³ãƒˆãƒªãƒ¼æ¯ã«ç‹¬ç«‹ã—ãŸTP/SLæ³¨æ–‡ï¼‰
- å¹³å‡ä¾¡æ ¼è¿½è·¡ã¯çµ±è¨ˆç›®çš„ã§ç¶­æŒï¼ˆçµ±åˆæ©Ÿèƒ½å‰Šé™¤ãƒ»ç›£è¦–ç”¨ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦æ´»ç”¨ï¼‰

### âœ… Phase 46è¨­è¨ˆå¤‰æ›´ï¼šå¹³å‡ä¾¡æ ¼è¿½è·¡ã®ç”¨é€”å¤‰æ›´

**èƒŒæ™¯**: Phase 42ã§å®Ÿè£…ã—ãŸå¹³å‡ä¾¡æ ¼è¿½è·¡æ©Ÿèƒ½ã¯çµ±åˆTP/SLè¨ˆç®—ç”¨ã§ã—ãŸãŒã€Phase 46ã§ã¯çµ±è¨ˆãƒ»ç›£è¦–ç›®çš„ã«ç”¨é€”å¤‰æ›´ã—ã¾ã—ãŸã€‚

**å¤‰æ›´å†…å®¹**:
```python
# Phase 46: å¹³å‡ä¾¡æ ¼è¿½è·¡ï¼ˆçµ±è¨ˆç”¨ãƒ»çµ±åˆTP/SLæ©Ÿèƒ½ã¯å‰Šé™¤ï¼‰
self._average_entry_price: float = 0.0
self._total_position_size: float = 0.0
```

**æ´»ç”¨æ–¹æ³•**:
- Discordé€šçŸ¥ã§ã®å¹³å‡ã‚¨ãƒ³ãƒˆãƒªãƒ¼ä¾¡æ ¼è¡¨ç¤º
- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰çµ±è¨ˆæƒ…å ±
- ãƒã‚¸ã‚·ãƒ§ãƒ³ç®¡ç†ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
- ãƒ‡ãƒãƒƒã‚°ãƒ»è§£æç”¨ãƒ‡ãƒ¼ã‚¿

**ãƒ¡ã‚½ãƒƒãƒ‰ç¶­æŒ**:
- `calculate_average_entry_price()`: åŠ é‡å¹³å‡ä¾¡æ ¼è¨ˆç®—ï¼ˆçµ±è¨ˆç”¨ï¼‰
- `update_average_on_entry()`: ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ™‚å¹³å‡æ›´æ–°ï¼ˆçµ±è¨ˆç”¨ï¼‰
- `update_average_on_exit()`: æ±ºæ¸ˆæ™‚å¹³å‡æ›´æ–°ï¼ˆçµ±è¨ˆç”¨ï¼‰

### ğŸ“Š Phase 46é‡è¦äº‹é …
- **Phase 46è¨­è¨ˆå“²å­¦**: ãƒ‡ã‚¤ãƒˆãƒ¬ãƒ¼ãƒ‰ç‰¹åŒ–ãƒ»å€‹åˆ¥TP/SLç®¡ç†ãƒ»ã‚·ãƒ³ãƒ—ãƒ«æ€§å„ªå…ˆ
- **å¹³å‡ä¾¡æ ¼ç”¨é€”å¤‰æ›´**: çµ±åˆTP/SLè¨ˆç®—ç”¨ â†’ çµ±è¨ˆãƒ»ç›£è¦–ç”¨
- **çŠ¶æ…‹æ°¸ç¶šåŒ–å‰Šé™¤**: Cloud Runå†èµ·å‹•å¯¾å¿œä¸è¦ï¼ˆå€‹åˆ¥TP/SLç®¡ç†ï¼‰
- **å“è³ªä¿è¨¼å®Œäº†**: 1,101ãƒ†ã‚¹ãƒˆ100%æˆåŠŸãƒ»68.93%ã‚«ãƒãƒ¬ãƒƒã‚¸é”æˆ

---

## ğŸ“ˆ Phase 42.4å®Œäº†ï¼ˆ2025å¹´10æœˆ20æ—¥ï¼‰

**ğŸ¯ Phase 42.4: çµ±åˆTP/SLçŠ¶æ…‹æ°¸ç¶šåŒ–ãƒ»Cloud Runå†èµ·å‹•å¯¾å¿œ**

### âœ… Phase 42.4æœ€é©åŒ–æˆæœ
- **JSONçŠ¶æ…‹æ°¸ç¶šåŒ–å®Ÿè£…**: tracker.py lines 489-538ã«çŠ¶æ…‹ä¿å­˜ãƒ»å¾©å…ƒæ©Ÿèƒ½è¿½åŠ 
  ```python
  # çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
  self.local_state_path = "src/core/state/consolidated_tp_sl_state.json"

  # ä¿å­˜: set_consolidated_tp_sl_ids()å‘¼ã³å‡ºã—æ™‚ã«è‡ªå‹•ä¿å­˜
  # å¾©å…ƒ: __init__()æ™‚ã«è‡ªå‹•å¾©å…ƒ
  ```

- **Cloud Runå†èµ·å‹•æ™‚ã®çŠ¶æ…‹ç¶­æŒ**:
  - å¾“æ¥ã®å•é¡Œ: ãƒ¡ãƒ¢ãƒªå†…ã®ã¿ã®çŠ¶æ…‹ç®¡ç† â†’ Cloud Runå†èµ·å‹•æ™‚ã«æ¶ˆå¤±
  - Phase 42.4è§£æ±ºç­–: JSONæ°¸ç¶šåŒ– â†’ å†èµ·å‹•å¾Œã‚‚çµ±åˆTP/SL IDç¶­æŒ
  - åŠ¹æœ: 22æ³¨æ–‡å•é¡Œï¼ˆæ—¢å­˜TP/SLã‚­ãƒ£ãƒ³ã‚»ãƒ«å¤±æ•—ï¼‰ã®æ ¹æœ¬è§£æ±º

- **ä¿å­˜å†…å®¹**:
  ```json
  {
    "tp_order_id": "12345",
    "sl_order_id": "12346",
    "tp_price": 15970209,
    "sl_price": 16793416,
    "side": "sell",
    "average_entry_price": 16464133.0,
    "total_position_size": 0.0001
  }
  ```

- **è‡ªå‹•ä¿å­˜ãƒ»è‡ªå‹•å¾©å…ƒ**:
  - `_save_state()`: çµ±åˆTP/SLè¨­å®šæ™‚ã«è‡ªå‹•ä¿å­˜ï¼ˆline 489-512ï¼‰
  - `_load_state()`: åˆæœŸåŒ–æ™‚ã«è‡ªå‹•å¾©å…ƒï¼ˆline 514-538ï¼‰
  - `__init__()`: èµ·å‹•æ™‚ã«è‡ªå‹•çš„ã«çŠ¶æ…‹å¾©å…ƒã‚’å‘¼ã³å‡ºã—ï¼ˆline 45ï¼‰

- **å“è³ªä¿è¨¼å®Œäº†**: 1,164ãƒ†ã‚¹ãƒˆ100%æˆåŠŸãƒ»69.58%ã‚«ãƒãƒ¬ãƒƒã‚¸é”æˆ

### ğŸ“Š Phase 42.4é‡è¦äº‹é …
- **drawdown_state.jsonè¨­è¨ˆè¸è¥²**: æ—¢å­˜ã®ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³æ°¸ç¶šåŒ–ã¨åŒã˜JSONè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ä½¿ç”¨
- **Graceful Degradation**: çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿å¤±æ•—æ™‚ã‚‚ã‚·ã‚¹ãƒ†ãƒ ç¶™ç¶š
- **å¾Œæ–¹äº’æ›æ€§**: æ—¢å­˜ã®Phase 42/42.2æ©Ÿèƒ½ã¨å®Œå…¨äº’æ›

## ğŸ“ˆ Phase 42.2å®Œäº†ï¼ˆ2025å¹´10æœˆ18æ—¥ï¼‰

**ğŸ¯ Phase 42.2: ãƒˆãƒ¬ãƒ¼ãƒªãƒ³ã‚°SL/TPä¾¡æ ¼ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ãƒ»ä¾¡æ ¼è¿½è·¡æ‹¡å¼µ**

### âœ… Phase 42.2æœ€é©åŒ–æˆæœ
- **ãƒˆãƒ¬ãƒ¼ãƒªãƒ³ã‚°SL/TPä¾¡æ ¼ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ **: PositionTrackeræ‹¡å¼µï¼ˆtracker.py:34-37ï¼‰
  ```python
  self._consolidated_tp_price: float = 0.0
  self._consolidated_sl_price: float = 0.0
  self._side: str = ""  # buy/sellï¼ˆãƒˆãƒ¬ãƒ¼ãƒªãƒ³ã‚°åˆ¤å®šç”¨ï¼‰
  ```

- **ä¾¡æ ¼è¿½è·¡æ©Ÿèƒ½æ‹¡å¼µ**: çµ±åˆTP/SL IDãƒ»ä¾¡æ ¼å–å¾—/è¨­å®šãƒ¡ã‚½ãƒƒãƒ‰æ‹¡å¼µ
  - `get_consolidated_tp_sl_ids()`: TP/SLæ³¨æ–‡IDãƒ»ä¾¡æ ¼å–å¾—ï¼ˆPhase 42.2æ‹¡å¼µï¼‰
  - `set_consolidated_tp_sl_ids()`: TP/SLæ³¨æ–‡IDãƒ»ä¾¡æ ¼è¨­å®šï¼ˆPhase 42.2æ‹¡å¼µï¼‰
  - `get_consolidated_position_info()`: çµ±åˆãƒã‚¸ã‚·ãƒ§ãƒ³æƒ…å ±å–å¾—ï¼ˆPhase 42.2æ‹¡å¼µï¼‰

- **ãƒˆãƒ¬ãƒ¼ãƒªãƒ³ã‚°ã‚¹ãƒˆãƒƒãƒ—çµ±åˆ**: Phase 42.2ãƒˆãƒ¬ãƒ¼ãƒªãƒ³ã‚°SLæ›´æ–°æ™‚ã®ä¾¡æ ¼è¿½è·¡
  - StopManager.update_trailing_stop_loss()ãŒæ–°SLä¾¡æ ¼ã‚’Trackerã«ä¿å­˜
  - Executor.monitor_trailing_conditions()ãŒä¾¡æ ¼æƒ…å ±ã‚’å–å¾—ã—ã¦åˆ¤å®š

- **å“è³ªä¿è¨¼å®Œäº†**: 1,081ãƒ†ã‚¹ãƒˆ100%æˆåŠŸãƒ»69.57%ã‚«ãƒãƒ¬ãƒƒã‚¸é”æˆ

### ğŸ“Š Phase 42.2é‡è¦äº‹é …
- **Phase 42åŸºç›¤æ‹¡å¼µ**: çµ±åˆTP/SLä¾¡æ ¼è¿½è·¡æ©Ÿèƒ½ã‚’ãƒˆãƒ¬ãƒ¼ãƒªãƒ³ã‚°å¯¾å¿œã«æ‹¡å¼µ
- **Sentinelå€¤å¯¾å¿œ**: `_UNSET`ã‚’ä½¿ç”¨ã—ã¦Noneå€¤ã«ã‚ˆã‚‹æ˜ç¤ºçš„ã‚¯ãƒªã‚¢ã‚’ã‚µãƒãƒ¼ãƒˆ
- **å¾Œæ–¹äº’æ›æ€§**: æ—¢å­˜ã®çµ±åˆTP/SLæ©Ÿèƒ½ã‚’ä¿æŒã—ã¤ã¤æ‹¡å¼µ

## ğŸ“ˆ Phase 42å®Œäº†ï¼ˆ2025å¹´10æœˆ18æ—¥ï¼‰

**ğŸ¯ Phase 42: å¹³å‡ä¾¡æ ¼è¿½è·¡ãƒ»çµ±åˆTP/SLå¯¾å¿œ**

### âœ… Phase 42æœ€é©åŒ–æˆæœ
- **å¹³å‡ä¾¡æ ¼è¿½è·¡æ©Ÿèƒ½**: PositionTrackeræ‹¡å¼µï¼ˆtracker.py:278-336ï¼‰
  - åŠ é‡å¹³å‡ã‚¨ãƒ³ãƒˆãƒªãƒ¼ä¾¡æ ¼è¨ˆç®—: `calculate_average_entry_price()`
  - æ–°è¦ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ™‚æ›´æ–°: `update_average_on_entry()`
  - æ±ºæ¸ˆæ™‚æ›´æ–°: `update_average_on_exit()`ï¼ˆå…¨æ±ºæ¸ˆ/éƒ¨åˆ†æ±ºæ¸ˆå¯¾å¿œï¼‰

- **çµ±åˆTP/SL IDç®¡ç†**: PositionTrackeræ‹¡å¼µï¼ˆtracker.py:366-469ï¼‰
  - çµ±åˆTP/SLæ³¨æ–‡IDå–å¾—/è¨­å®š
  - çµ±åˆãƒã‚¸ã‚·ãƒ§ãƒ³æƒ…å ±å–å¾—
  - çµ±åˆTP/SLæƒ…å ±ã‚¯ãƒªã‚¢

- **è¤‡æ•°ã‚¨ãƒ³ãƒˆãƒªãƒ¼å¯¾å¿œ**: å¹³å‡ä¾¡æ ¼ãƒ™ãƒ¼ã‚¹ã®çµ±åˆTP/SLå®Ÿç¾
  - å¾“æ¥: 3ã‚¨ãƒ³ãƒˆãƒªãƒ¼ â†’ 6æ³¨æ–‡ï¼ˆã‚¨ãƒ³ãƒˆãƒªãƒ¼3 + TP3 + SL3ï¼‰
  - Phase 42: 3ã‚¨ãƒ³ãƒˆãƒªãƒ¼ â†’ 5æ³¨æ–‡ï¼ˆã‚¨ãƒ³ãƒˆãƒªãƒ¼3 + TP1 + SL1ï¼‰

- **å“è³ªä¿è¨¼å®Œäº†**: 1,081ãƒ†ã‚¹ãƒˆ100%æˆåŠŸãƒ»69.57%ã‚«ãƒãƒ¬ãƒƒã‚¸é”æˆ

### ğŸ“Š Phase 42é‡è¦äº‹é …
- **Phase 38åŸºç›¤æ‹¡å¼µ**: ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«çµ±åˆTP/SLæ©Ÿèƒ½ã‚’è¿½åŠ 
- **å¾Œæ–¹äº’æ›æ€§**: å€‹åˆ¥TP/SLãƒ¢ãƒ¼ãƒ‰ç¶­æŒãƒ»æ®µéšçš„ç§»è¡Œå¯èƒ½
- **Phase 42.2çµ±åˆ**: ãƒˆãƒ¬ãƒ¼ãƒªãƒ³ã‚°ã‚¹ãƒˆãƒƒãƒ—ä¾¡æ ¼è¿½è·¡ã«æ‹¡å¼µ

## ğŸ“ˆ Phase 37.5.3å®Œäº†ï¼ˆ2025å¹´10æœˆ09æ—¥ï¼‰

**ğŸ¯ Phase 37.5.3: å­¤å…ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãƒ»OCOæ³¨æ–‡ä»£æ›¿**

### âœ… Phase 37.5.3æœ€é©åŒ–æˆæœ
- **å­¤å…ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: cleanup.pyå®Ÿè£…
  - ãƒã‚¸ã‚·ãƒ§ãƒ³æ±ºæ¸ˆå¾Œã«æ®‹ã£ãŸTP/SLæ³¨æ–‡ã‚’è‡ªå‹•å‰Šé™¤
  - bitbank OCOæ³¨æ–‡éå¯¾å¿œã®ä»£æ›¿å®Ÿè£…

## ğŸ“ˆ Phase 31.1å®Œäº†ï¼ˆ2025å¹´10æœˆ02æ—¥ï¼‰

**ğŸ¯ Phase 31.1: æŸ”è»Ÿã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰å¼·åº¦ãƒ™ãƒ¼ã‚¹åˆ¤å®š**

### âœ… Phase 31.1æœ€é©åŒ–æˆæœ
- **æŸ”è»Ÿã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³å®Ÿè£…**: cooldown.pyå®Ÿè£…
  - ãƒˆãƒ¬ãƒ³ãƒ‰å¼·åº¦ãƒ™ãƒ¼ã‚¹åˆ¤å®šï¼ˆADX 50%ãƒ»DI 30%ãƒ»EMA 20%ï¼‰
  - å¼·åº¦>=0.7ã§ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã‚¹ã‚­ãƒƒãƒ—ãƒ»æ©Ÿä¼šæå¤±å‰Šæ¸›

## ğŸ“ˆ Phase 38å®Œäº†ï¼ˆ2025å¹´10æœˆ11æ—¥ï¼‰

**ğŸ¯ Phase 38: tradingãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å®Ÿè£…**

### âœ… Phase 38æœ€é©åŒ–æˆæœ
- **positionå±¤åˆ†é›¢**: ãƒã‚¸ã‚·ãƒ§ãƒ³ç®¡ç†æ©Ÿèƒ½ã‚’ç‹¬ç«‹å±¤ã¨ã—ã¦åˆ†é›¢
- **5å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: core/balance/execution/position/riskå±¤ã«ã‚ˆã‚‹è²¬å‹™åˆ†é›¢
- **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Š**: 58.62% â†’ 70.56%ï¼ˆ+11.94ãƒã‚¤ãƒ³ãƒˆï¼‰
- **ä¿å®ˆæ€§å‘ä¸Š**: 4ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»å¹³å‡300è¡Œ/ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆé©åˆ‡ãªåˆ†å‰²ï¼‰

## ğŸ”§ ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«è©³ç´°

### **tracker.py** ğŸš€**Phase 42.2 ä¾¡æ ¼è¿½è·¡æ‹¡å¼µå®Œäº†**

ãƒã‚¸ã‚·ãƒ§ãƒ³è¿½è·¡ã®ä¸­æ ¸ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚Phase 42ã§å¹³å‡ä¾¡æ ¼è¿½è·¡ã€Phase 42.2ã§ãƒˆãƒ¬ãƒ¼ãƒªãƒ³ã‚°SL/TPä¾¡æ ¼ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚

**Phase 42.2æ–°æ©Ÿèƒ½**:
```python
class PositionTracker:
    def __init__(self):
        """PositionTrackeråˆæœŸåŒ–"""
        self.logger = get_logger()
        self.virtual_positions: List[Dict[str, Any]] = []

        # Phase 42: çµ±åˆTP/SLç”¨è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
        self._average_entry_price: float = 0.0
        self._total_position_size: float = 0.0
        self._consolidated_tp_order_id: Optional[str] = None
        self._consolidated_sl_order_id: Optional[str] = None

        # Phase 42.2: ãƒˆãƒ¬ãƒ¼ãƒªãƒ³ã‚°ã‚¹ãƒˆãƒƒãƒ—ç”¨ä¾¡æ ¼ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
        self._consolidated_tp_price: float = 0.0
        self._consolidated_sl_price: float = 0.0
        self._side: str = ""  # buy/sellï¼ˆãƒˆãƒ¬ãƒ¼ãƒªãƒ³ã‚°åˆ¤å®šç”¨ï¼‰

    def get_consolidated_tp_sl_ids(self) -> Dict[str, Any]:
        """
        çµ±åˆTP/SLæ³¨æ–‡IDãƒ»ä¾¡æ ¼å–å¾—ï¼ˆPhase 42ãƒ»Phase 42.2æ‹¡å¼µï¼‰

        Returns:
            Dict: {
                "tp_order_id": Optional[str],
                "sl_order_id": Optional[str],
                "tp_price": float,  # Phase 42.2è¿½åŠ 
                "sl_price": float   # Phase 42.2è¿½åŠ 
            }
        """

    def set_consolidated_tp_sl_ids(
        self,
        tp_order_id=_UNSET,
        sl_order_id=_UNSET,
        tp_price=_UNSET,      # Phase 42.2è¿½åŠ 
        sl_price=_UNSET,      # Phase 42.2è¿½åŠ 
        side=_UNSET           # Phase 42.2è¿½åŠ 
    ) -> None:
        """
        çµ±åˆTP/SLæ³¨æ–‡IDãƒ»ä¾¡æ ¼è¨­å®šï¼ˆPhase 42ãƒ»Phase 42.2æ‹¡å¼µãƒ»Phase 42.2.7 Noneå€¤å¯¾å¿œï¼‰

        Args:
            tp_order_id: TPæ³¨æ–‡IDï¼ˆNoneæŒ‡å®šå¯èƒ½=ã‚¯ãƒªã‚¢ï¼‰
            sl_order_id: SLæ³¨æ–‡IDï¼ˆNoneæŒ‡å®šå¯èƒ½=ã‚¯ãƒªã‚¢ï¼‰
            tp_price: TPä¾¡æ ¼ï¼ˆ0.0æŒ‡å®šå¯èƒ½=ã‚¯ãƒªã‚¢ï¼‰      # Phase 42.2è¿½åŠ 
            sl_price: SLä¾¡æ ¼ï¼ˆ0.0æŒ‡å®šå¯èƒ½=ã‚¯ãƒªã‚¢ï¼‰      # Phase 42.2è¿½åŠ 
            side: ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚µã‚¤ãƒ‰ï¼ˆç©ºæ–‡å­—æŒ‡å®šå¯èƒ½=ã‚¯ãƒªã‚¢ï¼‰  # Phase 42.2è¿½åŠ 

        Note:
            Phase 42.2.7: Sentinelå€¤ï¼ˆ_UNSETï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€
            ã€Œãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœªæŒ‡å®šã€ã¨ã€ŒNoneã§æ˜ç¤ºçš„ã«ã‚¯ãƒªã‚¢ã€ã‚’åŒºåˆ¥ã™ã‚‹ã€‚
        """

    def get_consolidated_position_info(self) -> Dict[str, Any]:
        """
        çµ±åˆãƒã‚¸ã‚·ãƒ§ãƒ³æƒ…å ±å–å¾—ï¼ˆPhase 42ãƒ»Phase 42.2æ‹¡å¼µï¼‰

        Returns:
            Dict: {
                "average_entry_price": float,
                "total_position_size": float,
                "tp_order_id": Optional[str],
                "sl_order_id": Optional[str],
                "tp_price": float,      # Phase 42.2è¿½åŠ 
                "sl_price": float,      # Phase 42.2è¿½åŠ 
                "side": str,            # Phase 42.2è¿½åŠ 
                "position_count": int
            }
        """
```

**Phase 42æ–°æ©Ÿèƒ½**:
```python
def calculate_average_entry_price(self) -> float:
    """
    åŠ é‡å¹³å‡ã‚¨ãƒ³ãƒˆãƒªãƒ¼ä¾¡æ ¼è¨ˆç®—ï¼ˆPhase 42ï¼‰

    å…¨ã¦ã®ä»®æƒ³ãƒã‚¸ã‚·ãƒ§ãƒ³ã‹ã‚‰åŠ é‡å¹³å‡ä¾¡æ ¼ã‚’è¨ˆç®—ã™ã‚‹ã€‚

    Returns:
        float: åŠ é‡å¹³å‡ã‚¨ãƒ³ãƒˆãƒªãƒ¼ä¾¡æ ¼ï¼ˆãƒã‚¸ã‚·ãƒ§ãƒ³ãŒãªã„å ´åˆã¯0.0ï¼‰
    """

def update_average_on_entry(self, price: float, amount: float) -> float:
    """
    æ–°è¦ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ™‚ã«å¹³å‡ä¾¡æ ¼æ›´æ–°ï¼ˆPhase 42ï¼‰

    Args:
        price: æ–°è¦ã‚¨ãƒ³ãƒˆãƒªãƒ¼ä¾¡æ ¼
        amount: æ–°è¦ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ•°é‡

    Returns:
        float: æ›´æ–°å¾Œã®å¹³å‡ã‚¨ãƒ³ãƒˆãƒªãƒ¼ä¾¡æ ¼

    è¨ˆç®—å¼:
        new_average = (old_average Ã— old_size + price Ã— amount) / (old_size + amount)
    """

def update_average_on_exit(self, amount: float) -> float:
    """
    æ±ºæ¸ˆæ™‚ã«å¹³å‡ä¾¡æ ¼æ›´æ–°ï¼ˆPhase 42ï¼‰

    Args:
        amount: æ±ºæ¸ˆæ•°é‡

    Returns:
        float: æ›´æ–°å¾Œã®å¹³å‡ã‚¨ãƒ³ãƒˆãƒªãƒ¼ä¾¡æ ¼ï¼ˆå…¨æ±ºæ¸ˆæ™‚ã¯0.0ï¼‰

    å‡¦ç†:
        - å…¨æ±ºæ¸ˆ: å¹³å‡ä¾¡æ ¼ãƒªã‚»ãƒƒãƒˆ
        - éƒ¨åˆ†æ±ºæ¸ˆ: å¹³å‡ä¾¡æ ¼ç¶­æŒãƒ»ã‚µã‚¤ã‚ºã®ã¿æ¸›å°‘
    """
```

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
- `add_position()`: ãƒã‚¸ã‚·ãƒ§ãƒ³è¿½åŠ 
- `remove_position()`: ãƒã‚¸ã‚·ãƒ§ãƒ³å‰Šé™¤
- `find_position()`: ãƒã‚¸ã‚·ãƒ§ãƒ³æ¤œç´¢
- `calculate_average_entry_price()`: **ã€Phase 42æ–°è¦ã€‘åŠ é‡å¹³å‡ä¾¡æ ¼è¨ˆç®—**
- `update_average_on_entry()`: **ã€Phase 42æ–°è¦ã€‘ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ™‚å¹³å‡æ›´æ–°**
- `update_average_on_exit()`: **ã€Phase 42æ–°è¦ã€‘æ±ºæ¸ˆæ™‚å¹³å‡æ›´æ–°**
- `get_consolidated_tp_sl_ids()`: **ã€Phase 42æ–°è¦ãƒ»Phase 42.2æ‹¡å¼µã€‘TP/SL IDãƒ»ä¾¡æ ¼å–å¾—**
- `set_consolidated_tp_sl_ids()`: **ã€Phase 42æ–°è¦ãƒ»Phase 42.2æ‹¡å¼µã€‘TP/SL IDãƒ»ä¾¡æ ¼è¨­å®š**

**ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ **:
- Lines 1-273: åŸºæœ¬ãƒã‚¸ã‚·ãƒ§ãƒ³ç®¡ç†ï¼ˆè¿½åŠ ãƒ»å‰Šé™¤ãƒ»æ¤œç´¢ï¼‰
- Lines 278-336: **ã€Phase 42ã€‘å¹³å‡ä¾¡æ ¼è¿½è·¡ãƒ¡ã‚½ãƒƒãƒ‰**
- Lines 366-469: **ã€Phase 42ãƒ»Phase 42.2ã€‘çµ±åˆTP/SLç®¡ç†ãƒ¡ã‚½ãƒƒãƒ‰**

### **limits.py**

ãƒã‚¸ã‚·ãƒ§ãƒ³åˆ¶é™ç®¡ç†ã®ä¸­æ ¸ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚Phase 38ã§åˆ†é›¢ã€Phase 31.1ã§æŸ”è»Ÿã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³çµ±åˆã—ã¾ã—ãŸã€‚

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
- `check_limits()`: ãƒã‚¸ã‚·ãƒ§ãƒ³ç®¡ç†åˆ¶é™ãƒã‚§ãƒƒã‚¯
- `_check_minimum_balance()`: æœ€å°è³‡é‡‘è¦ä»¶ãƒã‚§ãƒƒã‚¯
- `_check_cooldown()`: ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ãƒã‚§ãƒƒã‚¯ï¼ˆPhase 31.1æŸ”è»Ÿåˆ¤å®šï¼‰
- `_check_max_positions()`: æœ€å¤§ãƒã‚¸ã‚·ãƒ§ãƒ³æ•°ãƒã‚§ãƒƒã‚¯
- `_check_capital_usage()`: æ®‹é«˜åˆ©ç”¨ç‡ãƒã‚§ãƒƒã‚¯
- `_check_daily_trades()`: æ—¥æ¬¡å–å¼•å›æ•°ãƒã‚§ãƒƒã‚¯

### **cleanup.py** ğŸš€**Phase 37.5.3 å­¤å…ãƒã‚¸ã‚·ãƒ§ãƒ³å¯¾ç­–å®Œäº†**

å­¤å…ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã®ä¸­æ ¸ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚Phase 37.5.3ã§bitbank OCOéå¯¾å¿œã®ä»£æ›¿å®Ÿè£…ã‚’å®Œæˆã•ã›ã¾ã—ãŸã€‚

**Phase 37.5.3æ–°æ©Ÿèƒ½**:
```python
async def cleanup_orphaned_positions(
    self,
    bitbank_client: Optional[BitbankClient] = None
) -> Dict[str, Any]:
    """
    Phase 37.5.3: å­¤å…ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

    å®Ÿéš›ã®ãƒã‚¸ã‚·ãƒ§ãƒ³ã¨ä»®æƒ³ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚’ç…§åˆã—ã€
    æ¶ˆå¤±ã—ãŸãƒã‚¸ã‚·ãƒ§ãƒ³ã®TP/SLæ³¨æ–‡ã‚’å‰Šé™¤ã™ã‚‹ã€‚

    å‡¦ç†ãƒ•ãƒ­ãƒ¼:
        1. å®Ÿéš›ã®ãƒã‚¸ã‚·ãƒ§ãƒ³å–å¾—
        2. å­¤å…ãƒã‚¸ã‚·ãƒ§ãƒ³æ¤œå‡º
        3. TP/SLæ³¨æ–‡å‰Šé™¤
        4. ä»®æƒ³ãƒã‚¸ã‚·ãƒ§ãƒ³å‰Šé™¤

    Returns:
        ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—çµæœ
    """
```

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
- `cleanup_orphaned_positions()`: **ã€Phase 37.5.3æ–°è¦ã€‘å­¤å…ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**
- `check_stale_positions()`: å¤ã„ãƒã‚¸ã‚·ãƒ§ãƒ³æ¤œå‡º
- `emergency_cleanup()`: ç·Šæ€¥ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

### **cooldown.py** ğŸš€**Phase 31.1 æŸ”è»Ÿã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³å®Œäº†**

ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ç®¡ç†ã®ä¸­æ ¸ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚Phase 31.1ã§ãƒˆãƒ¬ãƒ³ãƒ‰å¼·åº¦ãƒ™ãƒ¼ã‚¹åˆ¤å®šã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

**Phase 31.1æ–°æ©Ÿèƒ½**:
```python
async def should_apply_cooldown(self, evaluation: TradeEvaluation) -> bool:
    """
    Phase 31.1: æŸ”è»Ÿãªã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³åˆ¤å®š

    å¼·ã„ãƒˆãƒ¬ãƒ³ãƒ‰ç™ºç”Ÿæ™‚ã¯ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã€
    æ©Ÿä¼šæå¤±ã‚’é˜²ãã€‚

    å‡¦ç†:
        1. features.yamlè¨­å®šç¢ºèª
        2. ãƒˆãƒ¬ãƒ³ãƒ‰å¼·åº¦è¨ˆç®—ï¼ˆADXãƒ»DIãƒ»EMAï¼‰
        3. é–¾å€¤åˆ¤å®šï¼ˆ0.7ä»¥ä¸Šã§ã‚¹ã‚­ãƒƒãƒ—ï¼‰

    Returns:
        bool: ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã‚’é©ç”¨ã™ã‚‹ã‹
    """

def calculate_trend_strength(self, market_data: Dict) -> float:
    """
    Phase 31.1: ãƒˆãƒ¬ãƒ³ãƒ‰å¼·åº¦è¨ˆç®—ï¼ˆADXãƒ»DIãƒ»EMAç·åˆåˆ¤å®šï¼‰

    Args:
        market_data: å¸‚å ´ãƒ‡ãƒ¼ã‚¿ï¼ˆç‰¹å¾´é‡å«ã‚€ï¼‰

    Returns:
        float: ãƒˆãƒ¬ãƒ³ãƒ‰å¼·åº¦ (0.0-1.0)

    è¨ˆç®—å¼:
        trend_strength = ADX(50%) + DIå·®åˆ†(30%) + EMAãƒˆãƒ¬ãƒ³ãƒ‰(20%)
    """
```

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
- `should_apply_cooldown()`: **ã€Phase 31.1æ–°è¦ã€‘æŸ”è»Ÿã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³åˆ¤å®š**
- `calculate_trend_strength()`: **ã€Phase 31.1æ–°è¦ã€‘ãƒˆãƒ¬ãƒ³ãƒ‰å¼·åº¦è¨ˆç®—**
- `get_cooldown_status()`: ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å–å¾—

## ğŸ“ ä½¿ç”¨æ–¹æ³•ãƒ»ä¾‹

### **Phase 42.2ãƒˆãƒ¬ãƒ¼ãƒªãƒ³ã‚°ä¾¡æ ¼è¿½è·¡ã®å‹•ä½œ**

```python
from src.trading.position.tracker import PositionTracker

# PositionTrackeråˆæœŸåŒ–
tracker = PositionTracker()

# Phase 42: ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ™‚å¹³å‡ä¾¡æ ¼æ›´æ–°
average_price = tracker.update_average_on_entry(price=10000000.0, amount=0.001)

# Phase 42: çµ±åˆTP/SLé…ç½®å¾Œã«IDãƒ»ä¾¡æ ¼ã‚’ä¿å­˜
tracker.set_consolidated_tp_sl_ids(
    tp_order_id="12345",
    sl_order_id="12346",
    tp_price=10250000.0,  # Phase 42.2è¿½åŠ 
    sl_price=9800000.0,   # Phase 42.2è¿½åŠ 
    side="buy"            # Phase 42.2è¿½åŠ 
)

# Phase 42.2: ãƒˆãƒ¬ãƒ¼ãƒªãƒ³ã‚°SLæ›´æ–°å¾Œã«ä¾¡æ ¼ã‚’æ›´æ–°
tracker.set_consolidated_tp_sl_ids(
    sl_price=10050000.0  # ãƒˆãƒ¬ãƒ¼ãƒªãƒ³ã‚°SLãŒä¸Šæ˜‡
)

# Phase 42.2: çµ±åˆãƒã‚¸ã‚·ãƒ§ãƒ³æƒ…å ±å–å¾—ï¼ˆãƒˆãƒ¬ãƒ¼ãƒªãƒ³ã‚°åˆ¤å®šç”¨ï¼‰
info = tracker.get_consolidated_position_info()
print(f"Average Entry: {info['average_entry_price']:.0f}å††")
print(f"TP Price: {info['tp_price']:.0f}å††")
print(f"SL Price: {info['sl_price']:.0f}å††")  # Phase 42.2ã§è¿½è·¡å¯èƒ½
print(f"Side: {info['side']}")  # Phase 42.2ã§è¿½è·¡å¯èƒ½
```

### **Phase 42å¹³å‡ä¾¡æ ¼è¿½è·¡ã®å‹•ä½œ**

```python
from src.trading.position.tracker import PositionTracker

# PositionTrackeråˆæœŸåŒ–
tracker = PositionTracker()

# è¤‡æ•°ã‚¨ãƒ³ãƒˆãƒªãƒ¼ä¾‹
tracker.update_average_on_entry(price=10000000.0, amount=0.001)
# â†’ å¹³å‡: 1000ä¸‡å††

tracker.update_average_on_entry(price=10100000.0, amount=0.001)
# â†’ å¹³å‡: 1005ä¸‡å††ï¼ˆ(1000ä¸‡Ã—0.001 + 1010ä¸‡Ã—0.001) / 0.002ï¼‰

tracker.update_average_on_entry(price=10200000.0, amount=0.001)
# â†’ å¹³å‡: 1010ä¸‡å††ï¼ˆ(1005ä¸‡Ã—0.002 + 1020ä¸‡Ã—0.001) / 0.003ï¼‰

# çµ±åˆTP/SLä¾¡æ ¼ã¯1010ä¸‡å††ãƒ™ãƒ¼ã‚¹ã§è¨ˆç®—ã•ã‚Œã‚‹
```

## âš ï¸ æ³¨æ„äº‹é …ãƒ»åˆ¶ç´„

### **Phase 42.2ä¾¡æ ¼è¿½è·¡ã®å‹•ä½œ**
- **Sentinelå€¤ä½¿ç”¨**: `_UNSET`ã‚’ä½¿ç”¨ã—ã¦Noneå€¤ã«ã‚ˆã‚‹æ˜ç¤ºçš„ã‚¯ãƒªã‚¢ã‚’ã‚µãƒãƒ¼ãƒˆ
- **ä¾¡æ ¼æ›´æ–°**: ãƒˆãƒ¬ãƒ¼ãƒªãƒ³ã‚°SLæ›´æ–°æ™‚ã¯`sl_price`ã®ã¿æ›´æ–°ãƒ»ä»–ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ç¶­æŒ
- **å¾Œæ–¹äº’æ›æ€§**: Phase 42ã®çµ±åˆTP/SLæ©Ÿèƒ½ã‚’ä¿æŒã—ã¤ã¤æ‹¡å¼µ

### **Phase 42å¹³å‡ä¾¡æ ¼è¿½è·¡ã®å‹•ä½œæ¡ä»¶**
- **è¤‡æ•°ã‚¨ãƒ³ãƒˆãƒªãƒ¼å¯¾å¿œ**: åŠ é‡å¹³å‡ä¾¡æ ¼è¨ˆç®—ã§å…¬å¹³ãªTP/SLé…ç½®
- **éƒ¨åˆ†æ±ºæ¸ˆå¯¾å¿œ**: æ±ºæ¸ˆæ™‚ã¯å¹³å‡ä¾¡æ ¼ç¶­æŒãƒ»ã‚µã‚¤ã‚ºã®ã¿æ¸›å°‘
- **å…¨æ±ºæ¸ˆæ™‚ãƒªã‚»ãƒƒãƒˆ**: å¹³å‡ä¾¡æ ¼ãƒ»ã‚µã‚¤ã‚ºãƒ»TP/SL IDã‚’ã™ã¹ã¦ãƒªã‚»ãƒƒãƒˆ

### **Phase 37.5.3å­¤å…ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã®å‹•ä½œ**
- **OCOä»£æ›¿**: bitbank OCOéå¯¾å¿œã®ãŸã‚æ‰‹å‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Ÿè£…
- **å®šæœŸå®Ÿè¡Œ**: å–å¼•ã‚µã‚¤ã‚¯ãƒ«æ¯ã«å­¤å…ãƒã‚¸ã‚·ãƒ§ãƒ³æ¤œå‡ºãƒ»å‰Šé™¤
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: æ³¨æ–‡ã‚­ãƒ£ãƒ³ã‚»ãƒ«å¤±æ•—æ™‚ã‚‚ç¶™ç¶š

### **Phase 31.1æŸ”è»Ÿã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã®å‹•ä½œ**
- **ãƒˆãƒ¬ãƒ³ãƒ‰å¼·åº¦åˆ¤å®š**: ADX 50%ãƒ»DI 30%ãƒ»EMA 20%ã®åŠ é‡å¹³å‡
- **é–¾å€¤0.7**: å¼·åº¦0.7ä»¥ä¸Šã§ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã‚¹ã‚­ãƒƒãƒ—
- **æ©Ÿä¼šæå¤±å‰Šæ¸›**: å¼·ãƒˆãƒ¬ãƒ³ãƒ‰æ™‚ã®å–å¼•æ©Ÿä¼šç¢ºä¿

## ğŸ”— é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ä¾å­˜é–¢ä¿‚

### **Phase 42.2æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**
- `src/trading/position/tracker.py`: ä¾¡æ ¼ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ï¼ˆlines 34-37ï¼‰

### **Phase 42æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**
- `src/trading/position/tracker.py`: å¹³å‡ä¾¡æ ¼è¿½è·¡ï¼ˆlines 278-336ï¼‰
- `src/trading/position/tracker.py`: çµ±åˆTP/SLç®¡ç†ï¼ˆlines 366-469ï¼‰

### **Phase 37.5.3æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**
- `src/trading/position/cleanup.py`: å­¤å…ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

### **Phase 31.1æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**
- `src/trading/position/cooldown.py`: æŸ”è»Ÿã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³

### **å‚ç…§å…ƒã‚·ã‚¹ãƒ†ãƒ **
- `src/trading/execution/executor.py`: ãƒã‚¸ã‚·ãƒ§ãƒ³è¿½è·¡ãƒ»ãƒˆãƒ¬ãƒ¼ãƒªãƒ³ã‚°ç›£è¦–
- `src/trading/execution/stop_manager.py`: TP/SLé…ç½®ãƒ»ãƒˆãƒ¬ãƒ¼ãƒªãƒ³ã‚°SLæ›´æ–°
- `src/core/execution/execution_service.py`: ãƒã‚¸ã‚·ãƒ§ãƒ³åˆ¶é™ãƒã‚§ãƒƒã‚¯

### **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«é€£æº**
- `config/core/thresholds.yaml`: ãƒã‚¸ã‚·ãƒ§ãƒ³åˆ¶é™ãƒ»ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³è¨­å®š
- `config/core/features.yaml`: æŸ”è»Ÿã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³è¨­å®š

---

**ğŸ¯ é‡è¦**: Phase 42.2ã«ã‚ˆã‚Šã€ãƒˆãƒ¬ãƒ¼ãƒªãƒ³ã‚°ã‚¹ãƒˆãƒƒãƒ—å¯¾å¿œã®ä¾¡æ ¼è¿½è·¡æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚Phase 42ã®å¹³å‡ä¾¡æ ¼è¿½è·¡åŸºç›¤ã‚’æ‹¡å¼µã—ã€è¤‡æ•°ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã«å¯¾ã™ã‚‹ãƒˆãƒ¬ãƒ¼ãƒªãƒ³ã‚°SL/TPç®¡ç†ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚
