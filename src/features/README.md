# src/features/ - ç‰¹å¾´é‡ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ 

## ğŸ¯ å½¹å‰²ãƒ»è²¬ä»»

AIè‡ªå‹•å–å¼•ã‚·ã‚¹ãƒ†ãƒ ã®ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°å±¤ã€‚ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ã€ç•°å¸¸æ¤œçŸ¥æŒ‡æ¨™ã€åŸºæœ¬ç‰¹å¾´é‡ã®ç”Ÿæˆã‚’æ‹…å½“ã€‚97ç‰¹å¾´é‡ã‹ã‚‰12ç‰¹å¾´é‡ã¸ã®æ¥µé™æœ€é©åŒ–ã‚’å®Ÿç¾ã—ã€æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã«é«˜å“è³ªãªå…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’æä¾›ã€‚

## ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
src/features/
â”œâ”€â”€ __init__.py            # ç‰¹å¾´é‡ã‚·ã‚¹ãƒ†ãƒ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆ32è¡Œï¼‰
â””â”€â”€ feature_generator.py   # çµ±åˆç‰¹å¾´é‡ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ï¼ˆ590è¡Œï¼‰
```

## ğŸ”§ ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### **feature_generator.pyï¼ˆ590è¡Œï¼‰**

**ç›®çš„**: ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ãƒ»ç•°å¸¸æ¤œçŸ¥ãƒ»åŸºæœ¬ç‰¹å¾´é‡ã®çµ±åˆç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ 

**ä¸»è¦ã‚¯ãƒ©ã‚¹**:
```python
class FeatureGenerator:
    def __init__(self, lookback_period: Optional[int] = None)  # åˆæœŸåŒ–
    async def generate_features(self, market_data) -> pd.DataFrame  # çµ±åˆç‰¹å¾´é‡ç”Ÿæˆ
    def _generate_basic_features(self) -> pd.DataFrame        # åŸºæœ¬ç‰¹å¾´é‡ï¼ˆ3å€‹ï¼‰
    def _generate_technical_indicators(self) -> pd.DataFrame  # ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ï¼ˆ6å€‹ï¼‰
    def _generate_anomaly_indicators(self) -> pd.DataFrame    # ç•°å¸¸æ¤œçŸ¥æŒ‡æ¨™ï¼ˆ3å€‹ï¼‰
    def get_feature_info(self) -> Dict                        # ç‰¹å¾´é‡æƒ…å ±å–å¾—
    def _validate_feature_generation(self)                    # 12ç‰¹å¾´é‡ç¢ºèª

# å¾Œæ–¹äº’æ›æ€§ã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼ˆ__init__.pyã‹ã‚‰åˆ©ç”¨å¯èƒ½ï¼‰
TechnicalIndicators = FeatureGenerator      # æ—§ã‚¯ãƒ©ã‚¹åå¯¾å¿œ
MarketAnomalyDetector = FeatureGenerator    # æ—§ã‚¯ãƒ©ã‚¹åå¯¾å¿œ
FeatureServiceAdapter = FeatureGenerator    # æ—§ã‚¯ãƒ©ã‚¹åå¯¾å¿œ
```

**ç‰¹å¾´é‡å®šç¾©**:
```python
# 12ç‰¹å¾´é‡ãƒªã‚¹ãƒˆï¼ˆå³é¸æœ€é©åŒ–ç‰ˆï¼‰
OPTIMIZED_FEATURES = [
    # åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ï¼ˆ3å€‹ï¼‰
    "close", "volume", "returns_1",
    
    # ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ï¼ˆ6å€‹ï¼‰  
    "rsi_14", "macd", "macd_signal", "atr_14", 
    "bb_position", "ema_20", "ema_50",
    
    # ç•°å¸¸æ¤œçŸ¥æŒ‡æ¨™ï¼ˆ3å€‹ï¼‰
    "zscore", "volume_ratio"
]

# ã‚«ãƒ†ã‚´ãƒªåˆ¥åˆ†é¡
FEATURE_CATEGORIES = {
    "essential": ["close", "volume", "returns_1"],
    "momentum": ["rsi_14", "macd", "macd_signal"],
    "volatility": ["atr_14", "bb_position"],
    "trend": ["ema_20", "ema_50"],
    "anomaly": ["zscore", "volume_ratio"]
}
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### **åŸºæœ¬çš„ãªç‰¹å¾´é‡ç”Ÿæˆ**
```python
from src.features.feature_generator import FeatureGenerator
import pandas as pd

# ãƒ‡ãƒ¼ã‚¿æº–å‚™ï¼ˆOHLCVå¿…é ˆï¼‰
market_data = pd.DataFrame({
    'open': [...],
    'high': [...],
    'low': [...],
    'close': [...],
    'volume': [...]
})

# ç‰¹å¾´é‡ç”Ÿæˆ
feature_generator = FeatureGenerator()
features_df = await feature_generator.generate_features(market_data)

# çµæœç¢ºèªï¼ˆ12ç‰¹å¾´é‡ç”Ÿæˆï¼‰
print(f"ç”Ÿæˆç‰¹å¾´é‡æ•°: {len(features_df.columns) - 5}")
print("ç‰¹å¾´é‡ãƒªã‚¹ãƒˆ:", list(features_df.columns))
```

### **å¾Œæ–¹äº’æ›æ€§ã«ã‚ˆã‚‹ä½¿ç”¨**
```python
# æ—§ã‚¯ãƒ©ã‚¹åã§ã‚‚åˆ©ç”¨å¯èƒ½ï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰
from src.features import TechnicalIndicators, MarketAnomalyDetector

# æ—¢å­˜ã‚³ãƒ¼ãƒ‰ãã®ã¾ã¾å‹•ä½œ
tech_indicators = TechnicalIndicators()
anomaly_detector = MarketAnomalyDetector()

features_df = await tech_indicators.generate_features(market_data)
```

### **ç‰¹å¾´é‡æƒ…å ±ã®å–å¾—**
```python
# ç‰¹å¾´é‡è©³ç´°æƒ…å ±
feature_info = feature_generator.get_feature_info()
print("ã‚«ãƒ†ã‚´ãƒªåˆ¥ç‰¹å¾´é‡:", feature_info['feature_categories'])
print("ç‰¹å¾´é‡èª¬æ˜:", feature_info['feature_descriptions'])
print("åˆè¨ˆç‰¹å¾´é‡æ•°:", feature_info['total_features'])
```

### **è¨­å®šã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º**
```python
# ç•°å¸¸æ¤œçŸ¥ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´
feature_generator = FeatureGenerator(
    lookback_period=30  # ç•°å¸¸æ¤œçŸ¥å‚ç…§æœŸé–“ã‚’30ã«å¤‰æ›´
)

features_df = await feature_generator.generate_features(market_data)
```

## ğŸ“Š 12ç‰¹å¾´é‡è©³ç´°

### **åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ï¼ˆ3å€‹ï¼‰**
- `close`: çµ‚å€¤ï¼ˆåŸºæº–ä¾¡æ ¼ï¼‰
- `volume`: å‡ºæ¥é«˜ï¼ˆå¸‚å ´æ´»å‹•åº¦ï¼‰
- `returns_1`: 1æœŸé–“ãƒªã‚¿ãƒ¼ãƒ³ï¼ˆçŸ­æœŸãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ ï¼‰

### **ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ï¼ˆ6å€‹ï¼‰**
- `rsi_14`: RSI 14æœŸé–“ï¼ˆã‚ªãƒ¼ãƒãƒ¼ãƒœãƒ¼ãƒˆãƒ»ã‚ªãƒ¼ãƒãƒ¼ã‚½ãƒ¼ãƒ«ãƒ‰åˆ¤å®šï¼‰
- `macd`: MACDï¼ˆãƒˆãƒ¬ãƒ³ãƒ‰è»¢æ›ã‚·ã‚°ãƒŠãƒ«ï¼‰
- `macd_signal`: MACDã‚·ã‚°ãƒŠãƒ«ï¼ˆã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼‰
- `atr_14`: ATR 14æœŸé–“ï¼ˆãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£æ¸¬å®šï¼‰
- `bb_position`: ãƒœãƒªãƒ³ã‚¸ãƒ£ãƒ¼ãƒãƒ³ãƒ‰ä½ç½®ï¼ˆä¾¡æ ¼ä½ç½®åˆ¤å®šï¼‰
- `ema_20`: EMA 20æœŸé–“ï¼ˆçŸ­æœŸãƒˆãƒ¬ãƒ³ãƒ‰ï¼‰
- `ema_50`: EMA 50æœŸé–“ï¼ˆä¸­æœŸãƒˆãƒ¬ãƒ³ãƒ‰ï¼‰

### **ç•°å¸¸æ¤œçŸ¥æŒ‡æ¨™ï¼ˆ3å€‹ï¼‰**
- `zscore`: ç§»å‹•Z-Scoreï¼ˆä¾¡æ ¼æ¨™æº–åŒ–ãƒ»ç•°å¸¸å€¤æ¤œçŸ¥ï¼‰
- `volume_ratio`: å‡ºæ¥é«˜æ¯”ç‡ï¼ˆå‡ºæ¥é«˜ç•°å¸¸æ¤œçŸ¥ï¼‰

## ğŸ”§ æœ€é©åŒ–æˆæœ

### **ç‰¹å¾´é‡å‰Šæ¸›åŠ¹æœ**
- **æ¥µé™å‰Šæ¸›**: 97å€‹ â†’ 12å€‹ï¼ˆ87.6%å‰Šæ¸›ï¼‰
- **éå­¦ç¿’é˜²æ­¢**: ä¸è¦ç‰¹å¾´é‡é™¤å»ã«ã‚ˆã‚‹æ±åŒ–æ€§èƒ½å‘ä¸Š
- **è¨ˆç®—åŠ¹ç‡**: é‡è¤‡è¨ˆç®—æ’é™¤ã«ã‚ˆã‚‹8å€é«˜é€ŸåŒ–

### **ã‚³ãƒ¼ãƒ‰çµ±åˆåŠ¹æœ**
- **ãƒ•ã‚¡ã‚¤ãƒ«å‰Šæ¸›**: 3ãƒ•ã‚¡ã‚¤ãƒ« â†’ 1ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ67%å‰Šæ¸›ï¼‰
- **ã‚³ãƒ¼ãƒ‰å‰Šæ¸›**: 461è¡Œ â†’ 590è¡Œï¼ˆçµ±åˆã«ã‚ˆã‚‹æ©Ÿèƒ½è¿½åŠ å«ã‚€ï¼‰
- **é‡è¤‡æ’é™¤**: å…±é€šå‡¦ç†ã®å®Œå…¨çµ±ä¸€åŒ–

### **å“è³ªå‘ä¸ŠåŠ¹æœ**
- **çµ±ä¸€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**: å…¨ç‰¹å¾´é‡ç”Ÿæˆã®ä¸€å…ƒåŒ–
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: çµ±ä¸€ã•ã‚ŒãŸNaNå€¤å‡¦ç†ãƒ»ä¾‹å¤–å‡¦ç†
- **æ¤œè¨¼æ©Ÿèƒ½**: 12ç‰¹å¾´é‡å®Œå…¨ç¢ºèªã‚·ã‚¹ãƒ†ãƒ 

## âš ï¸ é‡è¦äº‹é …

### **ãƒ‡ãƒ¼ã‚¿è¦ä»¶**
- **å¿…é ˆåˆ—**: `open`, `high`, `low`, `close`, `volume`
- **æœ€å°è¡Œæ•°**: 50è¡Œä»¥ä¸Šæ¨å¥¨ï¼ˆç§»å‹•å¹³å‡è¨ˆç®—ã®ãŸã‚ï¼‰
- **ãƒ‡ãƒ¼ã‚¿å“è³ª**: æ¬ æå€¤ãƒ»ç•°å¸¸å€¤ã®äº‹å‰ç¢ºèªæ¨å¥¨

### **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®**
- **å¤§é‡ãƒ‡ãƒ¼ã‚¿**: 10ä¸‡è¡Œè¶…ã®å ´åˆã¯åˆ†å‰²å‡¦ç†æ¨å¥¨
- **ãƒ¡ãƒ¢ãƒªåŠ¹ç‡**: pandasãƒã‚¤ãƒ†ã‚£ãƒ–æœ€é©åŒ–æ¸ˆã¿
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ **: å¢—åˆ†è¨ˆç®—ã«ã‚ˆã‚‹é«˜é€Ÿå‡¦ç†

### **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
- **ãƒ‡ãƒ¼ã‚¿ä¸è¶³**: è­¦å‘Šãƒ­ã‚°å‡ºåŠ›å¾Œã€åˆ©ç”¨å¯èƒ½ãƒ‡ãƒ¼ã‚¿ã§è¨ˆç®—ç¶™ç¶š
- **è¨ˆç®—ã‚¨ãƒ©ãƒ¼**: å€‹åˆ¥ç‰¹å¾´é‡å¤±æ•—æ™‚ã¯è©²å½“ç‰¹å¾´é‡ã®ã¿ã‚¹ã‚­ãƒƒãƒ—
- **NaNå€¤å‡¦ç†**: å‰æ–¹è£œé–“ãƒ»å¾Œæ–¹è£œé–“ãƒ»ã‚¼ãƒ­è£œé–“ã®æ®µéšçš„å‡¦ç†

### **è¨­è¨ˆåŸå‰‡**
- **æ¥µé™æœ€é©åŒ–**: æœ€å°é™ã®ç‰¹å¾´é‡ã§æœ€å¤§åŠ¹æœ
- **çµ±åˆåŠ¹ç‡**: é‡è¤‡æ’é™¤ã«ã‚ˆã‚‹é«˜é€Ÿè¨ˆç®—
- **å“è³ªä¿è¨¼**: 12ç‰¹å¾´é‡å®Œå…¨ç”Ÿæˆã®ç¢ºèªæ©Ÿèƒ½
- **å¾Œæ–¹äº’æ›æ€§**: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¨ã®å®Œå…¨äº’æ›æ€§ç¶­æŒ

### **ä¾å­˜é–¢ä¿‚**
- **å†…éƒ¨ä¾å­˜**: src.core.config.feature_managerï¼ˆç‰¹å¾´é‡å®šç¾©ï¼‰ã€src.core.loggerã€src.core.exceptions
- **å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: pandasï¼ˆãƒ‡ãƒ¼ã‚¿å‡¦ç†ï¼‰ã€numpyï¼ˆæ•°å€¤è¨ˆç®—ï¼‰

---

**ç‰¹å¾´é‡ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ **: 97ç‰¹å¾´é‡ã‹ã‚‰12ç‰¹å¾´é‡ã¸ã®æ¥µé™æœ€é©åŒ–ã«ã‚ˆã‚Šã€é«˜å“è³ªã§åŠ¹ç‡çš„ãªæ©Ÿæ¢°å­¦ç¿’å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’æä¾›ã™ã‚‹çµ±åˆç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã€‚