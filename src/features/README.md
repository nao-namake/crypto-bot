# src/features/ - ç‰¹å¾´é‡ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ 

## ğŸ¯ å½¹å‰²ãƒ»è²¬ä»»

AIè‡ªå‹•å–å¼•ã‚·ã‚¹ãƒ†ãƒ ã®ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°å±¤ã€‚ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ã€ç•°å¸¸æ¤œçŸ¥æŒ‡æ¨™ã€åŸºæœ¬ç‰¹å¾´é‡ã®ç”Ÿæˆã‚’æ‹…å½“ã—ã€15ç‰¹å¾´é‡çµ±ä¸€ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚Šæ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã«é«˜å“è³ªãªå…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’æä¾›ã—ã¾ã™ã€‚feature_order.jsonå˜ä¸€çœŸå®Ÿæºã¨ã®é€£æºã«ã‚ˆã‚Šã€å…¨ã‚·ã‚¹ãƒ†ãƒ ã§ã®ç‰¹å¾´é‡ä¸€è²«æ€§ã‚’ä¿è¨¼ã—ã¾ã™ã€‚

## ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
src/features/
â”œâ”€â”€ __init__.py            # ç‰¹å¾´é‡ã‚·ã‚¹ãƒ†ãƒ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â””â”€â”€ feature_generator.py   # çµ±åˆç‰¹å¾´é‡ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ 
```

## ğŸ”§ ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### **feature_generator.py**

**ç›®çš„**: 15ç‰¹å¾´é‡çµ±ä¸€ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚‹çµ±åˆç‰¹å¾´é‡ç”Ÿæˆãƒ»feature_order.jsoné€£æº

**ä¸»è¦ã‚¯ãƒ©ã‚¹**:
```python
class FeatureGenerator:
    def __init__(self, lookback_period: Optional[int] = None)  # åˆæœŸåŒ–
    async def generate_features(self, market_data) -> pd.DataFrame  # çµ±åˆç‰¹å¾´é‡ç”Ÿæˆ
    def _generate_basic_features(self) -> pd.DataFrame        # åŸºæœ¬ç‰¹å¾´é‡ï¼ˆ2å€‹ï¼‰
    def _generate_technical_indicators(self) -> pd.DataFrame  # ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ï¼ˆ8å€‹ï¼‰
    def _generate_anomaly_indicators(self) -> pd.DataFrame    # ç•°å¸¸æ¤œçŸ¥æŒ‡æ¨™ï¼ˆ5å€‹ï¼‰
    def get_feature_info(self) -> Dict                        # ç‰¹å¾´é‡æƒ…å ±å–å¾—
    def _validate_feature_generation(self)                    # 15ç‰¹å¾´é‡ç¢ºèª

# Phase 21çµ±åˆ: å˜ä¸€ã‚¯ãƒ©ã‚¹ã«ã‚ˆã‚‹çµ±åˆç‰¹å¾´é‡ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ 
```

**15ç‰¹å¾´é‡ã‚·ã‚¹ãƒ†ãƒ **:
```python
# 15ç‰¹å¾´é‡ãƒªã‚¹ãƒˆï¼ˆ7ã‚«ãƒ†ã‚´ãƒªåˆ†é¡ï¼‰
FEATURE_ORDER = [
    # åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ï¼ˆ2å€‹ï¼‰
    "close", "volume",
    
    # ãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ ï¼ˆ2å€‹ï¼‰
    "rsi_14", "macd",
    
    # ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆ2å€‹ï¼‰
    "atr_14", "bb_position",
    
    # ãƒˆãƒ¬ãƒ³ãƒ‰ï¼ˆ2å€‹ï¼‰
    "ema_20", "ema_50",
    
    # å‡ºæ¥é«˜ï¼ˆ1å€‹ï¼‰
    "volume_ratio",
    
    # ãƒ–ãƒ¬ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆï¼ˆ3å€‹ï¼‰
    "donchian_high_20", "donchian_low_20", "channel_position",
    
    # å¸‚å ´ãƒ¬ã‚¸ãƒ¼ãƒ ï¼ˆ3å€‹ï¼‰
    "adx_14", "plus_di_14", "minus_di_14"
]

# ã‚«ãƒ†ã‚´ãƒªåˆ¥åˆ†é¡
FEATURE_CATEGORIES = {
    "basic": ["close", "volume"],
    "momentum": ["rsi_14", "macd"],
    "volatility": ["atr_14", "bb_position"],
    "trend": ["ema_20", "ema_50"],
    "volume": ["volume_ratio"],
    "breakout": ["donchian_high_20", "donchian_low_20", "channel_position"],
    "regime": ["adx_14", "plus_di_14", "minus_di_14"]
}
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### **åŸºæœ¬çš„ãªç‰¹å¾´é‡ç”Ÿæˆ**
```python
from src.features.feature_generator import FeatureGenerator
import pandas as pd

# ãƒ‡ãƒ¼ã‚¿æº–å‚™ï¼ˆOHLCVå¿…é ˆï¼‰
market_data = pd.DataFrame({
    'open': [...],
    'high': [...],
    'low': [...],
    'close': [...],
    'volume': [...]
})

# ç‰¹å¾´é‡ç”Ÿæˆ
feature_generator = FeatureGenerator()
features_df = await feature_generator.generate_features(market_data)

# çµæœç¢ºèªï¼ˆ15ç‰¹å¾´é‡ç”Ÿæˆï¼‰
print(f"ç”Ÿæˆç‰¹å¾´é‡æ•°: {len(features_df.columns) - 5}")  # OHLCVã‚’é™¤ã
print("ç‰¹å¾´é‡ãƒªã‚¹ãƒˆ:", list(features_df.columns))
```


### **ç‰¹å¾´é‡æƒ…å ±ã®å–å¾—**
```python
# ç‰¹å¾´é‡è©³ç´°æƒ…å ±
feature_info = feature_generator.get_feature_info()
print("ã‚«ãƒ†ã‚´ãƒªåˆ¥ç‰¹å¾´é‡:", feature_info['feature_categories'])
print("ç‰¹å¾´é‡èª¬æ˜:", feature_info['feature_descriptions'])
print("åˆè¨ˆç‰¹å¾´é‡æ•°:", feature_info['total_features'])
```

### **feature_order.jsoné€£æºç¢ºèª**
```python
# feature_order.jsonæ•´åˆæ€§ç¢ºèª
from src.core.config.feature_manager import FeatureManager

fm = FeatureManager()
generated_features = await feature_generator.generate_features(market_data)

# é †åºãƒ»æ•´åˆæ€§ç¢ºèª
expected_features = fm.get_feature_names()
actual_features = [col for col in generated_features.columns if col not in ['open', 'high', 'low', 'close', 'volume']]

assert actual_features == expected_features, "ç‰¹å¾´é‡é †åºãŒä¸ä¸€è‡´"
print("âœ… feature_order.jsonæ•´åˆæ€§ç¢ºèªå®Œäº†")
```

### **è¨­å®šã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º**
```python
# ç•°å¸¸æ¤œçŸ¥ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´
feature_generator = FeatureGenerator(
    lookback_period=30  # ç•°å¸¸æ¤œçŸ¥å‚ç…§æœŸé–“ã‚’30ã«å¤‰æ›´
)

features_df = await feature_generator.generate_features(market_data)
```

## ğŸ“Š 15ç‰¹å¾´é‡è©³ç´°

### **åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ï¼ˆ2å€‹ï¼‰**
- `close`: çµ‚å€¤ï¼ˆåŸºæº–ä¾¡æ ¼ï¼‰
- `volume`: å‡ºæ¥é«˜ï¼ˆå¸‚å ´æ´»å‹•åº¦ï¼‰

### **ãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ æŒ‡æ¨™ï¼ˆ2å€‹ï¼‰**
- `rsi_14`: RSI 14æœŸé–“ï¼ˆã‚ªãƒ¼ãƒãƒ¼ãƒœãƒ¼ãƒˆãƒ»ã‚ªãƒ¼ãƒãƒ¼ã‚½ãƒ¼ãƒ«ãƒ‰åˆ¤å®šï¼‰
- `macd`: MACDï¼ˆãƒˆãƒ¬ãƒ³ãƒ‰è»¢æ›ã‚·ã‚°ãƒŠãƒ«ï¼‰

### **ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£æŒ‡æ¨™ï¼ˆ2å€‹ï¼‰**
- `atr_14`: ATR 14æœŸé–“ï¼ˆãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£æ¸¬å®šï¼‰
- `bb_position`: ãƒœãƒªãƒ³ã‚¸ãƒ£ãƒ¼ãƒãƒ³ãƒ‰ä½ç½®ï¼ˆä¾¡æ ¼ä½ç½®åˆ¤å®šï¼‰

### **ãƒˆãƒ¬ãƒ³ãƒ‰æŒ‡æ¨™ï¼ˆ2å€‹ï¼‰**
- `ema_20`: EMA 20æœŸé–“ï¼ˆçŸ­æœŸãƒˆãƒ¬ãƒ³ãƒ‰ï¼‰
- `ema_50`: EMA 50æœŸé–“ï¼ˆä¸­æœŸãƒˆãƒ¬ãƒ³ãƒ‰ï¼‰

### **å‡ºæ¥é«˜æŒ‡æ¨™ï¼ˆ1å€‹ï¼‰**
- `volume_ratio`: å‡ºæ¥é«˜æ¯”ç‡ï¼ˆå‡ºæ¥é«˜ç•°å¸¸æ¤œçŸ¥ï¼‰

### **ãƒ–ãƒ¬ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆæŒ‡æ¨™ï¼ˆ3å€‹ï¼‰**
- `donchian_high_20`: 20æœŸé–“æœ€é«˜å€¤ï¼ˆä¸Šé™ãƒ–ãƒ¬ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆåˆ¤å®šï¼‰
- `donchian_low_20`: 20æœŸé–“æœ€å®‰å€¤ï¼ˆä¸‹é™ãƒ–ãƒ¬ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆåˆ¤å®šï¼‰
- `channel_position`: Donchianãƒãƒ£ãƒãƒ«å†…ä½ç½®ï¼ˆç›¸å¯¾ä½ç½®åˆ¤å®šï¼‰

### **å¸‚å ´ãƒ¬ã‚¸ãƒ¼ãƒ æŒ‡æ¨™ï¼ˆ3å€‹ï¼‰**
- `adx_14`: ADX 14æœŸé–“ï¼ˆãƒˆãƒ¬ãƒ³ãƒ‰å¼·åº¦æ¸¬å®šï¼‰
- `plus_di_14`: +DI 14æœŸé–“ï¼ˆä¸Šæ˜‡æ–¹å‘æ€§æŒ‡æ¨™ï¼‰
- `minus_di_14`: -DI 14æœŸé–“ï¼ˆä¸‹é™æ–¹å‘æ€§æŒ‡æ¨™ï¼‰

## ğŸ”§ çµ±åˆã‚·ã‚¹ãƒ†ãƒ ç‰¹å¾´

### **feature_order.jsonçµ±åˆ**
- **å˜ä¸€çœŸå®Ÿæº**: config/core/feature_order.json ãŒå…¨ã‚·ã‚¹ãƒ†ãƒ ã®ç‰¹å¾´é‡å®šç¾©åŸºæº–
- **çµ±ä¸€ç®¡ç†**: ç‰¹å¾´é‡åãƒ»é †åºãƒ»ã‚«ãƒ†ã‚´ãƒªã®å®Œå…¨ä¸€è‡´ä¿è¨¼
- **ã‚·ã‚¹ãƒ†ãƒ é€£æº**: ç‰¹å¾´é‡ç”Ÿæˆãƒ»æˆ¦ç•¥ãƒ»MLãƒ»ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆã®çµ±åˆæ•´åˆæ€§

### **7ã‚«ãƒ†ã‚´ãƒªåˆ†é¡ã‚·ã‚¹ãƒ†ãƒ **
- **basic**: åŸºæœ¬ä¾¡æ ¼ãƒ»å‡ºæ¥é«˜ãƒ‡ãƒ¼ã‚¿
- **momentum**: ãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ ç³»æŒ‡æ¨™ï¼ˆRSIãƒ»MACDï¼‰
- **volatility**: ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£ç³»æŒ‡æ¨™ï¼ˆATRãƒ»ãƒœãƒªãƒ³ã‚¸ãƒ£ãƒ¼ãƒãƒ³ãƒ‰ï¼‰
- **trend**: ãƒˆãƒ¬ãƒ³ãƒ‰ç³»æŒ‡æ¨™ï¼ˆEMAï¼‰
- **volume**: å‡ºæ¥é«˜ç³»æŒ‡æ¨™
- **breakout**: ãƒ–ãƒ¬ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆç³»æŒ‡æ¨™ï¼ˆDonchianãƒãƒ£ãƒãƒ«ï¼‰
- **regime**: å¸‚å ´ãƒ¬ã‚¸ãƒ¼ãƒ ç³»æŒ‡æ¨™ï¼ˆADXãƒ»DIï¼‰

### **å“è³ªä¿è¨¼ã‚·ã‚¹ãƒ†ãƒ **
- **çµ±ä¸€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**: å…¨ç‰¹å¾´é‡ç”Ÿæˆã®ä¸€å…ƒåŒ–
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: çµ±ä¸€ã•ã‚ŒãŸNaNå€¤å‡¦ç†ãƒ»ä¾‹å¤–å‡¦ç†
- **æ¤œè¨¼æ©Ÿèƒ½**: 15ç‰¹å¾´é‡å®Œå…¨ç¢ºèªã‚·ã‚¹ãƒ†ãƒ 
- **å¾Œæ–¹äº’æ›æ€§**: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¨ã®å®Œå…¨äº’æ›æ€§ç¶­æŒ

## âš ï¸ é‡è¦äº‹é …

### **ãƒ‡ãƒ¼ã‚¿è¦ä»¶**
- **å¿…é ˆåˆ—**: `open`, `high`, `low`, `close`, `volume`
- **æœ€å°è¡Œæ•°**: 50è¡Œä»¥ä¸Šæ¨å¥¨ï¼ˆç§»å‹•å¹³å‡è¨ˆç®—ã®ãŸã‚ï¼‰
- **ãƒ‡ãƒ¼ã‚¿å“è³ª**: æ¬ æå€¤ãƒ»ç•°å¸¸å€¤ã®äº‹å‰ç¢ºèªæ¨å¥¨

### **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®**
- **å¤§é‡ãƒ‡ãƒ¼ã‚¿**: 10ä¸‡è¡Œè¶…ã®å ´åˆã¯åˆ†å‰²å‡¦ç†æ¨å¥¨
- **ãƒ¡ãƒ¢ãƒªåŠ¹ç‡**: pandasãƒã‚¤ãƒ†ã‚£ãƒ–æœ€é©åŒ–æ¸ˆã¿
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ **: å¢—åˆ†è¨ˆç®—ã«ã‚ˆã‚‹é«˜é€Ÿå‡¦ç†

### **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
- **ãƒ‡ãƒ¼ã‚¿ä¸è¶³**: è­¦å‘Šãƒ­ã‚°å‡ºåŠ›å¾Œã€åˆ©ç”¨å¯èƒ½ãƒ‡ãƒ¼ã‚¿ã§è¨ˆç®—ç¶™ç¶š
- **è¨ˆç®—ã‚¨ãƒ©ãƒ¼**: å€‹åˆ¥ç‰¹å¾´é‡å¤±æ•—æ™‚ã¯è©²å½“ç‰¹å¾´é‡ã®ã¿ã‚¹ã‚­ãƒƒãƒ—
- **NaNå€¤å‡¦ç†**: å‰æ–¹è£œé–“ãƒ»å¾Œæ–¹è£œé–“ãƒ»ã‚¼ãƒ­è£œé–“ã®æ®µéšçš„å‡¦ç†

### **è¨­è¨ˆåŸå‰‡**
- **çµ±ä¸€ã‚·ã‚¹ãƒ†ãƒ **: feature_order.jsonå˜ä¸€çœŸå®Ÿæºã¨ã®å®Œå…¨æ•´åˆæ€§
- **çµ±åˆåŠ¹ç‡**: é‡è¤‡æ’é™¤ã«ã‚ˆã‚‹é«˜é€Ÿè¨ˆç®—
- **å“è³ªä¿è¨¼**: 15ç‰¹å¾´é‡å®Œå…¨ç”Ÿæˆã®ç¢ºèªæ©Ÿèƒ½
- **å¾Œæ–¹äº’æ›æ€§**: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¨ã®å®Œå…¨äº’æ›æ€§ç¶­æŒ

### **ä¾å­˜é–¢ä¿‚**
- **å†…éƒ¨ä¾å­˜**: src.core.config.feature_managerï¼ˆç‰¹å¾´é‡å®šç¾©ï¼‰ã€src.core.loggerã€src.core.exceptions
- **å¤–éƒ¨è¨­å®š**: config/core/feature_order.jsonï¼ˆ15ç‰¹å¾´é‡çµ±ä¸€å®šç¾©ï¼‰
- **å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: pandasï¼ˆãƒ‡ãƒ¼ã‚¿å‡¦ç†ï¼‰ã€numpyï¼ˆæ•°å€¤è¨ˆç®—ï¼‰

---

**ç‰¹å¾´é‡ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ **: feature_order.jsonå˜ä¸€çœŸå®Ÿæºã¨é€£æºã—ãŸ15ç‰¹å¾´é‡çµ±ä¸€ã‚·ã‚¹ãƒ†ãƒ ã€‚7ã‚«ãƒ†ã‚´ãƒªåˆ†é¡ã«ã‚ˆã‚‹ä½“ç³»çš„ç‰¹å¾´é‡ç®¡ç†ã«ã‚ˆã‚Šã€é«˜å“è³ªã§åŠ¹ç‡çš„ãªæ©Ÿæ¢°å­¦ç¿’å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’æä¾›ã™ã‚‹çµ±åˆç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã€‚