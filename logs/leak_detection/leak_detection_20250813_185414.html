
<!DOCTYPE html>
<html>
<head>
    <title>Future Data Leak Detection Report</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .header { background-color: #2c3e50; color: white; padding: 25px; border-radius: 8px; }
        .status { font-size: 36px; color: yellow; font-weight: bold; margin: 20px 0; }
        .section { background-color: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .issue { padding: 15px; margin: 10px 0; border-left: 4px solid; background-color: #f9f9f9; }
        .CRITICAL { border-color: #e74c3c; background-color: #ffe6e6; }
        .HIGH { border-color: #e67e22; background-color: #fff4e6; }
        .MEDIUM { border-color: #f39c12; background-color: #fffae6; }
        .LOW { border-color: #3498db; background-color: #e6f3ff; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #34495e; color: white; }
        .code { font-family: 'Courier New', monospace; background-color: #2c3e50; color: #ecf0f1; padding: 3px 6px; border-radius: 3px; }
        .recommendation { background-color: #d4edda; padding: 15px; border-radius: 5px; margin: 15px 0; }
        .metric { display: inline-block; padding: 10px 20px; margin: 10px; background-color: white; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    <div class="header">
        <h1>🔍 Future Data Leak Detection Report</h1>
        <p>Generated: 2025-08-13 18:54:14</p>
        <div class="status">MEDIUM PRIORITY ISSUES</div>
    </div>
    
    <div class="section">
        <h2>📊 Scan Summary</h2>
        <div>
            <span class="metric">📁 Files Scanned: 10435</span>
            <span class="metric">⚠️ Total Issues: 22</span>
            <span class="metric">🔴 Critical: 0</span>
            <span class="metric">🟠 High: 0</span>
            <span class="metric">🟡 Medium: 22</span>
        </div>
    </div>
    
    <div class="section">
        <h2>⚠️ Issues Found</h2>

        <div class="issue MEDIUM">
            <strong>MEDIUM</strong>: Potential future data leak: future
            <br>📁 File: /Users/nao/Desktop/bot/crypto_bot/ml/timeframe_ensemble.py
            <br>📍 Line 9: <span class="code">from __future__ import annotations</span>
        </div>

        <div class="issue MEDIUM">
            <strong>MEDIUM</strong>: Potential future data leak: future
            <br>📁 File: /Users/nao/Desktop/bot/crypto_bot/ml/ensemble.py
            <br>📍 Line 8: <span class="code">from __future__ import annotations</span>
        </div>

        <div class="issue MEDIUM">
            <strong>MEDIUM</strong>: Potential future data leak: future
            <br>📁 File: /Users/nao/Desktop/bot/crypto_bot/ml/preprocessing/feature_engineer.py
            <br>📍 Line 15: <span class="code">from __future__ import annotations</span>
        </div>

        <div class="issue MEDIUM">
            <strong>MEDIUM</strong>: Potential future data leak: future
            <br>📁 File: /Users/nao/Desktop/bot/crypto_bot/ml/preprocessing/dataset_processor.py
            <br>📍 Line 14: <span class="code">from __future__ import annotations</span>
        </div>

        <div class="issue MEDIUM">
            <strong>MEDIUM</strong>: Potential future data leak: future
            <br>📁 File: /Users/nao/Desktop/bot/crypto_bot/ml/preprocessing/pipeline_builder.py
            <br>📍 Line 15: <span class="code">from __future__ import annotations</span>
        </div>

        <div class="issue MEDIUM">
            <strong>MEDIUM</strong>: Potential future data leak: future
            <br>📁 File: /Users/nao/Desktop/bot/crypto_bot/ml/preprocessing/utils.py
            <br>📍 Line 14: <span class="code">from __future__ import annotations</span>
        </div>

        <div class="issue MEDIUM">
            <strong>MEDIUM</strong>: Potential future data leak: forward
            <br>📁 File: /Users/nao/Desktop/bot/crypto_bot/backtest/metrics.py
            <br>📍 Line 13: <span class="code">def split_walk_forward(</span>
        </div>

        <div class="issue MEDIUM">
            <strong>MEDIUM</strong>: Potential future data leak: future
            <br>📁 File: /Users/nao/Desktop/bot/crypto_bot/strategy/ml_strategy.py
            <br>📍 Line 12: <span class="code">from __future__ import annotations</span>
        </div>

        <div class="issue MEDIUM">
            <strong>MEDIUM</strong>: Potential future data leak: future
            <br>📁 File: /Users/nao/Desktop/bot/crypto_bot/strategy/ensemble_ml_strategy.py
            <br>📍 Line 8: <span class="code">from __future__ import annotations</span>
        </div>

        <div class="issue MEDIUM">
            <strong>MEDIUM</strong>: Potential future data leak: future
            <br>📁 File: /Users/nao/Desktop/bot/crypto_bot/strategy/registry.py
            <br>📍 Line 8: <span class="code">from __future__ import annotations</span>
        </div>

        <div class="issue MEDIUM">
            <strong>MEDIUM</strong>: Potential future data leak: future
            <br>📁 File: /Users/nao/Desktop/bot/crypto_bot/strategy/factory.py
            <br>📍 Line 8: <span class="code">from __future__ import annotations</span>
        </div>

        <div class="issue MEDIUM">
            <strong>MEDIUM</strong>: Potential future data leak: future
            <br>📁 File: /Users/nao/Desktop/bot/crypto_bot/strategy/simple_ma.py
            <br>📍 Line 8: <span class="code">from __future__ import annotations</span>
        </div>

        <div class="issue MEDIUM">
            <strong>MEDIUM</strong>: Potential future data leak: future
            <br>📁 File: /Users/nao/Desktop/bot/crypto_bot/strategy/composite.py
            <br>📍 Line 8: <span class="code">from __future__ import annotations</span>
        </div>

        <div class="issue MEDIUM">
            <strong>MEDIUM</strong>: Potential future data leak: future
            <br>📁 File: /Users/nao/Desktop/bot/crypto_bot/strategy/aggressive_ml_strategy.py
            <br>📍 Line 9: <span class="code">from __future__ import annotations</span>
        </div>

        <div class="issue MEDIUM">
            <strong>MEDIUM</strong>: Potential future data leak: \.tail\(
            <br>📁 File: /Users/nao/Desktop/bot/crypto_bot/strategy/aggressive_ml_strategy.py
            <br>📍 Line 204: <span class="code">recent_4h = data.tail(4)</span>
        </div>

        <div class="issue MEDIUM">
            <strong>MEDIUM</strong>: Potential future data leak: \.tail\(
            <br>📁 File: /Users/nao/Desktop/bot/crypto_bot/strategy/aggressive_ml_strategy.py
            <br>📍 Line 212: <span class="code">recent_12h = data.tail(12)</span>
        </div>

        <div class="issue MEDIUM">
            <strong>MEDIUM</strong>: Potential future data leak: \.tail\(
            <br>📁 File: /Users/nao/Desktop/bot/crypto_bot/strategy/aggressive_ml_strategy.py
            <br>📍 Line 218: <span class="code">short_trend = data["close"].tail(4).pct_change().sum()</span>
        </div>

        <div class="issue MEDIUM">
            <strong>MEDIUM</strong>: Potential future data leak: \.tail\(
            <br>📁 File: /Users/nao/Desktop/bot/crypto_bot/strategy/aggressive_ml_strategy.py
            <br>📍 Line 219: <span class="code">medium_trend = data["close"].tail(12).pct_change().sum()</span>
        </div>

        <div class="issue MEDIUM">
            <strong>MEDIUM</strong>: Potential future data leak: \.tail\(
            <br>📁 File: /Users/nao/Desktop/bot/crypto_bot/strategy/aggressive_ml_strategy.py
            <br>📍 Line 220: <span class="code">long_trend = data["close"].tail(24).pct_change().sum()</span>
        </div>

        <div class="issue MEDIUM">
            <strong>MEDIUM</strong>: Potential future data leak: \.tail\(
            <br>📁 File: /Users/nao/Desktop/bot/crypto_bot/strategy/aggressive_ml_strategy.py
            <br>📍 Line 399: <span class="code">recent_volatility = data["close"].tail(20).pct_change().std()</span>
        </div>

    </div>
    
    <div class="section">
        <h2>💡 Recommendations</h2>
        <div class="recommendation">
            <h3>Best Practices to Prevent Future Data Leaks:</h3>
            <ul>
                <li>✅ Always use <code>shift(1)</code> or higher for past data, never negative values</li>
                <li>✅ Use <code>rolling(window)</code> without <code>center=True</code></li>
                <li>✅ When using <code>iloc</code>, ensure indices reference past data only</li>
                <li>✅ Split train/test data chronologically with no overlap</li>
                <li>✅ Validate feature consistency: features computed on partial data should match when computed on full data</li>
                <li>✅ Add timestamp checks in production to ensure no future data access</li>
            </ul>
        </div>
    </div>
    
    <div class="section">
        <h2>📈 Common Patterns Detected</h2>
        <table>
            <tr>
                <th>Pattern</th>
                <th>Risk Level</th>
                <th>Example</th>
                <th>Safe Alternative</th>
            </tr>
            <tr>
                <td>Future Shift</td>
                <td style="color: red;">HIGH</td>
                <td><code>df.shift(-1)</code></td>
                <td><code>df.shift(1)</code></td>
            </tr>
            <tr>
                <td>Center Rolling</td>
                <td style="color: orange;">MEDIUM</td>
                <td><code>df.rolling(5, center=True)</code></td>
                <td><code>df.rolling(5)</code></td>
            </tr>
            <tr>
                <td>Future Indexing</td>
                <td style="color: red;">HIGH</td>
                <td><code>df.iloc[i:i+10]</code></td>
                <td><code>df.iloc[max(0,i-10):i]</code></td>
            </tr>
        </table>
    </div>
</body>
</html>
