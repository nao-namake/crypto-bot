# ========================================
# æœ¬ç•ªé‹ç”¨è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« (production.yaml)
# ========================================
# 
# Phase 13å®Œæˆç‰ˆ: ãƒ©ã‚¤ãƒ–ãƒ¢ãƒ¼ãƒ‰æœ¬ç•ªé‹ç”¨æœ€é©åŒ–è¨­å®š
# ä½œæˆæ—¥: 2025å¹´8æœˆ22æ—¥
# ç›®çš„: å®Ÿå–å¼•ç’°å¢ƒã§ã®å®‰å…¨ãƒ»ç¢ºå®Ÿãƒ»åŠ¹ç‡çš„ãªé‹ç”¨
#
# é‡è¦: æœ¬è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ©ã‚¤ãƒ–ãƒ¢ãƒ¼ãƒ‰å°‚ç”¨ã§ã™
#       ãƒšãƒ¼ãƒ‘ãƒ¼ãƒˆãƒ¬ãƒ¼ãƒ‰ã«ã¯ base.yaml ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„
#
# ========================================
# åŸºæœ¬è¨­å®šï¼ˆæœ¬ç•ªé‹ç”¨ï¼‰
# ========================================

# æœ¬ç•ªãƒ¢ãƒ¼ãƒ‰ï¼ˆå®Ÿå–å¼•ï¼‰
mode: live  # ğŸš¨ æœ¬ç•ªãƒ¢ãƒ¼ãƒ‰: å®Ÿéš›ã®è³‡é‡‘ã§ã®å–å¼•

# å–å¼•æ‰€è¨­å®šï¼ˆæœ¬ç•ªç”¨ï¼‰
exchange:
  name: bitbank
  symbol: "BTC/JPY"
  
  # APIåˆ¶é™ï¼ˆæœ¬ç•ªç”¨å³æ ¼è¨­å®šï¼‰
  rate_limit_ms: 35000      # 35ç§’é–“éš”ï¼ˆæœ¬ç•ªå®‰å…¨ãƒãƒ¼ã‚¸ãƒ³ï¼‰
  timeout_ms: 120000        # 2åˆ†ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆæœ¬ç•ªå®‰å…¨æ€§ï¼‰
  retries: 5                # ãƒªãƒˆãƒ©ã‚¤å›æ•°å¢—åŠ ï¼ˆæœ¬ç•ªä¿¡é ¼æ€§ï¼‰
  
  # æœ¬ç•ªç”¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–
  ssl_verify: true          # SSLè¨¼æ˜æ›¸æ¤œè¨¼å¿…é ˆ
  api_version: "v1"         # APIãƒãƒ¼ã‚¸ãƒ§ãƒ³å›ºå®š

# ========================================
# æ©Ÿæ¢°å­¦ç¿’è¨­å®šï¼ˆæœ¬ç•ªæœ€é©åŒ–ï¼‰
# ========================================
ml:
  # æœ¬ç•ªç”¨ä¿¡é ¼åº¦é–¾å€¤ï¼ˆä¿å®ˆçš„ï¼‰
  confidence_threshold: 0.40  # 40%ï¼ˆæœ¬ç•ªã§ã¯ä¿å®ˆçš„ãªåˆ¤å®šï¼‰
  
  # ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ãƒ¢ãƒ‡ãƒ«è¨­å®š
  ensemble_enabled: true
  models: ["lgbm", "xgb", "rf"]
  model_weights: [0.5, 0.3, 0.2]  # LightGBMé‡è¦–ï¼ˆå®Ÿç¸¾ãƒ™ãƒ¼ã‚¹ï¼‰
  
  # æœ¬ç•ªç”¨ãƒ¢ãƒ‡ãƒ«ç®¡ç†
  model_path: "/app/models/production/production_ensemble.pkl"
  model_update_check: true     # ãƒ¢ãƒ‡ãƒ«æ›´æ–°ãƒã‚§ãƒƒã‚¯æœ‰åŠ¹
  fallback_enabled: true       # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½æœ‰åŠ¹

# ========================================
# ãƒªã‚¹ã‚¯ç®¡ç†è¨­å®šï¼ˆæœ¬ç•ªç”¨å³æ ¼ç®¡ç†ï¼‰
# ========================================
risk:
  # åŸºæœ¬ãƒªã‚¹ã‚¯è¨­å®šï¼ˆä¿å®ˆçš„ï¼‰
  risk_per_trade: 0.008        # 0.8%ï¼ˆæœ¬ç•ªã¯ä¿å®ˆçš„ï¼‰
  kelly_max_fraction: 0.025    # KellyåŸºæº–æœ€å¤§2.5%
  max_drawdown: 0.15           # æœ€å¤§ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³15%ï¼ˆå³æ ¼ï¼‰
  consecutive_loss_limit: 4     # é€£ç¶šæå¤±3å›ã§ä¸€æ™‚åœæ­¢
  
  # ã‚¹ãƒˆãƒƒãƒ—ãƒ­ã‚¹è¨­å®š
  stop_loss_atr_multiplier: 1.0  # ATRã®1.0å€ï¼ˆå³æ ¼ï¼‰
  take_profit_ratio: 2.0         # ãƒªã‚¹ã‚¯ãƒªãƒ¯ãƒ¼ãƒ‰æ¯”1:2
  
  # æœ¬ç•ªç”¨è¿½åŠ ä¿è­·æ©Ÿèƒ½
  daily_loss_limit: 0.05         # æ—¥æ¬¡æå¤±é™åº¦5%
  weekly_loss_limit: 0.10        # é€±æ¬¡æå¤±é™åº¦10%
  emergency_stop_enabled: true   # ç·Šæ€¥åœæ­¢æ©Ÿèƒ½æœ‰åŠ¹

# ========================================
# ãƒ‡ãƒ¼ã‚¿å–å¾—è¨­å®šï¼ˆæœ¬ç•ªç”¨ï¼‰
# ========================================
data:
  # ã‚¿ã‚¤ãƒ ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆãƒ¬ã‚¬ã‚·ãƒ¼å®Ÿè¨¼æ¸ˆã¿ï¼‰
  timeframes: ["15m", "1h", "4h"]
  since_hours: 96       # 4æ—¥åˆ†ï¼ˆBitbankå®‰å®šç¯„å›²ï¼‰
  limit: 100           # ç¢ºå®Ÿãªå–å¾—æ•°
  
  # ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®š
  cache:
    enabled: true
    ttl_minutes: 5      # 5åˆ†é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥
    max_size: 1000      # æœ€å¤§1000ã‚¨ãƒ³ãƒˆãƒª
    disk_cache: true
    retention_days: 90  # 90æ—¥ä¿å­˜

# ç‰¹å¾´é‡è¨­å®šï¼ˆPhase 3æœ€é©åŒ–ç‰ˆï¼‰
features:
  mode: "optimized"  # 12å€‹å³é¸ç‰¹å¾´é‡
  
  # åŸºæœ¬ç‰¹å¾´é‡
  basic:
    - "close"
    - "volume" 
    - "returns_1"
  
  # ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™
  technical:
    - "rsi_14"
    - "macd"
    - "atr_14"
    - "bb_position"
    - "ema_20"
    - "ema_50"
  
  # ç•°å¸¸æ¤œçŸ¥
  anomaly:
    - "zscore"
    - "volume_ratio"
    - "market_stress"

# æˆ¦ç•¥è¨­å®šï¼ˆPhase 4çµ±åˆç‰ˆï¼‰
strategies:
  enabled:
    - "atr_based"
    - "mochipoy_alert"
    - "multi_timeframe"
    - "fibonacci_retracement"
  
  # æˆ¦ç•¥é‡ã¿ï¼ˆå®Ÿç¸¾ãƒ™ãƒ¼ã‚¹ï¼‰
  weights:
    atr_based: 0.3
    mochipoy_alert: 0.3
    multi_timeframe: 0.25
    fibonacci_retracement: 0.15
  
  # çµ±åˆåˆ¤å®š
  consensus:
    required_agreement: 0.6  # 60%ä»¥ä¸Šã®åˆæ„ã§å®Ÿè¡Œ
    confidence_threshold: 0.4

# æ©Ÿæ¢°å­¦ç¿’è¨­å®šï¼ˆPhase 8ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆæœ€é©åŒ–ï¼‰
ml:
  ensemble_enabled: true      # ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«æœ‰åŠ¹
  confidence_threshold: 0.5   # Phase 8æœ€é©åŒ–ï¼ˆ0.25â†’0.5ãƒ»é©åˆ‡ãªç²¾åº¦ç¢ºä¿ï¼‰
  
  # ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«è¨­å®šï¼ˆãƒ¬ã‚¬ã‚·ãƒ¼å®Ÿç¸¾ãƒ™ãƒ¼ã‚¹ï¼‰
  models:
    - "lgbm"     # å®Ÿç¸¾ã®ã‚ã‚‹3ãƒ¢ãƒ‡ãƒ«
    - "xgb"
    - "rf"
  
  model_weights:  # æœ€é©åŒ–æ¸ˆã¿é‡ã¿
    - 0.5         # LightGBM
    - 0.3         # XGBoost
    - 0.2         # RandomForest
  
  # äºˆæ¸¬è¨­å®š
  prediction:
    lookback_periods: 100
    retrain_frequency: "weekly"

# ãƒªã‚¹ã‚¯ç®¡ç†è¨­å®šï¼ˆPhase 6å®Œå…¨ç‰ˆãƒ»ãƒ¬ã‚¬ã‚·ãƒ¼å®Ÿè¨¼å€¤æ´»ç”¨ï¼‰
risk:
  # KellyåŸºæº–ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚µã‚¤ã‚¸ãƒ³ã‚°ï¼ˆPhase 8ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆæœ€é©åŒ–ï¼‰
  kelly_criterion:
    max_position_ratio: 0.05    # æœ€å¤§5%ï¼ˆPhase 8æœ€é©åŒ–ãƒ»éåº¦ãªä¿å®ˆæ€§è§£æ¶ˆï¼‰
    safety_factor: 0.7          # Kellyå€¤ã®70%ä½¿ç”¨
    min_trades_for_kelly: 20
  
  # Phase 8ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆæœ€é©åŒ–è¨­å®š
  risk_per_trade: 0.01        # 1å–å¼•ã‚ãŸã‚Š1%ï¼ˆå®‰å…¨ãƒ»ç¶­æŒï¼‰
  kelly_max_fraction: 0.05    # KellyåŸºæº–æœ€å¤§5%ï¼ˆPhase 8æœ€é©åŒ–: 0.03â†’0.05ï¼‰
  max_drawdown: 0.20          # æœ€å¤§ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³20%
  stop_loss_atr_multiplier: 1.2  # 1.2Ã—ATRæåˆ‡ã‚Šï¼ˆãƒ¬ã‚¬ã‚·ãƒ¼å®Ÿè¨¼å€¤ï¼‰
  consecutive_loss_limit: 5   # é€£ç¶š5æå¤±ã§24æ™‚é–“åœæ­¢
  
  # ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³ç®¡ç†
  drawdown_manager:
    max_drawdown_ratio: 0.20    # 20%ä¸Šé™
    consecutive_loss_limit: 5   # é€£ç¶š5æå¤±ã§åœæ­¢
    cooldown_hours: 24          # 24æ™‚é–“ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³
  
  # ç•°å¸¸æ¤œçŸ¥ï¼ˆPhase 6ï¼‰
  anomaly_detector:
    spread_warning_threshold: 0.003   # 0.3%
    spread_critical_threshold: 0.005  # 0.5%
    api_latency_warning: 1.0         # 1ç§’
    api_latency_critical: 3.0        # 3ç§’
  
  # çµ±åˆåˆ¤å®šé–¾å€¤ï¼ˆPhase 8ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆæœ€é©åŒ–ï¼‰
  risk_thresholds:
    min_ml_confidence: 0.5         # æœ€å°MLä¿¡é ¼åº¦50%ï¼ˆPhase 8æœ€é©åŒ–: 0.25â†’0.5ï¼‰
    risk_threshold_deny: 0.8       # 80%ä»¥ä¸Šã§DENY
    risk_threshold_conditional: 0.6 # 60%ä»¥ä¸Šã§æ¡ä»¶ä»˜ã

# æ³¨æ–‡å®Ÿè¡Œè¨­å®šï¼ˆPhase 7ï¼‰
execution:
  mode: "live"  # æœ¬ç•ªã¯å®Ÿå–å¼•
  
  # æ³¨æ–‡è¨­å®šï¼ˆãƒ¬ã‚¬ã‚·ãƒ¼å®Ÿè¨¼æ¸ˆã¿å€¤ï¼‰
  order:
    default_type: "limit"  # æŒ‡å€¤æ³¨æ–‡å„ªå…ˆ
    slippage_tolerance: 0.001  # 0.1%ã‚¹ãƒªãƒƒãƒšãƒ¼ã‚¸è¨±å®¹
    max_retry: 3
    retry_delay: 1.0  # 1ç§’é–“éš”
  
  # ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ç›®æ¨™ï¼ˆPhase 7ï¼‰
  latency:
    target_ms: 1000    # 1ç§’ä»¥å†…
    warning_ms: 500    # 500msè­¦å‘Š
    critical_ms: 2000  # 2ç§’ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«

# æœ¬ç•ªå°‚ç”¨è¨­å®šï¼ˆPhase 7åç›Šæ€§æœ€é©åŒ–ãƒ»ãƒ¬ã‚¬ã‚·ãƒ¼å‚è€ƒå€¤æ¡ç”¨ï¼‰
production:
  min_order_size: 0.0001     # æœ€å°æ³¨æ–‡ã‚µã‚¤ã‚º
  max_order_size: 0.001      # æœ€å¤§æ³¨æ–‡ã‚µã‚¤ã‚ºï¼ˆ0.0005â†’0.001ãƒ»åç›Šæ€§å‘ä¸Šï¼‰
  trade_interval: 60         # å–å¼•é–“éš”ï¼ˆç§’ï¼‰
  margin_trading: true       # ä¿¡ç”¨å–å¼•æœ‰åŠ¹
  force_margin_mode: true    # ä¿¡ç”¨å–å¼•å¼·åˆ¶

# ãƒ­ã‚°è¨­å®šï¼ˆãƒ¬ã‚¬ã‚·ãƒ¼æœ€é©åŒ–ç¶™æ‰¿ï¼‰
logging:
  level: "INFO"              # æœ¬ç•ªæƒ…å ±ãƒ¬ãƒ™ãƒ«
  file_enabled: true         # ãƒ•ã‚¡ã‚¤ãƒ«è¨˜éŒ²å¿…é ˆ
  discord_enabled: true      # Discordç›£è¦–å¿…é ˆ
  retention_days: 30         # æœ¬ç•ªã¯é•·æœŸä¿æŒ
  
  # ãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ã‚°
  file:
    enabled: true
    path: "logs/production"
    rotation: "daily"
    retention_days: 30
    max_size_mb: 100
  
  # Discordé€šçŸ¥
  discord:
    enabled: true
    webhook_url: "${DISCORD_WEBHOOK_URL}"
    
    # é€šçŸ¥ãƒ¬ãƒ™ãƒ«è¨­å®š
    levels:
      critical: true   # å–å¼•åœæ­¢ã€é‡å¤§ã‚¨ãƒ©ãƒ¼
      warning: true    # APIé…å»¶ã€ç•°å¸¸å€¤
      info: false      # é€šå¸¸å–å¼•ï¼ˆæœ¬ç•ªã§ã¯ç„¡åŠ¹åŒ–ï¼‰

# ç›£è¦–ãƒ»ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
monitoring:
  # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
  health_check:
    enabled: true
    interval_seconds: 30
    timeout_seconds: 5
    
  # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
  performance:
    enabled: true
    metrics_interval: 300  # 5åˆ†é–“éš”

# GCP Cloud Runæœ€é©åŒ–
cloud_run:
  # ãƒªã‚½ãƒ¼ã‚¹è¨­å®š
  memory: "2Gi"
  cpu: 1
  
  # ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
  min_instances: 1     # æœ¬ç•ªã¯å¸¸æ™‚ç¨¼åƒ
  max_instances: 1     # å˜ä¸€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
  concurrency: 1       # å–å¼•æ•´åˆæ€§ç¢ºä¿
  
  # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
  timeout_seconds: 3600  # 1æ™‚é–“