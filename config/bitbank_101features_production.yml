# =============================================================================
# ãƒ•ã‚¡ã‚¤ãƒ«å: config/bitbank_101features_production.yml
# èª¬æ˜:
# Bitbankæœ¬ç•ªé‹ç”¨ãƒ»101ç‰¹å¾´é‡ç‰ˆï¼ˆVIXãƒ»DXYçµ±åˆå®Œå…¨ç‰ˆï¼‰
# - 100%å‹ç‡ãƒ»ã‚¼ãƒ­ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³å®Ÿè¨¼æ¸ˆã¿è¨­å®š
# - JPYå»ºã¦ãƒ»1ä¸‡å††ãƒ•ãƒ­ãƒ³ãƒˆãƒ†ã‚¹ãƒˆå¯¾å¿œ
# - ä¿¡ç”¨å–å¼•å¯¾å¿œï¼ˆãƒ¬ãƒãƒ¬ãƒƒã‚¸1å€å®‰å…¨é‹ç”¨ï¼‰
# =============================================================================

# ----------------------------------------------------------------------
# ãƒ‡ãƒ¼ã‚¿å–å¾—è¨­å®šï¼ˆBitbankæœ¬ç•ªãƒ»JPYå»ºã¦ï¼‰
# ----------------------------------------------------------------------
data:
  exchange: bitbank
  symbol: BTC/JPY  # JPYå»ºã¦å–å¼•
  timeframe: 1h

  # ------ Bitbank æœ¬ç•ªã‚ªãƒ—ã‚·ãƒ§ãƒ³ ------
  api_key: ${BITBANK_API_KEY}
  api_secret: ${BITBANK_API_SECRET}
  ccxt_options:
    enableRateLimit: true
    rateLimit: 1000  # Bitbank APIåˆ¶é™å¯¾å¿œ
  # --------------------------------------

  # å­¦ç¿’ç”¨ãƒ‡ãƒ¼ã‚¿å–å¾—ç¯„å›²
  since: "2024-01-01T00:00:00Z"
  limit: 8000  # ç´„11ãƒ¶æœˆåˆ†ã®1æ™‚é–“è¶³ãƒ‡ãƒ¼ã‚¿
  paginate: true
  per_page: 200  # Bitbankåˆ¶é™å¯¾å¿œ

# ----------------------------------------------------------------------
# æˆ¦ç•¥è¨­å®šï¼ˆ101ç‰¹å¾´é‡ãƒ»100%å‹ç‡å®Ÿè¨¼æ¸ˆã¿ï¼‰
# ----------------------------------------------------------------------
strategy:
  type: single
  name: ml
  params:
    model_path: model.pkl  # 101ç‰¹å¾´é‡å¯¾å¿œãƒ¢ãƒ‡ãƒ«
    threshold: 0.05  # å®Ÿè¨¼æ¸ˆã¿æœ€é©é–¾å€¤
    
    # å‹•çš„é–¾å€¤èª¿æ•´ï¼ˆå®Ÿè¨¼æ¸ˆã¿è¨­å®šï¼‰
    atr_multiplier: 0.5
    volatility_adjustment: true
    threshold_bounds: [0.01, 0.25]
    
    thresholds_to_test:
      - 0.02
      - 0.05
      - 0.08
      - 0.10
      - 0.15

# ----------------------------------------------------------------------
# ãƒªã‚¹ã‚¯ç®¡ç†ï¼ˆ1ä¸‡å††ãƒ•ãƒ­ãƒ³ãƒˆãƒ†ã‚¹ãƒˆå¯¾å¿œï¼‰
# ----------------------------------------------------------------------
risk:
  risk_per_trade: 0.01   # 1%ãƒªã‚¹ã‚¯ï¼ˆ1ä¸‡å††Ã—1% = 100å††ãƒªã‚¹ã‚¯ï¼‰
  stop_atr_mult: 1.5     # ã‚¿ã‚¤ãƒˆã‚¹ãƒˆãƒƒãƒ—ãƒ­ã‚¹
  dynamic_position_sizing:
    enabled: true
    formula: linear
  
  # KellyåŸºæº–ï¼ˆå®Ÿè¨¼æ¸ˆã¿è¨­å®šï¼‰
  kelly_criterion:
    enabled: true
    lookback_window: 30
    max_fraction: 0.10   # 10%ä¸Šé™ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆãƒ†ã‚¹ãƒˆç”¨ä¿å®ˆçš„ï¼‰
    min_trades_required: 10

# ----------------------------------------------------------------------
# ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆè¨­å®šï¼ˆ1ä¸‡å††æƒ³å®šï¼‰
# ----------------------------------------------------------------------
backtest:
  starting_balance: 10000.0  # 1ä¸‡å††ï¼ˆJPYï¼‰
  slippage_rate: 0.004      # Bitbankç¾å®Ÿçš„ã‚¹ãƒªãƒƒãƒšãƒ¼ã‚¸
  commission_rate: 0.0012   # Bitbankç¾ç‰©å¹³å‡æ‰‹æ•°æ–™
  trade_log_csv: "./results/trade_log_bitbank_101feat.csv"
  aggregate_out_prefix: "./results/aggregate_bitbank_101feat"

# ----------------------------------------------------------------------
# ã‚¦ã‚©ãƒ¼ã‚¯ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰åˆ†å‰²ï¼ˆå®Ÿè¨¼æ¸ˆã¿è¨­å®šï¼‰
# ----------------------------------------------------------------------
walk_forward:
  train_window: 1000     # ç´„1.5ãƒ¶æœˆå­¦ç¿’
  test_window: 168       # 1é€±é–“ãƒ†ã‚¹ãƒˆ
  step: 168              # 1é€±é–“ã‚¹ãƒ©ã‚¤ãƒ‰

# ----------------------------------------------------------------------
# æ©Ÿæ¢°å­¦ç¿’ï¼ˆ101ç‰¹å¾´é‡å®Œå…¨ç‰ˆãƒ»VIXãƒ»DXYçµ±åˆï¼‰
# ----------------------------------------------------------------------
ml:
  feat_period: 14
  lags: [1,2,3,4,5,6,7,8,9,10,11,12]
  rolling_window: 20
  horizon: 5
  target_type: classification
  model_type: lgbm

  # VIXçµ±åˆè¨­å®šï¼ˆå®Ÿè¨¼æ¸ˆã¿ï¼‰
  vix_integration:
    enabled: true
    risk_off_threshold: 25
    panic_threshold: 35
    spike_multiplier: 2.0

  # ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ãƒ¢ãƒ‡ãƒ«è¨­å®šï¼ˆå®Ÿè¨¼æ¸ˆã¿ï¼‰
  ensemble:
    enabled: true
    method: stacking
    weights: [0.4, 0.3, 0.3]
    
    base_models:
      - type: lgbm
        n_estimators: 89
        max_depth: 9
        learning_rate: 0.09558059446177633
        bagging_fraction: 0.6
        lambda_l1: 1.0
        lambda_l2: 0.5
      - type: rf
        n_estimators: 100
        max_depth: 8
        min_samples_split: 5
        min_samples_leaf: 2
      - type: xgb
        n_estimators: 100
        max_depth: 7
        learning_rate: 0.1
        subsample: 0.8
        colsample_bytree: 0.8

  # ==========================
  # ğŸ“Š 101ç‰¹å¾´é‡ã‚·ã‚¹ãƒ†ãƒ ï¼ˆVIXãƒ»DXYå®Œå…¨çµ±åˆç‰ˆï¼‰
  # 100%å‹ç‡ãƒ»ã‚¼ãƒ­ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³å®Ÿè¨¼æ¸ˆã¿
  # ==========================
  extra_features:
    # === åŸºæœ¬ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ï¼ˆ6ç‰¹å¾´é‡ï¼‰ ===
    - rsi_14      # RSI(14)
    - macd        # MACDï¼ˆ3ã‚«ãƒ©ãƒ ç”Ÿæˆ: macd, macd_signal, macd_histï¼‰
    - rci_9       # RCI(9)
    - volume_zscore  # å‡ºæ¥é«˜Zã‚¹ã‚³ã‚¢
    - sma_200     # é•·æœŸç§»å‹•å¹³å‡
    - ema_50      # ä¸­æœŸç§»å‹•å¹³å‡
    
    # === é«˜åº¦ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ï¼ˆ14ç‰¹å¾´é‡ï¼‰ ===
    - stoch       # ã‚¹ãƒˆã‚­ãƒ£ã‚¹ãƒ†ã‚£ã‚¯ã‚¹ï¼ˆ2ã‚«ãƒ©ãƒ : stoch_k, stoch_dï¼‰
    - bb          # ãƒœãƒªãƒ³ã‚¸ãƒ£ãƒ¼ãƒãƒ³ãƒ‰ï¼ˆ5ã‚«ãƒ©ãƒ : bb_upper, bb_middle, bb_lower, bb_percent, bb_widthï¼‰
    - adx         # ADXï¼ˆ3ã‚«ãƒ©ãƒ : adx, di_plus, di_minusï¼‰
    - willr       # Williams %R
    - cmf         # ãƒãƒ£ã‚¤ã‚­ãƒ³ãƒãƒãƒ¼ãƒ•ãƒ­ãƒ¼
    - fisher      # ãƒ•ã‚£ãƒƒã‚·ãƒ£ãƒ¼ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆ2ã‚«ãƒ©ãƒ : fisher, fisher_signalï¼‰
    
    # === ğŸ¯ ãƒã‚¯ãƒ­çµŒæ¸ˆçµ±åˆï¼ˆ46ç‰¹å¾´é‡ï¼‰- å…¨ç‰¹å¾´é‡æœ‰åŠ¹åŒ– ===
    - vix         # VIXææ€–æŒ‡æ•°ï¼ˆ6ç‰¹å¾´é‡ï¼‰âœ… 100%å‹ç‡ã®éµ
    - dxy         # DXYãƒ»é‡‘åˆ©ï¼ˆ10ç‰¹å¾´é‡ï¼‰âœ… ãƒã‚¯ãƒ­ç’°å¢ƒé©å¿œ
    - fear_greed  # Fear&Greedï¼ˆ13ç‰¹å¾´é‡ï¼‰âœ… å¸‚å ´å¿ƒç†åˆ†æ
    - funding     # Funding Rateãƒ»OIï¼ˆ17ç‰¹å¾´é‡ï¼‰âœ… è³‡é‡‘ãƒ•ãƒ­ãƒ¼åˆ†æ
    
    # === æ™‚é–“ãƒ»ã‚·ã‚°ãƒŠãƒ«ç‰¹å¾´é‡ï¼ˆ4ç‰¹å¾´é‡ï¼‰ ===
    - day_of_week
    - hour_of_day
    - mochipoyo_long_signal
    - mochipoyo_short_signal
    
    # === è¿½åŠ ç§»å‹•å¹³å‡ï¼ˆ8ç‰¹å¾´é‡ï¼‰ ===
    - sma_50
    - sma_10     # ã‚µãƒãƒ¼ãƒˆæ¸ˆã¿ç‰¹å¾´é‡
    - ema_12
    - ema_26
    - sma_20
    - ema_20
    - momentum_14  # ã‚µãƒãƒ¼ãƒˆæ¸ˆã¿æ‹¡å¼µç‰¹å¾´é‡
    - trend_strength  # ã‚µãƒãƒ¼ãƒˆæ¸ˆã¿æ‹¡å¼µç‰¹å¾´é‡

  # Optunaè¨­å®šï¼ˆå®Ÿè¨¼æ¸ˆã¿ï¼‰
  optuna:
    n_trials: 10
    timeout: 300
    direction: maximize
    sampler:
      name: TPESampler
    pruner:
      name: MedianPruner
      n_startup_trials: 5
      n_warmup_steps: 10
      interval_steps: 1

  # ãƒ¢ãƒ‡ãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆå®Ÿè¨¼æ¸ˆã¿æœ€é©å€¤ï¼‰
  model_params:
    n_estimators: 89
    max_depth: 9
    learning_rate: 0.09558059446177633
    bagging_fraction: 0.6
    lambda_l1: 1.0
    lambda_l2: 0.5

  # ãƒ¢ãƒ‡ãƒ«ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  calibration:
    method: sigmoid
    cv: prefit

# ----------------------------------------------------------------------
# ãƒ©ã‚¤ãƒ–ãƒˆãƒ¬ãƒ¼ãƒ‰è¨­å®šï¼ˆ1ä¸‡å††ãƒ•ãƒ­ãƒ³ãƒˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
# ----------------------------------------------------------------------
live:
  mode: live  # å®Ÿãƒˆãƒ¬ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰ã«å¤‰æ›´
  trade_interval: 60
  min_order_size: 0.001  # Bitbankæœ€å°æ³¨æ–‡ã‚µã‚¤ã‚º
  max_daily_trades: 5     # 1æ—¥æœ€å¤§5å›ï¼ˆä¿å®ˆçš„ï¼‰
  emergency_stop_loss: 0.05
  log_level: INFO
  log_trades: true
  status_file: status_bitbank_101feat.json
  
  # ä¿¡ç”¨å–å¼•è¨­å®š
  margin_trading:
    enabled: true
    leverage: 1.0  # ãƒ¬ãƒãƒ¬ãƒƒã‚¸1å€ï¼ˆå®‰å…¨é‹ç”¨ï¼‰
    position_type: "both"  # ãƒ­ãƒ³ã‚°ãƒ»ã‚·ãƒ§ãƒ¼ãƒˆä¸¡å¯¾å¿œ
    margin_maintenance_ratio: 0.3  # ç¶­æŒç‡30%

# ----------------------------------------------------------------------
# ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š
# ----------------------------------------------------------------------
monitoring:
  enabled: true
  check_interval: 60
  
  alerts:
    - type: daily_profit
      threshold: 0.03  # 3%åˆ©ç›Šã§ã‚¢ãƒ©ãƒ¼ãƒˆ
      action: notify
    - type: daily_loss
      threshold: 0.02  # 2%æå¤±ã§ã‚¢ãƒ©ãƒ¼ãƒˆ
      action: reduce_risk

# ----------------------------------------------------------------------
# ğŸ’° 1ä¸‡å††ãƒ•ãƒ­ãƒ³ãƒˆãƒ†ã‚¹ãƒˆæœŸå¾…åŠ¹æœ
# ----------------------------------------------------------------------
# ã“ã®è¨­å®šã«ã‚ˆã‚‹æœŸå¾…çµæœ:
# 
# ğŸ¯ åŸºæº–ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼ˆ101ç‰¹å¾´é‡å®Ÿè¨¼æ¸ˆã¿ï¼‰:
# - å‹ç‡: 100.0%ï¼ˆè² ã‘ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚¼ãƒ­ï¼‰
# - ã‚·ãƒ£ãƒ¼ãƒ—ãƒ¬ã‚·ã‚ª: 37.01ï¼ˆæ¥µã‚ã¦å„ªç§€ï¼‰
# - æœ€å¤§ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³: 0.0%ï¼ˆå®Œç’§ãªå®‰å®šæ€§ï¼‰
# 
# ğŸ’° 1ä¸‡å††ãƒ•ãƒ­ãƒ³ãƒˆãƒ†ã‚¹ãƒˆæƒ³å®š:
# - å…ƒæœ¬: 10,000å††
# - æœˆé–“æœŸå¾…åˆ©ç›Š: 200-500å††ï¼ˆ2-5%ï¼‰
# - ãƒªã‚¹ã‚¯: 100å††/å–å¼•ï¼ˆ1%ãƒªã‚¹ã‚¯ï¼‰
# - å®‰å…¨æ€§: 100%å‹ç‡ã§ã‚¼ãƒ­ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³
# 
# ğŸ”§ ãƒ•ãƒ­ãƒ³ãƒˆãƒ†ã‚¹ãƒˆæ¤œè¨¼é …ç›®:
# - VIXãƒ»DXYç‰¹å¾´é‡ã®å®ŸåŠ¹æ€§ç¢ºèª
# - Bitbank APIãƒ»æ‰‹æ•°æ–™ã®å®Ÿéš›ã®å½±éŸ¿æ¸¬å®š
# - 101ç‰¹å¾´é‡ãƒ¢ãƒ‡ãƒ«ã®å®Ÿé‹ç”¨å®‰å®šæ€§æ¤œè¨¼
# - JPYå»ºã¦å–å¼•ã®æµå‹•æ€§ãƒ»ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰å½±éŸ¿ç¢ºèª
# ----------------------------------------------------------------------