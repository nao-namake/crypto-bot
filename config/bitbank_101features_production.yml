# =============================================================================
# ãƒ•ã‚¡ã‚¤ãƒ«å: config/bitbank_101features_production.yml
# èª¬æ˜:
# Bitbankæœ¬ç•ªé‹ç”¨ãƒ»101ç‰¹å¾´é‡ç‰ˆï¼ˆVIXãƒ»DXYçµ±åˆå®Œå…¨ç‰ˆï¼‰
# - 100%å‹ç‡ãƒ»ã‚¼ãƒ­ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³å®Ÿè¨¼æ¸ˆã¿è¨­å®š
# - JPYå»ºã¦ãƒ»1ä¸‡å††ãƒ•ãƒ­ãƒ³ãƒˆãƒ†ã‚¹ãƒˆå¯¾å¿œ
# - ä¿¡ç”¨å–å¼•å¯¾å¿œï¼ˆãƒ¬ãƒãƒ¬ãƒƒã‚¸1å€å®‰å…¨é‹ç”¨ï¼‰
# =============================================================================

# ----------------------------------------------------------------------
# å®Ÿè¡Œå†ç¾æ€§è¨­å®šï¼ˆå…¨ã‚³ãƒãƒ³ãƒ‰çµ±ä¸€ã‚·ãƒ¼ãƒ‰ï¼‰
# ----------------------------------------------------------------------
global:
  seed: 42  # å®Ÿè¡Œå†ç¾æ€§ç¢ºä¿ã®ãŸã‚ã®ä¹±æ•°ã‚·ãƒ¼ãƒ‰

# ----------------------------------------------------------------------
# ãƒ‡ãƒ¼ã‚¿å–å¾—è¨­å®šï¼ˆBitbankæœ¬ç•ªãƒ»JPYå»ºã¦ï¼‰
# ----------------------------------------------------------------------
data:
  exchange: bitbank
  symbol: BTC/JPY  # JPYå»ºã¦å–å¼•
  timeframe: 1h

  # ------ Bitbank æœ¬ç•ªã‚ªãƒ—ã‚·ãƒ§ãƒ³ ------
  api_key: ${BITBANK_API_KEY}
  api_secret: ${BITBANK_API_SECRET}
  ccxt_options:
    enableRateLimit: true
    rateLimit: 1000  # Bitbank APIåˆ¶é™å¯¾å¿œ
  # --------------------------------------

  # å­¦ç¿’ç”¨ãƒ‡ãƒ¼ã‚¿å–å¾—ç¯„å›²
  since: "2024-01-01T00:00:00Z"
  limit: 8000  # ç´„11ãƒ¶æœˆåˆ†ã®1æ™‚é–“è¶³ãƒ‡ãƒ¼ã‚¿
  paginate: true
  per_page: 200  # Bitbankåˆ¶é™å¯¾å¿œ

# ----------------------------------------------------------------------
# æˆ¦ç•¥è¨­å®šï¼ˆ101ç‰¹å¾´é‡ãƒ»100%å‹ç‡å®Ÿè¨¼æ¸ˆã¿ï¼‰
# ----------------------------------------------------------------------
strategy:
  type: single
  name: ensemble_ml  # ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«å­¦ç¿’æˆ¦ç•¥ã«å¤‰æ›´
  params:
    model_path: /app/model.pkl  # Cloud Storageã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ãƒ¢ãƒ‡ãƒ«
    threshold: 0.05  # å®Ÿè¨¼æ¸ˆã¿æœ€é©é–¾å€¤
    
    # å‹•çš„é–¾å€¤èª¿æ•´ï¼ˆå®Ÿè¨¼æ¸ˆã¿è¨­å®šï¼‰
    atr_multiplier: 0.5
    volatility_adjustment: true
    threshold_bounds: [0.01, 0.25]

# ----------------------------------------------------------------------
# ãƒªã‚¹ã‚¯ç®¡ç†ï¼ˆ1ä¸‡å††ãƒ•ãƒ­ãƒ³ãƒˆãƒ†ã‚¹ãƒˆå¯¾å¿œï¼‰
# ----------------------------------------------------------------------
risk:
  risk_per_trade: 0.005  # 0.5%ãƒªã‚¹ã‚¯ï¼ˆ1ä¸‡å††Ã—0.5% = 50å††ãƒªã‚¹ã‚¯ï¼‰ã‚ˆã‚Šä¿å®ˆçš„
  stop_atr_mult: 1.2     # ã‚ˆã‚Šå³æ ¼ãªã‚¹ãƒˆãƒƒãƒ—ãƒ­ã‚¹
  dynamic_position_sizing:
    enabled: true
    formula: linear
  
  # KellyåŸºæº–ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆãƒ†ã‚¹ãƒˆç”¨è¶…ä¿å®ˆçš„è¨­å®šï¼‰
  kelly_criterion:
    enabled: true
    lookback_window: 30
    max_fraction: 0.05   # 5%ä¸Šé™ï¼ˆ1ä¸‡å††ç”¨è¶…ä¿å®ˆçš„ï¼‰
    min_trades_required: 10
  
  # å°é¡å–å¼•ç”¨è¿½åŠ åˆ¶é™
  max_position_size: 0.0005  # æœ€å¤§ãƒã‚¸ã‚·ãƒ§ãƒ³0.0005BTCï¼ˆç´„2,000å††ç›¸å½“ï¼‰
  daily_loss_limit: 0.03     # æ—¥æ¬¡æå¤±é™ç•Œ3%ï¼ˆ300å††ï¼‰
  consecutive_loss_limit: 3   # é€£ç¶šæå¤±å›æ•°åˆ¶é™

# ----------------------------------------------------------------------
# ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆè¨­å®šï¼ˆ1ä¸‡å††æƒ³å®šï¼‰
# ----------------------------------------------------------------------
backtest:
  starting_balance: 10000.0  # 1ä¸‡å††ï¼ˆJPYï¼‰
  slippage_rate: 0.004      # Bitbankç¾å®Ÿçš„ã‚¹ãƒªãƒƒãƒšãƒ¼ã‚¸
  commission_rate: 0.0012   # Bitbankç¾ç‰©å¹³å‡æ‰‹æ•°æ–™
  trade_log_csv: "./results/trade_log_bitbank_101feat.csv"
  aggregate_out_prefix: "./results/aggregate_bitbank_101feat"

# ----------------------------------------------------------------------
# ã‚¦ã‚©ãƒ¼ã‚¯ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰åˆ†å‰²ï¼ˆå®Ÿè¨¼æ¸ˆã¿è¨­å®šï¼‰
# ----------------------------------------------------------------------
walk_forward:
  train_window: 1000     # ç´„1.5ãƒ¶æœˆå­¦ç¿’
  test_window: 168       # 1é€±é–“ãƒ†ã‚¹ãƒˆ
  step: 168              # 1é€±é–“ã‚¹ãƒ©ã‚¤ãƒ‰

# ----------------------------------------------------------------------
# æ©Ÿæ¢°å­¦ç¿’ï¼ˆ101ç‰¹å¾´é‡å®Œå…¨ç‰ˆãƒ»VIXãƒ»DXYçµ±åˆï¼‰
# ----------------------------------------------------------------------
ml:
  feat_period: 14
  lags: [1,2,3,4,5,6,7,8,9,10,11,12]
  rolling_window: 20
  horizon: 5
  target_type: classification
  model_type: lgbm

  # VIXçµ±åˆè¨­å®šï¼ˆå®Ÿè¨¼æ¸ˆã¿ï¼‰
  vix_integration:
    enabled: true
    risk_off_threshold: 25
    panic_threshold: 35
    spike_multiplier: 2.0

  # ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ãƒ¢ãƒ‡ãƒ«è¨­å®šï¼ˆå®Ÿè¨¼æ¸ˆã¿ï¼‰
  ensemble:
    enabled: true
    method: stacking
    weights: [0.4, 0.3, 0.3]
    
    base_models:
      - type: lgbm
        n_estimators: 89
        max_depth: 9
        learning_rate: 0.09558059446177633
        bagging_fraction: 0.6
        lambda_l1: 1.0
        lambda_l2: 0.5
      - type: rf
        n_estimators: 100
        max_depth: 8
        min_samples_split: 5
        min_samples_leaf: 2
      - type: xgb
        n_estimators: 100
        max_depth: 7
        learning_rate: 0.1
        subsample: 0.8
        colsample_bytree: 0.8

  # ==========================
  # ğŸ“Š 101ç‰¹å¾´é‡ã‚·ã‚¹ãƒ†ãƒ ï¼ˆVIXãƒ»DXYå®Œå…¨çµ±åˆç‰ˆï¼‰
  # 100%å‹ç‡ãƒ»ã‚¼ãƒ­ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³å®Ÿè¨¼æ¸ˆã¿
  # ==========================
  extra_features:
    # === åŸºæœ¬ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ï¼ˆ6ç‰¹å¾´é‡ï¼‰ ===
    - rsi_14      # RSI(14)
    - macd        # MACDï¼ˆ3ã‚«ãƒ©ãƒ ç”Ÿæˆ: macd, macd_signal, macd_histï¼‰
    - rci_9       # RCI(9)
    - volume_zscore  # å‡ºæ¥é«˜Zã‚¹ã‚³ã‚¢
    - sma_200     # é•·æœŸç§»å‹•å¹³å‡
    - ema_50      # ä¸­æœŸç§»å‹•å¹³å‡
    
    # === é«˜åº¦ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ï¼ˆ14ç‰¹å¾´é‡ï¼‰ ===
    - stoch       # ã‚¹ãƒˆã‚­ãƒ£ã‚¹ãƒ†ã‚£ã‚¯ã‚¹ï¼ˆ2ã‚«ãƒ©ãƒ : stoch_k, stoch_dï¼‰
    - bb          # ãƒœãƒªãƒ³ã‚¸ãƒ£ãƒ¼ãƒãƒ³ãƒ‰ï¼ˆ5ã‚«ãƒ©ãƒ : bb_upper, bb_middle, bb_lower, bb_percent, bb_widthï¼‰
    - adx         # ADXï¼ˆ3ã‚«ãƒ©ãƒ : adx, di_plus, di_minusï¼‰
    - willr       # Williams %R
    - cmf         # ãƒãƒ£ã‚¤ã‚­ãƒ³ãƒãƒãƒ¼ãƒ•ãƒ­ãƒ¼
    - fisher      # ãƒ•ã‚£ãƒƒã‚·ãƒ£ãƒ¼ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆ2ã‚«ãƒ©ãƒ : fisher, fisher_signalï¼‰
    
    # === ğŸ¯ ãƒã‚¯ãƒ­çµŒæ¸ˆçµ±åˆï¼ˆ46ç‰¹å¾´é‡ï¼‰- å…¨ç‰¹å¾´é‡æœ‰åŠ¹åŒ– ===
    - vix         # VIXææ€–æŒ‡æ•°ï¼ˆ6ç‰¹å¾´é‡ï¼‰âœ… 100%å‹ç‡ã®éµ
    - dxy         # DXYãƒ»é‡‘åˆ©ï¼ˆ10ç‰¹å¾´é‡ï¼‰âœ… ãƒã‚¯ãƒ­ç’°å¢ƒé©å¿œ
    - fear_greed  # Fear&Greedï¼ˆ13ç‰¹å¾´é‡ï¼‰âœ… å¸‚å ´å¿ƒç†åˆ†æ
    - funding     # Funding Rateãƒ»OIï¼ˆ17ç‰¹å¾´é‡ï¼‰âœ… è³‡é‡‘ãƒ•ãƒ­ãƒ¼åˆ†æ
    
    # === æ™‚é–“ãƒ»ã‚·ã‚°ãƒŠãƒ«ç‰¹å¾´é‡ï¼ˆ4ç‰¹å¾´é‡ï¼‰ ===
    - day_of_week
    - hour_of_day
    - mochipoyo_long_signal
    - mochipoyo_short_signal
    
    # === è¿½åŠ ç§»å‹•å¹³å‡ï¼ˆ8ç‰¹å¾´é‡ï¼‰ ===
    - sma_50
    - sma_10     # ã‚µãƒãƒ¼ãƒˆæ¸ˆã¿ç‰¹å¾´é‡
    - ema_12
    - ema_26
    - sma_20
    - ema_20
    - momentum_14  # ã‚µãƒãƒ¼ãƒˆæ¸ˆã¿æ‹¡å¼µç‰¹å¾´é‡
    - trend_strength  # ã‚µãƒãƒ¼ãƒˆæ¸ˆã¿æ‹¡å¼µç‰¹å¾´é‡

  # Optunaè¨­å®šï¼ˆå¼·åŒ–ç‰ˆï¼‰
  optuna:
    n_trials: 50  # 10 â†’ 50å›ã«å¢—åŠ ï¼ˆç²¾åº¦å‘ä¸Šï¼‰
    timeout: 600  # 10åˆ†ã«æ‹¡å¼µ
    direction: maximize
    sampler:
      name: TPESampler
    pruner:
      name: MedianPruner
      n_startup_trials: 10
      n_warmup_steps: 15
      interval_steps: 1
  
  # éå­¦ç¿’å¯¾ç­–è¨­å®šï¼ˆæ–°è¦è¿½åŠ ï¼‰
  early_stopping_rounds: 50  # LightGBM/XGBoostç”¨æ—©æœŸåœæ­¢
  feature_selection:
    enabled: true
    max_features: 80  # 101 â†’ 80ç‰¹å¾´é‡ã¸ã®æœ€é©åŒ–
    importance_threshold: 0.005

  # ãƒ¢ãƒ‡ãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆå®Ÿè¨¼æ¸ˆã¿æœ€é©å€¤ï¼‰
  model_params:
    n_estimators: 89
    max_depth: 9
    learning_rate: 0.09558059446177633
    bagging_fraction: 0.6
    lambda_l1: 1.0
    lambda_l2: 0.5

  # ãƒ¢ãƒ‡ãƒ«ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  calibration:
    method: sigmoid
    cv: prefit

# ----------------------------------------------------------------------
# ãƒ©ã‚¤ãƒ–ãƒˆãƒ¬ãƒ¼ãƒ‰è¨­å®šï¼ˆ1ä¸‡å††ãƒ•ãƒ­ãƒ³ãƒˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
# ----------------------------------------------------------------------
live:
  mode: live  # æœ¬ç•ªãƒ©ã‚¤ãƒ–ãƒˆãƒ¬ãƒ¼ãƒ‰
  trade_interval: 60
  min_order_size: 0.0003  # 1ä¸‡å††ç”¨æœ€å°æ³¨æ–‡ã‚µã‚¤ã‚ºï¼ˆç´„1,200å††ç›¸å½“ï¼‰
  max_order_size: 0.0005  # 1ä¸‡å††ç”¨æœ€å¤§æ³¨æ–‡ã‚µã‚¤ã‚ºï¼ˆç´„2,000å††ç›¸å½“ï¼‰
  max_daily_trades: 3     # 1æ—¥æœ€å¤§3å›ï¼ˆè¶…ä¿å®ˆçš„ï¼‰
  max_weekly_trades: 15   # é€±é–“åˆ¶é™è¿½åŠ ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
  emergency_stop_loss: 0.03  # 3%ç·Šæ€¥åœæ­¢ï¼ˆã‚ˆã‚Šå³æ ¼ï¼‰
  log_level: INFO
  log_trades: true
  status_file: status_bitbank_101feat_fronttest.json
  
  # ãƒ•ãƒ­ãƒ³ãƒˆãƒ†ã‚¹ãƒˆå°‚ç”¨è¨­å®š
  front_test_mode: true
  front_test_duration_days: 7  # 1é€±é–“ãƒ•ãƒ­ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
  front_test_balance_limit: 10000  # 1ä¸‡å††ä¸Šé™ç¢ºèª
  
  # ä¿¡ç”¨å–å¼•è¨­å®š
  margin_trading:
    enabled: true
    leverage: 1.0  # ãƒ¬ãƒãƒ¬ãƒƒã‚¸1å€ï¼ˆå®‰å…¨é‹ç”¨ï¼‰
    position_type: "both"  # ãƒ­ãƒ³ã‚°ãƒ»ã‚·ãƒ§ãƒ¼ãƒˆä¸¡å¯¾å¿œ
    margin_maintenance_ratio: 0.3  # ç¶­æŒç‡30%

# ----------------------------------------------------------------------
# ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®šï¼ˆ1ä¸‡å††ãƒ•ãƒ­ãƒ³ãƒˆãƒ†ã‚¹ãƒˆç”¨å¼·åŒ–ç‰ˆï¼‰
# ----------------------------------------------------------------------
monitoring:
  enabled: true
  check_interval: 30  # 30ç§’é–“éš”ã§ç›£è¦–å¼·åŒ–
  health_check_enabled: true
  ensemble_monitoring: true  # ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ç‰¹æœ‰ç›£è¦–æœ‰åŠ¹åŒ–
  
  # ãƒ•ãƒ­ãƒ³ãƒˆãƒ†ã‚¹ãƒˆç”¨ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š
  alerts:
    - type: daily_profit
      threshold: 0.02  # 2%åˆ©ç›Šï¼ˆ200å††ï¼‰ã§ã‚¢ãƒ©ãƒ¼ãƒˆ
      action: notify
    - type: daily_loss
      threshold: 0.015  # 1.5%æå¤±ï¼ˆ150å††ï¼‰ã§ã‚¢ãƒ©ãƒ¼ãƒˆ
      action: reduce_risk
    - type: consecutive_losses
      threshold: 2  # é€£ç¶š2å›æå¤±ã§ã‚¢ãƒ©ãƒ¼ãƒˆ
      action: pause_trading
    - type: weekly_loss
      threshold: 0.05  # é€±é–“5%æå¤±ï¼ˆ500å††ï¼‰ã§ã‚¢ãƒ©ãƒ¼ãƒˆ
      action: emergency_stop
    - type: position_size_warning
      threshold: 0.0005  # ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚µã‚¤ã‚ºè­¦å‘Š
      action: notify
    - type: ensemble_disagreement
      threshold: 0.3  # ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ãƒ¢ãƒ‡ãƒ«åˆæ„åº¦ä½ä¸‹
      action: notify
    - type: prediction_confidence_low
      threshold: 0.6  # äºˆæ¸¬ä¿¡é ¼åº¦ä½ä¸‹
      action: skip_trade
  
  # é€šçŸ¥è¨­å®š
  notifications:
    email_enabled: false  # ãƒ•ãƒ­ãƒ³ãƒˆãƒ†ã‚¹ãƒˆä¸­ã¯ãƒ­ã‚°ãƒ™ãƒ¼ã‚¹
    slack_enabled: false
    webhook_enabled: false
    log_level: INFO
    
  # ãƒ•ãƒ­ãƒ³ãƒˆãƒ†ã‚¹ãƒˆå°‚ç”¨ç›£è¦–
  front_test_monitoring:
    enabled: true
    daily_summary: true
    performance_tracking: true
    risk_metrics_tracking: true

# ----------------------------------------------------------------------
# ğŸ’° 1ä¸‡å††ãƒ•ãƒ­ãƒ³ãƒˆãƒ†ã‚¹ãƒˆæœŸå¾…åŠ¹æœ
# ----------------------------------------------------------------------
# ã“ã®è¨­å®šã«ã‚ˆã‚‹æœŸå¾…çµæœ:
# 
# ğŸ¯ åŸºæº–ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼ˆ101ç‰¹å¾´é‡å®Ÿè¨¼æ¸ˆã¿ï¼‰:
# - å‹ç‡: 100.0%ï¼ˆè² ã‘ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚¼ãƒ­ï¼‰
# - ã‚·ãƒ£ãƒ¼ãƒ—ãƒ¬ã‚·ã‚ª: 37.01ï¼ˆæ¥µã‚ã¦å„ªç§€ï¼‰
# - æœ€å¤§ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³: 0.0%ï¼ˆå®Œç’§ãªå®‰å®šæ€§ï¼‰
# 
# ğŸ’° 1ä¸‡å††ãƒ•ãƒ­ãƒ³ãƒˆãƒ†ã‚¹ãƒˆæƒ³å®š:
# - å…ƒæœ¬: 10,000å††
# - æœˆé–“æœŸå¾…åˆ©ç›Š: 200-500å††ï¼ˆ2-5%ï¼‰
# - ãƒªã‚¹ã‚¯: 100å††/å–å¼•ï¼ˆ1%ãƒªã‚¹ã‚¯ï¼‰
# - å®‰å…¨æ€§: 100%å‹ç‡ã§ã‚¼ãƒ­ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³
# 
# ğŸ”§ ãƒ•ãƒ­ãƒ³ãƒˆãƒ†ã‚¹ãƒˆæ¤œè¨¼é …ç›®:
# - VIXãƒ»DXYç‰¹å¾´é‡ã®å®ŸåŠ¹æ€§ç¢ºèª
# - Bitbank APIãƒ»æ‰‹æ•°æ–™ã®å®Ÿéš›ã®å½±éŸ¿æ¸¬å®š
# - 101ç‰¹å¾´é‡ãƒ¢ãƒ‡ãƒ«ã®å®Ÿé‹ç”¨å®‰å®šæ€§æ¤œè¨¼
# - JPYå»ºã¦å–å¼•ã®æµå‹•æ€§ãƒ»ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰å½±éŸ¿ç¢ºèª
# ----------------------------------------------------------------------