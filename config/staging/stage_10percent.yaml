# Phase 11: æ®µéšçš„æœ¬ç•ªç§»è¡Œè¨­å®šï¼ˆ10%æ®µéšï¼‰
# ğŸ¯ æœ¬ç•ªç’°å¢ƒã¨åŒä¸€è¨­å®šãƒ»é‡‘é¡ã®ã¿ã‚¹ã‚±ãƒ¼ãƒ«æˆ¦ç•¥
# æˆåŠŸæ™‚ã¯é‡‘é¡ã‚’10å€ã«ã™ã‚‹ã ã‘ã§æœ¬ç•ªç§»è¡Œå¯èƒ½

# ã‚·ã‚¹ãƒ†ãƒ åŸºæœ¬è¨­å®šï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
system:
  name: "crypto-bot-phase11-stage-10percent"
  version: "11.0.0"
  mode: "live"
  debug: false
  log_level: "INFO"
  deployment_stage: "10_percent"

# å–å¼•æ‰€è¨­å®šï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
exchange:
  name: "bitbank"
  symbol: "BTC/JPY"
  leverage: 1.0
  
  # APIè¨­å®šï¼ˆç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—ï¼‰
  api_key: "${BITBANK_API_KEY}"
  api_secret: "${BITBANK_API_SECRET}"
  sandbox: false
  
  # APIåˆ¶é™ï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
  rate_limit: 30000
  timeout: 90000
  enable_rate_limit: true
  retries: 3

# ãƒ‡ãƒ¼ã‚¿è¨­å®šï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
data:
  timeframes: ["15m", "1h", "4h"]
  since_hours: 96
  limit: 100
  
  cache:
    enabled: true
    ttl_minutes: 5
    max_size: 1000
    disk_cache: true
    retention_days: 90

# ç‰¹å¾´é‡è¨­å®šï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
features:
  mode: "optimized"
  
  basic:
    - "close"
    - "volume" 
    - "returns_1"
  
  technical:
    - "rsi_14"
    - "macd"
    - "atr_14"
    - "bb_position"
    - "ema_20"
    - "ema_50"
  
  anomaly:
    - "zscore"
    - "volume_ratio"
    - "market_stress"

# æˆ¦ç•¥è¨­å®šï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
strategies:
  enabled:
    - "atr_based"
    - "mochipoy_alert"
    - "multi_timeframe"
    - "fibonacci_retracement"
  
  # æœ¬ç•ªåŒä¸€é‡ã¿è¨­å®š
  weights:
    atr_based: 0.35
    mochipoy_alert: 0.3
    multi_timeframe: 0.25
    fibonacci_retracement: 0.1
  
  consensus:
    required_agreement: 0.6
    confidence_threshold: 0.5

# æ©Ÿæ¢°å­¦ç¿’è¨­å®šï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
ml:
  ensemble_enabled: true
  confidence_threshold: 0.5
  
  models:
    - "lgbm"
    - "xgb" 
    - "rf"
  
  model_weights:
    - 0.5
    - 0.3
    - 0.2
  
  prediction:
    lookback_periods: 100
    retrain_frequency: "weekly"

# ãƒªã‚¹ã‚¯ç®¡ç†è¨­å®šï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
risk:
  # KellyåŸºæº–ï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
  kelly_criterion:
    max_position_ratio: 0.05
    safety_factor: 0.7
    min_trades_for_kelly: 20
  
  # åŸºæœ¬ãƒªã‚¹ã‚¯è¨­å®šï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
  risk_per_trade: 0.01
  kelly_max_fraction: 0.05
  max_drawdown: 0.20
  stop_loss_atr_multiplier: 1.2
  consecutive_loss_limit: 5
  
  # ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³ç®¡ç†ï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
  drawdown_manager:
    max_drawdown_ratio: 0.20
    consecutive_loss_limit: 5
    cooldown_hours: 24
  
  # ç•°å¸¸æ¤œçŸ¥ï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
  anomaly_detector:
    spread_warning_threshold: 0.003
    spread_critical_threshold: 0.005
    api_latency_warning: 1.0
    api_latency_critical: 3.0
  
  # çµ±åˆåˆ¤å®šé–¾å€¤ï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
  risk_thresholds:
    min_ml_confidence: 0.5
    risk_threshold_deny: 0.8
    risk_threshold_conditional: 0.6

# æ³¨æ–‡å®Ÿè¡Œè¨­å®šï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
execution:
  mode: "live"
  
  order:
    default_type: "limit"
    slippage_tolerance: 0.001
    max_retry: 3
    retry_delay: 1.0
  
  latency:
    target_ms: 1000
    warning_ms: 500
    critical_ms: 2000

# ğŸ¯ å”¯ä¸€ã®å·®åˆ†: è³‡é‡‘ã‚¹ã‚±ãƒ¼ãƒ«è¨­å®š
production:
  # 10%æ®µéšç”¨è³‡é‡‘è¨­å®šï¼ˆ1ä¸‡å††æƒ³å®šï¼‰
  min_order_size: 0.0001          # æœ€å°æ³¨æ–‡ã‚µã‚¤ã‚ºï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
  max_order_size: 0.0001          # ğŸ’° 10%: 0.0001 BTCï¼ˆç´„1,000å††ï¼‰æœ¬ç•ªæ™‚ã¯0.001 BTCï¼ˆç´„10,000å††ï¼‰
  trade_interval: 60              # å–å¼•é–“éš”ï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
  margin_trading: true
  force_margin_mode: true
  
  # å–å¼•åˆ¶é™ï¼ˆæœ¬ç•ªåŒä¸€æ¯”ç‡ãƒ»é‡‘é¡ã®ã¿ã‚¹ã‚±ãƒ¼ãƒ«ï¼‰
  daily_trade_limit: 20           # 1æ—¥æœ€å¤§20å›å–å¼•ï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
  max_daily_loss: 0.02           # 1æ—¥æœ€å¤§2%æå¤±ï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
  emergency_stop_loss: 0.05      # ç·Šæ€¥åœæ­¢5%æå¤±ï¼ˆæœ¬ç•ªåŒä¸€ï¼‰

# ãƒ­ã‚°è¨­å®šï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
logging:
  level: "INFO"
  file_enabled: true
  discord_enabled: true
  retention_days: 30
  
  file:
    enabled: true
    path: "logs/production_10percent"
    rotation: "daily"
    retention_days: 30
    max_size_mb: 100
  
  discord:
    enabled: true
    webhook_url: "${DISCORD_WEBHOOK_URL}"
    
    levels:
      critical: true
      warning: true
      info: false

# ç›£è¦–è¨­å®šï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
monitoring:
  health_check:
    enabled: true
    interval_seconds: 30
    timeout_seconds: 5
    endpoints:
      - "/health"
      - "/api/status"
      - "/metrics"
    
  performance:
    enabled: true
    metrics_interval: 300
    collection:
      - "response_time"
      - "memory_usage"
      - "cpu_usage"
      - "error_rate"
  
  # çµ±åˆç›£è¦–ï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
  integrated_monitoring:
    enabled: true
    bot_manager_checks: true
    alert_thresholds:
      consecutive_failures: 3
      error_rate_threshold: 5
      response_time_warning: 1000
      response_time_critical: 3000
  
  # è‡ªå‹•å¾©æ—§ã‚·ã‚¹ãƒ†ãƒ ï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
  auto_recovery:
    enabled: true
    max_restart_attempts: 3
    cooldown_minutes: 10
    escalation_after_failures: 5

# Cloud Runè¨­å®šï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
cloud_run:
  memory: "2Gi"
  cpu: 1
  
  # ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°è¨­å®š
  min_instances: 1
  max_instances: 2
  concurrency: 1
  
  timeout_seconds: 3600
  
  # ã‚µãƒ¼ãƒ“ã‚¹è¨­å®š
  service:
    name: "crypto-bot-stage-10percent"
    region: "asia-northeast1"
    platform: "managed"
  
  labels:
    stage: "10-percent"
    phase: "phase-11"
    environment: "staging"
    managed-by: "ci-cd"

# CI/CDçµ±åˆè¨­å®šï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
cicd:
  environment_variables:
    MODE: "live"
    DEPLOYMENT_STAGE: "10_percent"
    LOG_LEVEL: "INFO"
    PYTHONPATH: "/app"
    BITBANK_TESTNET: "false"
  
  secrets:
    bitbank_api_key: "bitbank-api-key:latest"
    bitbank_api_secret: "bitbank-api-secret:latest"
    discord_webhook: "discord-webhook:latest"
  
  deployment:
    strategy: "gradual"
    health_check_timeout: 300
    rollback_on_failure: true
  
  quality_gates:
    required_tests_pass: true
    flake8_max_errors: 100
    coverage_threshold: 80

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
security:
  authentication:
    workload_identity: true
    service_account: "crypto-bot-runner@my-crypto-bot-project.iam.gserviceaccount.com"
    token_refresh_minutes: 55
  
  secret_management:
    provider: "gcp_secret_manager"
    auto_rotation: true
    rotation_schedule: "0 2 * * 0"
    backup_strategy: "multiple_versions"
  
  api_security:
    rate_limiting: true
    max_calls_per_hour: 1000
    ip_allowlist_enabled: false
    request_logging: true
    anomaly_detection: true
  
  incident_response:
    auto_circuit_breaker: true
    emergency_shutdown: true
    notification_channels:
      - "discord"
      - "gcp_monitoring"
    escalation_after_minutes: 15

# ğŸ¯ æ®µéšçš„ç§»è¡ŒæˆåŠŸæŒ‡æ¨™ï¼ˆæœ¬ç•ªåŒä¸€åŸºæº–ï¼‰
targets:
  stage_success_criteria:
    min_uptime_percentage: 99.0
    max_error_rate: 5.0
    target_win_rate: 0.55
    min_evaluation_trades: 100
    evaluation_period_days: 30
  
  # ğŸ’° 10%è³‡é‡‘ç”¨åˆ©ç›Šç›®æ¨™ï¼ˆé‡‘é¡ã®ã¿ã‚¹ã‚±ãƒ¼ãƒ«ï¼‰
  financial_targets:
    daily_profit_target: 100      # ğŸ’° 10%: 100å††ã€æœ¬ç•ª: 1,000å††ï¼ˆ10å€ï¼‰
    monthly_profit_target: 2000   # ğŸ’° 10%: 2,000å††ã€æœ¬ç•ª: 20,000å††ï¼ˆ10å€ï¼‰
    max_daily_loss: 200           # ğŸ’° 10%: 200å††ã€æœ¬ç•ª: 2,000å††ï¼ˆ10å€ï¼‰
    target_sharpe_ratio: 1.0
  
  # å–å¼•åˆ¶é™ï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
  trading_limits:
    max_daily_trades: 20
    max_monthly_trades: 400
    trade_interval_minutes: 1
  
  # æ¬¡æ®µéšç§»è¡Œæ¡ä»¶ï¼ˆæœ¬ç•ªåŒä¸€ï¼‰
  graduation_criteria:
    consecutive_profitable_days: 14
    cumulative_profit_minimum: 3000   # ğŸ’° 10%: 3,000å††ã€æœ¬ç•ª: 30,000å††ï¼ˆ10å€ï¼‰
    zero_critical_errors: true
    stable_performance_days: 30

# ğŸ’¡ æœ¬ç•ªç§»è¡Œã‚¬ã‚¤ãƒ‰
migration_guide:
  scaling_instructions: |
    10%æ®µéšãƒ†ã‚¹ãƒˆæˆåŠŸå¾Œã®æœ¬ç•ªç§»è¡Œæ‰‹é †ï¼š
    
    1. max_order_size: 0.0001 â†’ 0.001 BTCï¼ˆ10å€ï¼‰
    2. daily_profit_target: 100 â†’ 1,000å††ï¼ˆ10å€ï¼‰
    3. monthly_profit_target: 2,000 â†’ 20,000å††ï¼ˆ10å€ï¼‰
    4. max_daily_loss: 200 â†’ 2,000å††ï¼ˆ10å€ï¼‰
    5. cumulative_profit_minimum: 3,000 â†’ 30,000å††ï¼ˆ10å€ï¼‰
    
    ãã®ä»–ã®è¨­å®šã¯ä¸€åˆ‡å¤‰æ›´ä¸è¦ã€‚
    é‡‘é¡ã®ã¿ã®ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—ã§æœ¬ç•ªç§»è¡Œå®Œäº†ã€‚
  
  risk_note: |
    ã“ã®è¨­å®šã«ã‚ˆã‚Šã€10%æ®µéšã§æˆåŠŸã—ãŸã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¨
    ãƒªã‚¹ã‚¯ç®¡ç†ãŒã€æœ¬ç•ªã§ã‚‚åŒæ§˜ã«æ©Ÿèƒ½ã™ã‚‹ã“ã¨ã‚’ä¿è¨¼ã€‚