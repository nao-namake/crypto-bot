# Phase 28å®Œäº†ãƒ»Phase 29æœ€é©åŒ–ç‰ˆ: GCPçµ±åˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
#
# bitbankä¿¡ç”¨å–å¼•ãƒ»15ç‰¹å¾´é‡çµ±ä¸€ã‚·ã‚¹ãƒ†ãƒ ãƒ»æ®µéšçš„ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆpaperâ†’liveï¼‰
# 625ãƒ†ã‚¹ãƒˆãƒ»64.74%ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ»Phase 29è¨­å®šé‡è¤‡è§£æ¶ˆå®Œäº†å¯¾å¿œ
#
# ğŸš€ Phase 29è¨­å®šé‡è¤‡è§£æ¶ˆæˆæœ:
#   - config/coreçµ±ä¸€æœ€é©åŒ–: é‡è¤‡è¨­å®šå®Œå…¨è§£æ¶ˆãƒ»è¦–è¦šçš„æ”¹å–„å®Œäº†
#   - config/infrastructureçµ±ä¸€: Phase 29ãƒãƒ¼ã‚«ãƒ¼çµ±ä¸€ãƒ»ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æœ€æ–°åŒ–
#   - ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Š: 58.64%â†’64.74%ãƒ»å“è³ªå‘ä¸Šç¢ºèª
#   - çµ±ä¸€è¨­å®šç®¡ç†ä½“ç³»å®Œæˆ: å…¨è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«Phase 29å¯¾å¿œå®Œäº†
#
# ä½¿ç”¨æ–¹æ³•:
#   - CI/CDç’°å¢ƒå¤‰æ•°ã®çµ±ä¸€ç®¡ç†
#   - 2æ®µéšãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šï¼ˆstageå»ƒæ­¢ãƒ»ã‚·ãƒ³ãƒ—ãƒ«åŒ–ï¼‰
#   - ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‹ã‚‰ã®è¨­å®šèª­ã¿è¾¼ã¿

# ========================================
# åŸºæœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
# ========================================
project:
  id: "my-crypto-bot-project"
  number: ""  # è‡ªå‹•å–å¾—: $(gcloud projects describe ${PROJECT_ID} --format="value(projectNumber)")
  region: "asia-northeast1"
  zone: "asia-northeast1-a"

# ========================================
# GCP ã‚µãƒ¼ãƒ“ã‚¹è¨­å®šï¼ˆPhase 22æœ€é©åŒ–å®Œäº†ï¼‰
# ========================================
services:
  # Cloud Runè¨­å®šï¼ˆ2æ®µéšãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»stageå»ƒæ­¢ãƒ»è¨­å®šæœ€é©åŒ–å¯¾å¿œï¼‰
  cloud_run:
    service_name: "crypto-bot-service-prod"
    region: "asia-northeast1"
    platform: "managed"
    
    # 2æ®µéšãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šï¼ˆPhase 22å¯¾å¿œãƒ»è¨­å®šæœ€é©åŒ–å®Œäº†ï¼‰
    deployment_modes:
      paper:
        memory: "1Gi"
        cpu: "1"
        min_instances: 0
        max_instances: 1
        timeout: 1800
        concurrency: 1
        description: "ãƒšãƒ¼ãƒ‘ãƒ¼ãƒˆãƒ¬ãƒ¼ãƒ‰ï¼ˆé–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç”¨ï¼‰"

      live:
        memory: "1Gi"
        cpu: "1"
        min_instances: 1
        max_instances: 2
        timeout: 3600
        concurrency: 1
        description: "å®Ÿè³‡é‡‘å–å¼•ï¼ˆCI/CDãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰"

  # Artifact Registryè¨­å®š
  artifact_registry:
    repository: "crypto-bot-repo"
    location: "asia-northeast1"
    format: "docker"
    description: "Phase 22: crypto-bot Docker images repositoryï¼ˆè¨­å®šæœ€é©åŒ–å®Œäº†ï¼‰"
    
    # ã‚¤ãƒ¡ãƒ¼ã‚¸è¨­å®š
    image:
      name: "crypto-bot"
      base_url: "asia-northeast1-docker.pkg.dev/my-crypto-bot-project/crypto-bot-repo"
      tags:
        - "latest"
        - "${GITHUB_SHA}"

  # Secret Managerè¨­å®šï¼ˆbitbankå°‚ç”¨ï¼‰
  secret_manager:
    secrets:
      - name: "bitbank-api-key"
        version: "3"  # CI/CDã§ä½¿ç”¨ä¸­ã®å…·ä½“çš„ãƒãƒ¼ã‚¸ãƒ§ãƒ³
        description: "Bitbank API ã‚­ãƒ¼"
        labels:
          managed-by: "crypto-bot"
          environment: "production"

      - name: "bitbank-api-secret"
        version: "3"  # CI/CDã§ä½¿ç”¨ä¸­ã®å…·ä½“çš„ãƒãƒ¼ã‚¸ãƒ§ãƒ³
        description: "Bitbank API ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ"
        labels:
          managed-by: "crypto-bot"
          environment: "production"

      - name: "discord-webhook-url"
        version: "5"  # CI/CDã§ä½¿ç”¨ä¸­ã®å…·ä½“çš„ãƒãƒ¼ã‚¸ãƒ§ãƒ³
        description: "Discord Webhook URL"
        labels:
          managed-by: "crypto-bot"
          environment: "production"

# ========================================
# IAMãƒ»èªè¨¼è¨­å®šï¼ˆPhase 22å¯¾å¿œãƒ»è¨­å®šæœ€é©åŒ–å®Œäº†ï¼‰
# ========================================
iam:
  # GitHub Actionsç”¨ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆå®Ÿç’°å¢ƒã«åˆã‚ã›ã¦ä¿®æ­£ãƒ»è¨­å®šæœ€é©åŒ–å¯¾å¿œï¼‰
  github_service_account:
    name: "github-deployer"
    display_name: "github-deployer"
    description: "å®Ÿéš›ã«å­˜åœ¨ã™ã‚‹CI/CD automation service accountï¼ˆPhase 22å¯¾å¿œï¼‰"
    
    # å®Ÿéš›ã«ä»˜ä¸ã•ã‚Œã¦ã„ã‚‹æ¨©é™ï¼ˆadminæ¨©é™å¤šæ•°ãƒ»å®Ÿç’°å¢ƒåæ˜ ï¼‰
    roles:
      - "roles/artifactregistry.admin"
      - "roles/bigquery.admin"
      - "roles/cloudfunctions.admin"
      - "roles/iam.securityReviewer"
      - "roles/iam.serviceAccountAdmin"
      - "roles/iam.serviceAccountUser"
      - "roles/iam.workloadIdentityPoolAdmin"
      - "roles/logging.admin"
      - "roles/monitoring.admin"
      - "roles/pubsub.admin"
      - "roles/resourcemanager.projectIamAdmin"
      - "roles/run.admin"
      - "roles/secretmanager.admin"
      - "roles/serviceusage.serviceUsageAdmin"
      - "roles/storage.admin"
      - "roles/storage.objectAdmin"
      - "roles/viewer"

  # Workload Identityè¨­å®š
  workload_identity:
    pool:
      id: "github-pool"
      display_name: "GitHub Actions Pool"
      description: "Phase 22: GitHub Actionsç”¨Workload Identity Poolï¼ˆè¨­å®šæœ€é©åŒ–å®Œäº†ï¼‰"
      location: "global"
      
    provider:
      id: "github-provider"
      issuer_uri: "https://token.actions.githubusercontent.com"
      
      # å±æ€§ãƒãƒƒãƒ”ãƒ³ã‚°
      attribute_mapping:
        google.subject: "assertion.sub"
        attribute.actor: "assertion.actor"
        attribute.repository: "assertion.repository"

# ========================================
# APIè¨­å®šï¼ˆå¿…è¦æœ€å°é™ï¼‰
# ========================================
apis:
  required:
    - "cloudbuild.googleapis.com"
    - "run.googleapis.com"
    - "artifactregistry.googleapis.com"
    - "secretmanager.googleapis.com"
    - "iamcredentials.googleapis.com"
    - "sts.googleapis.com"
    - "logging.googleapis.com"
    - "monitoring.googleapis.com"

# ========================================
# GitHub Actionsè¨­å®šï¼ˆPhase 22å¯¾å¿œãƒ»è¨­å®šæœ€é©åŒ–å®Œäº†ï¼‰
# ========================================
github_actions:
  # Repository Secretsï¼ˆå®Ÿç’°å¢ƒã«åˆã‚ã›ã¦ä¿®æ­£ï¼‰
  secrets:
    GCP_PROJECT_ID: "my-crypto-bot-project"
    GCP_WIF_PROVIDER: "projects/11445303925/locations/global/workloadIdentityPools/github-pool/providers/github-provider"
    GCP_SERVICE_ACCOUNT: "github-deployer@my-crypto-bot-project.iam.gserviceaccount.com"

  # ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒå¤‰æ•°ï¼ˆCI/CDã§å®Ÿéš›ã«ä½¿ç”¨ï¼‰
  environment_variables:
    MODE: "live"  # CI/CDã¯å¸¸ã«ãƒ©ã‚¤ãƒ–ãƒ¢ãƒ¼ãƒ‰
    LOG_LEVEL: "INFO"
    PYTHONPATH: "/app"
    FEATURE_MODE: "full"
    DEPLOY_STAGE: "live"
    
  # Repository Variables
  variables:
    GCP_REGION: "asia-northeast1"
    ARTIFACT_REPOSITORY: "crypto-bot-repo"
    CLOUD_RUN_SERVICE: "crypto-bot-service-prod"

# ========================================
# ç›£è¦–ãƒ»ãƒ­ã‚°è¨­å®šï¼ˆPhase 22æœ€é©åŒ–ãƒ»è¨­å®šæœ€é©åŒ–å®Œäº†ï¼‰
# ========================================
monitoring:
  # Cloud Loggingè¨­å®š
  logging:
    retention_days: 30
    log_level: "INFO"
    
    # ãƒ­ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
    filters:
      error_logs: 'severity>=ERROR'
      trading_logs: 'labels."component"="trading"'
      ci_logs: 'labels."component"="ci-cd"'
  
  # ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®šï¼ˆé‡è¦ã®ã¿ï¼‰
  alerts:
    critical:
      - name: "service_down"
        condition: "Cloud Run service unavailable"
        notification_channels: ["discord"]
        
      - name: "api_authentication_failure"
        condition: "Bitbank API authentication failed"
        notification_channels: ["discord"]

# ========================================
# ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆè¨­å®šï¼ˆ2æ®µéšãƒ»ã‚·ãƒ³ãƒ—ãƒ«åŒ–ï¼‰
# ========================================
deployment:
  # ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥
  strategy:
    type: "rolling_update"  # ãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
    rollback_enabled: true
    health_check_timeout: 300
    
  # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯è¨­å®š
  health_check:
    endpoint: "/health"
    initial_delay: 60
    timeout: 5
    interval: 30
    failure_threshold: 3
    success_threshold: 1

# ========================================
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šï¼ˆbitbankå¯¾å¿œï¼‰
# ========================================
security:
  # Secret Managerè¨­å®š
  secret_management:
    replication_policy: "automatic"
    automatic_rotation: false
    version_strategy: "explicit"  # :latestã§ã¯ãªãå…·ä½“çš„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä½¿ç”¨
    
  # Workload Identityè¨­å®š
  workload_identity:
    attribute_conditions:
      repository_restriction: true
      branch_restriction: ["main"]
      
  # Cloud Runè¨­å®š
  cloud_run_security:
    allow_unauthenticated: true  # å–å¼•ã‚·ã‚¹ãƒ†ãƒ ã®ãŸã‚
    ingress: "all"
    egress: "all"

# ========================================
# ã‚³ã‚¹ãƒˆæœ€é©åŒ–è¨­å®šï¼ˆå€‹äººé–‹ç™ºå‘ã‘ï¼‰
# ========================================
cost_optimization:
  # Cloud Runæœ€é©åŒ–
  cloud_run:
    cpu_throttling: false  # å–å¼•ã‚·ã‚¹ãƒ†ãƒ ã®ãŸã‚false
    request_timeout: 3600  # é•·æ™‚é–“å‡¦ç†å¯¾å¿œ
    
  # Artifact Registryæœ€é©åŒ–
  artifact_registry:
    cleanup_policy:
      keep_recent: 10
      keep_tagged: true
      
  # ãƒ­ã‚°æœ€é©åŒ–
  logging:
    retention_policy: "30_days"
    sampling_rate: 1.0

# ========================================
# ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ»ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆPhase 29æœ€é©åŒ–ç‰ˆï¼‰
# ========================================
metadata:
  version: "29.0.0"
  created_date: "2025-08-29"
  last_updated: "2025-09-28"
  description: "Phase 28å®Œäº†ãƒ»Phase 29æœ€é©åŒ–ç‰ˆ: è¨­å®šé‡è¤‡å®Œå…¨è§£æ¶ˆãƒ»çµ±ä¸€è¨­å®šç®¡ç†ä½“ç³»å®Œæˆãƒ»625ãƒ†ã‚¹ãƒˆ64.74%ã‚«ãƒãƒ¬ãƒƒã‚¸å¯¾å¿œ"

  # è¨­å®šå¤‰æ›´å±¥æ­´
  changelog:
    - version: "29.0.0"
      date: "2025-09-28"
      changes:
        - "ğŸ¯ Phase 29è¨­å®šé‡è¤‡è§£æ¶ˆå®Œäº†: å…¨è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«é‡è¤‡å•é¡Œå®Œå…¨è§£æ±º"
        - "ğŸ¨ è¦–è¦šçš„æ”¹å–„: æ—¥æœ¬èªã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»ç†è§£ã—ã‚„ã™ã„æ§‹é€ åŒ–å®Œæˆ"
        - "ğŸ”§ çµ±ä¸€è¨­å®šç®¡ç†ä½“ç³»å®Œæˆ: unified.yaml/thresholds.yamlå®Œå…¨åˆ†é›¢ãƒ»æœ€é©åŒ–å®Œäº†"
        - "ğŸ“Š ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Š: 58.64%â†’64.74%ãƒ»å“è³ªåŸºæº–å‘ä¸Š"
        - "âœ¨ Phase 29ãƒãƒ¼ã‚«ãƒ¼çµ±ä¸€: å…¨configéšå±¤Phase 29å¯¾å¿œå®Œäº†"
    - version: "22.0.0"
      date: "2025-09-14"
      changes:
        - "ğŸš€ Phase 22è¨­å®šæœ€é©åŒ–å®Œäº†: 26ã‚­ãƒ¼é‡è¤‡å•é¡Œå®Œå…¨è§£æ±º"
        - "ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºå¤§å¹…å‰Šæ¸›: unified.yaml 72.7%å‰Šæ¸›ãƒ»thresholds.yaml 60.9%å‰Šæ¸›"
        - "ğŸ”§ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤å¼·åˆ¶å•é¡Œè§£æ±º: ã‚·ã‚¹ãƒ†ãƒ æœ¬æ¥æ€§èƒ½ç™ºæ®ãƒ»æœ€é©åŒ–è¨­å®šæ´»ç”¨"
        - "ğŸ§ª 625ãƒ†ã‚¹ãƒˆå¯¾å¿œ: 58.64%ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ»15ç‰¹å¾´é‡çµ±ä¸€ã‚·ã‚¹ãƒ†ãƒ "
        - "âš¡ ã‚·ã‚¹ãƒ†ãƒ æ€§èƒ½å‘ä¸Š: è¨­å®šæœ€é©åŒ–ã«ã‚ˆã‚ŠçœŸã®æ€§èƒ½ç™ºæ®"
    - version: "16.2.0"
      date: "2025-09-07"
      changes:
        - "ğŸ”§ å®Ÿç’°å¢ƒæ•´åˆæ€§ä¿®æ­£: github-actions-sa â†’ github-deployerï¼ˆå®Ÿéš›ã®SAï¼‰"
        - "âœ… å®Ÿæ¨©é™åæ˜ : adminæ¨©é™å¤šæ•°ã®å®Ÿéš›ã®æ¨©é™æ§‹æˆã‚’åæ˜ "
        - "ğŸš¨ CI/CDä¿®æ­£: å­˜åœ¨ã—ãªã„SAæŒ‡å®šå•é¡Œè§£æ±º"
        - "ğŸ“Š è¨­å®švså®Ÿç’°å¢ƒä¹–é›¢è§£æ¶ˆ: 2ãƒ¶æœˆåœæ­¢ã—ã¦ã„ãŸãƒ‡ãƒ—ãƒ­ã‚¤å•é¡Œè§£æ±º"
        - "ğŸ¯ å®Ÿç”¨æ€§å‘ä¸Š: å®Ÿéš›ã«å‹•ä½œã™ã‚‹è¨­å®šã«çµ±ä¸€"
    - version: "16.1.0"
      date: "2025-08-29"
      changes:
        - "Phase 16-Bå®Œäº†å¯¾å¿œ: 620ãƒ†ã‚¹ãƒˆãƒ»50%+ã‚«ãƒãƒ¬ãƒƒã‚¸ â†’ Phase 22ã§625ãƒ†ã‚¹ãƒˆãƒ»58.64%ã‚«ãƒãƒ¬ãƒƒã‚¸ã«é€²åŒ–"
        - "stage-10/50å»ƒæ­¢: 2æ®µéšãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆpaperâ†’liveï¼‰ã«çµ±åˆ"
        - "è¨­å®šå¤§å¹…å‰Šæ¸›: 380è¡Œâ†’180è¡Œï¼ˆ53%å‰Šæ¸›ï¼‰"
        - "bitbankä¿¡ç”¨å–å¼•å°‚ç”¨è¨­å®š"
        - "å€‹äººé–‹ç™ºæœ€é©åŒ–: 1ä¸‡å††â†’50ä¸‡å††æ®µéšæ‹¡å¤§"

# ========================================
# bitbankä¿¡ç”¨å–å¼•åˆ¶ç´„
# ========================================
trading_constraints:
  exchange: "bitbank"
  trading_type: "margin"  # ä¿¡ç”¨å–å¼•å°‚ç”¨
  leverage_max: 2.0       # 2å€ãƒ¬ãƒãƒ¬ãƒƒã‚¸ä¸Šé™
  currency_pair: "BTC/JPY"
  initial_capital: 10000  # 1ä¸‡å††ã‚¹ã‚¿ãƒ¼ãƒˆ
  target_capital: 500000  # æœ€çµ‚ç›®æ¨™50ä¸‡å††
  features_count: 15      # å³é¸ç‰¹å¾´é‡æ•°
  timeframes: ["15m", "4h"]  # ãƒãƒ«ãƒã‚¿ã‚¤ãƒ ãƒ•ãƒ¬ãƒ¼ãƒ 