# =============================================================================
# ãƒ•ã‚¡ã‚¤ãƒ«å: config/bitbank_101features_csv_backtest.yml
# èª¬æ˜:
# CSVç‰ˆãƒ»1å¹´é–“ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆå°‚ç”¨è¨­å®š
# - é«˜é€ŸãªCSVèª­ã¿è¾¼ã¿ã«ã‚ˆã‚‹1å¹´é–“ãƒ•ãƒ«ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
# - ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå›é¿ãƒ»è»½é‡åŒ–å¯¾å¿œ
# - 101ç‰¹å¾´é‡ãƒ»ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ãƒ¢ãƒ‡ãƒ«å¯¾å¿œ
# =============================================================================

# ----------------------------------------------------------------------
# ãƒ‡ãƒ¼ã‚¿å–å¾—è¨­å®šï¼ˆCSVç‰ˆï¼‰
# ----------------------------------------------------------------------
data:
  exchange: csv  # CSV ãƒ¢ãƒ¼ãƒ‰ã‚’æŒ‡å®š
  symbol: BTC/USD  # CSVãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚·ãƒ³ãƒœãƒ«
  timeframe: 1h
  
  # CSV ãƒ•ã‚¡ã‚¤ãƒ«æŒ‡å®š
  csv_path: /Users/nao/Desktop/bot/data/btc_usd_2024_hourly.csv
  
  # å­¦ç¿’ç”¨ãƒ‡ãƒ¼ã‚¿æœŸé–“ï¼ˆ1å¹´é–“ãƒ•ãƒ«ï¼‰
  since: "2024-01-01T00:00:00Z"
  limit: 8760  # 1å¹´åˆ†ï¼ˆ365æ—¥ Ã— 24æ™‚é–“ï¼‰
  
  # APIè¨­å®šã¯ç„¡åŠ¹åŒ–
  api_key: null
  api_secret: null
  ccxt_options: {}

# ----------------------------------------------------------------------
# æˆ¦ç•¥è¨­å®šï¼ˆ101ç‰¹å¾´é‡ãƒ»ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«å¯¾å¿œï¼‰
# ----------------------------------------------------------------------
strategy:
  type: single
  name: ml
  params:
    model_path: csv_model_101feat.pkl
    threshold: 0.05
    
    # å‹•çš„é–¾å€¤èª¿æ•´
    atr_multiplier: 0.5
    volatility_adjustment: true
    threshold_bounds: [0.01, 0.25]
    
    thresholds_to_test:
      - 0.02
      - 0.05
      - 0.08
      - 0.10
      - 0.15

# ----------------------------------------------------------------------
# ãƒªã‚¹ã‚¯ç®¡ç†ï¼ˆCSVç”¨æœ€é©åŒ–ï¼‰
# ----------------------------------------------------------------------
risk:
  risk_per_trade: 0.02   # 2%ãƒªã‚¹ã‚¯ï¼ˆãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆç”¨ï¼‰
  stop_atr_mult: 2.0     # æ¨™æº–çš„ãªã‚¹ãƒˆãƒƒãƒ—ãƒ­ã‚¹
  dynamic_position_sizing:
    enabled: true
    formula: linear
  
  # KellyåŸºæº–
  kelly_criterion:
    enabled: true
    lookback_window: 50
    max_fraction: 0.25
    min_trades_required: 10

# ----------------------------------------------------------------------
# ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆè¨­å®šï¼ˆ1å¹´é–“ãƒ»é«˜é€ŸåŒ–ï¼‰
# ----------------------------------------------------------------------
backtest:
  starting_balance: 10000.0   # 1ä¸‡å††
  slippage_rate: 0.001        # è»½é‡åŒ–ã®ãŸã‚ä½ã‚ã«è¨­å®š
  commission_rate: 0.0005     # è»½é‡åŒ–ã®ãŸã‚ä½ã‚ã«è¨­å®š
  trade_log_csv: "./results/trade_log_csv_1year.csv"
  aggregate_out_prefix: "./results/aggregate_csv_1year"

# ----------------------------------------------------------------------
# ã‚¦ã‚©ãƒ¼ã‚¯ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰åˆ†å‰²ï¼ˆ1å¹´é–“ç”¨æœ€é©åŒ–ï¼‰
# ----------------------------------------------------------------------
walk_forward:
  train_window: 720      # 30æ—¥é–“å­¦ç¿’ï¼ˆ720æ™‚é–“ï¼‰
  test_window: 168       # 1é€±é–“ãƒ†ã‚¹ãƒˆï¼ˆ168æ™‚é–“ï¼‰
  step: 24               # 1æ—¥é–“éš”ã§ã‚¹ãƒ©ã‚¤ãƒ‰ï¼ˆé«˜é€ŸåŒ–ï¼‰

# ----------------------------------------------------------------------
# æ©Ÿæ¢°å­¦ç¿’ï¼ˆ101ç‰¹å¾´é‡å®Œå…¨ç‰ˆï¼‰
# ----------------------------------------------------------------------
ml:
  feat_period: 14
  lags: [1,2,3,4,5,6,7,8,9,10,11,12]
  rolling_window: 20
  horizon: 5
  target_type: classification
  model_type: lgbm

  # VIXçµ±åˆè¨­å®š
  vix_integration:
    enabled: true
    risk_off_threshold: 25
    panic_threshold: 35
    spike_multiplier: 2.0

  # ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ãƒ¢ãƒ‡ãƒ«è¨­å®š
  ensemble:
    enabled: true
    method: stacking
    weights: [0.4, 0.3, 0.3]
    
    base_models:
      - type: lgbm
        n_estimators: 100
        max_depth: 8
        learning_rate: 0.1
        bagging_fraction: 0.8
        lambda_l1: 0.5
        lambda_l2: 0.5
      - type: rf
        n_estimators: 100
        max_depth: 8
        min_samples_split: 5
        min_samples_leaf: 2
      - type: xgb
        n_estimators: 100
        max_depth: 6
        learning_rate: 0.1
        subsample: 0.8
        colsample_bytree: 0.8

  # ==========================
  # ğŸ“Š 101ç‰¹å¾´é‡ã‚·ã‚¹ãƒ†ãƒ ï¼ˆVIXãƒ»DXYå®Œå…¨çµ±åˆç‰ˆï¼‰
  # 100%å‹ç‡ãƒ»ã‚¼ãƒ­ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³å®Ÿè¨¼æ¸ˆã¿
  # ==========================
  extra_features:
    # === åŸºæœ¬ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ï¼ˆ6ç‰¹å¾´é‡ï¼‰ ===
    - rsi_14      # RSI(14)
    - macd        # MACDï¼ˆ3ã‚«ãƒ©ãƒ ç”Ÿæˆ: macd, macd_signal, macd_histï¼‰
    - rci_9       # RCI(9)
    - volume_zscore  # å‡ºæ¥é«˜Zã‚¹ã‚³ã‚¢
    - sma_200     # é•·æœŸç§»å‹•å¹³å‡
    - ema_50      # ä¸­æœŸç§»å‹•å¹³å‡
    
    # === é«˜åº¦ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ï¼ˆ14ç‰¹å¾´é‡ï¼‰ ===
    - stoch       # ã‚¹ãƒˆã‚­ãƒ£ã‚¹ãƒ†ã‚£ã‚¯ã‚¹ï¼ˆ2ã‚«ãƒ©ãƒ : stoch_k, stoch_dï¼‰
    - bb          # ãƒœãƒªãƒ³ã‚¸ãƒ£ãƒ¼ãƒãƒ³ãƒ‰ï¼ˆ5ã‚«ãƒ©ãƒ : bb_upper, bb_middle, bb_lower, bb_percent, bb_widthï¼‰
    - adx         # ADXï¼ˆ3ã‚«ãƒ©ãƒ : adx, di_plus, di_minusï¼‰
    - willr       # Williams %R
    - cmf         # ãƒãƒ£ã‚¤ã‚­ãƒ³ãƒãƒãƒ¼ãƒ•ãƒ­ãƒ¼
    - fisher      # ãƒ•ã‚£ãƒƒã‚·ãƒ£ãƒ¼ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆ2ã‚«ãƒ©ãƒ : fisher, fisher_signalï¼‰
    
    # === ğŸ¯ ãƒã‚¯ãƒ­çµŒæ¸ˆçµ±åˆï¼ˆ46ç‰¹å¾´é‡ï¼‰- å…¨ç‰¹å¾´é‡æœ‰åŠ¹åŒ– ===
    - vix         # VIXææ€–æŒ‡æ•°ï¼ˆ6ç‰¹å¾´é‡ï¼‰âœ… 100%å‹ç‡ã®éµ
    - dxy         # DXYãƒ»é‡‘åˆ©ï¼ˆ10ç‰¹å¾´é‡ï¼‰âœ… ãƒã‚¯ãƒ­ç’°å¢ƒé©å¿œ
    - fear_greed  # Fear&Greedï¼ˆ13ç‰¹å¾´é‡ï¼‰âœ… å¸‚å ´å¿ƒç†åˆ†æ
    - funding     # Funding Rateãƒ»OIï¼ˆ17ç‰¹å¾´é‡ï¼‰âœ… è³‡é‡‘ãƒ•ãƒ­ãƒ¼åˆ†æ
    
    # === æ™‚é–“ãƒ»ã‚·ã‚°ãƒŠãƒ«ç‰¹å¾´é‡ï¼ˆ4ç‰¹å¾´é‡ï¼‰ ===
    - day_of_week
    - hour_of_day
    - mochipoyo_long_signal
    - mochipoyo_short_signal
    
    # === è¿½åŠ ç§»å‹•å¹³å‡ï¼ˆ8ç‰¹å¾´é‡ï¼‰ ===
    - sma_50
    - sma_10     # ã‚µãƒãƒ¼ãƒˆæ¸ˆã¿ç‰¹å¾´é‡
    - ema_12
    - ema_26
    - sma_20
    - ema_20
    - momentum_14  # ã‚µãƒãƒ¼ãƒˆæ¸ˆã¿æ‹¡å¼µç‰¹å¾´é‡
    - trend_strength  # ã‚µãƒãƒ¼ãƒˆæ¸ˆã¿æ‹¡å¼µç‰¹å¾´é‡

  # Optunaè¨­å®šï¼ˆé«˜é€ŸåŒ–ï¼‰
  optuna:
    n_trials: 5      # é«˜é€ŸåŒ–ã®ãŸã‚è©¦è¡Œæ•°å‰Šæ¸›
    timeout: 180     # 3åˆ†ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
    direction: maximize
    sampler:
      name: TPESampler
    pruner:
      name: MedianPruner
      n_startup_trials: 3
      n_warmup_steps: 5
      interval_steps: 1

  # ãƒ¢ãƒ‡ãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆè»½é‡åŒ–ï¼‰
  model_params:
    n_estimators: 100
    max_depth: 8
    learning_rate: 0.1
    bagging_fraction: 0.8
    lambda_l1: 0.5
    lambda_l2: 0.5

  # ãƒ¢ãƒ‡ãƒ«ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  calibration:
    method: sigmoid
    cv: prefit

# ----------------------------------------------------------------------
# ç›£è¦–ãƒ»ãƒ¬ãƒãƒ¼ãƒˆè¨­å®š
# ----------------------------------------------------------------------
monitoring:
  enabled: true
  check_interval: 300  # 5åˆ†é–“éš”ï¼ˆè»½é‡åŒ–ï¼‰
  
  metrics:
    - total_return
    - sharpe_ratio
    - max_drawdown
    - win_rate
    - profit_factor
    - calmar_ratio

# ----------------------------------------------------------------------
# ğŸ¯ CSVç‰ˆãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆæœŸå¾…åŠ¹æœ
# ----------------------------------------------------------------------
# ã“ã®è¨­å®šã«ã‚ˆã‚‹ç‰¹å¾´:
# 
# ğŸ“ˆ é«˜é€ŸåŒ–åŠ¹æœ:
# - APIåˆ¶é™ãªã—: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå®Œå…¨å›é¿
# - è»½é‡å‡¦ç†: 1å¹´é–“ãƒ‡ãƒ¼ã‚¿ã‚’ç¬æ™‚ã«èª­ã¿è¾¼ã¿
# - ä¸¦åˆ—å‡¦ç†: ãƒãƒ«ãƒã‚³ã‚¢æ´»ç”¨ã§ã•ã‚‰ã«é«˜é€ŸåŒ–
# 
# ğŸ” è©³ç´°åˆ†æ:
# - 8,760æ™‚é–“ã®ãƒ•ãƒ«ãƒ‡ãƒ¼ã‚¿: æœˆæ¬¡ãƒ»å­£ç¯€ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º
# - 52é€±é–“ã®ã‚¦ã‚©ãƒ¼ã‚¯ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰: å®Ÿé‹ç”¨ã«è¿‘ã„æ¤œè¨¼
# - 101ç‰¹å¾´é‡ãƒ•ãƒ«æ´»ç”¨: æœ€å¤§ç²¾åº¦ã§ã®æˆ¦ç•¥æ¤œè¨¼
# 
# ğŸ“Š æœŸå¾…çµæœ:
# - å®Œå…¨ãªå¹´é–“ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š
# - å››åŠæœŸåˆ¥ãƒ»æœˆåˆ¥è©³ç´°åˆ†æ
# - æœ€é©ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç™ºè¦‹
# - å®Ÿé‹ç”¨å‰ã®æœ€çµ‚æ¤œè¨¼
# ----------------------------------------------------------------------