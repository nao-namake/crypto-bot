# ========================================
# çµ±ä¸€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« (unified.yaml)
# ========================================
# 
# Phase 19 MLOpsçµ±åˆå¯¾å¿œãƒ»å…¨ç’°å¢ƒçµ±ä¸€è¨­å®šãƒ»v16.3.0
# ä½œæˆæ—¥: 2025å¹´9æœˆ7æ—¥
# ç›®çš„: base.yaml + production.yamlã®çµ±åˆãƒ»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§å‘ä¸Šãƒ»è¨­å®šä¸€å…ƒåŒ–
#
# é‡è¦: 1ã¤ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§å…¨ç’°å¢ƒã‚’ã‚µãƒãƒ¼ãƒˆ
#       ãƒ¢ãƒ¼ãƒ‰åˆ¶å¾¡: ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•° > ç’°å¢ƒå¤‰æ•°MODE > YAMLå†…mode
#
# ä½¿ç”¨æ–¹æ³•:
#   é–‹ç™º: python main.py --config config/core/unified.yaml --mode paper
#   æœ¬ç•ª: python main.py --config config/core/unified.yaml --mode live
#   ç’°å¢ƒå¤‰æ•°: MODE=live python main.py --config config/core/unified.yaml
#
# ========================================
# åŸºæœ¬è¨­å®šï¼ˆå…¨ç’°å¢ƒå…±é€šï¼‰
# ========================================

# å‹•ä½œãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ãƒšãƒ¼ãƒ‘ãƒ¼ãƒˆãƒ¬ãƒ¼ãƒ‰ãƒ»å®‰å…¨æ€§å„ªå…ˆï¼‰
mode: paper  # paper/live/backtestï¼ˆç’°å¢ƒå¤‰æ•°ãƒ»CLIã§ä¸Šæ›¸ãå¯èƒ½ï¼‰

# å–å¼•æ‰€è¨­å®šï¼ˆbitbankä¿¡ç”¨å–å¼•å°‚ç”¨ï¼‰
exchange:
  name: bitbank
  symbol: "BTC/JPY"          # ä¿¡ç”¨å–å¼•å°‚ç”¨é€šè²¨ãƒšã‚¢
  leverage: 1.0              # 1å€ï¼ˆå®‰å…¨æ€§æœ€å„ªå…ˆãƒ»å®Ÿè³ªç¾ç‰©å–å¼•ç›¸å½“ï¼‰
  
  # APIåˆ¶é™ï¼ˆå…¨ç’°å¢ƒå…±é€šï¼‰
  rate_limit_ms: 35000       # 35ç§’é–“éš”ï¼ˆå®‰å…¨ãƒãƒ¼ã‚¸ãƒ³ï¼‰
  timeout_ms: 120000         # 2åˆ†ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆå®‰å…¨æ€§ï¼‰
  retries: 5                 # ãƒªãƒˆãƒ©ã‚¤å›æ•°å¢—åŠ ï¼ˆä¿¡é ¼æ€§ï¼‰
  
  # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
  ssl_verify: true           # SSLè¨¼æ˜æ›¸æ¤œè¨¼å¿…é ˆ
  api_version: "v1"          # APIãƒãƒ¼ã‚¸ãƒ§ãƒ³å›ºå®š

# ========================================
# æ©Ÿæ¢°å­¦ç¿’è¨­å®šï¼ˆPhase 19 MLOpsçµ±åˆï¼‰
# ========================================
ml:
  # çµ±ä¸€ä¿¡é ¼åº¦é–¾å€¤ï¼ˆåç›Šæ€§é‡è¦–ãƒ»é«˜å“è³ªã‚·ã‚°ãƒŠãƒ«ç¢ºä¿ï¼‰
  confidence_threshold: 0.65    # 65%ï¼ˆåç›Šæ©Ÿä¼šæ‹¡å¤§ãƒ»é«˜å“è³ªã‚·ã‚°ãƒŠãƒ«ç¢ºä¿ã®ãƒãƒ©ãƒ³ã‚¹ï¼‰
  
  # ProductionEnsembleãƒ¢ãƒ‡ãƒ«è¨­å®š
  ensemble_enabled: true
  models: ["lgbm", "xgb", "rf"]
  model_weights: [0.5, 0.3, 0.2]  # LightGBMé‡è¦–ï¼ˆå®Ÿç¸¾ãƒ™ãƒ¼ã‚¹ï¼‰
  
  # ãƒ¢ãƒ‡ãƒ«ç®¡ç†ï¼ˆPhase 19 MLOpså¯¾å¿œï¼‰
  model_path: "/app/models/production/production_ensemble.pkl"
  model_update_check: true      # ãƒ¢ãƒ‡ãƒ«æ›´æ–°ãƒã‚§ãƒƒã‚¯æœ‰åŠ¹
  fallback_enabled: true        # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½æœ‰åŠ¹
  
  # äºˆæ¸¬è¨­å®šï¼ˆå“è³ªä¿è¨¼ï¼‰
  prediction:
    lookback_periods: 100
    retrain_frequency: "weekly"

# ========================================
# ãƒ‡ãƒ¼ã‚¿å–å¾—è¨­å®šï¼ˆãƒãƒ«ãƒã‚¿ã‚¤ãƒ ãƒ•ãƒ¬ãƒ¼ãƒ çµ±ä¸€ï¼‰
# ========================================
data:
  # ã‚¿ã‚¤ãƒ ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆ2è»¸æ§‹æˆãƒ»MLOpsæœ€é©åŒ–ï¼‰
  timeframes: ["15m", "4h"]
  since_hours: 96            # 4æ—¥åˆ†ï¼ˆBitbankå®‰å®šç¯„å›²ï¼‰
  limit: 100                 # ç¢ºå®Ÿãªå–å¾—æ•°
  
  # ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®šï¼ˆçµ±ä¸€ï¼‰
  cache:
    enabled: true
    ttl_minutes: 5           # 5åˆ†é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥
    max_size: 1000           # æœ€å¤§1000ã‚¨ãƒ³ãƒˆãƒª
    disk_cache: true
    retention_days: 90       # 90æ—¥ä¿å­˜

# ç‰¹å¾´é‡è¨­å®šï¼ˆPhase 19ãƒ»12å€‹å³é¸ã‚·ã‚¹ãƒ†ãƒ çµ±ä¸€ï¼‰
features:
  mode: "optimized"  # 12å€‹å³é¸ç‰¹å¾´é‡
  
  # åŸºæœ¬ç‰¹å¾´é‡ï¼ˆ3å€‹ï¼‰
  basic:
    - "close"
    - "volume" 
    - "returns_1"
  
  # ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ï¼ˆ6å€‹ï¼‰
  technical:
    - "rsi_14"
    - "macd"
    - "atr_14"
    - "bb_position"
    - "ema_20"
    - "ema_50"
  
  # ç•°å¸¸æ¤œçŸ¥ï¼ˆ3å€‹ï¼‰
  anomaly:
    - "zscore"
    - "volume_ratio"
    - "market_stress"

# æˆ¦ç•¥è¨­å®šï¼ˆPhase 19çµ±åˆç‰ˆï¼‰
strategies:
  enabled:
    - "atr_based"
    - "mochipoy_alert"
    - "multi_timeframe"
    - "fibonacci_retracement"
  
  # æˆ¦ç•¥é‡ã¿ï¼ˆå®Ÿç¸¾ãƒ™ãƒ¼ã‚¹ï¼‰
  weights:
    atr_based: 0.3
    mochipoy_alert: 0.3
    multi_timeframe: 0.25
    fibonacci_retracement: 0.15
  
  # çµ±åˆåˆ¤å®š
  consensus:
    required_agreement: 0.6     # 60%ä»¥ä¸Šã®åˆæ„ã§å®Ÿè¡Œ
    confidence_threshold: 0.4

# ========================================
# ãƒªã‚¹ã‚¯ç®¡ç†è¨­å®šï¼ˆçµ±ä¸€ãƒ»å€‹äººé–‹ç™ºæœ€é©åŒ–ï¼‰
# ========================================
risk:
  # KellyåŸºæº–ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚µã‚¤ã‚¸ãƒ³ã‚°ï¼ˆçµ±ä¸€ï¼‰
  kelly_criterion:
    max_position_ratio: 0.03    # æœ€å¤§3%ï¼ˆå€‹äººé–‹ç™ºå®‰å…¨æ€§é‡è¦–ï¼‰
    safety_factor: 0.7          # Kellyå€¤ã®70%ä½¿ç”¨
    min_trades_for_kelly: 20
  
  # åŸºæœ¬ãƒªã‚¹ã‚¯è¨­å®š
  risk_per_trade: 0.01          # 1å–å¼•ã‚ãŸã‚Š1%ï¼ˆå®‰å…¨ãƒ»çµ±ä¸€ï¼‰
  kelly_max_fraction: 0.03      # KellyåŸºæº–æœ€å¤§3%ï¼ˆå€‹äººé–‹ç™ºé©æ­£ï¼‰
  max_drawdown: 0.20            # æœ€å¤§ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³20%
  stop_loss_atr_multiplier: 1.2  # 1.2Ã—ATRæåˆ‡ã‚Šï¼ˆå®Ÿè¨¼å€¤ï¼‰
  consecutive_loss_limit: 5     # é€£ç¶š5æå¤±ã§24æ™‚é–“åœæ­¢
  
  # ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³ç®¡ç†
  drawdown_manager:
    max_drawdown_ratio: 0.20    # 20%ä¸Šé™
    consecutive_loss_limit: 5   # é€£ç¶š5æå¤±ã§åœæ­¢
    cooldown_hours: 24          # 24æ™‚é–“ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³
  
  # ç•°å¸¸æ¤œçŸ¥ï¼ˆçµ±ä¸€ï¼‰
  anomaly_detector:
    spread_warning_threshold: 0.003   # 0.3%
    spread_critical_threshold: 0.005  # 0.5%
    api_latency_warning: 1.0          # 1ç§’
    api_latency_critical: 3.0         # 3ç§’
  
  # çµ±åˆåˆ¤å®šé–¾å€¤
  risk_thresholds:
    min_ml_confidence: 0.5          # æœ€å°MLä¿¡é ¼åº¦50%
    risk_threshold_deny: 0.8        # 80%ä»¥ä¸Šã§DENY
    risk_threshold_conditional: 0.6  # 60%ä»¥ä¸Šã§æ¡ä»¶ä»˜ã

# ========================================
# æ³¨æ–‡å®Ÿè¡Œè¨­å®šï¼ˆçµ±ä¸€ï¼‰
# ========================================
execution:
  mode: "paper"  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆç’°å¢ƒå¤‰æ•°ãƒ»CLIã§ä¸Šæ›¸ãï¼‰
  
  # æ³¨æ–‡è¨­å®šï¼ˆå®Ÿè¨¼æ¸ˆã¿å€¤ï¼‰
  order:
    default_type: "limit"       # æŒ‡å€¤æ³¨æ–‡å„ªå…ˆ
    slippage_tolerance: 0.001   # 0.1%ã‚¹ãƒªãƒƒãƒšãƒ¼ã‚¸è¨±å®¹
    max_retry: 3
    retry_delay: 1.0            # 1ç§’é–“éš”
  
  # ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ç›®æ¨™
  latency:
    target_ms: 1000             # 1ç§’ä»¥å†…
    warning_ms: 500             # 500msè­¦å‘Š
    critical_ms: 2000           # 2ç§’ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«

# ========================================
# ğŸš¨ æœ¬ç•ªå°‚ç”¨è¨­å®šï¼ˆMODE=liveæ™‚ã®ã¿æœ‰åŠ¹ï¼‰
# ========================================
production:
  min_order_size: 0.0001        # æœ€å°æ³¨æ–‡ã‚µã‚¤ã‚º
  max_order_size: 0.001         # æœ€å¤§æ³¨æ–‡ã‚µã‚¤ã‚ºï¼ˆå€‹äººé–‹ç™ºé©æ­£ï¼‰
  trade_interval: 180           # å–å¼•é–“éš”ï¼ˆç§’ï¼‰ãƒ»åç›Šæ€§é‡è¦–ï¼ˆ3åˆ†é–“éš”ï¼‰
  margin_trading: true          # ä¿¡ç”¨å–å¼•æœ‰åŠ¹
  force_margin_mode: true       # ä¿¡ç”¨å–å¼•å¼·åˆ¶

# ========================================
# ãƒ­ã‚°è¨­å®šï¼ˆç’°å¢ƒåˆ¥å¯¾å¿œï¼‰
# ========================================
logging:
  level: "INFO"                 # æƒ…å ±ãƒ¬ãƒ™ãƒ«
  file_enabled: true            # ãƒ•ã‚¡ã‚¤ãƒ«è¨˜éŒ²
  discord_enabled: true         # Discordç›£è¦–
  retention_days: 30            # ä¿æŒæœŸé–“ï¼ˆæœ¬ç•ªé•·æœŸãƒ»é–‹ç™ºçŸ­æœŸï¼‰
  
  # ãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ã‚°
  file:
    enabled: true
    path: "logs/production"
    rotation: "daily"
    retention_days: 30
    max_size_mb: 100
  
  # Discordé€šçŸ¥ï¼ˆçµ±ä¸€ï¼‰
  discord:
    enabled: true
    webhook_url: "${DISCORD_WEBHOOK_URL}"
    
    # é€šçŸ¥ãƒ¬ãƒ™ãƒ«è¨­å®š
    levels:
      critical: true            # å–å¼•åœæ­¢ã€é‡å¤§ã‚¨ãƒ©ãƒ¼
      warning: true             # APIé…å»¶ã€ç•°å¸¸å€¤
      info: false               # é€šå¸¸å–å¼•ï¼ˆæœ¬ç•ªã§ã¯ç„¡åŠ¹åŒ–ï¼‰

# ========================================
# ç›£è¦–ãƒ»ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆçµ±ä¸€å¼·åŒ–ï¼‰
# ========================================
monitoring:
  # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
  health_check:
    enabled: true
    interval_seconds: 30
    timeout_seconds: 5
    manual_execution: true      # æ‰‹å‹•å®Ÿè¡Œå¯¾å¿œ
    
  # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
  performance:
    enabled: true
    metrics_interval: 300       # 5åˆ†é–“éš”

# ========================================
# GCP Cloud Runæœ€é©åŒ–ï¼ˆçµ±ä¸€ï¼‰
# ========================================
cloud_run:
  # ãƒªã‚½ãƒ¼ã‚¹è¨­å®šï¼ˆå®Ÿè¨¼æ¸ˆã¿: 1Giååˆ†ãƒ»MLãƒ¢ãƒ‡ãƒ«è»½é‡ï¼‰
  memory: "1Gi"
  cpu: 1
  
  # ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
  min_instances: 1              # æœ¬ç•ªã¯å¸¸æ™‚ç¨¼åƒ
  max_instances: 2              # è² è·åˆ†æ•£å¯¾å¿œ
  concurrency: 1                # å–å¼•æ•´åˆæ€§ç¢ºä¿
  
  # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
  timeout_seconds: 3600         # 1æ™‚é–“

# ========================================
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šï¼ˆGCPçµ±åˆï¼‰
# ========================================
security:
  secret_management: "gcp_secret_manager"  # GCP Secret Managerä½¿ç”¨
  workload_identity: true                  # Workload Identityèªè¨¼

# ========================================
# åˆ¶ç´„ãƒ»åˆ¶é™äº‹é …ï¼ˆå€‹äººé–‹ç™ºï¼‰
# ========================================
trading_constraints:
  exchange: "bitbank"
  trading_type: "margin"        # ä¿¡ç”¨å–å¼•å°‚ç”¨
  leverage_max: 2.0             # 2å€ãƒ¬ãƒãƒ¬ãƒƒã‚¸ä¸Šé™ï¼ˆbitbankä»•æ§˜ï¼‰
  leverage_actual: 1.0          # å®Ÿéš›ä½¿ç”¨ï¼ˆå®‰å…¨æ€§é‡è¦–ï¼‰
  currency_pair: "BTC/JPY"
  initial_capital: 10000        # 1ä¸‡å††ã‚¹ã‚¿ãƒ¼ãƒˆ
  target_capital: 500000        # æœ€çµ‚ç›®æ¨™50ä¸‡å††
  features_count: 12            # å³é¸ç‰¹å¾´é‡æ•°
  timeframes: ["15m", "4h"]     # ãƒãƒ«ãƒã‚¿ã‚¤ãƒ ãƒ•ãƒ¬ãƒ¼ãƒ 