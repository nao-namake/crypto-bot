execution:
  backtest_period_days: 30
  live_mode_interval_seconds: 300
  paper_mode_interval_seconds: 300
backtest:
  log_level: WARNING
  discord_enabled: false
  progress_interval: 1000
  report_interval: 10000
  mock_api_calls: true
  enable_detailed_logging: false
  fast_data_slicing: true
ml:
  confidence_threshold: 0.3
  allow_dummy_fallback: false
  default_confidence: 0.5
  strategy_integration:
    enabled: true
    ml_weight: 0.35  # Phase 44.1: +17%増加（ML予測信頼度反映強化）
    strategy_weight: 0.7
    high_confidence_threshold: 0.6
    agreement_bonus: 1.2
    disagreement_penalty: 0.85  # Phase 44.1: -30% → -15%ペナルティ（過剰ペナルティ削減）
    min_ml_confidence: 0.45
    hold_conversion_threshold: 0.4
  dynamic_confidence:
    base_hold: 0.35
    error_fallback: 0.25
    ml_fallback: 0.35
    neutral_default: 0.4
    strategy_fallback: 0.35
dynamic_confidence:
  market_uncertainty:
    volatility_factor_max: 0.1
    volatility_divisor: 1.0
    volume_factor_max: 0.06
    volume_multiplier: 0.2
    price_factor_max: 0.04
    uncertainty_max: 0.2
    uncertainty_boost: 1.0
  strategies:
    mochipoy_alert:
      buy_strong_base: 0.7
      buy_strong_max: 0.70  # Phase 44.2: 最大70%に制限（単一戦略過剰影響防止）
      buy_weak_base: 0.45
      buy_weak_max: 0.6
      sell_strong_base: 0.7
      sell_strong_max: 0.70  # Phase 44.2: 最大70%に制限（単一戦略過剰影響防止）
      sell_weak_base: 0.45
      sell_weak_max: 0.6
      hold_base: 0.2
      hold_min: 0.1
      hold_max: 0.35
    multi_timeframe:
      agreement_base: 0.75
      agreement_min: 0.7
      agreement_max: 1.0
      single_tf_base: 0.55
      single_tf_min: 0.4
      single_tf_max: 0.75
      disagreement_base: 0.15
      disagreement_min: 0.1
      disagreement_max: 0.3
      weighted_min: 0.35
      weighted_max: 1.0
      tf_4h_min_strength: 0.002
      tf_4h_weight: 0.6
      tf_15m_weight: 0.4
      position_size_base: 0.025
      atr_ratio_threshold: 0.005
      price_breakout_ratio: 0.995
    donchian_channel:
      breakout_base: 0.6
      breakout_min: 0.3
      breakout_max: 0.85
      reversal_base: 0.5
      reversal_min: 0.3
      reversal_max: 0.7
      hold_base: 0.4
      hold_min: 0.35
      hold_max: 0.6
      volume_bonus_max: 0.1
      volume_multiplier: 0.2
    adx_trend:
      strong_base: 0.65
      strong_min: 0.4
      strong_max: 0.85
      moderate_base: 0.5
      moderate_min: 0.35
      moderate_max: 0.7
      weak_base: 0.35
      weak_min: 0.25
      weak_max: 0.5
      hold_base: 0.45
      hold_min: 0.35
      hold_max: 0.6
      default_min: 0.25
      default_max: 0.6
      adx_bonus_max: 0.25
      adx_divisor: 25
      di_bonus_max: 0.15
      di_divisor: 12
      volume_bonus_max: 0.1
      volume_multiplier: 0.15
    atr_based:
      high_volatility_base: 0.55
      high_volatility_min: 0.35
      high_volatility_max: 0.8
      normal_volatility_base: 0.45
      normal_volatility_min: 0.3
      normal_volatility_max: 0.65
      low_volatility_base: 0.35
      low_volatility_min: 0.25
      low_volatility_max: 0.5
      rsi_base: 0.2
      rsi_multiplier: 0.3
      agreement_max: 0.85
      weak_base: 0.08
      weak_multiplier: 0.1
      volatility_bonus: 1.02
      volatility_max: 0.85
      position_size_base: 0.015
      market_stress_threshold: 0.7
      min_atr_ratio: 0.5
      strength_divisor: 0.2
      strength_normalize: 30.0
  emergency_stop_on_dummy: true
  max_model_failures: 3
  prediction_fallback_confidence: 0.0
  dummy_confidence: 0.5
  model_paths:
    base_path: /app
    local_path: .
    training_path: models/training
performance:
  default_latency_ms: 100.0
strategies:
  adx_trend:
    di_crossover_threshold: 0.5
    di_weak_signal_confidence: 0.35
    hold_confidence: 0.45
    min_confidence: 0.25
    moderate_trend_max: 25
    moderate_trend_min: 15
    strong_trend_threshold: 25
    weak_di_threshold: 1.0
    weak_trend_threshold: 15
  atr_based:
    bb_overbought: 0.7
    bb_oversold: 0.3
    high_volatility_strength: 0.5
    hold_confidence: 0.15
    low_volatility_strength: 0.2
    min_confidence: 0.25
    normal_volatility_strength: 0.25
    rsi_overbought: 65
    rsi_oversold: 35
    strength_fallback: 0.3
    base_confidence: 0.25
    confidence_multiplier: 0.3
  donchian_channel:
    breakout_threshold: 0.002
    hold_confidence: 0.4
    middle_zone_max: 0.6
    middle_zone_min: 0.4
    min_confidence: 0.25
    reversal_threshold: 0.05
    weak_signal_confidence: 0.35
    weak_signal_max: 0.75
    weak_signal_min: 0.25
  mochipoy_alert:
    hold_confidence: 0.15
    weak_signal_confidence: 0.4
  multi_timeframe:
    hold_confidence: 0.15
    trend_conflict_confidence: 0.3
trading:
  anomaly:
    spread_critical_threshold: 0.005
    spread_warning_threshold: 0.003
  ask_spread_ratio: 1.001
  bid_spread_ratio: 0.999
  confidence_levels:
    high: 0.45
    low: 0.2
    medium: 0.3
    min_ml: 0.12
    very_high: 0.6
  fallback_btc_jpy: 16500000.0
  fallback_prices:
    ask: 16600000.0
    bid: 16400000.0
    default_ask: 16100000.0
    default_bid: 15900000.0
  kelly_criterion:
    min_trades_for_kelly: 5
    max_position_ratio: 0.03
    safety_factor: 0.7
  min_trade_size: 0.0001
  initial_position_size: 0.0001
  fee_rate: 0.0012
  minimum_live_balance: 3000
  position_sizing:
    max_position_ratio: 0.05
    stop_loss_atr_multiplier: 1.2
    stop_loss_rate: 0.02
    take_profit_rate: 0.04
    take_profit_ratio: 2.0
  risk_thresholds:
    conditional: 0.65
    deny: 0.85
    min_ml_confidence: 0.12
  stats_log_interval: 10
ensemble:
  max_nan_ratio_features: 0.5
  max_nan_ratio_target: 0.3
  min_training_samples: 50
models:
  lgbm:
    num_leaves: 31
    learning_rate: 0.05
    n_estimators: 100
    feature_fraction: 0.9
    bagging_fraction: 0.8
    bagging_freq: 5
    max_depth: -1
    min_child_samples: 20
    reg_alpha: 0.0
    reg_lambda: 0.0
  min_training_samples: 10
  rf:
    n_estimators: 100
    max_depth: 10
    min_samples_split: 5
    min_samples_leaf: 2
    max_features: sqrt
    bootstrap: true
    oob_score: true
    class_weight: balanced
  xgb:
    max_depth: 6
    learning_rate: 0.05
    n_estimators: 100
    min_child_weight: 1
    subsample: 0.8
    colsample_bytree: 0.8
    alpha: 0
    lambda: 1
    gamma: 0
reporting:
  base_dir: logs/reports
  paper_trading_dir: logs/paper_trading_reports
risk:
  emergency_ratio: 0.005
  emergency_stop_ratio: 0.98
  fallback_max_ratio: 0.1
  fallback_min_ratio: 0.01
  fallback_stop_ratio: 0.95
  kelly_lookback_days: 30
  recent_lookback_hours: 24
  safe_balance_ratio: 0.3
  max_capital_usage: 0.3
  reserve_ratio: 0.7
position_management:
  # Phase 43.5: individualモード廃止、統合TP/SL強制（トレーリングストップ含む）
  consolidate_on_new_entry: true  # エントリー時に既存TP/SLキャンセル・再統合
  min_account_balance: 10000
  max_open_positions: 3
  max_daily_trades: 20
  cooldown_minutes: 15
  min_trade_size: 0.0001
  max_position_ratio_per_trade:
    low_confidence: 0.03
    medium_confidence: 0.05
    high_confidence: 0.1
    enforce_minimum: true
  dynamic_position_sizing:
    enabled: true
    low_confidence:
      min_ratio: 0.01
      max_ratio: 0.03
    medium_confidence:
      min_ratio: 0.03
      max_ratio: 0.05
    high_confidence:
      min_ratio: 0.05
      max_ratio: 0.1
  account_size_adjustments:
    small:
      threshold: 50000
      min_trade_override: true
    medium:
      threshold: 100000
      position_multiplier: 1.0
    large:
      threshold: 100001
      position_multiplier: 1.0
  emergency_stop_loss:
    enable: true
    price_change_threshold: 0.03
    time_window_minutes: 5
    max_loss_threshold: 0.05
    override_cooldown: true
    min_hold_minutes: 1
  take_profit:
    enabled: true
    default_ratio: 2.5
    min_profit_ratio: 0.01
    override_strategy_tp: false
    position_partial_exit: false
  stop_loss:
    enabled: true
    default_atr_multiplier: 2.0
    max_loss_ratio: 0.03
    override_strategy_sl: false
    enable_trailing: false
    execution_slippage: 0.003
    adaptive_atr:
      enabled: true
      use_15m_timeframe: true
      volatility_lookback: 20
      low_volatility:
        threshold_ratio: 0.7
        multiplier: 2.5
      normal_volatility:
        multiplier: 2.0
      high_volatility:
        threshold_ratio: 1.3
        multiplier: 1.5
    min_distance:
      enabled: true
      ratio: 0.01
      override_atr: false
      min_atr_multiplier: 1.5
    trailing:
      enabled: true
      activation_profit: 0.02
      trailing_percent: 0.03
      min_update_distance: 200
      min_profit_lock: 0.005
      cancel_tp_when_exceeds: true
margin:
  position_value_estimation_ratio: 0.8
  # Phase 43: 維持率閾値設定
  thresholds:
    critical: 100.0      # 追証発生レベル - 100%未満でエントリー拒否
    warning: 100.0       # 警告レベル
    caution: 150.0       # 注意レベル
    safe: 200.0          # 安全レベル
  large_drop_threshold: 50.0
  min_position_value: 1000.0
  max_ratio_cap: 10000.0
order_execution:
  smart_order_enabled: true
  high_confidence_threshold: 0.0
  low_confidence_threshold: -1.0
  max_spread_ratio_for_limit: 0.005
  price_improvement_ratio: 0.0002
  entry_price_strategy: unfavorable
  guaranteed_execution_premium: 0.0005
  limit_order_timeout:
    enabled: true
    timeout_minutes: 5
    fallback_to_market: true
    max_price_deviation: 0.05
    check_interval_seconds: 60
balance_alert:
  enabled: true
  min_required_margin: 14000.0
  alert_threshold_ratio: 1.2
  check_interval_minutes: 3
  discord_critical_alert: true

# ==================================================================================
# Phase 42.4: TP/SL距離固定値（デイトレード段階的最適化・2025/10/20更新）
# ==================================================================================
# 2025年市場ベストプラクティス準拠（BTC日次ボラティリティ2-5%対応）
# 段階的アプローチ: RR比1:1.5で実績収集 → 将来的に2:1へ移行検討
#
# 設定根拠:
# - SL 2.0%: 市場推奨3-8%の下限（証拠金1万円で最大損失200円）
# - TP 3.0%: 細かく利益確定（市場ボラティリティ中間値）
# - RR比 1.5:1: 勝率40%以上で収益化可能（現行MLモデルF1スコア0.56-0.61）
#
# optimize_risk_management.py の FIXED_TP_SL_PARAMS と同期してください。
# ==================================================================================
sl_atr_low_vol: 2.1                     # 固定値: 適応型ATR倍率（低ボラティリティ）
sl_atr_normal_vol: 2.0                  # 固定値: 適応型ATR倍率（通常ボラティリティ）
sl_atr_high_vol: 1.2                    # 固定値: 適応型ATR倍率（高ボラティリティ）
sl_min_distance_ratio: 0.02             # Phase 42.4: 最小SL距離比率（2.0% ← 1.0%から変更）
sl_min_atr_multiplier: 1.3              # 固定値: 最小ATR倍率
tp_default_ratio: 1.5                   # Phase 42.4: リスクリワード比（1.5:1維持・段階的最適化）
tp_min_profit_ratio: 0.03               # Phase 42.4: 最小利益率（3.0% ← 1.9%から変更）
# ==================================================================================
kelly_max_position_ratio: 0.05
kelly_safety_factor: 1.0
risk_conditional: 0.7
risk_deny: 0.85
mochipoy_buy_strong_base: 0.7
mochipoy_buy_weak_base: 0.44999999999999996
mochipoy_sell_strong_base: 0.75
mochipoy_sell_weak_base: 0.45
mochipoy_neutral_base: 0.30000000000000004
mtf_agreement_base: 0.8
mtf_partial_agreement_base: 0.4
mtf_no_agreement_base: 0.30000000000000004
mtf_4h_weight: 0.55
donchian_breakout_base: 0.5
donchian_reversal_base: 0.4
donchian_weak_base: 0.25
donchian_breakout_threshold: 0.0015
donchian_reversal_threshold: 0.09
adx_strong_base: 0.7000000000000001
adx_moderate_base: 0.45
adx_weak_base: 0.3
adx_strong_threshold: 23
adx_moderate_min: 10
adx_di_crossover: 0.6000000000000001
adx_di_confirmation: 0.4
atr_high_vol_base: 0.55
atr_normal_vol_base: 0.5
atr_low_vol_base: 0.4
atr_rsi_overbought: 63
atr_rsi_oversold: 26
atr_bb_overbought: 0.8
atr_bb_oversold: 0.35
ml_weight: 0.35
high_confidence_threshold: 0.85
agreement_bonus: 1.15
disagreement_penalty: 0.85  # Phase 44.1: 同期更新（-30% → -15%ペナルティ）
min_ml_confidence: 0.45
hold_conversion_threshold: 0.4
lgbm_num_leaves: 40
lgbm_learning_rate: 0.03842362394715147
lgbm_n_estimators: 200
lgbm_max_depth: 10
lgbm_max_depth_unlimited: true
lgbm_min_child_samples: 100
lgbm_feature_fraction: 0.65
lgbm_bagging_fraction: 0.8
lgbm_bagging_freq: 7
lgbm_reg_alpha: 4.9643553965532245e-05
lgbm_reg_lambda: 0.05302953797331255
xgb_max_depth: 8
xgb_learning_rate: 0.09229165545667654
xgb_n_estimators: 350
xgb_min_child_weight: 7
xgb_subsample: 0.9
xgb_colsample_bytree: 0.8
xgb_gamma: 4.5
xgb_alpha: 0.006691186940196909
xgb_lambda: 0.20681062974015182
xgb_scale_pos_weight: 0.9
rf_n_estimators: 200
rf_max_depth: 24
rf_max_depth_none: false
rf_min_samples_split: 18
rf_min_samples_leaf: 5
rf_max_features_type: sqrt
rf_max_features_float: 0.5
rf_max_leaf_nodes: 50
rf_max_leaf_nodes_none: true
rf_min_impurity_decrease: 0.06
rf_bootstrap: true
rf_oob_score: false
rf_class_weight: null
