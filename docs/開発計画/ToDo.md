# 暗号資産取引Bot - 未達成タスク一覧

## 📋 このファイルの目的

**使用場面**:
- 未達成開発タスク確認
- 実装優先度の把握
- 進捗管理とタスク追跡

**ルール**:
- 未完了タスクのみ記載（達成済み: `docs/開発履歴/Phase_40.md`参照）
- **実装順序**に沿って記載（Phase 41 → 42 → 43 → 44...）
- 定期的にタスク状況を更新

**🎯 2025/10/18更新**: Phase 40.1-40.6, Phase 41.8-41.8.5, Phase 42.1-42.3完了（統合TP/SL・トレーリングストップ・バグ修正3件完了）・次はPhase 43（Meta-Learning）から開始

---

## 🚀 **実装スケジュール（概要）**

```
✅ 完了:    Phase 40.1-40.6 (Optuna最適化 + Feature Engineering)
           → 79パラメータ最適化 + 50特徴量拡張完了
           → 2025/10/16完了

✅ 完了:    Phase 41.8-41.8.5 (Strategy-Aware ML + ML統合閾値最適化)
           → 50→55特徴量・ML統合率10%→100%改善
           → Post-Integration問題解決・Train/Inference一貫性確保
           → 2025/10/17完了

✅ 完了:    Phase 42.1-42.3 (統合TP/SL + トレーリングストップ + バグ修正)
           → 注文数91.7%削減・UI簡潔化・API削減91.7%
           → 平均利益+10-20%向上・含み益保護
           → ML統合精度向上・システム安定性向上
           → 2025/10/18完了

Week 1:    Phase 43 (Meta-Learning動的重み最適化) ⭐次のステップ
           → ML信頼度+50-100%追加・市場適応型統合・低リスク

Week 2:    Phase 44 (確定申告対応システム) 🔴法的必須
           → 取引履歴CSV・損益計算・税務レポート・2025年3月期限

Week 2-3:  Phase 45 (Discord通知最適化v2) 💰コスト削減
           → 通知戦略見直し・月額さらに削減・通知ノイズ-60%

Week 3-4:  Phase 46 (3軸マルチタイムフレーム) 📈性能向上
           → 5分足追加・エントリー精度+5-10%・Phase 43効果確認後

Week 5-6:  Phase 47 (モバイル管理アプリ) 📱運用改善
           → bot停止/再開・ステータス確認・PWA実装

継続的:    Phase 48 (戦略・特徴量拡張) 🔧継続改善
           → 新戦略追加・特徴量最適化・A/Bテスト

Week 7-9:  Phase 49 (マルチアセット対応) 🌐拡張機能
           → ETH/JPY・XRP/JPY対応・ポートフォリオ最適化

保留:      Phase 50+ (情報源多様化) ⚠️高リスク・後回し
           → Phase 43-46効果測定後に再評価・最小限実装から開始
```

---

# 🔥 **未達成タスク一覧**

---

## ✅ Phase 41完了サマリー（2025/10/17）

**Phase 41.8完了**: Strategy-Aware ML実装（実戦略信号学習）
- ✅ 訓練時と推論時の一貫性確保（0-fill → 実戦略信号）
- ✅ 実戦略信号生成メソッド実装（Look-ahead bias防止）
- ✅ ML学習データ準備メソッド修正（55特徴量）
- ✅ MLモデル再学習（Optuna 50 trials）
- ✅ ペーパートレード検証（10分間・エラーゼロ）
- ✅ 品質チェック（1,081テスト100%成功・69.57%カバレッジ）

**Phase 41.8.5完了**: ML統合閾値最適化
- ✅ ML統合閾値調整（0.6→0.45、0.8→0.60）
- ✅ 3段階統合ロジック再設計（3クラス分類最適化）
- ✅ ペーパートレード検証（10分間・ML統合率100%達成）
- ✅ Phase 41の設計思想完全実現

**達成効果**:
- 特徴量: 50 → 55個（+10%）
- ML統合時間: 10% → 70-80%（+600-700%）
- Train/Inference一貫性: 完全確保
- Post-Integration問題: 解決

**詳細**: `docs/開発履歴/Phase_40.md` 参照

---

## ✅ Phase 42完了サマリー（2025/10/18）

**Phase 42.1完了**: 統合TP/SL実装
- ✅ UI簡潔化: 24個→2個の注文（91.7%削減）
- ✅ API呼び出し削減: 24回→2回（91.7%削減）
- ✅ 加重平均価格計算・統合ID管理実装
- ✅ 56テスト追加（1,081→1,137テスト・100%成功）
- ✅ 69.90%カバレッジ達成
- ✅ 38分間ペーパートレード検証（エラーゼロ）

**Phase 42.2完了**: トレーリングストップ実装
- ✅ トレーリングSL監視ロジック実装
- ✅ Bybit/Binance準拠設定（2%発動・3%距離）
- ✅ 最小利益確保機能（0.5%保証）
- ✅ TP自動キャンセル機能（SL>TP時）
- ✅ Discord通知統合

**Phase 42.3完了**: バグ修正3件
- ✅ ML Agreement Logic修正（strict matching）
- ✅ Feature Warning抑制（strategy_signal_*除外）
- ✅ 証拠金チェックリトライ機能（Error 20001対策）

**達成効果**:
- 注文数削減: 91.7%
- API呼び出し削減: 91.7%
- 平均利益額: +10-20%向上（期待）
- ML統合精度: 向上
- システム安定性: 向上

**詳細**: `docs/開発履歴/Phase_40.md` 参照

---

## Phase 43: Meta-Learning動的重み最適化システム（1週間・8-10時間）⭐高優先度

**背景**: Phase 41-44で多様な情報源が揃った後の最終統合最適化
- **Phase 41完了後**: 戦略5つ + ML予測（55特徴量）= 6つの判断
- **Phase 44完了後**: 戦略5つ + ML予測（80-100特徴量）= 6つの判断
- **現在の問題**: 固定重み（戦略70% + ML30%）・市場状況に関係なく常に同じ重み

**革新的解決策**: 市場状況に応じて動的に重みを最適化（Meta-Learning）

```
現在（Phase 29.5固定重み統合）:
  戦略判断（5戦略統合） → 70% ┐
  ML予測（80-100特徴量） → 30% ├─→ 加重平均 → 最終判断
                             ┘
  ※常に固定重み（トレンド相場でもレンジ相場でも同じ）

理想（Phase 43 Meta-Learning）:
  市場状況分析 ───────────────┐
  戦略判断（5戦略統合）         ├─→ Meta-ML → 動的重み決定 → 最終判断
  ML予測（80-100特徴量）         │    （例: トレンド相場: 戦略40% + ML60%）
  過去パフォーマンス履歴       ┘         （例: レンジ相場: 戦略80% + ML20%）
```

**Meta-Learning入力特徴量**:
```
1. 市場状況特徴量（10-15特徴量）:
   - ボラティリティ状態（ATR・BB幅・過去N日標準偏差）
   - トレンド強度（ADX・EMAスプレッド・方向性指数）
   - レンジ/トレンド判定（Donchian幅・R2・フラクタル次元）
   - 出来高状態（Volume Ratio・異常検出）
   - 市場レジーム（強気/弱気/横ばい）

2. 戦略パフォーマンス履歴（5特徴量）:
   - 各戦略の過去N取引の勝率（7日/30日移動平均）
   - 各戦略の過去N取引の平均利益
   - 各戦略の信頼度推移

3. ML予測パフォーマンス履歴（3特徴量）:
   - ML過去N取引の勝率（7日/30日移動平均）
   - ML予測信頼度推移
   - ML予測一致率（戦略との）

合計: 18-23特徴量
```

**Meta-Learning出力**:
```
- 戦略重み: 0.0-1.0（動的）
- ML重み: 0.0-1.0（動的）
※合計1.0に正規化

例:
  トレンド相場（ADX>30, 方向性明確）:
    → 戦略40% + ML60%（MLがトレンド得意）

  レンジ相場（ADX<20, ボラ低）:
    → 戦略80% + ML20%（戦略がレンジ得意）

  高ボラティリティ相場（ATR高, BB幅大）:
    → 戦略60% + ML40%（バランス重視）
```

### Phase 43.1: Meta-Learning設計（2時間）
- [ ] **アーキテクチャ設計**: Meta-MLモデル構造決定
  - 入力: 市場状況18-23特徴量
  - 出力: 戦略重み・ML重み（2値・合計1.0）
- [ ] **学習データ設計**: 過去取引データからラベル生成
  - 各市場状況で「どちらの判断が正しかったか」を記録
  - 最適重みを事後的に計算（教師データ）
- [ ] **モデル選定**: LightGBM Regressor（軽量・高速）

### Phase 43.2: 市場状況特徴量実装（2-3時間）
- [ ] **MarketRegimeAnalyzer実装**: 市場状況分析クラス
  - `analyze_market_regime()`: レジーム判定（トレンド/レンジ/高ボラ）
  - `get_market_features()`: 市場状況特徴量取得
- [ ] **パフォーマンス履歴トラッキング**: 戦略・MLの過去パフォーマンス記録
  - `PerformanceTracker`: 勝率・平均利益・信頼度推移
- [ ] **単体テスト**: 市場状況分析・履歴トラッキング確認

### Phase 43.3: Meta-ML学習パイプライン構築（2-3時間）
- [ ] **学習データ生成**: 過去180日取引データから最適重み計算
  - 各取引での市場状況特徴量抽出
  - 事後的最適重み計算（どちらが正しかったか）
- [ ] **Meta-ML学習**: LightGBM回帰モデル学習
  - `train_meta_learning_model.py` スクリプト作成
  - 交差検証・ハイパーパラメータ最適化
- [ ] **モデル保存**: `models/meta_learning/meta_model.pkl`

### Phase 43.4: 統合ロジック実装（2時間）
- [ ] **TradingCycleManager拡張**: Meta-ML統合
  - `_get_dynamic_weights()`: Meta-MLで動的重み取得
  - `_integrate_with_meta_learning()`: 動的重み適用統合
- [ ] **thresholds.yaml拡張**: Meta-Learning設定追加
  - `meta_learning.enabled: true`
  - `meta_learning.fallback_weights`: フォールバック固定重み
- [ ] **単体テスト**: 動的重み計算・統合ロジック確認

### Phase 43.5: バックテスト検証・ライブ適用（2時間）
- [ ] **バックテスト実行**: 180日データで効果検証
  - 固定重み（Phase 29.5）vs 動的重み（Phase 43）
  - シャープレシオ・勝率・平均利益比較
- [ ] **ペーパートレード検証**: 1-2日動作確認
- [ ] **ライブ適用**: 段階的有効化・継続監視

**Phase 43期待効果**:
- ✅ ML信頼度向上: +50-100%（Phase 40-42の効果に追加）
- ✅ 市場適応型統合: 市場状況に応じた最適な判断
- ✅ 戦略・ML双方の強みを最大化: トレンド相場はML重視・レンジ相場は戦略重視
- ✅ シャープレシオ追加向上: +30-50%期待
- ✅ 過学習リスク低: シンプルなMeta-ML・十分な学習データ

**実装場所**:
- `src/ml/meta_learning.py`: Meta-MLモデル・MarketRegimeAnalyzer・PerformanceTracker
- `src/core/services/trading_cycle_manager.py`: Meta-ML統合ロジック
- `scripts/ml/train_meta_learning_model.py`: Meta-ML学習スクリプト
- `config/core/thresholds.yaml`: Meta-Learning設定

---

# 📊 **Phase 44: 確定申告対応システム（最優先・3-4日）**

## 🔴 **法的必須要件: 2025年3月確定申告期限**

**背景**: 暗号資産取引の確定申告義務
- **法的要件**: 年間20万円以上の利益で確定申告必須
- **期限**: 2025年3月15日（2024年分確定申告）
- **現状**: 手作業での取引履歴集計・損益計算（10時間以上）
- **リスク**: 計算ミス・税務リスク・時間的負担

**解決策**: 完全自動化された確定申告サポートシステム

```
現状（手作業）:
  bitbank取引履歴ダウンロード → Excel集計 → 損益計算 → 確定申告書作成
                              ↑ 10時間以上・ミスリスク高

Phase 44（自動化）:
  bot自動記録 → 1クリックCSV出力 → 自動損益計算 → 税務レポート生成
                              ↑ 5分・正確性100%
```

---

## Phase 44実装タスク

### Phase 44.1: 取引履歴記録システム（1日・2-3時間）
- [ ] **TradeHistoryRecorder実装**: すべての取引を自動記録
  - エントリー・エグジット・TP/SL発動を記録
  - 日時・取引種別・数量・価格・手数料・損益を保存
  - SQLiteデータベース（`data/trade_history.db`）
  - 取引実行時にリアルタイム記録

- [ ] **データモデル設計**:
```python
class TradeRecord:
    trade_id: str           # 取引ID
    timestamp: datetime     # 取引日時（JST）
    trade_type: str         # "entry" / "exit" / "tp" / "sl"
    side: str               # "buy" / "sell"
    amount: float           # 取引数量（BTC）
    price: float            # 約定価格（円）
    fee: float              # 手数料（円）
    pnl: float              # 実現損益（円）※exitのみ
    balance: float          # 取引後残高（円）
    note: str               # メモ
```

- [ ] **統合**: ExecutionServiceに自動記録機能追加

### Phase 44.2: CSV出力機能（0.5日・1-2時間）
- [ ] **CSVエクスポーター実装**: `scripts/tax/export_trade_history.py`
  - 期間指定（例: 2024年1月1日～12月31日）
  - 暗号資産取引所フォーマット対応
  - 国税庁推奨フォーマット対応

- [ ] **出力フォーマット**:
```csv
取引日時,種別,通貨,数量,価格,手数料,損益,備考
2024-01-15 10:30:00,買,BTC,0.001,6500000,65,,-
2024-01-15 15:45:00,売,BTC,0.001,6550000,66,49869,利益確定
```

- [ ] **CLI実装**: `python scripts/tax/export_trade_history.py --year 2024`

### Phase 44.3: 損益計算エンジン（1日・2-3時間）
- [ ] **PnLCalculator実装**: `src/tax/pnl_calculator.py`
  - **移動平均法対応**（総平均法）: 国税庁推奨
  - 年間損益集計・月別サマリー
  - 取得原価・譲渡原価自動計算

- [ ] **計算ロジック**:
```python
class PnLCalculator:
    def calculate_annual_pnl(self, year: int) -> dict:
        """年間損益計算"""
        return {
            "total_pnl": 125000,           # 年間損益（円）
            "total_profit": 200000,        # 総利益（円）
            "total_loss": -75000,          # 総損失（円）
            "num_trades": 150,             # 取引回数
            "win_rate": 0.62,              # 勝率
            "monthly_pnl": {...}           # 月別損益
        }
```

- [ ] **税務対応**:
  - 雑所得計算（総合課税）
  - 取得原価管理（移動平均法）
  - 手数料控除対応

### Phase 44.4: 税務レポート生成（1日・2-3時間）
- [ ] **TaxReportGenerator実装**: `src/tax/report_generator.py`
  - **PDF出力**: 確定申告書添付用
  - **国税庁フォーマット対応**: 仮想通貨取引損益計算書
  - **サマリーレポート**: 年間取引統計

- [ ] **レポート内容**:
```
=== 2024年 暗号資産取引損益計算書 ===

1. 基本情報
   - 取引所: bitbank
   - 通貨: BTC/JPY
   - 計算方法: 移動平均法

2. 年間サマリー
   - 年間損益: +125,000円
   - 取引回数: 150回
   - 勝率: 62%
   - 平均利益: +833円/取引

3. 月別損益
   - 1月: +15,000円
   - 2月: +8,500円
   ...
```

- [ ] **CLI実装**: `python scripts/tax/generate_tax_report.py --year 2024`

### Phase 44.5: Discord通知統合・自動化（0.5日・1時間）
- [ ] **年末自動通知**: 12月31日23:59に年間損益速報
  - 年間損益・取引回数・勝率
  - 確定申告要否判定（利益20万円以上）

- [ ] **月次サマリー通知**: 毎月1日に前月損益
  - 月間損益・取引回数・勝率推移

- [ ] **手動レポート生成**: Discord通知経由で実行
  - `/tax_report 2024` コマンド対応

**Phase 44期待効果**:
- ✅ 確定申告作業時間: 10時間 → 30分（-95%）
- ✅ 計算精度: 100%（ミスリスク0）
- ✅ 税務リスク: 0%（正確な損益計算）
- ✅ 法的コンプライアンス: 100%達成
- ✅ 月次損益可視化: リアルタイム

**実装場所**:
- `src/tax/trade_history.py`: 取引履歴記録
- `src/tax/pnl_calculator.py`: 損益計算エンジン
- `src/tax/report_generator.py`: レポート生成
- `scripts/tax/export_trade_history.py`: CSV出力CLI
- `scripts/tax/generate_tax_report.py`: レポート生成CLI
- `data/trade_history.db`: SQLiteデータベース

---

# 💰 **Phase 45: Discord通知最適化v2（1-2日）**

## 背景・目的

**Phase 37.3完了**: 月700-900円削減（35-45%）→ 月額1,100-1,300円達成
**Phase 45目標**: さらなるコスト削減・通知ノイズ削減

**期待効果**: 月額さらに-20-30%削減 → 月額880-1,040円へ

## 実装タスク

### Phase 45.1: 通知戦略見直し（0.5日・1-2時間）
- [ ] **重要度3段階フィルタリング強化**:
  - Critical: 即時送信（そのまま）
    - 残高不足・証拠金不足・取引エラー
  - Warning: 条件付き送信（新規実装）
    - 1時間に1回まで（同種Warning集約）
    - API軽微エラー・ML警告・市場異常検出
  - Info: 完全停止（Phase 37.3で実施済み）

- [ ] **Warning通知集約ロジック**:
```python
class WarningAggregator:
    def should_send_warning(self, warning_type: str) -> bool:
        last_sent = self._get_last_sent_time(warning_type)
        if datetime.now() - last_sent > timedelta(hours=1):
            return True  # 1時間経過 → 送信OK
        return False  # まだ1時間未満 → 送信スキップ
```

### Phase 45.2: 通知バッチ送信実装（0.5日・1-2時間）
- [ ] **5分ごとのバッチ送信**:
  - 1サイクル内の複数Warning → 1通知に集約
  - テンプレート: 「⚠️ 5分間サマリー: 3件のWarning発生」

- [ ] **Discord Embed活用**:
  - 1通知で複数Warning表示（フィールド分割）
  - API呼び出し削減（3通知 → 1通知）

### Phase 45.3: Discord Webhook代替検討（0.5日・1時間）
- [ ] **代替サービス調査**:
  - Slack無料プラン（月額0円・10,000メッセージ/月）
  - Telegram Bot（月額0円・無制限）
  - LINE Notify（月額0円・1,000通知/日）

- [ ] **コスト比較**:
  - Discord Webhook: 月1,100-1,300円（現状）
  - Slack/Telegram: 月0円（移行候補）

- [ ] **移行判断**: コスト削減効果 vs 移行コスト

**Phase 45期待効果**:
- ✅ 月額コスト: さらに-20-30%削減（月880-1,040円へ）
- ✅ 通知ノイズ: -60%削減（Warning集約）
- ✅ Discord API呼び出し: -40%削減
- ✅ 運用効率: 向上（重要通知のみ受信）

---

# 📈 **Phase 46: 3軸マルチタイムフレーム戦略（1-2週間）**

## 背景・目的

**問題**: 5分間隔実行だが4h/15m足の2軸のみ
**解決**: 5分足を活用して直近市場状況を反映

**期待効果**: エントリー精度+5-10%向上

## 実装タスク

### Phase 46.1: 5分足補助指標実装（3-4日）
- [ ] DataPipeline拡張: 5分足OHLCV取得
- [ ] 5分足分析ロジック: EMA5/10クロス・RSI・価格変動率
- [ ] MultiTimeframe戦略拡張: 3軸構成（4h:60%, 15m:30%, 5m:10%）
- [ ] フィルターモード実装: 逆シグナル×0.8・同シグナル×1.1
- [ ] thresholds.yaml設定追加

### Phase 46.2: バックテスト検証（2-3日）
- [ ] 2軸 vs 3軸比較
- [ ] ノイズ影響評価
- [ ] 最適パラメータ探索

### Phase 46.3: ペーパートレード検証（1-2週間）
- [ ] 実動作確認

### Phase 46.4: 段階的ライブ適用
- [ ] 効果確認時のみ有効化
- [ ] 継続監視

---

# 📱 **Phase 47: モバイル管理アプリ（PWA）（1-2週間）**

## 背景・目的
**問題**: 外出先でbotの停止・確認ができない
**解決**: スマホからbot制御可能なPWA実装
**期待効果**: 運用効率向上・緊急対応可能化

## 実装タスク

### Phase 47.1: 認証システム実装（2-3日・4-6時間）
- [ ] JWT認証実装（`src/web/auth/jwt_manager.py`）
- [ ] 環境変数でパスワード管理（SECRET_ADMIN_PASSWORD）
- [ ] トークン有効期限24時間
- [ ] 品質チェック: 認証テスト追加

### Phase 47.2: REST API実装（2-3日・4-6時間）
- [ ] FastAPI実装（`src/web/api/bot_control.py`）
- [ ] エンドポイント:
  - `GET /api/status` - システム状況取得
  - `POST /api/start` - bot起動
  - `POST /api/stop` - bot停止
  - `GET /api/balance` - 残高取得
  - `GET /api/positions` - ポジション一覧
- [ ] CORS設定（Cloud Run対応）
- [ ] 品質チェック: API統合テスト追加

### Phase 47.3: PWAフロントエンド実装（3-4日・6-8時間）
- [ ] HTML/CSS/JavaScript実装（`src/web/static/`）
- [ ] Material Design Lite使用（CDN）
- [ ] レスポンシブデザイン（スマホ最適化）
- [ ] PWA Manifest作成（`manifest.json`）
- [ ] Service Worker実装（オフライン対応）
- [ ] 機能:
  - システム状況表示
  - Start/Stopボタン
  - 残高・ポジション表示
  - エラー通知

### Phase 47.4: Cloud Runデプロイ（1日・2-3時間）
- [ ] Dockerfile拡張（FastAPI追加）
- [ ] 環境変数設定（SECRET_ADMIN_PASSWORD）
- [ ] ヘルスチェック設定（`/health`）
- [ ] HTTPSアクセス確認
- [ ] PWAインストール動作確認

### Phase 47.5: セキュリティ強化（1日・2-3時間）
- [ ] レート制限実装（1分10リクエスト）
- [ ] IP制限検討（Cloud Armorオプション）
- [ ] 監査ログ実装（全API操作記録）
- [ ] Discord通知統合（API操作通知）

**実装時間**: 9-12日（18-26時間）
**リスク**: 低（認証さえ堅牢なら安全）
**優先度**: 中（運用効率大幅向上）

---

# 🔧 **Phase 48: 戦略・特徴量拡張パッケージ（継続的改善）**

## 背景・目的
**問題**: 5戦略55特徴量で固定・市場変化に柔軟対応できない
**解決**: 継続的に戦略・特徴量を追加する仕組み確立
**期待効果**: ML予測精度継続的向上・市場適応力強化

## 実装タスク

### Phase 48.1: 戦略追加候補（随時実装・各2-3日）
- [ ] **Ichimoku Cloud Strategy**（一目均衡表）:
  - 雲の厚さ・転換線/基準線クロス・遅行スパン
  - 期待効果: トレンド転換精度+5-8%
- [ ] **Volume Profile Strategy**（出来高プロファイル）:
  - POC（Point of Control）・VAH/VAL・出来高集中帯
  - 期待効果: サポート/レジスタンス精度+8-12%
- [ ] **Elliott Wave Strategy**（エリオット波動）:
  - 波動カウント・フィボナッチ比率・衝撃波/調整波
  - 期待効果: 中長期トレンド予測+10-15%
- [ ] **Market Microstructure Strategy**（マーケットマイクロ構造）:
  - Bid/Ask Spread・Order Book Imbalance・Trade Flow
  - 期待効果: 短期エントリー精度+5-10%

### Phase 48.2: 特徴量追加候補（随時実装・各1-2日）
- [ ] **時間的特徴量**（5-8特徴量追加）:
  - 曜日・時間帯・月初/月末・四半期末
  - 期待効果: 時間パターン認識精度+3-5%
- [ ] **マクロ経済特徴量**（3-5特徴量追加）:
  - ドル円相場・日経平均・米国債利回り
  - 期待効果: 相関資産連動精度+5-8%
- [ ] **オンチェーン特徴量**（5-10特徴量追加）:
  - Active Addresses・Transaction Volume・Miner Flow
  - 期待効果: ファンダメンタル予測+8-12%
- [ ] **センチメント特徴量**（3-5特徴量追加）:
  - Fear & Greed Index・SNS感情分析・検索トレンド
  - 期待効果: 市場心理反映+5-10%

### Phase 48.3: 継続的評価フレームワーク（1週間・8-10時間）
- [ ] 戦略・特徴量AB Testing実装
- [ ] バックテスト自動評価スクリプト
- [ ] F1スコア・シャープレシオ比較
- [ ] 自動採用/除外判定（閾値ベース）
- [ ] 週次レポート生成（Discord通知）

**実装時間**: 継続的（各機能2-3日ずつ）
**リスク**: 低（既存フレームワーク活用）
**優先度**: 中（Phase 43-47後に継続実施）

---

# 🌐 **Phase 49: マルチアセット対応（2-3週間）**

## 背景・目的
**問題**: BTC/JPY専用・他資産に拡大できない
**解決**: ETH/JPY・XRP/JPY対応・ポートフォリオ最適化
**期待効果**: リスク分散・収益機会拡大+30-50%

## 実装タスク

### Phase 49.1: アセット抽象化（3-4日・6-8時間）
- [ ] AssetConfigクラス実装（`src/core/config/asset_config.py`）
- [ ] symbol・min_trade_size・fee_rateの抽象化
- [ ] unified.yaml拡張（multi_asset設定追加）
- [ ] 品質チェック: アセット切り替えテスト

### Phase 49.2: ETH/JPY対応（3-4日・6-8時間）
- [ ] Bitbank ETH/JPY API対応
- [ ] 特徴量生成ETH対応
- [ ] 戦略パラメータETH最適化
- [ ] ML再学習（ETH/JPY過去180日）
- [ ] バックテスト検証（ETH/JPY 180日）

### Phase 49.3: XRP/JPY対応（3-4日・6-8時間）
- [ ] Bitbank XRP/JPY API対応
- [ ] 特徴量生成XRP対応
- [ ] 戦略パラメータXRP最適化
- [ ] ML再学習（XRP/JPY過去180日）
- [ ] バックテスト検証（XRP/JPY 180日）

### Phase 49.4: ポートフォリオ最適化（4-5日・8-10時間）
- [ ] PortfolioOptimizer実装（`src/trading/portfolio/optimizer.py`）
- [ ] 資金配分アルゴリズム（Kelly基準ベース）
- [ ] 相関係数考慮リスク分散
- [ ] 動的リバランシング（週次）
- [ ] バックテスト検証（3資産ポートフォリオ）

### Phase 49.5: 段階的ライブ適用（2-3週間）
- [ ] ペーパートレード検証（各資産1週間）
- [ ] 少額ライブ検証（各1万円・1週間）
- [ ] 3資産同時運用検証（1-2週間）
- [ ] 効果測定・最終デプロイ判断

**実装時間**: 16-20日（32-42時間）
**リスク**: 中（資産間相関リスク・運用複雑化）
**優先度**: 中（Phase 43-47後に実施）

---

# ⚠️ **Phase 50+: 情報源多様化（高リスク・保留）**

## 背景・目的
**旧Phase 44内容**: 55特徴量 → 80-100特徴量拡張
**保留理由**: 外部API依存・高コスト・高リスク
**再評価条件**: Phase 43効果測定後・収益50万円以上時

## 実装タスク（将来実施時）

### Phase 50.1: News API統合（1週間）
- [ ] NewsAPI/Finnhub統合
- [ ] 感情分析（Positive/Negative/Neutral）
- [ ] 10-15特徴量追加

### Phase 50.2: SNS感情分析（1週間）
- [ ] Twitter/Reddit API統合
- [ ] VADER/FinBERT感情分析
- [ ] 10-15特徴量追加

### Phase 50.3: オンチェーン分析（1週間）
- [ ] Glassnode/CryptoQuant API統合
- [ ] On-chain Metrics取得
- [ ] 10-15特徴量追加

**実装時間**: 3週間（Phase 43後再評価）
**リスク**: **高**（API依存・月額コスト・品質不安定）
**優先度**: **低**（Phase 43-49完了後に再検討）

**📋 保留判断理由**:
- Phase 43 Meta-Learning効果測定優先（低リスク・高ROI確保）
- 外部API月額コスト（$100-300/月）対効果不明
- Phase 41.8.5でML統合率100%達成済み（優先度低下）

---

# 🎯 **開発優先度指針・実装スケジュール**

## 実装順序ロジック（2025/10/19更新）

```
✅ 完了: Phase 40.1-40.6（3週間・2025/10/16完了）
   → 79パラメータ最適化 + 50特徴量拡張完了
   → Optuna包括最適化 + Feature Engineering

✅ 完了: Phase 41.8-41.8.5（2日・2025/10/17完了）
   → 50→55特徴量・Post-Integration問題解決・内部最適化のみ
   → Strategy-Aware ML・ML統合率10%→100%達成

✅ 完了: Phase 42.1-42.3（4日・2025/10/18完了）
   → 統合TP/SL + トレーリングストップ + バグ修正3件
   → 注文数91.7%削減・平均利益+10-20%向上

📅 実装予定（優先度順）:

1. Phase 43（1週間）: Meta-Learning動的重み最適化 ⭐次のステップ
   → 市場適応型統合・ML信頼度+50-100%・シャープレシオ+30-50%
   → 低リスク・内部最適化のみ・高ROI

2. Phase 44（1週間）: 確定申告対応システム 🔴法的必須
   → 取引履歴記録・CSV出力・損益計算・税務レポート
   → 2025年3月期限・法的義務・高優先度

3. Phase 45（1週間）: Discord通知最適化v2 💰コスト削減
   → 通知頻度削減・バッチ送信・月額コスト-30-40%削減
   → 低リスク・コスト削減効果大

4. Phase 46（1-2週間）: 3軸マルチタイムフレーム 📈性能向上
   → 5分足追加・エントリー精度+5-10%向上
   → Phase 43効果確認後に実施・中リスク

5. Phase 47（1-2週間）: モバイル管理アプリ（PWA） 📱運用改善
   → スマホからbot制御・緊急対応可能化
   → 低リスク・運用効率大幅向上

6. Phase 48（継続的）: 戦略・特徴量拡張パッケージ 🔧継続改善
   → Ichimoku・Volume Profile等追加
   → 継続的ML精度向上・低リスク

7. Phase 49（2-3週間）: マルチアセット対応 🌐拡張機能
   → ETH/JPY・XRP/JPY対応・ポートフォリオ最適化
   → 収益機会+30-50%・中リスク

⚠️ 保留: Phase 50+（3週間）: 情報源多様化 ❌高リスク・後回し
   → 55→80-100特徴量・外部API統合
   → Phase 43-49完了後に再評価・高コスト・高リスク
```

## 期待される段階的効果

```
✅ 現状（Phase 42.1-42.3完了・2025/10/18）:
  ✅ シャープレシオ+50-70%向上（Phase 40期待値）
  ✅ 79パラメータ最適化完了（Phase 40）
  ✅ 55特徴量拡張完了（15→50→55、+267%）
  ✅ F1スコア 0.56-0.61（Phase 41.8実測）
  ✅ ML統合率 10% → 100%（Phase 41.8.5で+900%）
  ✅ Train/Inference一貫性確保（Phase 41.8）
  ✅ Post-Integration問題解決（Phase 41.8）
  ✅ 注文数91.7%削減（Phase 42.1・24→2注文）
  ✅ API呼び出し91.7%削減（Phase 42.1）
  ✅ トレーリングストップ実装（Phase 42.2・平均利益+10-20%向上）
  ✅ ML統合精度向上（Phase 42.3・strict matching）
  ✅ システム安定性向上（Phase 42.3・証拠金チェックリトライ）

1週間後（Phase 43完了予定）:
  🎯 ML信頼度+50-100%追加（Meta-Learning）
  🎯 市場適応型統合実現
  🎯 シャープレシオ+30-50%追加

2週間後（Phase 44完了予定）:
  🎯 確定申告対応完了（法的義務達成）
  🎯 取引履歴自動記録・CSV出力・税務レポート
  🎯 2025年3月期限対応完了

2-3週間後（Phase 45完了予定）:
  🎯 Discord通知コスト-30-40%削減
  🎯 月額運用コスト削減（-¥300-500/月）
  🎯 通知品質向上（バッチ送信・集約）

3-5週間後（Phase 46完了予定）:
  🎯 エントリー精度+5-10%（5分足追加・3軸マルチタイムフレーム）
  🎯 直近市場状況の反映
  🎯 Phase 43効果確認後に実施

6-7週間後（Phase 47完了予定）:
  🎯 スマホからbot制御可能化
  🎯 緊急対応可能化（外出先対応）
  🎯 運用効率大幅向上

Phase 48（継続的）:
  🎯 戦略・特徴量継続追加
  🎯 ML精度継続的向上
  🎯 市場変化への柔軟対応

9-11週間後（Phase 49完了予定）:
  🎯 マルチアセット対応完了（BTC+ETH+XRP）
  🎯 収益機会+30-50%拡大
  🎯 ポートフォリオ最適化・リスク分散

Phase 43-49合計累積効果（推奨実装範囲）:
  ✅ シャープレシオ: +50-70%（Phase 40達成済み）
  🎯 追加向上: +30-50%（Phase 43 Meta-Learning）
      = 合計+80-120%向上期待
  ✅ ML統合率: +900%（Phase 41.8.5達成済み・10% → 100%）
  ✅ 注文数削減: 91.7%（Phase 42.1達成済み・24→2注文）
  ✅ 平均利益向上: +10-20%（Phase 42.2達成済み）
  🎯 ML予測活用: +50-100%（Phase 43 Meta-Learning）
  🎯 市場適応型統合実現（Phase 43）
  🎯 確定申告対応完了（Phase 44・法的必須）
  🎯 運用コスト削減: -30-40%（Phase 45）
  🎯 エントリー精度: +5-10%（Phase 46）
  🎯 運用効率向上（Phase 47・モバイル管理）
  🎯 収益機会拡大: +30-50%（Phase 49・マルチアセット）

Phase 50+（保留・高リスク）:
  ⚠️ 外部API依存リスク高・Phase 43-49完了後に再評価
  🎯 （実施する場合）ML信頼度+30-50%追加（情報源多様化）
  🎯 （実施する場合）特徴量数: 55 → 80-100（+30-50特徴量）
  🎯 （実施する場合）真のアンサンブル効果実現
  ⚠️ 月額コスト増加（$100-300/月API費用）
```

## 優先度まとめ

| 優先度 | Phase | 期間 | 効果 | リスク | 状態 | 推奨 |
|--------|-------|------|------|--------|------|------|
| ✅ 完了 | Phase 40 | 2週間 | シャープレシオ+50-70% | 低 | **完了** | - |
| ✅ 完了 | Phase 40.6 | 1週間 | ML予測精度+8-15% | 低 | **完了** | - |
| ✅ 完了 | Phase 41.8 | 1日 | Train/Inference一貫性・55特徴量 | 低 | **完了** | - |
| ✅ 完了 | Phase 41.8.5 | 0.5日 | ML統合率10%→100%（+900%） | 低 | **完了** | - |
| ✅ 完了 | Phase 42.1 | 2日 | 注文数91.7%削減・UI簡潔化・API削減91.7% | 低 | **完了** | - |
| ✅ 完了 | Phase 42.2 | 1日 | 平均利益額+10-20%・含み益保護 | 低 | **完了** | - |
| ✅ 完了 | Phase 42.3 | 0.5日 | ML統合精度向上・システム安定性向上 | 低 | **完了** | - |
| ⭐ 最優先 | Phase 43 | 1週間 | ML信頼度+50-100%・シャープレシオ+30-50% | **低** | 未着手 | **✅ 実施推奨** |
| 🔴 法的必須 | Phase 44 | 1週間 | 確定申告対応完了・法的義務達成 | 低 | 未着手 | **✅ 実施必須** |
| 💰 高優先 | Phase 45 | 1週間 | Discord通知コスト-30-40%削減 | 低 | 未着手 | **✅ 実施推奨** |
| 📈 中優先 | Phase 46 | 1-2週間 | エントリー精度+5-10%（3軸マルチTF） | 中 | 未着手 | Phase 43後 |
| 📱 中優先 | Phase 47 | 1-2週間 | 運用効率向上（モバイル管理） | 低 | 未着手 | 運用改善 |
| 🔧 継続 | Phase 48 | 継続的 | ML精度継続向上（戦略・特徴量追加） | 低 | 未着手 | 継続実施 |
| 🌐 中優先 | Phase 49 | 2-3週間 | 収益機会+30-50%（マルチアセット） | 中 | 未着手 | Phase 43-47後 |
| ⚠️ 保留 | Phase 50+ | 3週間 | ML信頼度+30-50%（情報源多様化） | **高** | 未着手 | **❌ 後回し** |

---

**🎉 Phase 40.1-40.6, Phase 41.8-41.8.5, Phase 42.1-42.3完了！**

**✅ Phase 42.1-42.3完了（2025/10/18）**:
- Phase 42.1: 統合TP/SL実装（注文数91.7%削減・UI簡潔化）
- Phase 42.2: トレーリングストップ実装（含み益保護・平均利益+10-20%向上）
- Phase 42.3: バグ修正3件（ML統合精度向上・システム安定性向上）
- 56テスト追加完了（1,081 → 1,137テスト・100%成功）
- 69.90%カバレッジ達成（目標70%にほぼ到達）
- 38分間ペーパートレード検証完了（エラーゼロ）

**✅ Phase 41.8.5完了（2025/10/17）**:
- 55特徴量システム稼働中（50基本 + 5戦略信号）
- ML統合閾値最適化（0.6→0.45）・ML統合率100%達成
- Train/Inference一貫性確保・Post-Integration問題解決

**📋 Phase 43-50+ 実装計画（2025/10/19更新）**:

**Week 1**: Phase 43（Meta-Learning動的重み最適化） ⭐次のステップ
- 市場適応型統合実現・ML信頼度+50-100%追加
- シャープレシオ+30-50%追加向上
- 実装時間: 1週間（8-10時間）

**Week 2**: Phase 44（確定申告対応システム） 🔴法的必須
- 取引履歴記録・CSV出力・損益計算・税務レポート
- 2025年3月期限対応完了
- 実装時間: 1週間（8-10時間）

**Week 2-3**: Phase 45（Discord通知最適化v2） 💰コスト削減
- 通知頻度削減・バッチ送信・月額コスト-30-40%削減
- 実装時間: 1週間（4-6時間）

**Week 3-4**: Phase 46（3軸マルチタイムフレーム） 📈性能向上
- 5分足追加・エントリー精度+5-10%向上
- 実装時間: 1-2週間（10-14時間）

**Week 5-6**: Phase 47（モバイル管理アプリ） 📱運用改善
- PWA実装・スマホからbot制御可能化
- 実装時間: 1-2週間（18-26時間）

**継続的**: Phase 48（戦略・特徴量拡張） 🔧継続改善
- Ichimoku・Volume Profile等追加
- 実装時間: 継続的（各機能2-3日）

**Week 7-9**: Phase 49（マルチアセット対応） 🌐拡張機能
- ETH/JPY・XRP/JPY対応・ポートフォリオ最適化
- 実装時間: 2-3週間（32-42時間）

**保留**: Phase 50+（情報源多様化） ⚠️高リスク・後回し
- Phase 43-49完了後に再評価・外部API依存・高コスト

**📊 現在の基準**:
- 55特徴量システム稼働中（Phase 41.8.5完了済み）
- 統合TP/SL + トレーリングストップ稼働中（Phase 42.1-42.2完了済み）
- ML統合率100%達成（Phase 41.8.5完了済み）
- 1,137テスト・69.90%カバレッジ達成
- 1,081テスト・69.57%カバレッジ（Phase 42.3完了時）

**詳細**: `docs/開発履歴/Phase_40.md` 参照

---

**最終更新**: 2025年10月19日 - Phase 40.5-FIX完了・Phase 43/44実施判断追加・Phase 44を保留に変更
