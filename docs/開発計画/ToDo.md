# 暗号資産取引Bot - Phase 51完走計画

## 📋 このファイルの目的

**Claude Codeに読み込ませ、続きの開発を実行するための未達成タスク管理ファイル**

**基本方針**:
- **Phase 51完走を最優先**（Phase 51.8-51.12）
- **Phase 52以降は凍結**（Phase 51完了後、実運用データに基づいて再検討）
- **バックテスト評価を各ステップに組み込み**（データドリブンな戦略選択）
- **完走後は実運用3ヶ月のデータ収集**（収益性実証）

---

## 🎯 現在の状態

**Phase 51.9-51.10完全完了**（2025/11/10-11）:

**Phase 51.9完了** ✅:
- 真の3クラス分類実装完了（2→3クラス変換ロジック完全削除）
- ML再学習完了（F1改善: LightGBM +9.7%, XGBoost +7.8%, RandomForest +4.1%）
- 特徴量数表記統一（17ファイル・55特徴量確定）

**Phase 51.10-A完了** ✅:
- TP/SL孤児注文問題完全解決（Option D実装・144行）
- Phase 51.6 Atomic Entry Pattern完全実装
- 品質チェック成功（1,245テスト・65.42%カバレッジ）

**Phase 51.10-B完了** ✅:
- バックテスト検証完了（2時間43分・12,083サイクル）
- パフォーマンス: +5.47%利益・Sharpe 6.289・勝率46.1%
- ML 3クラス分類正常動作確認
- Phase 51.8レジーム別制限正常動作（3,040件拒否）

**Phase 51.10-C完了** ✅:
- バックテスト改善完了（data_limit: 10000・progress_interval: 100・ETA計算実装）

**ペーパートレード検証完了** ✅:
- Phase 51.9+51.10統合動作確認完了
- 55特徴量・ML 3クラス予測・6戦略統合すべて正常
- ライブモード展開準備完了

**次回作業**: **Phase 51.11: 本番デプロイ** 🎯

---

## 📊 Phase 51完走ロードマップ

| Phase | ステータス | 目的 | 期間 | 詳細ドキュメント |
|-------|-----------|------|------|-----------------|
| Phase 51.1-51.5 | ✅完了 | 市場レジーム分類・動的戦略管理基盤構築 | 11/02-04 | `docs/開発履歴/Phase_51.5.md` |
| Phase 51.6 | ✅完了 | TP/SL問題完全解決・Atomic Entry Pattern実装 | 11/05 | `docs/開発履歴/Phase_51.6.md` |
| Phase 51.7 | ✅完了 | 新戦略実装（6戦略統合・55特徴量システム確立） | 11/05-08 | `docs/開発履歴/Phase_51.7.md` |
| Phase 51.8 | ✅完了 | レジーム別戦略重み最適化+保有ポジション制限 | 11/08-09 | `docs/開発履歴/Phase_51.8.md` |
| **Phase 51.9** | ✅完了 | **真の3クラス分類実装+ML再学習** | 11/10 | `docs/開発履歴/Phase_51.9-51.10.md` |
| **Phase 51.10-A** | ✅完了 | **TP/SL孤児注文問題完全解決（Option D）** | 11/10 | `docs/開発履歴/Phase_51.9-51.10.md` |
| **Phase 51.10-B** | ✅完了 | **バックテスト検証（+5.47%・Sharpe 6.289）** | 11/11 | `docs/開発履歴/Phase_51.9-51.10.md` |
| **Phase 51.10-C** | ✅完了 | **バックテスト改善（ETA計算・進捗表示）** | 11/11 | `docs/開発履歴/Phase_51.9-51.10.md` |
| **ペーパートレード検証** | ✅完了 | **Phase 51.9+51.10統合動作確認** | 11/11 | `docs/開発履歴/Phase_51.9-51.10.md` |
| **Phase 51.11** | 🎯次のステップ | **本番デプロイ + Phase 51完走宣言** | 1日 | ⬇実装タスク詳細 |

**Phase 51完走後のアクション**:
```
Phase 51.11完了 → 実運用3ヶ月（1万円→段階的拡大） → データ分析 → Phase 52判断
```

---

## 🎯 Phase 51.11: 本番デプロイ + Phase 51完走宣言（次のステップ）

### 目的

**背景**: Phase 51.9-51.10完了・バックテスト検証成功・ペーパートレード検証完了

**解決**: 本番環境へデプロイし、Phase 51完走を宣言

**期待効果**: Phase 51システム本番稼働開始・実運用データ収集開始

### 実装タスク

#### Step 1: Git Commit & ドキュメント更新（0.5日）

**実施内容**:
- [ ] Phase_51.9-51.10.md最終確認
- [ ] CLAUDE.md更新（Phase 51.9-51.10完了記載）
- [ ] Git Commit
  ```bash
  git add .
  git commit -m "Phase 51.9-51.10完了: 真の3クラス分類・TP/SL孤児注文問題完全解決・バックテスト検証・ペーパートレード検証完了"
  git push origin main
  ```

#### Step 2: GCP Cloud Run デプロイ（0.5日）

**実施内容**:
- [ ] 本番環境デプロイ
  ```bash
  # GCP認証確認
  gcloud auth list

  # デプロイ実行（GitHub Actionsが自動実行）
  git push origin main

  # デプロイ確認
  gcloud run services describe crypto-bot-service-prod --region=asia-northeast1
  ```
- [ ] デプロイ成功確認
  ```bash
  # ログ確認
  gcloud logging read "resource.type=cloud_run_revision" --limit=50

  # 稼働確認
  gcloud logging read "textPayload:\"Phase 51.9\" OR textPayload:\"Phase 51.10\"" --limit=10
  ```

#### Step 3: 本番環境監視（24時間）⭐最重要

**実施内容**:
- [ ] 初回エントリー確認（1-2時間）
  - レジーム判定ログ確認
  - 戦略選択ログ確認
  - ML 3クラス予測ログ確認
  - エントリー成功ログ確認
  - TP/SL配置ログ確認
- [ ] 24時間監視
  - エラー・警告の有無
  - 証拠金維持率監視
  - TP/SL孤児注文問題再発チェック（Option D動作確認）

**確認項目**:
```
1. システム稼働（24時間ダウンタイムゼロ）
2. エントリー判断（レジーム別戦略選択動作）
3. ML 3クラス予測（0=sell, 1=hold, 2=buy正常動作）
4. TP/SL配置（孤児注文なし・Option D正常動作）
5. 証拠金維持率（80%以上維持）
```

#### Step 4: Phase 51完走宣言（0.5日）

**実施内容**:
- [ ] CLAUDE.md更新
  - Phase 51.11完了記載
  - Phase 51完走宣言
  - 実運用3ヶ月計画記載
  - Phase 52凍結記載
- [ ] ToDo.md更新
  - Phase 51.11完了マーク
  - Phase 51完走記載
  - 実運用3ヶ月計画明記
- [ ] Git Commit & GitHub Tag
  ```bash
  git add .
  git commit -m "Phase 51完走: 真の3クラス分類・TP/SL完全解決・本番デプロイ完了"
  git tag -a Phase-51-Complete -m "Phase 51完走: レジーム別最適化・6戦略統合・ML 3クラス分類システム完成"
  git push origin main
  git push origin Phase-51-Complete
  ```

### Phase 51.11期待効果

- **Phase 51完走**: 2週間の開発完了（Phase 51.1-51.11）
- **本番稼働開始**: 1万円で実運用スタート
- **データ収集開始**: 次の3ヶ月で収益性実証

---

## 📊 Phase 51完走後のアクション（3ヶ月）

### 実運用データ収集計画

**期間**: Phase 51.11完了後 3ヶ月間

**実施内容**:
1. **毎日の記録**:
   - Discord週間レポート確認（毎週月曜9時）
   - 月次サマリー作成（手動・Excel or CSV）

2. **記録項目**:
   ```
   - 総損益（円）
   - 月次利益（円）
   - 勝率（%）
   - 取引回数
   - 最大ドローダウン（%）
   - レジーム分布（tight_range/trending発生頻度）
   - 戦略別貢献度
   ```

3. **月次評価**:
   - 1ヶ月目: データ収集のみ（調整なし）
   - 2ヶ月目: データ収集のみ（調整なし）
   - 3ヶ月目: データ収集 + 総合評価

### 3ヶ月後の評価基準

**成功判定**:
```
✅ 成功（Phase 52検討可）:
- 3ヶ月総損益 > 0円（利益確認）
- 月平均利益 ≥ 2,000円（運用コストカバー）
- 最大ドローダウン ≤ 20%（リスク管理）

⚠️ 微益（現状維持）:
- 3ヶ月総損益 > 0円だが月平均 < 2,000円
- 資金拡大は見送り・1万円継続

❌ 失敗（戦略見直し or 終了）:
- 3ヶ月総損益 < 0円（損失）
- Phase 51.7-51.9に戻って戦略調整
- または、プロジェクト終了判断
```

**Phase 52判断**:
```
成功時のみ Phase 52を検討:
1. Phase 52の内容を再評価（5分足移行は本当に必要か？）
2. データに基づいて優先度判断
3. Phase 53（オンチェーン指標）は引き続き凍結

微益・失敗時:
- Phase 52凍結継続
- Phase 51の戦略調整 or プロジェクト終了
```

---

## 🎯 開発方針・品質基準（Phase 51共通）

### KISS原則の徹底

- **Phase 51完走に集中**（Phase 52以降は凍結）
- **バックテスト評価必須**（データドリブンな戦略選択）
- **過度な複雑化を避ける**

### 品質保証プロセス

1. **バックテスト必須**: Phase 51.8-51.10で徹底評価
2. **段階的導入**: backtest → paper(7日) → live(3ヶ月)の3段階
3. **テスト100%維持**: 新機能は必ず単体・統合テスト追加
4. **カバレッジ維持**: 68%以上を維持

### 複雑化リスク管理

- **Phase 51完走でストップ**（Phase 52以降は実運用データで判断）
- **設定ファイル化の徹底**（ハードコード禁止）
- **レガシーコード即座削除**（Phase 51.5-Dの教訓）

---

## ❄️ 凍結タスク（Phase 51完了後に再検討）

### Phase 52: 5分足移行（凍結）

**凍結理由**:
- Phase 51完了後、実運用3ヶ月のデータ収集を優先
- 5分足の効果はバックテストでは不明確
- ノイズ増加・API呼び出し増加のリスク

**再検討条件**:
- Phase 51で3ヶ月成功（月2,000円以上利益）
- データ分析で5分足の必要性が明確化

### Phase 53: 特徴量拡張（凍結）

**凍結理由**:
- Phase 50.9で外部API削除した教訓（GCP環境不安定性）
- オンチェーン指標も外部API依存
- 複雑性増加 vs リターン不明

**再検討条件**:
- Phase 51で3ヶ月成功
- GCP環境での外部API安定性が実証される

---

**📅 最終更新**: 2025年11月11日 - **Phase 51.9-51.10完全完了**（真の3クラス分類・TP/SL孤児注文問題完全解決・バックテスト検証+5.47%利益・Sharpe 6.289・ペーパートレード検証完了）・**次のステップ: Phase 51.11（本番デプロイ）** 🎯
