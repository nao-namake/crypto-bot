# 暗号資産取引Bot - 開発計画

## 現在の状態

**Phase 59.3完了** → Phase 59.4実装中

※ 完了済みタスクの詳細は `docs/開発履歴/` を参照

---

## Phase 59.4: 戦略判定・ML統合改善

### 目的

Phase 59.3バックテスト分析で発見された問題を段階的に修正し、各変更の効果を検証する。

### 基準値（Phase 59.3バックテスト: 2025/07/01〜2025/12/31）

| 指標 | Phase 59.3結果 | Phase 59.4目標 |
|------|---------------|----------------|
| 総損益 | ¥+35,955 | **≥¥+40,000** |
| PF | 1.39 | **≥1.45** |
| 勝率 | 50.9% | **≥52%** |
| 取引数 | 591件 | - |

### 発見された問題

| 問題 | 内容 | 対応Phase |
|------|------|-----------|
| 2票ルールが重み無視 | 重み0の戦略が75件取引 | 59.4-A |
| Agreement逆効果 | 一致時勝率46.4% < 不一致時51.5% | 59.4-B |
| 高信頼度で負ける | 高信頼度25% < 中信頼度57.8% | 59.4-B |

---

### Phase 59.4-A: 2票ルール無効化（従来の重み付けルールに戻す）

#### 背景

| 項目 | 内容 |
|------|------|
| 問題 | 2票ルールは戦略の「重み」を無視して「票数」のみカウント |
| 影響 | 重み0のADXTrendStrengthが75件取引に参加 |
| 対応 | 2票ルール無効化 → 従来の重み付け統合に戻す |

#### 実装内容

| ファイル | 変更内容 |
|---------|---------|
| `config/core/features.yaml` | `consensus.enabled: false` |

#### 期待効果

- 重み設定が正しく機能
- レジーム別戦略選択が設計通りに動作

---

### Phase 59.4-B: ML統合ボーナス/ペナルティ無効化

#### 背景

| 指標 | 値 |
|------|-----|
| Agreement時勝率 | 46.4% |
| Disagreement時勝率 | **51.5%** |
| 結論 | bonus/penaltyが逆効果 |

#### 実装内容

| ファイル | 変更内容 |
|---------|---------|
| `config/core/thresholds.yaml` | `agreement_bonus: 1.00`（無効化） |
| `config/core/thresholds.yaml` | `disagreement_penalty: 1.00`（無効化） |

#### 期待効果

- 信頼度操作による逆効果を解消
- 戦略本来の信頼度で判断

---

### Phase 59.4-C: レジーム別重み調整

#### 背景

| 戦略 | 勝率 | 損益 | 現在重み | 提案重み |
|------|------|------|---------|---------|
| ATRBased | 54.2% | ¥+30,381 | 0.20 | **0.40** |
| BBReversal | 50.0% | ¥-1,330 | 0.35 | 0.25 |
| StochasticReversal | 42.3% | ¥+179 | 0.35 | 0.25 |
| DonchianChannel | 49.1% | ¥+6,711 | 0.10 | 0.10 |

#### 実装内容

| ファイル | 変更内容 |
|---------|---------|
| `config/core/thresholds.yaml` | tight_range重み調整 |

#### 期待効果

- ATRBased（最高勝率戦略）の影響力増加
- BBReversal（損失戦略）の影響力削減

---

### Phase 59.4-D: 個別戦略調整（必要に応じて）

A-Cの結果を見て判断。BBReversalの改善検討。

---

## 実装ステップ

- [x] Phase 59.1-59.3完了
- [ ] **Phase 59.4-A: 2票ルール無効化** ← 現在
- [ ] Phase 59.4-A: バックテスト実行・検証
- [ ] Phase 59.4-B: bonus/penalty無効化
- [ ] Phase 59.4-B: バックテスト実行・検証
- [ ] Phase 59.4-C: 重み調整
- [ ] Phase 59.4-C: バックテスト実行・検証
- [ ] Phase 59.4-D: 個別戦略調整（必要に応じて）
- [ ] GCPデプロイ

---

## 保留タスク

| タスク | 優先度 | 備考 |
|--------|--------|------|
| MLモデル改修（信頼度計算） | 中 | 59.4-B効果確認後に検討 |
| 戦略分析とバックテストの乖離調査 | 低 | 戦略帰属ルールの影響 |

---

## 関連ファイル

| ファイル | 内容 |
|---------|------|
| `docs/開発履歴/Phase_59.md` | Phase 59開発記録 |
| `config/core/features.yaml` | 機能トグル設定 |
| `config/core/thresholds.yaml` | 戦略重み・ML統合設定 |
| `docs/検証記録/analysis_history.csv` | 分析履歴 |

---

**最終更新**: 2026年1月15日 - Phase 59.4-A実装中
