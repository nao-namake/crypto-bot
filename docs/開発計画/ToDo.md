# 暗号資産取引Bot - 開発計画

## 現在の状態

**Phase 59.4-B実装完了** → バックテスト検証中

※ 完了済みタスクの詳細は `docs/開発履歴/` を参照

---

## Phase 59 ロードマップ

| Phase | 内容 | 状態 |
|-------|------|------|
| 59.1-59.3 | バックテストシステム改善・分析 | ✅完了 |
| 59.4-A | 2票ルール無効化 | ✅完了 |
| 59.4-B | 重み調整（旧59.4-Cから繰り上げ） | ✅実装完了（検証中） |
| 59.5 | ライブモード分析バグ修正 | ✅完了（先行実施） |
| 59.6 | SL指値処理変更（手数料削減） | 📋予定 |
| 59.7 | MLモデル性能向上（Stacking等） | 📋予定 |
| 59.8 | 戦略見直し | 📋予定 |

---

## Phase 59.4-A: 2票ルール無効化 ✅完了

### 結果

| 指標 | Phase 59.3 | Phase 59.4-A | 改善 |
|------|-----------|--------------|------|
| 総損益 | ¥+35,955 | ¥+44,506 | **+24%** |
| PF | 1.39 | 1.55 | **+0.16** |
| 勝率 | 50.9% | 53.8% | **+2.9%** |
| Agreement勝率 | 46.4% | 55.2% | **+8.8%** |

**成果**: Agreement/Disagreement逆転問題も解消

---

## Phase 59.4-B: 重み調整 ✅実装完了（検証中）

### 実装内容（2026-01-16）

**tight_range（取引の88%）:**

| 戦略 | 勝率 | 損益 | 変更前 | 変更後 |
|------|------|------|--------|--------|
| ATRBased | 55.7% | ¥+36,504 | 0.20 | **0.45** |
| BBReversal | 57.1% | ¥+1,310 | 0.35 | 0.25 |
| StochasticReversal | 47.9% | ¥+2,774 | 0.35 | 0.20 |
| DonchianChannel | 49.1% | ¥+3,893 | 0.10 | 0.10 |

**normal_range（取引の12%）:**

| 戦略 | 変更前 | 変更後 |
|------|--------|--------|
| ATRBased | 0.50 | **0.60** |
| StochasticReversal | 0.30 | 0.25 |
| DonchianChannel | 0.20 | 0.15 |
| BBReversal | 0.00 | 0.00 |

### 対象ファイル

| ファイル | 変更内容 |
|---------|---------|
| `config/core/thresholds.yaml` | tight_range・normal_range重み調整 |

### 検証基準

| 指標 | Phase 59.4-A | 59.4-B目標 |
|------|-------------|-----------|
| 総損益 | ¥+44,506 | ≥¥+44,506 |
| PF | 1.55 | ≥1.55 |
| 勝率 | 53.8% | ≥53.8% |

---

## Phase 59.5: ライブモード分析バグ修正 ✅完了（先行実施）

Phase 59.4の前に先行実施済み。

### 修正内容

1. 注文タイプ検出改善（maker/taker判定）
2. 4時間足データの年跨ぎ対応
3. タイムゾーン処理統一

---

## Phase 59.6: SL指値処理変更（手数料削減）📋予定

### 背景

現在SL（ストップロス）は成行注文で執行しているが、taker手数料（0.12%）が発生。
指値注文（maker: 0.02%）に変更することで手数料を大幅削減。

### 実装内容

| 項目 | 変更前 | 変更後 |
|------|-------|-------|
| SL注文方式 | 成行（taker） | 指値（maker） |
| 手数料率 | 0.12% | 0.02% |
| 削減効果 | - | **83%削減** |

### 注意点

- スリッページリスクの考慮
- 約定しない場合のフォールバック処理

---

## Phase 59.7: MLモデル性能向上 📋予定

### 背景

現在のMLモデル性能（F1スコア: 0.41-0.42）は改善の余地あり。

### 検討手法

| 手法 | 効果 | 工数 |
|------|------|------|
| **Stacking Meta-Learner導入** | F1 0.41→0.60+ | 中 |
| F1ベース重み最適化 | F1 +5-10% | 小 |
| 特徴量追加・選択 | 不明 | 中 |

### 参考（Web調査結果）

- アンサンブルモデルで81% F1スコア達成事例あり
- Stacking + Meta-Learnerが不均衡データで最高性能
- XGBoost + LightGBM組み合わせが効果的

---

## Phase 59.8: 戦略見直し 📋予定

### 検討内容

1. 低パフォーマンス戦略の改善または除外
2. 新戦略の検討
3. レジーム判定の精度向上

---

## 保留タスク

| タスク | 優先度 | 備考 |
|--------|--------|------|
| 戦略分析とバックテストの乖離調査 | 低 | 戦略帰属ルールの影響 |

---

## 関連ファイル

| ファイル | 内容 |
|---------|------|
| `docs/開発履歴/Phase_59.md` | Phase 59開発記録 |
| `config/core/features.yaml` | 機能トグル設定 |
| `config/core/thresholds.yaml` | 戦略重み・ML統合設定 |
| `docs/検証記録/analysis_history.csv` | 分析履歴 |

---

**最終更新**: 2026年1月16日 - Phase 59.4-B実装完了・バックテスト検証中
