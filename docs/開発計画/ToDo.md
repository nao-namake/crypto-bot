# 暗号資産取引Bot - 未達成タスク管理

## 📋 このファイルの目的

**Claude Codeに読み込ませ、続きの開発を実行するための未達成タスク管理ファイル**

**基本方針**:
- **Phase 51完走完了**（2025/11/02-11/12・10日間・11サブPhase）
- **実運用フェーズ開始**（2025/11/12-）
- **段階的資金拡大**（1週間1万円 → 問題なければ10万円）
- **Phase 52以降は3ヶ月凍結**（実運用データに基づいて再検討）

---

## 🎯 現在の状態

**Phase 51完走完了** 🎉（2025/11/02-11/12）:

**Phase 51.1-51.11完全完了**:
- Phase 51.1-51.5: 市場レジーム分類・動的戦略管理基盤構築
- Phase 51.6: Atomic Entry Pattern実装
- Phase 51.7: 6戦略統合・55特徴量システム確立
- Phase 51.8: レジーム別戦略重み最適化・ポジション制限
- Phase 51.9: 真の3クラス分類実装（F1改善+9.7%）
- Phase 51.10-A: TP/SL孤児注文問題完全解決（Option D実装）
- Phase 51.10-B: バックテスト検証（+5.47%・Sharpe 6.289）
- Phase 51.10-C: バックテスト改善（ETA計算・進捗表示）
- ペーパートレード: Phase 51統合動作確認完了
- Phase 51.11: 本番デプロイ・Phase 50決済・完走宣言

**実運用フェーズ**（2025/11/12開始）:
- 初期資金: 1万円（Phase 51システム単独）
- 運用期間: 1週間（問題なければ10万円に増額）
- 評価期間: 3ヶ月（2025/11/12-2026/02/12）

**バックテスト記録整理完了**（2025/11/12）:
- ✅ ファイル命名規則統一（Phase_XX.Y_YYYYMMDD形式）
- ✅ 記録フォーマット標準化（設定値・TP/SL・統計情報記載）
- ✅ バックテスト初期残高10万円化（unified.yaml・ライブモード独立）
- ✅ TP/SL設定確認（0.9%/0.7%・Phase 51.6設計・ハードコードゼロ）
- **コミット待ち**: Phase 52完了後にまとめてコミット

**現在の作業**: **Phase 52.0開発準備**（動的パラメータ調整）

**次回作業**: **Phase 52.0-52.3開発**（実運用期間中に並行実施）

---

## 📊 実運用計画（2025/11/12開始）

### 段階的資金拡大計画

**第1段階: 少額運用検証**（1週間）:
- 初期資金: **1万円**
- 期間: 2025/11/12 - 2025/11/19（約1週間）
- 目的: Phase 51システムの実運用動作確認
- 確認項目:
  - ML 3クラス予測正常動作
  - TP/SL孤児注文問題なし（Option D動作確認）
  - レジーム別戦略選択正常動作
  - システム安定性（ダウンタイムゼロ）

**第2段階: 中額運用検証**（問題なければ開始）:
- 運用資金: **10万円**
- 期間: 2025/11/19 - 2026/02/12（約3ヶ月）
- 目的: Phase 51収益性実証・3ヶ月データ収集
- 評価指標:
  - 3ヶ月総損益 > 0円
  - 月平均利益 ≥ 2,000円
  - 最大ドローダウン ≤ 20%

**評価基準**（3ヶ月後・2026/02/12）:
```
✅ 成功（Phase 54検討可）:
- 3ヶ月総損益 > 0円
- 月平均利益 ≥ 2,000円
- 最大ドローダウン ≤ 20%

⚠️ 微益（現状維持）:
- 3ヶ月総損益 > 0円だが月平均 < 2,000円
- 資金拡大は見送り・10万円継続

❌ 失敗（戦略見直し or 終了）:
- 3ヶ月総損益 < 0円
- Phase 51戦略調整 or プロジェクト終了判断
```

---

## 🚀 Phase 52-54未達成タスク（3ヶ月凍結中・実運用期間中に並行開発）

### 開発優先度

**実運用期間中の開発方針**:
- Phase 51システムを1週間1万円 → 問題なければ10万円で運用
- 待機時間を活用してPhase 52（コード整理）・Phase 53（アプリ化）を開発
- Phase 54（5分足導入）は3ヶ月後の評価結果に基づいて判断

| Phase | 優先度 | 開発タイミング | 目的 |
|-------|--------|--------------|------|
| **Phase 52** | 🔴高 | 実運用期間中 | **全体コード見直し**（3ヶ月凍結解除後） |
| **Phase 53** | 🔴高 | 実運用期間中 | **アプリ化**（外出先での確認・bot停止機能） |
| **Phase 54** | 🟡低 | 3ヶ月後判断 | **5分足導入**（Phase 51成功時のみ） |

---

## 📦 Phase 52: システム改善・最適化（実運用期間中に並行開発）

### 開発方針

**Phase 51システムを運用しながら、待機時間を活用してシステム改善を実施**

**優先順位**:
1. **Phase 52.0**: 動的パラメータ調整（収益性向上）
2. **Phase 52.1**: バックテスト自動化（開発効率化）
3. **Phase 52.2**: ドローダウン対応（リスク管理強化）
4. **Phase 52.3**: コード整理（保守性向上・Phase 54準備）

---

### Phase 52.0: 動的パラメータ調整

#### 目的

**問題**: 現在のパラメータは固定値（TP 1.0%・SL 1.5%等）
**解決**: 市場レジーム・ボラティリティに応じた動的パラメータ調整
**期待効果**: 収益性+10-20%向上・各レジームに最適化

#### 実装タスク

**Phase 52.0-A: レジーム別パラメータ設計**:
- [ ] レジーム別最適パラメータ分析（バックテスト）
  - tight_range: TP/SL幅調整（現在1.0%/1.5%）
  - normal_range: デフォルト維持
  - trending: TP拡大・SL縮小検討
  - high_volatility: SL拡大検討
- [ ] ボラティリティ別パラメータ設計
  - ATR倍率動的調整（現在2.5x/2.0x/1.5x）
- [ ] Kelly基準係数動的調整

**Phase 52.0-B: 実装・バックテスト検証**:
- [ ] `thresholds.yaml`動的パラメータ追加
- [ ] `threshold_manager.py`レジーム別パラメータ取得実装
- [ ] `executor.py`・`stop_manager.py`統合
- [ ] バックテスト検証（180日間）
- [ ] 固定パラメータとの性能比較

**Phase 52.0-C: ペーパートレード・本番展開**:
- [ ] ペーパートレード検証（1週間）
- [ ] 本番展開判断（バックテスト+5%以上改善時）

**期待効果**:
- 収益性+10-20%向上
- レジーム別最適化
- リスクリワード比改善

---

### Phase 52.1: バックテスト自動化

#### 目的

**問題**: 手動バックテスト実行・結果分析に時間がかかる
**解決**: GitHub Actions週次自動実行・結果レポート自動生成
**期待効果**: 開発効率+30%向上・パラメータ変更の影響即座確認

#### 実装タスク

**Phase 52.1-A: GitHub Actions設定**:
- [ ] `.github/workflows/weekly_backtest.yml`作成
- [ ] 週次実行設定（毎週月曜9:00 JST）
- [ ] 実行時間: 2.5時間想定（無料枠2,000分/月内）
- [ ] コスト試算: **無料枠内で完結**（月13回まで実行可能）

**Phase 52.1-B: 結果レポート自動生成**:
- [ ] バックテスト結果サマリー自動生成
  - 損益・Sharpe ratio・最大DD
  - エクイティカーブ・損益分布グラフ
  - レジーム別統計
- [ ] Discord通知実装（結果サマリー投稿）
- [ ] GitHub Artifacts保存（詳細ログ・グラフ）

**Phase 52.1-C: 比較分析機能**:
- [ ] 前週比較機能実装
- [ ] パフォーマンス推移トラッキング
- [ ] パラメータ変更影響分析

**期待効果**:
- 開発効率+30%向上
- パラメータ変更の影響即座確認
- GCPコストゼロ（GitHub Actions無料枠）
- 週次自動レポートでトレンド把握

**GCPコスト影響**: **ゼロ**（GitHub Actions無料枠2,000分/月活用）

---

### Phase 52.2: ドローダウン対応

#### 目的

**問題**: Phase 51.10-Bで最大DD -29.84%検出・大幅損失リスク
**解決**: ドローダウン制限・自動停止機能実装
**期待効果**: リスク管理強化・最大損失-20%以内制限

#### 実装タスク

**Phase 52.2-A: ドローダウン監視システム**:
- [ ] `drawdown_monitor.py`実装
  - ピーク残高トラッキング
  - 現在DD率計算（ピークからの下落率）
  - 警告閾値: -15%（Discord警告通知）
  - 停止閾値: -20%（取引停止）
- [ ] `unified.yaml`設定追加
  - `drawdown.warning_threshold: 0.15`
  - `drawdown.stop_threshold: 0.20`
  - `drawdown.resume_threshold: 0.10`（DD回復後の再開閾値）

**Phase 52.2-B: 自動停止・再開ロジック**:
- [ ] DD -20%到達時の自動停止実装
  - 新規エントリー停止
  - 既存ポジション保持（TP/SL継続）
  - Discord緊急通知
- [ ] DD回復時の再開ロジック
  - DD -10%まで回復で自動再開
  - 段階的エントリー再開（ポジション制限半分から）

**Phase 52.2-C: バックテスト検証**:
- [ ] Phase 51.10-Bデータで検証
  - -29.84%ドローダウン時の停止確認
  - 再開ロジック動作確認
- [ ] 停止期間・損失削減効果分析

**Phase 52.2-D: 本番展開**:
- [ ] ペーパートレード検証（1週間）
- [ ] 本番展開（GCP Cloud Run）

**期待効果**:
- 最大損失-20%以内制限
- 大幅ドローダウン時の自動保護
- リスク管理強化

---

### Phase 52.3: コード整理

#### 目的

**問題**: Phase 51開発で蓄積した技術的負債・コードの複雑性
**解決**: コードベース全体の見直し・リファクタリング・最適化
**期待効果**: 保守性+30-40%改善・Phase 54（5分足導入）準備

#### 実装タスク

**Phase 52.3-A: コード品質分析**:
- [ ] 全ファイルの複雑度分析（cyclomatic complexity測定）
- [ ] デッドコード検出・削除（vulture）
- [ ] 重複コード検出・統合
- [ ] 命名規則統一確認
- [ ] pylintコード品質分析

**Phase 52.3-B: アーキテクチャレビュー**:
- [ ] レイヤードアーキテクチャ整合性確認
- [ ] 依存関係の循環参照検出
- [ ] モジュール分割の妥当性評価
- [ ] 設定管理の一貫性確認

**Phase 52.3-C: パフォーマンス最適化**:
- [ ] ボトルネック特定（profiling）
- [ ] メモリ使用量削減
- [ ] API呼び出し回数削減
- [ ] 特徴量生成高速化

**Phase 52.3-D: テストカバレッジ向上**:
- [ ] カバレッジ65% → 75%目標
- [ ] エッジケーステスト追加
- [ ] 統合テスト強化
- [ ] バックテストテスト追加

**期待効果**:
- コードベース品質向上
- 保守性+30-40%改善
- Phase 54（5分足導入）の基盤整備

---

### Phase 52全体期待効果

- **収益性**: +10-20%向上（Phase 52.0動的パラメータ）
- **開発効率**: +30%向上（Phase 52.1自動バックテスト）
- **リスク管理**: 最大DD -20%制限（Phase 52.2）
- **保守性**: +30-40%改善（Phase 52.3コード整理）
- **GCPコスト**: ゼロ（GitHub Actions無料枠活用）

---

## 📱 Phase 53: アプリ化（実運用期間中に開発可）

### 目的

**問題**: 外出先でのbot稼働確認・緊急停止が困難
**解決**: モバイルアプリ・Web UIで外出先からbot管理
**期待効果**: 運用利便性大幅向上・リスク管理強化

### 実装タスク

#### Phase 53.1: 要件定義

**実施内容**:
- [ ] 必要機能リストアップ
  - bot稼働状況確認
  - 残高・証拠金維持率確認
  - ポジション一覧確認
  - bot緊急停止機能
  - ログ確認機能
- [ ] 技術スタック選定
  - バックエンド: FastAPI or Flask
  - フロントエンド: React Native or Flutter
  - 認証: JWT or OAuth2

#### Phase 53.2: API実装

**実施内容**:
- [ ] REST API実装（FastAPI）
  - GET /status（bot稼働状況）
  - GET /balance（残高・証拠金維持率）
  - GET /positions（ポジション一覧）
  - POST /stop（bot停止）
  - GET /logs（ログ取得）
- [ ] 認証・認可機能実装
- [ ] GCP Cloud Runデプロイ

#### Phase 53.3: モバイルアプリ実装

**実施内容**:
- [ ] React Native or Flutterアプリ開発
- [ ] UI/UX設計
- [ ] API連携実装
- [ ] プッシュ通知実装（緊急時）
- [ ] App Store / Google Play公開

### Phase 53期待効果

- 外出先からのbot管理可能
- リスク管理強化（緊急停止機能）
- 運用利便性大幅向上

---

## ⏱️ Phase 54: 5分足導入（3ヶ月凍結・Phase 51成功時のみ）

### 目的

**問題**: 15分足では短期的な価格変動を捉えきれない
**解決**: 5分足データで高頻度取引実現
**期待効果**: エントリー機会増加・収益性向上

### 凍結理由

- Phase 51で3ヶ月成功（月2,000円以上利益）を確認後に検討
- 5分足の効果はバックテストで検証必要
- ノイズ増加・API呼び出し増加のリスク
- Phase 52（コード整理）完了が前提

### 再検討条件

✅ **Phase 54開始条件**:
- Phase 51で3ヶ月成功（月平均利益 ≥ 2,000円）
- Phase 52完了（コード整理完了）
- バックテストで5分足の優位性実証
- GCP Cloud Runコスト増加許容範囲内

### 実装タスク（凍結中）

#### Phase 54.1: 5分足データ収集

**実施内容**:
- [ ] bitbank API 5分足取得実装
- [ ] 履歴データ収集（180日間・5分足）
- [ ] データ品質確認

#### Phase 54.2: 特徴量生成調整

**実施内容**:
- [ ] 5分足用特徴量生成調整
- [ ] ATR・ボリンジャーバンド等の期間調整
- [ ] レジーム判定ロジック調整

#### Phase 54.3: バックテスト検証

**実施内容**:
- [ ] 5分足バックテスト実行（180日間）
- [ ] 15分足との性能比較
- [ ] 5分足の優位性検証

### Phase 54期待効果（凍結中）

- エントリー機会3倍増加（15分 → 5分）
- 短期的な価格変動を捉える
- 収益性+20-30%向上（バックテスト要検証）

---

## 🎯 開発方針・品質基準

### KISS原則の徹底

- **実運用データ優先**（Phase 51成功確認後にPhase 54検討）
- **バックテスト評価必須**（Phase 54はバックテスト検証必須）
- **過度な複雑化を避ける**（Phase 52でコード整理）

### 品質保証プロセス

1. **テスト100%維持**: 新機能は必ず単体・統合テスト追加
2. **カバレッジ維持**: 65%以上維持・Phase 52で75%目標
3. **CI/CD維持**: GitHub Actions自動品質ゲート
4. **段階的導入**: backtest → paper → live（Phase 51の教訓）

### 複雑化リスク管理

- **Phase 52でコード整理**（技術的負債解消）
- **Phase 53はシンプル実装**（API + モバイルアプリ）
- **Phase 54は慎重判断**（3ヶ月成功後のみ）

---

**📅 最終更新**: 2025年11月12日 - **Phase 51完走完了** 🎉 + **バックテスト記録整理完了**（Phase_51.10-B標準化・初期残高10万円化）・**現在の作業: Phase 52.0開発準備**（動的パラメータ調整）・**Phase 52完了後に一括コミット**
