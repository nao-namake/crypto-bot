# 暗号資産取引Bot - 開発計画

## 📋 このファイルの目的

**Claude Codeに読み込ませ、Phase 54開発を実行するための計画ファイル**

---

## 🎯 現在の状態

**Phase 53完了** - GCP安定化・バグ修正完了（2025/12/15）

**最新バックテスト結果**（Phase 52.1 - 2025/12/14）:
- **PF**: 1.26
- **勝率**: 48.3%
- **取引数**: 698件
- **シャープレシオ**: 8.20
- **最大DD**: 0.33%

**ベースライン**（Phase 52.1最良値）:
- **PF**: 1.34
- **勝率**: 51.4%

**現在の課題**: PF -0.08、勝率 -3.1%の性能低下

---

## 🚀 Phase 54: ML性能検証・戦略最適化

### 目的

**ML予測と戦略の総合的な見直しによる性能回復・向上**

### 背景分析（アーカイブ調査結果）

#### ML現状
- 3クラス分類（BUY/SELL/HOLD）
- アンサンブル: LightGBM 50% + XGBoost 30% + RandomForest 20%
- 55特徴量（50基本 + 3戦略シグナル + 2時間的）
- HOLDバイアス問題: 訓練データの92.1%がHOLD → SMOTE + 閾値0.002で対応済み

#### 戦略別性能（Phase 59-60アーカイブより）

| 戦略 | PF | 傾向 | 評価 |
|------|-----|------|------|
| MACDEMACrossover | 4.62 | トレンド追従 | 高性能 |
| ADXTrendStrength | 2.72 | トレンド追従 | 高性能 |
| DonchianChannel | 1.86 | トレンド追従 | 良好 |
| ATRBased | <1.0 | リバーサル | 要改善 |
| BBReversal | <1.0 | リバーサル | 要改善 |
| StochasticReversal | <1.0 | リバーサル | 要改善 |

#### 発見された問題
1. **リバーサル戦略の構造的限界**: トレンド相場でPF < 1.0
2. **レジーム偏り**: tight_range 89%占有
3. **動的信頼度**: 0.15-0.55に統一済みだが最適化余地あり

---

### Phase 54.0: ML予測分析・検証

**目的**: BUY/SELL/HOLD予測の分布・精度を検証

**タスク**:
- [ ] バックテスト中のML予測分布を記録・分析
  - BUY/SELL/HOLD比率の確認
  - 信頼度分布の可視化
- [ ] 予測と実際の価格動向の照合
  - TP/SL到達率との相関
  - 誤分類パターンの特定
- [ ] SMOTE効果の検証
  - 訓練データバランス確認
  - クラス別精度測定

**対象ファイル**:
- `src/ml/production_ensemble.py`
- `scripts/ml/create_ml_models.py`

**成果物**: ML予測分析レポート

---

### Phase 54.1: 戦略別性能分析

**目的**: 個別戦略のSR/PF測定・弱点特定

**タスク**:
- [ ] 戦略別バックテスト実行
  - 各戦略単独でのPF/SR/勝率測定
  - レジーム別パフォーマンス分析
- [ ] 戦略相関分析
  - 戦略間のシグナル相関
  - 冗長性の特定
- [ ] 低性能戦略の原因分析
  - ATRBased/BBReversal/StochasticReversalの詳細調査
  - 改善可能性 vs 無効化判断

**対象ファイル**:
- `src/strategies/implementations/`
- `src/backtest/core/backtest_engine.py`

**成果物**: 戦略別性能レポート・改善提案

---

### Phase 54.2: 動的信頼度最適化

**目的**: 戦略の動的信頼度を最適化

**タスク**:
- [ ] 現在の動的信頼度ロジック調査
  - 各戦略の信頼度計算方法確認
  - 0.15-0.55範囲の妥当性検証
- [ ] レジーム連動型信頼度の検討
  - tight_range: リバーサル戦略の信頼度調整
  - trending: トレンド戦略の信頼度調整
- [ ] 信頼度加重方式の最適化
  - 現在の加重平均方式の評価
  - 代替方式（最大値選択、閾値フィルタ）の検討

**対象ファイル**:
- `src/strategies/implementations/*.py`
- `config/core/thresholds.yaml`

**成果物**: 最適化された動的信頼度設定

---

### Phase 54.3: 戦略組み合わせ見直し

**目的**: 戦略ポートフォリオの最適化

**タスク**:
- [ ] 現行6戦略の評価
  - 継続推奨: MACDEMACrossover, ADXTrendStrength, DonchianChannel
  - 要検討: ATRBased, BBReversal, StochasticReversal
- [ ] 戦略削減/統合の検討
  - 低性能リバーサル戦略の無効化オプション
  - 戦略数削減による単純化効果
- [ ] 新戦略追加の検討（慎重）
  - RSI OverboughtOversold
  - VWAP戦略
  - 追加は既存最適化後に限定

**成果物**: 最適戦略組み合わせ提案

---

### Phase 54.4: 統合バックテスト・検証

**目的**: Phase 54変更の総合検証

**タスク**:
- [ ] 変更適用後の180日バックテスト
- [ ] Phase 52.1ベースラインとの比較
- [ ] 本番デプロイ判断

**成功基準**:

| 指標 | 現在値 | 目標値 |
|------|--------|--------|
| PF | 1.26 | ≥1.34 |
| 勝率 | 48.3% | ≥51% |
| シャープレシオ | 8.20 | ≥9.0 |
| 最大DD | 0.33% | ≤0.5% |

---

## 📊 実装優先順位

1. **Phase 54.0** - ML予測分析（根本原因把握）
2. **Phase 54.1** - 戦略別性能分析（弱点特定）
3. **Phase 54.2** - 動的信頼度最適化（改善実装）
4. **Phase 54.3** - 戦略組み合わせ見直し（構造的改善）
5. **Phase 54.4** - 統合検証（効果確認）

---

## ⚠️ リスク・注意事項

1. **過剰最適化回避**: バックテスト期間外データでの検証必須
2. **複雑性増加回避**: 戦略追加より既存最適化優先
3. **段階的実装**: 各Phaseで検証後に次へ進む
4. **ベースライン維持**: Phase 52.1設定をフォールバックとして保持

---

## 🎯 開発方針

### 品質保証プロセス

1. **テスト100%維持**: 新機能は必ず単体・統合テスト追加
2. **カバレッジ維持**: 65%以上維持
3. **CI/CD維持**: GitHub Actions自動品質ゲート
4. **段階的導入**: backtest → paper → live

### KISS原則の徹底

- **データドリブン**: バックテスト結果に基づく判断
- **過度な複雑化を避ける**: 戦略追加より既存最適化
- **実運用データ優先**: 本番環境での効果確認

---

**📅 最終更新**: 2025年12月15日 - **Phase 54計画策定**
