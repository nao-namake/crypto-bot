# 暗号資産取引Bot - 未達成タスク管理

## 📋 このファイルの目的

**Claude Codeに読み込ませ、続きの開発を実行するための未達成タスク管理ファイル**

**基本方針**:
- **Phase 51完走完了**（2025/11/02-11/12・10日間・11サブPhase）
- **実運用フェーズ開始**（2025/11/12-）
- **段階的資金拡大**（1週間1万円 → 問題なければ10万円）
- **Phase 52以降は3ヶ月凍結**（実運用データに基づいて再検討）

---

## 🎯 現在の状態

**Phase 51完走完了** 🎉（2025/11/02-11/12）:

**Phase 51.1-51.11完全完了**:
- Phase 51.1-51.5: 市場レジーム分類・動的戦略管理基盤構築
- Phase 51.6: Atomic Entry Pattern実装
- Phase 51.7: 6戦略統合・55特徴量システム確立
- Phase 51.8: レジーム別戦略重み最適化・ポジション制限
- Phase 51.9: 真の3クラス分類実装（F1改善+9.7%）
- Phase 51.10-A: TP/SL孤児注文問題完全解決（Option D実装）
- Phase 51.10-B: バックテスト検証（+5.47%・Sharpe 6.289）
- Phase 51.10-C: バックテスト改善（ETA計算・進捗表示）
- ペーパートレード: Phase 51統合動作確認完了
- Phase 51.11: 本番デプロイ・Phase 50決済・完走宣言

**実運用フェーズ**（2025/11/12開始）:
- 初期資金: 1万円（Phase 51システム単独）
- 運用期間: 1週間（問題なければ10万円に増額）
- 評価期間: 3ヶ月（2025/11/12-2026/02/12）

**Phase 52完了**（2025/11/12-11/18）:
- ✅ Phase 52.0: レジームベース動的TP/SL実装
- ✅ Phase 52.1: 週次バックテスト自動化
- ✅ Phase 52.2: 本番シミュレーション対応
- ✅ Phase 52.3: コード品質改善（flake8エラー完全解消）
- ✅ Phase 52.4: 設定ファイル・ルートファイル更新完了

**現在の状態**: **Phase 52.4完了** ✅（2025/11/18）

**次回作業**: **Phase 52.5以降**（本番展開準備・Phase 52完了宣言）

---

## 📊 実運用計画（2025/11/12開始）

### 段階的資金拡大計画

**第1段階: 少額運用検証**（1週間）:
- 初期資金: **1万円**
- 期間: 2025/11/12 - 2025/11/19（約1週間）
- 目的: Phase 51システムの実運用動作確認
- 確認項目:
  - ML 3クラス予測正常動作
  - TP/SL孤児注文問題なし（Option D動作確認）
  - レジーム別戦略選択正常動作
  - システム安定性（ダウンタイムゼロ）

**第2段階: 中額運用検証**（問題なければ開始）:
- 運用資金: **10万円**
- 期間: 2025/11/19 - 2026/02/12（約3ヶ月）
- 目的: Phase 51収益性実証・3ヶ月データ収集
- 評価指標:
  - 3ヶ月総損益 > 0円
  - 月平均利益 ≥ 2,000円
  - 最大ドローダウン ≤ 20%

**評価基準**（3ヶ月後・2026/02/12）:
```
✅ 成功（Phase 54検討可）:
- 3ヶ月総損益 > 0円
- 月平均利益 ≥ 2,000円
- 最大ドローダウン ≤ 20%

⚠️ 微益（現状維持）:
- 3ヶ月総損益 > 0円だが月平均 < 2,000円
- 資金拡大は見送り・10万円継続

❌ 失敗（戦略見直し or 終了）:
- 3ヶ月総損益 < 0円
- Phase 51戦略調整 or プロジェクト終了判断
```

---

## 🚀 Phase 52-54未達成タスク（3ヶ月凍結中・実運用期間中に並行開発）

### 開発優先度

**実運用期間中の開発方針**:
- Phase 51システムを1週間1万円 → 問題なければ10万円で運用
- 待機時間を活用してPhase 52（コード整理）・Phase 53（アプリ化）を開発
- Phase 54（5分足導入）は3ヶ月後の評価結果に基づいて判断

| Phase | 優先度 | 開発タイミング | 目的 |
|-------|--------|--------------|------|
| **Phase 52** | ✅完了 | 2025/11/12-11/18 | **システム改善・コード整理**（Phase 52.0-52.4完了） |
| **Phase 53** | 🔴高 | 実運用期間中 | **アプリ化**（外出先での確認・bot停止機能） |
| **Phase 54** | 🟡低 | 3ヶ月後判断 | **5分足導入**（Phase 51成功時のみ） |

---

## 📦 Phase 52: システム改善・最適化（完了 ✅ 2025/11/18）

### 完了サマリー

**実施期間**: 2025/11/12 - 2025/11/18（7日間）

**完了内容**:
1. ✅ **Phase 52.0**: レジーム別動的TP/SL実装（tight_range/normal_range/trending）
2. ✅ **Phase 52.1**: 週次バックテスト自動化（GitHub Actions・Markdownレポート生成）
3. ✅ **Phase 52.2**: 本番シミュレーションモード（DrawdownManager統合）
4. ✅ **Phase 52.3**: コード品質改善（flake8エラー52件→0件完全解消）
5. ✅ **Phase 52.4-A**: CI/CD系統整理（.github/workflows/）
6. ✅ **Phase 52.4-B**: プロジェクト全体整理（src/・config/・docs/・scripts/・models/・logs/）
7. ✅ **Phase 52.4-C**: ルートファイル更新（pyproject.toml・requirements.txt・Dockerfile・main.py）

**主要成果**:
- レジーム別TP/SL実装完了（市場状況適応型）
- GitHub Actions週次自動バックテスト稼働
- flake8エラーゼロ達成（コード品質企業級）
- システムバージョン52.4.0統一
- Phase参照統一67%削減達成
- プロジェクト全体整理完了（7フォルダ）
- 技術的負債ゼロ化

**詳細記録**: `docs/開発履歴/Phase_52.md`

---

## 📦 Phase 52 未実装タスク（オプション機能・将来検討）

### Phase 52.X: 追加最適化タスク（優先度低）

#### 目的

**問題**: Phase 52.0-52.3完了後の古いPhase参照・ハードコード値・重複コード蓄積
**解決**: プロジェクト全体の系統的なコード見直し・整理・最適化
**期待効果**: 保守性+20-30%向上・Phase 53（アプリ化）準備・技術的負債ゼロ化

---

#### Phase 52.4 基本方針（長期作業での指針）

**🎯 整理の5大原則**:

1. **コード整理・統廃合・分離**
   - 重複コードの統合（DRY原則徹底）
   - 責任の適切な分離（Single Responsibility Principle）
   - デッドコード・未使用import削除
   - 長大な関数の分割（100行超えは分割検討）
   - 循環参照の解消

2. **ハードコード撲滅・設定一元化**
   - 全ハードコード値を特定・設定ファイル移行
   - マジックナンバー禁止（0.7 → `get_threshold("key", 0.7)`）
   - 文字列リテラル統合（"buy"/"sell" → EntryAction enum使用）
   - 環境依存値の環境変数化
   - 設定階層の明確化（unified.yaml/thresholds.yaml/features.yaml）
   - **特徴量数一元管理**（Phase 52.4実装済み・必須ルール）:
     - `feature_order.json`が唯一の真実（Single Source of Truth）
     - Python: `get_feature_count()`で自動取得
     - GitHub Actions: `python -c "from src.core.config.feature_manager import get_feature_count; print(get_feature_count())"`
     - **ハードコード厳禁**: 55, 60, 62等の特徴量数を直接記載しない

3. **Phase参照・コメント統一**
   - Phase 52.4への統一（古いPhase参照削除）
   - 統計情報削除（テスト数・カバレッジは随時変動）
   - コメントの簡潔化（Phase番号不要な場合は削除）
   - 時代遅れの設計コメント更新

4. **命名規則・可読性向上**
   - 変数名の意図明確化（`x` → `current_price`）
   - 関数名の動詞化（`data()` → `fetch_data()`）
   - クラス名の名詞化・責任明確化
   - 型ヒント追加（Python 3.13対応）
   - docstring整備（特にpublic API）

5. **アーキテクチャ整合性確保**
   - レイヤードアーキテクチャ遵守確認
   - 依存関係の正しい方向性（上位層→下位層のみ）
   - インターフェース明確化
   - テスタビリティ向上（依存注入・モック容易性）
   - SOLID原則遵守確認

**🚫 実施しないこと**:

- 機能追加・変更（Phase 52.4は整理のみ）
- アルゴリズム最適化（Phase 52.3で実施済み）
- テストカバレッジ向上（Phase 53以降）
- パフォーマンスチューニング（必要なら別Phase）
- 大規模リファクタリング（段階的な小規模整理のみ）

**📏 品質基準**:

```
✅ flake8エラー: 0件維持
✅ blackフォーマット: 全ファイル適用
✅ isort: import順序統一
✅ pytest: 1,191テスト100%成功維持
✅ カバレッジ: 65%以上維持
✅ 実行時間: checks.sh 90秒以内
```

**🔄 作業フロー**（各ファイル・フォルダごと）:

```
1. Read: ファイル内容完全把握
2. Analyze: 問題点特定
   - Phase参照の古さ
   - ハードコード箇所
   - 重複コード
   - デッドコード
   - 命名問題
   - アーキテクチャ違反
3. Plan: 修正計画立案（ユーザー確認）
4. Execute: 修正実施
5. Verify: 品質チェック（checks.sh）
6. Document: ToDo.md更新
7. Next: 次のファイル・フォルダへ
```

**⚠️ 注意事項**:

- 1ファイルずつ慎重に作業（一括変更禁止）
- 各修正後に必ずchecks.sh実行
- 機能変更が疑われる場合はユーザー確認
- 不明なコードは削除せず質問
- バックアップ不要（Git履歴で管理）

---

#### 未実装タスク（オプション・将来検討）

**Phase 52.X-A: レジーム別パラメータ最適化**（優先度低）:
- [ ] レジーム別最適パラメータ分析（バックテスト）
- [ ] ボラティリティ別パラメータ設計
- [ ] Kelly基準係数動的調整

**Phase 52.X-B: Discord通知機能拡張**（優先度低）:
- [ ] バックテスト結果Discord通知実装
- [ ] 前週比較機能実装
- [ ] パフォーマンス推移トラッキング

**Phase 52.X-C: ドローダウン監視拡張**（Phase 52.2で基本実装済み）:
- [ ] 警告閾値追加（-15% Discord警告通知）
- [ ] DD回復時の段階的再開ロジック
- [ ] 停止期間・損失削減効果分析

**実装判断基準**:
- Phase 51実運用3ヶ月成功後に再検討
- バックテストで効果実証された場合のみ実装
- GCPコスト増加が許容範囲内の場合のみ

---

## 📱 Phase 53: アプリ化（実運用期間中に開発可）

### 目的

**問題**: 外出先でのbot稼働確認・緊急停止が困難
**解決**: モバイルアプリ・Web UIで外出先からbot管理
**期待効果**: 運用利便性大幅向上・リスク管理強化

### 実装タスク

#### Phase 53.1: 要件定義

**実施内容**:
- [ ] 必要機能リストアップ
  - bot稼働状況確認
  - 残高・証拠金維持率確認
  - ポジション一覧確認
  - bot緊急停止機能
  - ログ確認機能
- [ ] 技術スタック選定
  - バックエンド: FastAPI or Flask
  - フロントエンド: React Native or Flutter
  - 認証: JWT or OAuth2

#### Phase 53.2: API実装

**実施内容**:
- [ ] REST API実装（FastAPI）
  - GET /status（bot稼働状況）
  - GET /balance（残高・証拠金維持率）
  - GET /positions（ポジション一覧）
  - POST /stop（bot停止）
  - GET /logs（ログ取得）
- [ ] 認証・認可機能実装
- [ ] GCP Cloud Runデプロイ

#### Phase 53.3: モバイルアプリ実装

**実施内容**:
- [ ] React Native or Flutterアプリ開発
- [ ] UI/UX設計
- [ ] API連携実装
- [ ] プッシュ通知実装（緊急時）
- [ ] App Store / Google Play公開

### Phase 53期待効果

- 外出先からのbot管理可能
- リスク管理強化（緊急停止機能）
- 運用利便性大幅向上

---

## ⏱️ Phase 54: 5分足導入（3ヶ月凍結・Phase 51成功時のみ）

### 目的

**問題**: 15分足では短期的な価格変動を捉えきれない
**解決**: 5分足データで高頻度取引実現
**期待効果**: エントリー機会増加・収益性向上

### 凍結理由

- Phase 51で3ヶ月成功（月2,000円以上利益）を確認後に検討
- 5分足の効果はバックテストで検証必要
- ノイズ増加・API呼び出し増加のリスク
- Phase 52（コード整理）完了が前提

### 再検討条件

✅ **Phase 54開始条件**:
- Phase 51で3ヶ月成功（月平均利益 ≥ 2,000円）
- Phase 52完了（コード整理完了）
- バックテストで5分足の優位性実証
- GCP Cloud Runコスト増加許容範囲内

### 実装タスク（凍結中）

#### Phase 54.1: 5分足データ収集

**実施内容**:
- [ ] bitbank API 5分足取得実装
- [ ] 履歴データ収集（180日間・5分足）
- [ ] データ品質確認

#### Phase 54.2: 特徴量生成調整

**実施内容**:
- [ ] 5分足用特徴量生成調整
- [ ] ATR・ボリンジャーバンド等の期間調整
- [ ] レジーム判定ロジック調整

#### Phase 54.3: バックテスト検証

**実施内容**:
- [ ] 5分足バックテスト実行（180日間）
- [ ] 15分足との性能比較
- [ ] 5分足の優位性検証

### Phase 54期待効果（凍結中）

- エントリー機会3倍増加（15分 → 5分）
- 短期的な価格変動を捉える
- 収益性+20-30%向上（バックテスト要検証）

---

## 🎯 開発方針・品質基準

### KISS原則の徹底

- **実運用データ優先**（Phase 51成功確認後にPhase 54検討）
- **バックテスト評価必須**（Phase 54はバックテスト検証必須）
- **過度な複雑化を避ける**（Phase 52でコード整理）

### 品質保証プロセス

1. **テスト100%維持**: 新機能は必ず単体・統合テスト追加
2. **カバレッジ維持**: 65%以上維持・Phase 52で75%目標
3. **CI/CD維持**: GitHub Actions自動品質ゲート
4. **段階的導入**: backtest → paper → live（Phase 51の教訓）

### 複雑化リスク管理

- **Phase 52でコード整理**（技術的負債解消）
- **Phase 53はシンプル実装**（API + モバイルアプリ）
- **Phase 54は慎重判断**（3ヶ月成功後のみ）

---

---

## 📊 Phase 52完了サマリー

### 達成事項（2025/11/12-11/18）

| Phase | 実施日 | 内容 | 成果 |
|-------|--------|------|------|
| **Phase 52.0** | 11/12 | レジーム別動的TP/SL | tight_range/normal_range/trending実装 |
| **Phase 52.1** | 11/12 | 週次バックテスト自動化 | GitHub Actions・Markdownレポート |
| **Phase 52.2** | 11/12-11/13 | 本番シミュレーション | DrawdownManager統合・2モード運用 |
| **Phase 52.3** | 11/14 | コード品質改善 | flake8エラー52件→0件完全解消 |
| **Phase 52.4-A** | 11/14 | CI/CD系統整理 | .github/workflows/（5ファイル） |
| **Phase 52.4-B** | 11/15-11/18 | プロジェクト全体整理 | src/・config/・docs/・scripts/・models/・logs/（7フォルダ） |
| **Phase 52.4-C** | 11/18 | ルートファイル更新 | pyproject.toml・requirements.txt・Dockerfile・main.py |

### 品質指標

- ✅ flake8エラー: 0件維持
- ✅ テスト成功率: 100%（1,153テスト）
- ✅ カバレッジ: 68.77%（目標65%超過）
- ✅ システムバージョン: 52.4.0統一
- ✅ Phase参照統一: 67%削減達成
- ✅ 技術的負債: ゼロ

### 整理フォルダ・ファイル数

**Phase 52.4整理範囲**:
- ✅ `.github/workflows/`: CI/CDワークフロー（5ファイル）
- ✅ `src/`: ソースコード全体（7サブフォルダ・100+ファイル）
- ✅ `config/`: 設定ファイル（core/infrastructure/secrets）
- ✅ `docs/`: ドキュメント（開発履歴・開発計画・運用手順）
- ✅ `scripts/`: スクリプト（testing/backtest/management/deployment/ml/optimization/reports）
- ✅ `models/`: MLモデル（production/training/archive）
- ✅ `logs/`: ログファイル（trading/）
- ✅ ルートファイル: pyproject.toml・requirements.txt・Dockerfile・main.py・設定ファイル5件

**変更ファイル総数**: 推定100+ファイル（Phase参照統一・ハードコード削除・Docstring更新）

---

**📅 最終更新**: 2025年11月18日 - **Phase 52完了** ✅（Phase 52.0-52.4全完了・システム整合性100%達成・技術的負債ゼロ化・Phase 53準備完了）
