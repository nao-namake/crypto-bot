# 暗号資産取引Bot - 開発計画

## 📋 このファイルの目的

**Claude Codeに読み込ませ、Phase 54開発を実行するための計画ファイル**

---

## 🎯 現在の状態

**Phase 53完了** - GCP安定化・バグ修正完了（2025/12/15）

**最新バックテスト結果**（Phase 53.13 - 2025/12/15）:
- **PF**: 1.25
- **勝率**: 47.9%
- **取引数**: 697件
- **シャープレシオ**: 7.83
- **最大DD**: 0.33%

**ベースライン**（Phase 52.1最良値）:
- **PF**: 1.34
- **勝率**: 51.4%

**現在の課題**: PF -0.09、勝率 -3.5%の性能低下

---

## 🚀 Phase 54: ML性能検証・戦略最適化（慎重な段階的実装）

### 目的

**ML予測と戦略の最適化による性能回復（PF 1.25 → 1.34+）**

### 方針

**分析→判断→実装→検証のサイクルを1つずつ慎重に実行**

---

## ステージ1: 分析フェーズ（コード変更なし）

### Phase 54.0: ML予測分析 ← 現在実行中

**目的**: ML予測の分布・精度を可視化し、問題点を特定

**タスク**:
- [ ] バックテストログからBUY/SELL/HOLD比率を集計
- [ ] 予測信頼度の分布を確認（0.4-0.6に集中していないか）
- [ ] 予測と実際の結果（TP/SL到達）の相関を確認

**対象ファイル**（読み取りのみ）:
- `src/ml/production_ensemble.py`
- `scripts/ml/create_ml_models.py`
- バックテストログ

**成果物**: ML予測分析レポート（数値データ）
**検証**: レポート確認後、ユーザーと次ステップを相談

---

### Phase 54.1: 戦略別性能分析

**目的**: 各戦略の個別性能を測定し、弱点を特定

**タスク**:
- [ ] 各戦略のシグナル生成ログを分析
- [ ] 戦略別の勝率・PFを算出（可能な範囲で）
- [ ] HOLDシグナルが多い戦略を特定

**対象ファイル**（読み取りのみ）:
- `src/strategies/implementations/*.py`
- `src/strategies/base/strategy_manager.py`

**成果物**: 戦略別性能レポート
**検証**: レポート確認後、ユーザーと改善方針を相談

---

## ステージ2: 実装フェーズ（分析結果に基づく）

### Phase 54.2: 設定調整（thresholds.yaml変更のみ）

**目的**: コード変更なしで設定値を調整し、効果を検証

**候補となる調整**:
- [ ] 戦略の重み配分調整（ATRBased: 0.45 → ?）
- [ ] min_ml_confidence閾値調整（0.40 → ?）
- [ ] 低性能戦略の重みを下げる

**手順**:
1. 1つの設定変更
2. バックテスト実行
3. 結果確認（PF/勝率）
4. 改善なら次へ、悪化ならロールバック

---

### Phase 54.3: コード変更（必要な場合のみ）

**目的**: 設定調整で効果が限定的な場合のみ実施

**候補となる変更**:
- [ ] 信頼度計算ロジックの改善
- [ ] 戦略の無効化/削減
- [ ] ML統合ロジックの調整

**注意**: 各変更は1つずつ実施し、バックテストで検証

---

### Phase 54.4: 最終検証

**目的**: 全変更の総合効果を確認

**成功基準**:

| 指標 | 現在値 | 最低限 | 目標値 |
|------|--------|--------|--------|
| PF | 1.25 | ≥1.30 | ≥1.34 |
| 勝率 | 47.9% | ≥50% | ≥51% |
| シャープレシオ | 7.83 | - | ≥9.0 |
| 最大DD | 0.33% | ≤0.5% | ≤0.5% |

---

## ⚠️ リスク管理

### ロールバック基準
- PFが1.20未満に低下 → 即時ロールバック
- 勝率が45%未満に低下 → 即時ロールバック
- 取引数が500件未満に減少 → 要検討

### フォールバック
- Phase 53.13の設定をベースラインとして保持
- 問題発生時は即座にロールバック可能

---

## 📊 実装優先順位

1. **Phase 54.0** - ML予測分析（分析のみ・コード変更なし）
2. **Phase 54.1** - 戦略別性能分析（分析のみ・コード変更なし）
3. **Phase 54.2** - 設定調整（thresholds.yamlのみ・1つずつ検証）
4. **Phase 54.3** - コード変更（必要な場合のみ）
5. **Phase 54.4** - 統合検証（効果確認）

---

## 🎯 開発方針

### 品質保証プロセス

1. **テスト100%維持**: 新機能は必ず単体・統合テスト追加
2. **カバレッジ維持**: 65%以上維持
3. **CI/CD維持**: GitHub Actions自動品質ゲート
4. **段階的導入**: backtest → paper → live

### KISS原則の徹底

- **データドリブン**: バックテスト結果に基づく判断
- **過度な複雑化を避ける**: 戦略追加より既存最適化
- **1つずつ検証**: 複数変更の同時適用を避ける

---

**📅 最終更新**: 2025年12月16日 - **Phase 54計画更新（慎重な段階的実装）**
