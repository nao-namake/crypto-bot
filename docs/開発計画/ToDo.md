# 暗号資産取引Bot - 開発計画

## 現在の状態

**Phase 59完了** - Stacking検証完了・ProductionEnsemble採用（過去最高¥+54,526、PF 1.60）

※ 完了済みタスクの詳細は `docs/開発履歴/` を参照

---

## Phase 60: 安定稼働・コード整理

**目的**: スパゲティ化したコードベースの整理と稼働率改善

| Phase | 内容 | 状態 |
|-------|------|------|
| 60.1 | コードベース整理 | 📋予定 |
| 60.2 | 稼働率改善（73%→90%） | 📋予定 |
| 60.3 | Walk-Forward実装 | 📋予定 |

---

### Phase 60.1: コードベース整理

#### 背景

Phase 1-59で多くの機能を追加した結果、コードがスパゲティ状態に。
全フォルダを一つずつ確認し、整理・リファクタリングを行う。

#### 対象ディレクトリ

| ディレクトリ | 確認内容 | 状態 |
|-------------|---------|------|
| `src/core/` | 基盤システム整理 | 📋予定 |
| `src/data/` | データ層整理 | 📋予定 |
| `src/features/` | 特徴量生成整理 | 📋予定 |
| `src/strategies/` | 戦略層整理 | 📋予定 |
| `src/ml/` | ML層整理 | 📋予定 |
| `src/trading/` | 取引管理層整理 | 📋予定 |
| `src/backtest/` | バックテスト整理 | 📋予定 |
| `src/monitoring/` | 監視系整理 | 📋予定 |
| `scripts/` | スクリプト整理 | 📋予定 |
| `config/` | 設定ファイル整理 | 📋予定 |
| `tax/` | 税務システム整理 | 📋予定 |

#### 整理方針

- 未使用コード・デッドコードの削除
- 重複処理の統合
- 責務の明確化（単一責任原則）
- 命名規則の統一
- 不要なコメント・TODOの整理

---

### Phase 60.2: 稼働率改善

#### 背景

| 指標 | 現状 | 目標 |
|------|------|------|
| 稼働率 | 73.3% | 90%+ |
| ダウンタイム（48h） | 770分 | 288分以下 |

#### 調査・改善内容

| 項目 | 内容 |
|------|------|
| **原因調査** | ダウンタイムの原因特定（Cloud Runログ分析） |
| **タイムアウト対策** | API呼び出しタイムアウト最適化 |
| **リトライ強化** | 一時的エラー時のリトライ機構改善 |
| **ヘルスチェック** | Cloud Runヘルスチェック設定最適化 |

---

### Phase 60.3: Walk-Forward実装

#### 背景

現在のバックテストは単純な過去データ検証のため、過学習リスクがある。
Walk-Forward検証を実装し、バックテスト結果の信頼性を向上させる。

#### 実装内容

| 項目 | 内容 |
|------|------|
| **ローリングウィンドウ** | 学習期間→検証期間を順次移動 |
| **期間設定** | 学習60日 / 検証30日（例） |
| **評価指標** | 各期間のPF・勝率・DD推移 |
| **安定性評価** | 期間ごとの性能バラツキ確認 |

#### 期待効果

- バックテスト結果の過学習検出
- 戦略の堅牢性評価
- 本番との乖離低減

---

## Phase 61: 戦略分析・改修

**目的**: 戦略パフォーマンス分析と改善

| Phase | 内容 | 状態 |
|-------|------|------|
| 61.1 | 戦略パフォーマンス詳細分析 | 📋予定 |
| 61.2 | 低パフォーマンス戦略改修 | 📋予定 |
| 61.3 | レジーム判定閾値調整 | 📋予定 |

---

### Phase 61.1: 戦略パフォーマンス詳細分析

#### 分析対象

| 戦略 | 現状PF | 課題 |
|------|--------|------|
| BBReversal | 1.32 | normal_range無効化済み |
| StochasticDivergence | 1.25 | - |
| ATRBased | 1.16 | - |
| DonchianChannel | 0.85 | 赤字・要改善 |
| MACDEMACrossover | 1.50 | 発動機会少ない |
| ADXTrendStrength | 1.01 | 発動機会少ない |

#### 分析内容

- レジーム別・時間帯別パフォーマンス
- エントリー精度 vs 決済精度
- TP/SL到達率分析

---

### Phase 61.2: 低パフォーマンス戦略改修

#### 対象

| 戦略 | 課題 | 対策案 |
|------|------|--------|
| DonchianChannel | PF 0.85（赤字） | パラメータ調整 or 無効化 |
| トレンド型全般 | 発動0件 | ADX閾値緩和検討 |

---

### Phase 61.3: レジーム判定閾値調整

#### 発見された課題（Phase 59.4-B分析）

| 課題 | 詳細 |
|------|------|
| **trending 0件** | ADX>25条件が厳しすぎる可能性 |
| **high_volatility 0件** | ATR比1.8%条件が厳しすぎる可能性 |
| **レジーム偏り** | 取引の88%がtight_range |

#### 検討内容

- レジーム判定閾値の見直し
- トレンド型戦略の発動機会増加

---

## 保留タスク

| タスク | 優先度 | 備考 |
|--------|--------|------|
| CatBoost追加 | 低 | 4モデルアンサンブル化 |
| SL指値非約定時の成行フォールバック | 中 | 急落時リスク対策 |

---

## 関連ファイル

| ファイル | 内容 |
|---------|------|
| `docs/開発履歴/Phase_59.md` | Phase 59開発記録 |
| `docs/開発履歴/SUMMARY.md` | 全Phase総括 |
| `config/core/thresholds.yaml` | 戦略重み・レジーム設定 |

---

**最終更新**: 2026年1月18日 - Phase 60計画策定
