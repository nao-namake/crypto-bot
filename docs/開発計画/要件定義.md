# 暗号資産取引Bot 要件定義書（Phase 19完了版）

## 1. プロジェクト概要

**Phase 19完了**により、9ヶ月の開発を経て、**bitbank信用取引専用**の個人向けAI自動取引システムが完成しました。

**Phase 19達成項目**：
- ✅ **特徴量統一管理**: feature_manager.py による12特徴量一元化
- ✅ **MLOps基盤**: 週次自動再学習・バージョン管理・Git統合
- ✅ **品質保証**: 654テスト100%・59.24%カバレッジ・統一品質ゲート
- ✅ **本番稼働**: Cloud Run 24時間稼働・Discord監視・自動取引継続

本システムは**1万円の小額資金から開始し、成功時50万円に拡大する**現実的な個人トレーダー向け自動取引システムです。**GCP 1Gi・1CPU・月額2,000円以内**での運用を実現し、個人開発と企業級品質を両立しました。

---

## 2. システム要件

### 2.1 基本仕様
- **取引所**: bitbank信用取引専用（BTC/JPY特化）
- **資金管理**: 初期1万円→段階的拡大→最大50万円
- **取引頻度**: 月50-150回（質重視・高精度シグナル）
- **監視体制**: Discord 3階層通知（Critical/Warning/Info）
- **収益目標**: 月額GCPコスト（約2,000円）以上の利益確保

### 2.2 技術仕様
- **機械学習**: ProductionEnsemble（LightGBM・XGBoost・RandomForest統合）
- **特徴量**: feature_manager.py による12特徴量統一管理
- **時間軸**: マルチタイムフレーム（15分足・4時間足）統合分析
- **リスク管理**: Kelly基準・最大ドローダウン20%制限
- **品質保証**: 654テスト100%・59.24%カバレッジ

---

## 3. Phase 19システム構成

```
Phase 19完了システム構成:
├── src/features/           # 特徴量統一管理（feature_manager.py・12特徴量一元化）
├── src/ml/                 # MLOps基盤（週次自動再学習・バージョン管理）
├── src/strategies/         # 4戦略統合（もちぽよ・ATR・フィボナッチ・ML）
├── src/core/               # 基盤システム（orchestration・統合制御）
├── src/data/               # データ層（Bitbank API・マルチタイムフレーム）
├── src/trading/            # 取引実行（Kelly基準・リスク管理）
└── src/monitoring/         # 監視（Discord通知・3階層アラート）

CI/CD・品質保証:
├── scripts/testing/checks.sh      # 統一品質ゲート（654テスト・30秒実行）
├── scripts/testing/dev_check.py # システム診断・MLOps管理
└── .github/workflows/              # 自動CI/CD・週次再学習
```

---

## 4. 取引戦略

### 4.1 統合4戦略システム
1. **もちぽよアラート戦略**: EMA・MACD・ZigZag・RCI統合シグナル
2. **ATR戦略**: ボラティリティベース動的ポジションサイジング
3. **フィボナッチ戦略**: リトレースメント・エクステンション活用
4. **機械学習戦略**: feature_manager.py・ProductionEnsemble・週次自動再学習

### 4.2 統合判定システム
- **マルチタイムフレーム**: 4時間足（トレンド）・15分足（エントリー）
- **信頼度統合**: 4戦略シグナル統合・65%閾値・高品質取引
- **リスク管理**: Kelly基準・ポジションサイジング・自動損切り

---

## 5. MLOps基盤（Phase 19完了）

### 5.1 特徴量統一管理
- **feature_manager.py**: 12特徴量一元化・統一インターフェース
- **バージョン管理**: Git統合・特徴量定義追跡・整合性保証
- **品質保証**: 自動テスト・型安全性・統合チェック

### 5.2 自動再学習システム
- **週次自動実行**: GitHub Actions・Cloud Run統合
- **モデル更新**: ProductionEnsemble・性能評価・自動デプロイ
- **品質ゲート**: 性能閾値・A/Bテスト・段階的適用

---

## 6. リスク管理・監視

### 6.1 Kelly基準リスク管理
- **科学的資金管理**: Kelly Criterion式ポジション計算
- **段階的拡大**: 1万円→10万円→50万円慎重成長
- **自動制限**: 最大ドローダウン20%・連続損失5回で自動停止
- **レバレッジ制限**: bitbank仕様準拠・最大2倍・安全性重視

### 6.2 24時間監視システム
- **Discord通知**: 3階層アラート・リアルタイム状況報告
- **システム監視**: 15分間隔ヘルスチェック・パフォーマンス追跡
- **自動復旧**: エラー検知・ロールバック・段階的復旧
- **運用報告**: 日次・週次・月次レポート自動生成

---

## 7. 品質保証・CI/CD

### 7.1 統一品質ゲート
- **654テスト100%**: 全モジュール・統合・エラーケーステスト
- **59.24%カバレッジ**: 継続監視・新機能カバレッジ向上
- **30秒品質チェック**: checks.sh統一実行・開発効率化
- **CI/CD統合**: GitHub Actions・自動品質ゲート・段階デプロイ

### 7.2 運用品質管理
- **段階的デプロイ**: paper → stage-10 → stage-50 → live
- **ロールバック**: 自動・手動両対応・安全性優先
- **監視統合**: Cloud Run・ログ分析・メトリクス追跡

---

## 8. コスト最適化

### 8.1 GCP効率化（月額2,000円以内）
- **Cloud Run最適化**: 1Gi・1CPU・段階的スケーリング
- **リソース監視**: 使用率追跡・コスト最適化・自動クリーンアップ
- **効率的取引**: 高品質シグナル選別・無駄な取引排除

### 8.2 開発・運用効率化
- **自動化**: CI/CD・品質チェック・デプロイ・監視統合
- **統一管理**: feature_manager.py・設定階層化・ドキュメント整備
- **保守性**: 型安全性・テスト完備・リファクタリング対応

---

## 9. 成功指標・実績

### 9.1 Phase 19完了実績
- ✅ **特徴量統一管理**: feature_manager.py・12特徴量一元化完成
- ✅ **MLOps基盤**: 週次自動再学習・バージョン管理・Git統合
- ✅ **品質保証**: 654テスト100%・59.24%カバレッジ維持
- ✅ **本番稼働**: Cloud Run 24時間・Discord監視・安定運用

### 9.2 現実的収益目標
- **初期目標**: 月額2,000円（GCPコスト）以上利益確保
- **中期目標**: 10%→50%→100%段階的資金拡大成功
- **長期目標**: 1万円→50万円資金達成（成功時）
- **リスク管理**: 最大ドローダウン20%以内・自動停止機能

---

## 10. 将来計画

### 10.1 Phase 20: 運用監視・可観測性強化（進行中）
- **ヘルスチェック拡張**: システムパフォーマンス監視
- **ログ分析自動化**: 取引履歴分析・パターン検出
- **Discord監視統合**: 統合ダッシュボード・可視化強化
- **パフォーマンス可視化**: 取引成績・リスク指標分析

### 10.2 Phase 21: セキュリティ・型システム完成（計画中）
- **型エラー解消**: MyPy完全対応・型安全性100%
- **セキュリティ強化**: 認証・暗号化・脆弱性対策
- **長期運用体制**: 自動メンテナンス・バックアップ自動化

### 10.3 Phase 22以降: 高度機能拡張（将来計画）
- **マルチタイムフレーム拡張**: 3軸統合分析
- **機械学習高度化**: AutoML・Model Drift Detection
- **収益最大化**: Kelly基準高度化・リスクパリティ

---

## 11. 技術スタック

### 11.1 コア技術
- **言語**: Python 3.11+
- **ML Framework**: scikit-learn・LightGBM・XGBoost
- **データ処理**: pandas・numpy・タイムシリーズ最適化
- **API**: ccxt（Bitbank統合）・Discord通知

### 11.2 インフラ・CI/CD
- **実行環境**: GCP Cloud Run（1Gi・1CPU）
- **CI/CD**: GitHub Actions・自動品質ゲート
- **監視**: Cloud Monitoring・Discord統合通知
- **セキュリティ**: Secret Manager・Workload Identity

---

## 12. ドキュメント体系

### 12.1 運用ドキュメント
- **運用マニュアル**: `docs/運用手順/運用マニュアル.md`
- **ローカル検証**: `docs/運用手順/ローカル検証手順.md`
- **CI/CD設定**: `docs/CI-CD設定/`

### 12.2 開発ドキュメント
- **システム全体**: `CLAUDE.md`（Phase 19完了状態）
- **開発計画**: `docs/開発計画/ToDo.md`・`開発履歴.md`
- **各層README**: 全モジュール完備・統一フォーマット

---

**🎯 Phase 19完了成果**: 特徴量統一管理・MLOps基盤・定期再学習CI完成により、654テスト100%品質保証・59.24%カバレッジ・24時間自動監視を実現した企業級AI自動取引システムを確立

**最終更新**: 2025年9月4日 - Phase 19完了・要件定義最適化・構造化完了