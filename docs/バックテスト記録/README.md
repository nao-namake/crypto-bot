# バックテスト記録 - Backtest Records

**Phase 52.4**

**最終更新**: 2025年11月15日

## 🎯 フォルダの目的

バックテスト実行結果とパフォーマンス分析記録を管理します。各Phase実装の効果検証、戦略最適化、システム改善のエビデンスとして活用します。

## 📂 記録ファイル構成

```
docs/バックテスト記録/
├── README.md                                             # このファイル
├── Phase_51.10-B_20251111.md                            # Phase 51.10-B検証結果
└── Phase_52.2-production-simulation-final_20251112.md   # Phase 52.2本番シミュレーション
```

**注**: 特徴量数・戦略数・システム設定は`config/core/feature_order.json`・`config/core/strategies.yaml`・`config/core/thresholds.yaml`を参照

## 📋 バックテスト記録の役割

### **記録内容**
- バックテスト実行結果（損益・勝率・リスク指標）
- Phase実装効果検証（新機能・最適化の効果測定）
- レジーム別パフォーマンス分析
- システム統合動作確認
- エントリー統計・取引品質分析

### **活用方法**
- **効果検証**: Phase実装前後の性能比較
- **戦略最適化**: TP/SL設定・レジーム別制限の調整根拠
- **意思決定**: 本番展開判断のエビデンス
- **改善提案**: ドローダウン削減・勝率向上の施策検討

### **記録基準**
- **Phase完了時**: 主要Phase実装後のバックテスト結果
- **重要な変更**: TP/SL調整・戦略追加削除・ML統合変更
- **本番前検証**: ペーパートレード前の最終確認

## 📝 バックテスト実行方法

### **標準コマンド**
```bash
# バックテスト実行（ログ自動保存）
bash scripts/backtest/run_backtest.sh

# カスタム名指定
bash scripts/backtest/run_backtest.sh phase52.4

# 直接実行（手動ログ管理）
python3 main.py --mode backtest
```

### **データ確認**
```bash
# データ存在確認
wc -l src/backtest/data/historical/btc_jpy_4h.csv
wc -l src/backtest/data/historical/btc_jpy_15m.csv

# データ収集（不足時）
python src/backtest/data/historical/collect_historical_csv.py --days 180
```

### **結果確認**
```bash
# 最新バックテストログ確認
ls -lt logs/backtest/ | head -5

# レポート確認
cat logs/backtest/backtest_report_latest.json | jq .
```

## 📊 記録ファイル一覧

### **Phase 51.10-B_20251111.md**
- **実施日**: 2025年11月11日
- **目的**: Phase 51.9（真の3クラス分類）+ Phase 51.10-A（TP/SL孤児注文解決）統合検証
- **期間**: 約104日間（10,000サンプル）
- **結果**: +5.47%（¥10,000 → ¥10,547）
- **主要指標**:
  - 総エントリー数: 1,385件
  - 勝率: 46.1%
  - 最大DD: -29.84%
  - シャープレシオ: 6.289
- **検証内容**:
  - ML 3クラス分類正常動作確認
  - レジーム別ポジション制限動作確認
  - Option D（エントリー前TP/SLクリーンアップ）動作確認

### **Phase_52.2-production-simulation-final_20251112.md**
- **実施日**: 2025年11月12日
- **目的**: Phase 52.2本番シミュレーション効果検証
- **初期残高**: ¥100,000
- **結果**: +1.14%（¥100,000 → ¥101,142）
- **主要指標**:
  - 総エントリー数: 717件
  - 勝率: 49.7%
  - 最大DD: 60.73%
  - プロフィットファクター: 1.27
- **検証内容**:
  - レジーム別動的TP/SL調整効果
  - tight_range最適化効果

## ⚠️ 注意事項・制約

### **バックテスト制限**
- **過去データ依存**: 将来の市場環境変化は反映されない
- **オーバーフィッティング**: 過度な最適化は実運用で性能低下
- **スリッページ未考慮**: 実運用では約定価格に差が発生
- **ファンダメンタルズ無視**: ニュース・イベント影響は未反映

### **記録管理要件**
- **Phase番号明記**: 実装内容との対応明確化
- **設定値記録**: TP/SL・レジーム制限・ML設定等
- **統計的妥当性**: 十分なサンプル数（1,000エントリー以上推奨）
- **客観的分析**: 良好な結果だけでなく問題点も記録

### **解釈上の注意**
- **バックテストは参考情報**: 実運用性能を保証するものではない
- **リスク管理必須**: 高DD記録時は設定見直し検討
- **継続的検証**: 定期的なバックテスト実行と性能監視

## 🔗 関連ファイル・依存関係

### **バックテストシステム**
- `src/backtest/`: バックテスト実装（Phase 49完全改修）
- `scripts/backtest/run_backtest.sh`: バックテスト実行スクリプト
- `logs/backtest/`: バックテストログ・レポート

### **設定ファイル**
- `config/core/feature_order.json`: 特徴量定義（Single Source of Truth）
- `config/core/strategies.yaml`: 戦略定義（Single Source of Truth）
- `config/core/thresholds.yaml`: TP/SL設定・ML統合設定・Optuna最適化結果

### **開発履歴**
- `docs/開発履歴/`: Phase実装詳細記録
- `docs/運用手順/`: バックテスト実行手順・トラブルシューティング

### **週次レポート**
- `scripts/reports/weekly_report.py`: 週次バックテストレポート生成
- `.github/workflows/`: 週次自動バックテスト（将来実装予定）

## 📈 バックテスト指標の読み方

### **損益指標**
- **総損益**: 初期残高に対する増減額・率
- **平均損益/取引**: エントリーあたりの期待値
- **プロフィットファクター**: 総利益 ÷ 総損失（1.0以上が必須、2.0以上が優秀）

### **リスク指標**
- **最大ドローダウン**: ピークからの最大下落率（20%以内が望ましい）
- **シャープレシオ**: リスク調整後リターン（1.0以上が良好、2.0以上が優秀）
- **リスクリワード比**: 平均利益 ÷ 平均損失（1.5:1以上が望ましい）

### **取引品質**
- **勝率**: 勝ちトレード ÷ 総トレード（40-60%が一般的）
- **総エントリー数**: 統計的妥当性の指標（1,000件以上推奨）
- **レジーム別分布**: 市場環境への適応性確認

---

**最終更新**: Phase 52.4完了（2025年11月15日）

**バックテスト記録管理**: Phase実装効果検証・戦略最適化・本番展開判断のエビデンス管理により、データドリブンなシステム改善を実現 🚀
