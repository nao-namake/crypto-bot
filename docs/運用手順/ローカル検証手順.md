# ローカル検証手順

Phase 19完了システムでローカルで実行と検証ができる環境の使用方法を説明します。

## 🎯 概要

Phase 19完了時点で、以下の統一品質チェック・実行機能が自動レポート生成に対応しています：

1. **統一品質チェック** (`checks.sh`) - 654テスト・59.24%カバレッジ・統一品質ゲート・特徴量統一管理対応
2. **統合管理チェック** (`dev_check.py`) - システム検証・MLOpsモデル管理・特徴量整合性チェック
3. **バックテスト** (`main.py --mode backtest`) - 過去データでの戦略検証・Phase 19対応
4. **ペーパートレード** (`main.py --mode paper`) - リアルタイム仮想取引・feature_manager.py統合

すべての実行結果は自動的にマークダウンレポートとして保存され、Local=CI環境統一により他のAIツールとの情報共有が可能です。Phase 19の特徴量統一管理・MLOps基盤も含まれます。

---

## 1. 🔍 統一品質チェック（CI環境同一・統一品質ゲート）

### 実行方法

```bash
# 統一品質チェック（CI環境同一・推奨）
bash scripts/testing/checks.sh

# 統合管理チェック（補完）
python3 scripts/management/dev_check.py full-check

# 個別チェック（必要時のみ）
python3 scripts/management/dev_check.py validate      # 軽量品質チェック
python3 scripts/management/dev_check.py ml-models     # MLモデル作成・検証
python3 scripts/management/dev_check.py status        # システム状態確認
```

### 期待結果

```
🚀 Phase 19システム品質チェック開始 (特徴量統一管理・MLOps基盤完了)
=================================================
>>> 📂 新システムディレクトリ構造確認
✅ src/ディレクトリ確認完了
>>> 🤖 特徴量統一管理・MLOpsモデル整合性チェック
✅ feature_manager.py 12特徴量統一管理確認
✅ ProductionEnsembleモデル・バージョン管理確認
>>> 🎨 flake8: コードスタイルチェック
✅ flake8チェック完了
>>> 📥 isort: import順序チェック
✅ isortチェック完了
>>> ⚫ black: コード整形チェック
✅ blackチェック完了
>>> 🧪 pytest: 新システム全テスト実行
対象テスト: 全テストスイート
============================= test session starts ==============================
...
✅ 654 passed in 26.78s (59.24%カバレッジ達成・Phase 19対応)

🎉 Phase 19品質チェック完了！特徴量統一管理・MLOps基盤・全項目合格・統一品質ゲート通過
```

### レポート保存場所

```
logs/dev_check_reports/
├── dev_check_full-check_20250821_040907.md     # 統合チェック結果
├── dev_check_validate_20250821_040623.md       # 品質チェック結果
├── dev_check_phase-check_20250821_040525.md    # Phase実装確認結果
└── ...
```

---

## 2. 🏥 Phase 19運用チェック（特徴量統一管理・運用診断・稼働状況確認）

### 実行方法

```bash
# 包括的運用診断（推奨）
python3 scripts/management/ops_monitor.py

# 個別フェーズ実行
python3 scripts/management/ops_monitor.py --phase phase1  # インフラ・基盤確認
python3 scripts/management/ops_monitor.py --phase phase2  # アプリケーション動作確認
python3 scripts/management/ops_monitor.py --phase phase3  # 隠れた問題検出
python3 scripts/management/ops_monitor.py --phase phase4  # 総合判定・レポート

# 詳細ログ出力
python3 scripts/management/ops_monitor.py --verbose

# レポート生成無効化
python3 scripts/management/ops_monitor.py --no-report
```

### 期待結果

```
============================================================
📊 crypto-bot Phase 19システム稼働状況確認結果
============================================================
🕐 実行時刻: 2025-08-21T04:28:51.550838
🎨 システム: Phase 19 - 特徴量統一管理・MLOps基盤
🎯 総合スコア: 85.0/100
🔍 総合状態: healthy

📋 インフラ・基盤確認: 90.0/100 (healthy)
  ✅ project_structure: Project structure intact
  ✅ system_imports: All system imports successful
  ✅ ml_models_availability: ML models operational
  ✅ test_system_health: 654 tests passed successfully
  ✅ feature_management: 12特徴量統一管理正常
  ✅ mlops_integration: ProductionEnsemble・バージョン管理正常
...
```

### レポート保存場所

```
logs/ops_monitor_reports/
├── ops_monitor_comprehensive_20250821_042905.md   # 包括的診断結果
├── ops_monitor_phase1_20250821_042905.md          # Phase1結果
├── ops_monitor_phase2_20250821_042906.md          # Phase2結果
└── ...
```

---

## 3. 📊 バックテスト（過去データでの戦略検証）

### 実行方法

```bash
# 基本バックテスト実行（過去30日間）
python3 main.py --mode backtest

# 設定ファイル指定
python3 main.py --mode backtest --config config/production.yaml
```

### 期待結果

```
🚀 暗号資産取引Bot Phase 19・特徴量統一管理・MLOps基盤・企業級品質 起動 - モード: BACKTEST
📊 バックテストモード開始
📅 バックテスト期間: 2025-07-22 ~ 2025-08-21
⏳ バックテスト実行中...
📈 総取引数: 15件、勝率: 73.33%、総損益: ¥127,500
✅ バックテスト実行完了
📁 バックテストレポート保存: logs/backtest_reports/backtest_20250821_043015.md
```

### レポート保存場所

```
logs/backtest_reports/
├── backtest_20250821_043015.md          # バックテスト結果レポート
├── backtest_20250821_043015.json        # 詳細データ（JSON形式）
├── backtest_error_20250821_043020.md    # エラー時のレポート（該当時のみ）
└── ...
```

### レポート内容例

```markdown
# バックテスト実行レポート

## 📊 実行サマリー
- **実行時刻**: 2025年08月21日 04:30:15
- **バックテスト期間**: 2025-07-22 ~ 2025-08-21
- **対象シンボル**: BTC_JPY
- **実行結果**: ✅ SUCCESS

## 📈 パフォーマンス結果
- **総取引数**: 15件
- **勝率**: 73.33% (11/15)
- **総損益**: ¥127,500
- **最終資産**: ¥1,127,500
- **リターン**: 12.75%

## 📊 取引詳細
### 取引履歴（最新10件）
1. 2025-08-20 14:30:00 - BUY @ ¥10,250,000 📈 ¥15,000
2. 2025-08-20 16:45:00 - SELL @ ¥10,180,000 📉 ¥-8,500
...
```

---

## 4. 📝 ペーパートレード（リアルタイム仮想取引）

### 実行方法

```bash
# ペーパートレード開始（デフォルト）
python3 main.py --mode paper

# または明示的に指定
python3 main.py --mode paper --config config/production/production.yaml

# 停止は Ctrl+C
```

### 期待結果

```
🚀 暗号資産取引Bot Phase 19・特徴量統一管理・MLOps基盤・企業級品質 起動 - モード: PAPER
📝 ペーパートレードモード開始
🔄 取引サイクル開始 (1分間隔)
📊 シグナル生成: BUY @ ¥10,250,000 (信頼度: 0.78)
💼 仮想取引実行: BUY 0.001 BTC @ ¥10,250,000
🕐 次のサイクルまで 60秒待機...
...
📁 ペーパートレードレポート保存: logs/paper_trading_reports/paper_trading_20250821_043105.md
```

### レポート保存場所

```
logs/paper_trading_reports/
├── paper_trading_20250821_043105.md     # 10分ごとの定期レポート
├── paper_trading_20250821_043105.json   # セッション詳細データ
├── paper_trading_20250821_043205.md     # 次の定期レポート
└── ...
```

### レポート内容例

```markdown
# ペーパートレードセッションレポート

## 📊 セッションサマリー
- **セッション開始**: 2025-08-21 04:31:05
- **レポート生成**: 2025年08月21日 04:41:05
- **実行結果**: ✅ SUCCESS

## 📈 取引パフォーマンス
- **生成シグナル数**: 8件
- **実行取引数**: 3件
- **現在残高**: ¥1,015,500
- **セッション損益**: ¥15,500
- **シグナル実行率**: 37.5%

## 📊 取引詳細
### 最近の取引（最新5件）
1. 04:35:12 - BUY @ ¥10,250,000 (信頼度: 0.78)
2. 04:37:45 - HOLD @ ¥10,240,000 (信頼度: 0.45)
3. 04:39:18 - SELL @ ¥10,265,000 (信頼度: 0.82)
...
```

---

## 5. 🚀 実行時のトラブルシューティング

### よくある問題と解決方法

#### 1. インポートエラー
```bash
❌ 必要なモジュールのインポートに失敗: No module named 'src.core.config'
```

**解決方法**:
```bash
# プロジェクトルートディレクトリから実行していることを確認
cd /Users/nao/Desktop/bot
python3 main.py --mode paper
```

#### 2. MLモデル読み込みエラー
```bash
❌ ML models availability: Model files exist but loading failed（sklearn警告解消後は解決済み）
```

**解決方法**:
```bash
# MLモデル再作成
python3 scripts/management/dev_check.py ml-models
```

#### 3. テスト失敗
```bash
❌ pytest: 654 tests failed
```

**解決方法**:
```bash
# 統一品質チェック実行（CI環境同一）
bash scripts/testing/checks.sh

# 詳細なテスト結果確認
python3 -m pytest tests/unit/ -v --tb=short

# 統合管理チェック実行
python3 scripts/management/dev_check.py validate
```

#### 4. 権限エラー
```bash
❌ Permission denied: '/Users/nao/Desktop/bot/logs'
```

**解決方法**:
```bash
# ログディレクトリの権限確認・作成（Phase 19対応構造）
mkdir -p logs/reports/{ci_checks,operational,trading,analytics}
chmod 755 logs/
```

---

## 6. 🤖 他のAIツールとの情報共有

### レポートファイルの活用方法

1. **レポートファイルを開く**:
   ```bash
   # 最新のレポートを確認（Phase 19対応構造）
   cat logs/reports/INDEX.md  # ビジュアルナビゲーション
   cat logs/reports/ci_checks/latest/latest_dev_check.md
   ```

2. **内容をコピーしてAIに相談**:
   - レポートの内容をコピー
   - 他のAIツール（ChatGPT、Claude等）に貼り付け
   - 「このレポートを基に問題の解決方法を教えて」等で相談

3. **具体的な相談例**:
   ```
   以下のdev_checkレポートで問題が検出されました。
   解決方法を教えてください：
   
   [レポート内容をここに貼り付け]
   ```

### レポートに含まれる有用情報

- **実行コマンド**: 再現可能な実行手順
- **エラー詳細**: 具体的なエラーメッセージ
- **システム環境**: Phase・バージョン・設定情報
- **推奨アクション**: 次に実行すべきコマンド
- **統計情報**: テスト成功率・パフォーマンス指標

---

## 7. 📅 定期実行の推奨スケジュール

### 開発時
```bash
# コード変更後（CI環境同一）
bash scripts/testing/checks.sh

# 大きな変更後
python3 scripts/management/dev_check.py full-check

# デプロイ前（統一品質ゲート）
bash scripts/testing/checks.sh
```

### 運用時
```bash
# 毎日の健全性確認
python3 scripts/management/ops_monitor.py --phase phase1

# 週次の包括確認
python3 scripts/management/ops_monitor.py

# 月次のバックテスト
python3 main.py --mode backtest
```

---

## 8. 📊 レポート保存構造

```
logs/
├── dev_check_reports/           # CI前チェック結果
│   ├── dev_check_full-check_*.md
│   ├── dev_check_validate_*.md
│   └── dev_check_phase-check_*.md
├── ops_monitor_reports/         # CI後チェック結果
│   ├── ops_monitor_comprehensive_*.md
│   ├── ops_monitor_phase1_*.md
│   └── ...
├── backtest_reports/            # バックテスト結果
│   ├── backtest_*.md
│   ├── backtest_*.json
│   └── backtest_error_*.md
└── paper_trading_reports/       # ペーパートレード結果
    ├── paper_trading_*.md
    ├── paper_trading_*.json
    └── ...
```

すべてのレポートは **タイムスタンプ付きファイル名** で保存され、実行履歴の追跡が可能です。

---

**🎉 これでPhase 19完了システム（特徴量統一管理・MLOps基盤・企業級品質）のすべての主要機能をローカルで実行・検証し、Local=CI環境統一により結果を他のAIツールと共有できます！**