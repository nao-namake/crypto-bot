# ローカル検証手順

**最終更新**: 2025年9月8日  
**対象者**: 開発者  
**目的**: ローカル環境での開発・検証・テスト実行手順

## 🎯 概要

ローカル環境で実行できる主要な検証機能を説明します：

1. **統一品質チェック** - 654テスト・コード品質・統一品質ゲート
2. **システム診断** - 設定・モデル・整合性チェック
3. **バックテスト** - 過去データでの戦略検証
4. **ペーパートレード** - リアルタイム仮想取引

すべての実行結果は自動的にマークダウンレポートとして保存され、他のツールとの情報共有が可能です。

## 1. 🔍 統一品質チェック

### 実行方法

```bash
# メイン品質チェック（推奨・CI環境同一）
bash scripts/testing/checks.sh

# システム診断（補完）
python3 scripts/testing/dev_check.py full-check

# 個別チェック（必要時のみ）
python3 scripts/testing/dev_check.py validate      # 軽量品質チェック
python3 scripts/testing/dev_check.py ml-models     # MLモデル作成・検証
python3 scripts/testing/dev_check.py status        # システム状態確認
```

### 期待結果

```
🚀 新システム品質チェック開始
=================================================
>>> 📂 新システムディレクトリ構造確認
✅ src/ディレクトリ確認完了
>>> 🤖 MLモデル整合性チェック
✅ 本番用統合モデル存在確認
>>> 🎨 flake8: コードスタイルチェック
✅ flake8チェック完了
>>> 📥 isort: import順序チェック
✅ isortチェック完了
>>> ⚫ black: コード整形チェック
✅ blackチェック完了
>>> 🧪 pytest: 新システム全テスト実行
✅ 654 passed in 26.78s (59.24%カバレッジ達成)

🎉 品質チェック完了！全項目合格
```

### レポート保存場所

```
logs/dev_check_reports/
├── dev_check_full-check_YYYYMMDD_HHMMSS.md     # 統合チェック結果
├── dev_check_validate_YYYYMMDD_HHMMSS.md       # 品質チェック結果
└── dev_check_status_YYYYMMDD_HHMMSS.md         # システム状態確認結果
```

## 2. 📊 バックテスト

### 実行方法

```bash
# 基本バックテスト実行（過去30日間）
python3 main.py --mode backtest

# 設定ファイル指定
python3 main.py --mode backtest --config config/core/unified.yaml
```

### 期待結果

```
🚀 暗号資産取引Bot 起動 - モード: BACKTEST
📊 バックテストモード開始
📅 バックテスト期間: 2025-08-22 ~ 2025-09-08
⏳ バックテスト実行中...
📈 総取引数: 15件、勝率: 73.33%、総損益: ¥127,500
✅ バックテスト実行完了
📁 レポート保存: logs/backtest_reports/backtest_YYYYMMDD_HHMMSS.md
```

### レポート保存場所

```
logs/backtest_reports/
├── backtest_YYYYMMDD_HHMMSS.md          # バックテスト結果レポート
├── backtest_YYYYMMDD_HHMMSS.json        # 詳細データ（JSON形式）
└── backtest_error_YYYYMMDD_HHMMSS.md    # エラー時のレポート（該当時のみ）
```

### レポート内容例

```markdown
# バックテスト実行レポート

## 📊 実行サマリー
- **実行時刻**: 2025年09月08日 10:30:15
- **バックテスト期間**: 2025-08-08 ~ 2025-09-08
- **対象シンボル**: BTC_JPY
- **実行結果**: ✅ SUCCESS

## 📈 パフォーマンス結果
- **総取引数**: 15件
- **勝率**: 73.33% (11/15)
- **総損益**: ¥127,500
- **最終資産**: ¥1,127,500
- **リターン**: 12.75%

## 📊 取引詳細
### 取引履歴（最新10件）
1. 2025-09-07 14:30:00 - BUY @ ¥10,250,000 📈 ¥15,000
2. 2025-09-07 16:45:00 - SELL @ ¥10,180,000 📉 ¥-8,500
...
```

## 3. 📝 ペーパートレード

### 実行方法

```bash
# ペーパートレード開始（デフォルト）
python3 main.py --mode paper

# 設定ファイル明示的指定
python3 main.py --mode paper --config config/core/unified.yaml

# 停止は Ctrl+C
```

### 期待結果

```
🚀 暗号資産取引Bot 起動 - モード: PAPER
📝 ペーパートレードモード開始
🔄 取引サイクル開始 (1分間隔)
📊 シグナル生成: BUY @ ¥10,250,000 (信頼度: 0.78)
💼 仮想取引実行: BUY 0.001 BTC @ ¥10,250,000
🕐 次のサイクルまで 60秒待機...
...
📁 レポート保存: logs/paper_trading_reports/paper_trading_YYYYMMDD_HHMMSS.md
```

### レポート保存場所

```
logs/paper_trading_reports/
├── paper_trading_YYYYMMDD_HHMMSS.md     # 10分ごとの定期レポート
├── paper_trading_YYYYMMDD_HHMMSS.json   # セッション詳細データ
└── ...
```

## 4. 🚀 トラブルシューティング

### よくある問題と解決方法

#### 1. インポートエラー
```bash
❌ 必要なモジュールのインポートに失敗: No module named 'src.core.config'
```

**解決方法**:
```bash
# プロジェクトルートディレクトリから実行していることを確認
cd /Users/nao/Desktop/bot
python3 main.py --mode paper
```

#### 2. MLモデル読み込みエラー
```bash
❌ ML models availability: Model files exist but loading failed
```

**解決方法**:
```bash
# MLモデル再作成
python3 scripts/testing/dev_check.py ml-models
```

#### 3. テスト失敗
```bash
❌ pytest: 654 tests failed
```

**解決方法**:
```bash
# 統一品質チェック実行
bash scripts/testing/checks.sh

# 詳細なテスト結果確認
python3 -m pytest tests/unit/ -v --tb=short

# システム診断
python3 scripts/testing/dev_check.py validate
```

#### 4. 権限エラー
```bash
❌ Permission denied: '/Users/nao/Desktop/bot/logs'
```

**解決方法**:
```bash
# ログディレクトリの権限確認・作成
mkdir -p logs/reports/{ci_checks,operational,trading,analytics}
chmod 755 logs/
```

## 5. 🤖 他のAIツールとの情報共有

### レポートファイルの活用方法

1. **レポートファイルを開く**:
   ```bash
   # 最新のレポートを確認
   ls -la logs/dev_check_reports/ | tail -5
   cat logs/dev_check_reports/dev_check_full-check_latest.md
   ```

2. **内容をコピーしてAIに相談**:
   - レポートの内容をコピー
   - 他のAIツール（ChatGPT、Claude等）に貼り付け
   - 「このレポートを基に問題の解決方法を教えて」等で相談

### レポートに含まれる有用情報

- **実行コマンド**: 再現可能な実行手順
- **エラー詳細**: 具体的なエラーメッセージ
- **システム環境**: バージョン・設定情報
- **推奨アクション**: 次に実行すべきコマンド
- **統計情報**: テスト成功率・パフォーマンス指標

## 6. 📅 推奨実行スケジュール

### 開発時
```bash
# コード変更後
bash scripts/testing/checks.sh

# 大きな変更後
python3 scripts/testing/dev_check.py full-check

# デプロイ前
bash scripts/testing/checks.sh
```

### 運用時
```bash
# 日次の健全性確認
python3 scripts/testing/dev_check.py validate

# 週次の包括確認
python3 scripts/testing/dev_check.py full-check

# 月次のバックテスト
python3 main.py --mode backtest
```

## 7. 📊 レポート保存構造

```
logs/
├── dev_check_reports/           # システム診断結果
│   ├── dev_check_full-check_*.md
│   ├── dev_check_validate_*.md
│   └── dev_check_status_*.md
├── backtest_reports/            # バックテスト結果
│   ├── backtest_*.md
│   ├── backtest_*.json
│   └── backtest_error_*.md
└── paper_trading_reports/       # ペーパートレード結果
    ├── paper_trading_*.md
    ├── paper_trading_*.json
    └── ...
```

すべてのレポートは **タイムスタンプ付きファイル名** で保存され、実行履歴の追跡が可能です。

## 🔗 関連リソース

### コマンドリファレンス
- `bash scripts/testing/checks.sh` - 統一品質チェック
- `python3 scripts/testing/dev_check.py [command]` - システム診断
- `python3 main.py --mode [backtest|paper]` - システム実行

### 設定ファイル
- `config/core/unified.yaml` - 統一設定ファイル
- `config/core/thresholds.yaml` - 動的閾値設定

### 関連ドキュメント
- `docs/CI-CD設定/CI-CDデプロイメントガイド.md` - CI/CD環境構築
- `docs/運用手順/運用マニュアル.md` - 日常運用・緊急対応

---

**🎉 このガイドに従ってローカル環境での検証を実行し、結果を他のツールと共有することで効率的な開発・デバッグが可能になります。**