# Phase 60: 実効レバレッジ最適化期

**期間**: 2026年1月19日〜
**目的**: 実効レバレッジ引き上げによる収益最大化

---

## 概要

Phase 59完了時点で過去最高のパフォーマンス（PF 1.60、年利22.9%相当）を達成。
しかし実効レバレッジが0.15倍と非常に保守的であり、DD許容10%に対して余裕がありすぎる状態。
レバレッジを段階的に引き上げ、リスク・リターンの最適化を図る。

---

## 現状分析（Phase 59完了時点）

### 実績データ（1週間・ライブ運用）

| 項目 | 値 |
|------|-----|
| 証拠金 | 約33万円 |
| 平均ポジション価値 | ¥48,765 |
| **実効レバレッジ** | **0.15倍**（非常に保守的） |
| エントリー数 | 30回/週 |

### バックテスト結果（183日間）

| 指標 | 値 |
|------|-----|
| 総損益 | ¥+54,526 |
| PF | 1.60 |
| 勝率 | 53.2% |
| 最大DD | 1.49% |
| 年利換算 | 22.9% |

### 課題

- **DD 1.49%** は目標上限10%の**15%**しか使っていない
- リスク許容度に対して非常に保守的
- 年利22.9%は良好だが、リスク対比で改善余地あり

---

## Phase 60.1: 実効レバレッジ0.5倍移行

**実施日**: 2026年1月19日
**コミット**: `0fddf670`

### 目標

| 項目 | 変更前 | 変更後 | 倍率 |
|------|--------|--------|------|
| 実効レバレッジ | 0.15倍 | 0.5倍 | 3.3倍 |
| 期待DD | 1.5% | 5% | 3.3倍 |
| 期待年利 | 23% | 75% | 3.3倍 |

### 発見事項

**`unified.yaml`の`leverage: 1.0`は設定ファイルにあるだけで、コード内で参照されていない**

実際のポジションサイズは`thresholds.yaml`の複数パラメータで制御されている。

### 修正内容（14箇所）

すべて`config/core/thresholds.yaml`内：

| # | パラメータ | 変更前 | 変更後 |
|---|-----------|--------|--------|
| 1 | `production.max_order_size` | 0.05 | 0.15 |
| 2 | `kelly_criterion.max_position_ratio` | 0.35 | 1.00 |
| 3 | `initial_position_size` | 0.005 | 0.015 |
| 4 | `position_sizing.max_position_ratio` | 0.35 | 1.00 |
| 5 | `risk.max_capital_usage` | 0.5 | 1.5 |
| 6 | `max_position_ratio_per_trade.low_confidence` | 0.25 | 0.80 |
| 7 | `max_position_ratio_per_trade.medium_confidence` | 0.35 | 1.00 |
| 8 | `max_position_ratio_per_trade.high_confidence` | 0.50 | 1.50 |
| 9 | `dynamic_position_sizing.low_confidence.min_ratio` | 0.10 | 0.30 |
| 10 | `dynamic_position_sizing.low_confidence.max_ratio` | 0.20 | 0.60 |
| 11 | `dynamic_position_sizing.medium_confidence.min_ratio` | 0.15 | 0.45 |
| 12 | `dynamic_position_sizing.medium_confidence.max_ratio` | 0.25 | 0.75 |
| 13 | `dynamic_position_sizing.high_confidence.min_ratio` | 0.20 | 0.60 |
| 14 | `dynamic_position_sizing.high_confidence.max_ratio` | 0.35 | 1.05 |

### 追加対応

1. **テスト修正**: `test_capital_usage_limits`を`max_capital_usage: 1.5`に対応
2. **ドキュメント追加**: `config/core/README.md`にレバレッジ変更ガイドを追加
   - 14箇所の修正箇所一覧表
   - スケーリング計算式
   - 0.15倍/0.5倍/1.0倍の値対応表

### 期待効果（シミュレーション）

| 指標 | 0.15倍（現在） | 0.5倍（目標） |
|------|---------------|--------------|
| 期待リターン | ¥+54,526 | **¥+180,000** |
| 最大DD | 1.49% | **約5%** |
| 年利換算 | 22.9% | **約75%** |
| 1回あたり損失 | ¥200前後 | **¥660前後** |
| 1回あたり利益 | ¥300前後 | **¥1,000前後** |

### 検証基準

| 指標 | 許容範囲 | NG条件 |
|------|---------|--------|
| 最大DD | 7%以下 | 7%超過 |
| PF | 1.40以上 | 1.40未満 |
| 総損益 | ¥+120,000以上 | ¥+120,000未満 |

### バックテスト結果

**ステータス**: ⏳ 実行中（GitHub Actions）
**URL**: https://github.com/nao-namake/crypto-bot/actions/runs/21118646342

<!-- バックテスト完了後に結果を記入 -->

---

## Phase 60.2: 稼働率計算修正 ✅完了

**実施日**: 2026年1月19日

### 背景

ライブモード分析で稼働率73.8%と表示されていたが、実際はシステム正常稼働中。
原因は稼働率計算の期待値が実態と乖離していた。

### 原因分析

| 項目 | 設定値 | 実測値 |
|------|--------|--------|
| 待機時間 | 300秒（5分） | 300秒 |
| 処理時間 | - | 約120秒（2分） |
| **実際の間隔** | 5分想定 | **7分** |

`live_trading_runner.py`で処理完了**後**に5分待機するため、実際の間隔は「処理時間+待機時間」になっていた。

### 実施内容

`scripts/live/standard_analysis.py`の稼働率計算を修正：

```python
# 修正前
expected_runs = self.period_hours * 12  # 1時間に12回（5分間隔）

# 修正後
runs_per_hour = 60 / 7  # 約8.57回/時間（7分間隔）
expected_runs = int(self.period_hours * runs_per_hour)
```

### 結果

| 項目 | 修正前 | 修正後 |
|------|--------|--------|
| 期待実行回数(48h) | 576回 | 411回 |
| 実際実行回数 | 425回 | 426回 |
| **稼働率** | **73.8%** | **100.0%** |

### 補足

15分足ベースの取引では5分と7分の差は実質影響なし。
コードの修正（処理開始からの経過時間でスリープ）は見送り、計算側で対応。

---

## Phase 60.3: （予定）Walk-Forward検証

- 未使用コード削除
- ドキュメント整理
- 依存関係更新

---

## Phase 60.3: （予定）稼働率改善

- 目標: 稼働率90%以上
- Container再起動対策
- API障害対応強化

---

## Phase 60.4: （予定）Walk-Forward検証実装

- 期間分割バックテスト
- 過学習検出
- モデル安定性評価

---

## 学習事項

### レバレッジ設定の実態

1. `unified.yaml`の`leverage`設定は**未使用**
2. 実効レバレッジは複数パラメータの組み合わせで決まる
3. 変更時は14箇所を一括修正する必要がある

### レバレッジ変更時のチェックリスト

1. `thresholds.yaml`の14箇所を修正
2. `test_capital_usage_limits`テストを更新
3. バックテストで事前検証（DD 7%以下を確認）
4. 本番デプロイ後は1週間のモニタリング推奨

---

## 関連ドキュメント

- [config/core/README.md](../../config/core/README.md) - レバレッジ変更ガイド
- [Phase_59.md](Phase_59.md) - 前Phase（Stacking無効化・PE採用）
- [SUMMARY.md](SUMMARY.md) - 全Phase総括

---

**最終更新**: 2026年1月19日
