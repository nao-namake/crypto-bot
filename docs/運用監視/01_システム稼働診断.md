# ğŸš€ AIè‡ªå‹•å–å¼•ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒè¨ºæ–­ï¼ˆã‚¤ãƒ³ãƒ•ãƒ©ãƒ»åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ ç·¨ï¼‰

**Phase 52.4**

**æ³¨**: ç‰¹å¾´é‡æ•°ãƒ»æˆ¦ç•¥æ•°ãƒ»ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã¯`config/core/feature_order.json`ãƒ»`config/core/strategies.yaml`ãƒ»`config/core/thresholds.yaml`ã‚’å‚ç…§

## ğŸ“‹ ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ç›®çš„

**ä½¿ç”¨å ´é¢**:
- ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ã‚¤ãƒ³ãƒ•ãƒ©åŸºç›¤ç¨¼åƒç¢ºèª
- Cloud Runãƒ»Secret Managerãƒ»Discordé€šçŸ¥ã®å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯
- Containerå®‰å®šæ€§ãƒ»APIæ¥ç¶šå•é¡Œã®æ—©æœŸæ¤œçŸ¥
- è¨¼æ‹ é‡‘ç¶­æŒç‡80%éµå®ˆç¢ºèªï¼ˆPhase 49å®Œäº†æ©Ÿèƒ½ï¼‰
- å®šæœŸçš„ãªã‚·ã‚¹ãƒ†ãƒ åŸºç›¤è¨ºæ–­ï¼ˆæ¯æ™‚æ¨å¥¨ï¼‰

**ãƒ«ãƒ¼ãƒ«**:
- å¿…ãšæœ€åˆã«å®Ÿè¡Œï¼ˆBotæ©Ÿèƒ½è¨ºæ–­ã®å‰æï¼‰
- çµ‚äº†ã‚³ãƒ¼ãƒ‰ã§å•é¡Œã®é‡å¤§åº¦ã‚’åˆ¤æ–­
- å®Ÿè£…å±¥æ­´ã¯é–‹ç™ºå±¥æ­´ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‚ç…§
- åŸºç›¤æ­£å¸¸å¾Œã«Botæ©Ÿèƒ½è¨ºæ–­ã¸é€²ã‚€

**ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹**: Phase 52.4å®Œäº†ï¼ˆ2025/11/15ï¼‰
- 2æ®µéšGraceful Degradationï¼ˆensemble_full.pkl â†’ ensemble_basic.pkl â†’ DummyModelï¼‰
- Atomic Entry Patternå®Ÿè£…ï¼ˆEntry/TP/SLä¸€ä½“ä¿è¨¼ãƒ»Exponential Backoff retryï¼‰
- Market Regime Classificationï¼ˆå¸‚å ´çŠ¶æ³åˆ†é¡ãƒ»å‹•çš„æˆ¦ç•¥é¸æŠï¼‰
- Dynamic Strategy Managementï¼ˆRegistry+Decorator+Facadeãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
- ç¢ºå®šç”³å‘Šå¯¾å¿œã‚·ã‚¹ãƒ†ãƒ ãƒ»Discordé€±é–“ãƒ¬ãƒãƒ¼ãƒˆ

## âš ï¸ é‡è¦: ã¾ãšREADME.mdã‚’èª­ã‚“ã§ãã ã•ã„

**ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹å‰ã«ã€å¿…ãš [README.md](./README.md) ã‚’å…ˆã«èª­ã‚“ã§å…¨ä½“ã®æ§‹æˆãƒ»å®Ÿè¡Œé †åºãƒ»æ¨å¥¨ãƒ•ãƒ­ãƒ¼ã‚’ç†è§£ã—ã¦ãã ã•ã„ã€‚**

---

## ğŸ¯ è¨ºæ–­å¯¾è±¡

- ğŸš¨ **Cloud Run**: ã‚µãƒ¼ãƒ“ã‚¹ç¨¼åƒçŠ¶æ³ãƒ»ãƒªãƒ“ã‚¸ãƒ§ãƒ³ç®¡ç†
- ğŸ” **Secret Manager**: APIèªè¨¼æƒ…å ±ã®æ¨©é™ãƒ»ã‚¢ã‚¯ã‚»ã‚¹çŠ¶æ³
- ğŸ“¨ **Discordé€šçŸ¥**: Webhookæ¥ç¶šãƒ»é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ï¼ˆé€±é–“ãƒ¬ãƒãƒ¼ãƒˆå«ã‚€ï¼‰
- ğŸ”¥ **Containerå®‰å®šæ€§**: ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ãƒ»async/awaitå•é¡Œ
- ğŸ’° **APIæ¥ç¶š**: bitbank APIèªè¨¼ãƒ»ãƒ‡ãƒ¼ã‚¿å–å¾—
- âš ï¸ **ã‚¨ãƒ©ãƒ¼ç›£è¦–**: ãƒ­ã‚°åˆ†æãƒ»è­¦å‘Šæ¤œå‡º
- ğŸ›¡ï¸ **å–å¼•é˜»å®³ã‚¨ãƒ©ãƒ¼**: NoneType ã‚¨ãƒ©ãƒ¼ãƒ»APIå¿œç­”ç•°å¸¸ãƒ»å–å¼•å®Ÿè¡Œã‚¨ãƒ©ãƒ¼æ¤œå‡º
- ğŸ¯ **Atomic Entry Pattern**: Entry/TP/SLä¸€ä½“æ€§ä¿è¨¼ãƒ»ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œç¢ºèªï¼ˆPhase 51.6ï¼‰
- ğŸ“Š **Market Regime Classification**: å¸‚å ´çŠ¶æ³åˆ†é¡ãƒ»å‹•çš„æˆ¦ç•¥é¸æŠç¢ºèªï¼ˆPhase 51.1-51.4ï¼‰

## ğŸ“‚ é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- **[02_Botæ©Ÿèƒ½è¨ºæ–­.md](./02_Botæ©Ÿèƒ½è¨ºæ–­.md)** - Botå›ºæœ‰æ©Ÿèƒ½ï¼ˆç‰¹å¾´é‡ãƒ»æˆ¦ç•¥ãƒ»MLï¼‰ã®ãƒã‚§ãƒƒã‚¯
- **[03_ç·Šæ€¥å¯¾å¿œãƒãƒ‹ãƒ¥ã‚¢ãƒ«.md](./03_ç·Šæ€¥å¯¾å¿œãƒãƒ‹ãƒ¥ã‚¢ãƒ«.md)** - å•é¡Œç™ºç”Ÿæ™‚ã®ä¿®æ­£æ‰‹é †

---

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆ5åˆ†ï¼‰

### æº–å‚™: å…±é€šé–¢æ•°å®šç¾©ï¼ˆmacOSæœ€é©åŒ–ï¼‰

```bash
#!/bin/bash
# AIè‡ªå‹•å–å¼•ã‚·ã‚¹ãƒ†ãƒ åŸºç›¤è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆmacOSå¯¾å¿œç‰ˆï¼‰
echo "ğŸš€ AIè‡ªå‹•å–å¼•ã‚·ã‚¹ãƒ†ãƒ åŸºç›¤è¨ºæ–­é–‹å§‹: $(python3 -c "import datetime; print(datetime.datetime.now(datetime.timezone(datetime.timedelta(hours=9))).strftime('%Y-%m-%d %H:%M:%S JST'))")"

# æœ€æ–°CIæ™‚åˆ»å–å¾—ï¼ˆmacOSå¯¾å¿œãƒ»GNU dateã‚’ä½¿ã‚ãªã„ï¼‰
LATEST_CI_UTC=$(gh run list --limit=1 --workflow="CI/CD Pipeline" --status=success --json=createdAt --jq='.[0].createdAt' 2>/dev/null)
if [ -n "$LATEST_CI_UTC" ]; then
    LATEST_CI_JST=$(python3 -c "
import datetime
utc_time = datetime.datetime.fromisoformat('$LATEST_CI_UTC'.replace('Z', '+00:00'))
jst_time = utc_time.astimezone(datetime.timezone(datetime.timedelta(hours=9)))
print(jst_time.strftime('%Y-%m-%d %H:%M:%S JST'))
")
    echo "âœ… æœ€æ–°CIæ™‚åˆ»: $LATEST_CI_JST"
    DEPLOY_TIME="$LATEST_CI_UTC"
else
    # macOSå¯¾å¿œ: GNU date -d ã‚’ä½¿ã‚ãšPython3ã§è¨ˆç®—
    DEPLOY_TIME=$(python3 -c "
import datetime
utc_time = datetime.datetime.now(datetime.timezone.utc) - datetime.timedelta(days=1)
print(utc_time.strftime('%Y-%m-%dT%H:%M:%S.%fZ'))
")
    echo "âš ï¸ CIæ™‚åˆ»å–å¾—å¤±æ•—ã€éå»24æ™‚é–“ã®ãƒ­ã‚°ã‚’ç¢ºèª"
fi

# å…±é€šé–¢æ•°å®šç¾©ï¼ˆmacOSå¯¾å¿œãƒ»wc -l ã‚¨ãƒ©ãƒ¼å›é¿ï¼‰
show_logs_since_deploy() {
    local query="$1"
    local limit="${2:-10}"
    if [ -n "$DEPLOY_TIME" ]; then
        gcloud logging read "resource.type=\"cloud_run_revision\" AND resource.labels.service_name=\"crypto-bot-service-prod\" AND ($query) AND timestamp>=\"$DEPLOY_TIME\"" --limit="$limit" --format="value(timestamp.date(tz='Asia/Tokyo'),textPayload)"
    else
        echo "âŒ DEPLOY_TIMEæœªè¨­å®š"
    fi
}

# macOSå¯¾å¿œã‚«ã‚¦ãƒ³ãƒˆé–¢æ•°ï¼ˆgrep -c ã§ã‚«ã‚¦ãƒ³ãƒˆï¼‰
count_logs_since_deploy() {
    local query="$1"
    local limit="${2:-50}"
    if [ -n "$DEPLOY_TIME" ]; then
        gcloud logging read "resource.type=\"cloud_run_revision\" AND resource.labels.service_name=\"crypto-bot-service-prod\" AND ($query) AND timestamp>=\"$DEPLOY_TIME\"" --limit="$limit" --format="value(textPayload)" | grep -c . || echo "0"
    else
        echo "0"
    fi
}

# ã‚¹ã‚³ã‚¢åˆæœŸåŒ–
CRITICAL_ISSUES=0
WARNING_ISSUES=0
NORMAL_CHECKS=0
```

### A. è‡´å‘½çš„ã‚·ã‚¹ãƒ†ãƒ éšœå®³ãƒã‚§ãƒƒã‚¯

```bash
echo ""
echo "ğŸš¨ è‡´å‘½çš„ã‚·ã‚¹ãƒ†ãƒ éšœå®³ãƒã‚§ãƒƒã‚¯"

# 1. Secret Manageræ¨©é™ç¢ºèª
SERVICE_ACCOUNT=$(gcloud run services describe crypto-bot-service-prod --region=asia-northeast1 --format="value(spec.template.spec.serviceAccountName)" 2>/dev/null)
if [ -n "$SERVICE_ACCOUNT" ]; then
    echo "âœ… ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ: $SERVICE_ACCOUNT"

    # macOSå¯¾å¿œ: å„Secret Manageræ¨©é™ç¢ºèª
    BITBANK_KEY_ACCESS=$(gcloud secrets get-iam-policy bitbank-api-key --format="value(bindings[].members)" 2>/dev/null | grep -q "$SERVICE_ACCOUNT" && echo "OK" || echo "NG")
    BITBANK_SECRET_ACCESS=$(gcloud secrets get-iam-policy bitbank-api-secret --format="value(bindings[].members)" 2>/dev/null | grep -q "$SERVICE_ACCOUNT" && echo "OK" || echo "NG")
    DISCORD_ACCESS=$(gcloud secrets get-iam-policy discord-webhook-url --format="value(bindings[].members)" 2>/dev/null | grep -q "$SERVICE_ACCOUNT" && echo "OK" || echo "NG")

    if [ "$BITBANK_KEY_ACCESS" = "OK" ] && [ "$BITBANK_SECRET_ACCESS" = "OK" ] && [ "$DISCORD_ACCESS" = "OK" ]; then
        echo "âœ… Secret Manageræ¨©é™: æ­£å¸¸ (API Key/Secret/Discord å…¨ã¦ OK)"
        NORMAL_CHECKS=$((NORMAL_CHECKS + 1))
    else
        echo "âŒ Secret Manageræ¨©é™: æ¬ å¦‚ (API Key:$BITBANK_KEY_ACCESS / Secret:$BITBANK_SECRET_ACCESS / Discord:$DISCORD_ACCESS)"
        CRITICAL_ISSUES=$((CRITICAL_ISSUES + 2))
    fi
else
    echo "âŒ ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå–å¾—å¤±æ•—"
    CRITICAL_ISSUES=$((CRITICAL_ISSUES + 2))
fi

# 2. Containerå®‰å®šæ€§ç¢ºèª
echo ""
echo "ğŸ”¥ Containerå®‰å®šæ€§ãƒ»éåŒæœŸå‡¦ç†ç¢ºèª"
CONTAINER_EXIT_COUNT=$(count_logs_since_deploy "textPayload:\"Container called exit(1)\"" 20)
RUNTIME_WARNING_COUNT=$(count_logs_since_deploy "textPayload:\"RuntimeWarning\" AND textPayload:\"never awaited\"" 20)

echo "   Container exit(1): $CONTAINER_EXIT_COUNTå›"
echo "   RuntimeWarning: $RUNTIME_WARNING_COUNTå›"

if [ $CONTAINER_EXIT_COUNT -lt 5 ] && [ $RUNTIME_WARNING_COUNT -eq 0 ]; then
    echo "âœ… Containerå®‰å®šæ€§: æ­£å¸¸"
    NORMAL_CHECKS=$((NORMAL_CHECKS + 1))
elif [ $CONTAINER_EXIT_COUNT -lt 10 ] && [ $RUNTIME_WARNING_COUNT -lt 5 ]; then
    echo "âš ï¸ Containerè»½å¾®å•é¡Œ (è¦ç›£è¦–)"
    WARNING_ISSUES=$((WARNING_ISSUES + 1))
else
    echo "âŒ Containeræ·±åˆ»å•é¡Œ (async/awaitå•é¡Œãƒ»é »ç¹ã‚¯ãƒ©ãƒƒã‚·ãƒ¥)"
    CRITICAL_ISSUES=$((CRITICAL_ISSUES + 1))
fi

# 3. Discordç›£è¦–ç¢ºèª
echo ""
echo "ğŸ“¨ Discordç›£è¦–æ©Ÿèƒ½ç¢ºèª"
DISCORD_ERROR_COUNT=$(count_logs_since_deploy "textPayload:\"code: 50027\" OR textPayload:\"Invalid Webhook Token\"" 5)
if [ $DISCORD_ERROR_COUNT -eq 0 ]; then
    echo "âœ… Discordç›£è¦–: æ­£å¸¸ (Webhook Tokenæœ‰åŠ¹)"
    NORMAL_CHECKS=$((NORMAL_CHECKS + 1))
else
    echo "âŒ Discordç›£è¦–: åœæ­¢ (Webhook Tokenç„¡åŠ¹ãƒ»ã‚¨ãƒ©ãƒ¼ ${DISCORD_ERROR_COUNT}å›)"
    CRITICAL_ISSUES=$((CRITICAL_ISSUES + 1))
fi
```

### B. åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒãƒã‚§ãƒƒã‚¯

```bash
echo ""
echo "ğŸ”§ åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒãƒã‚§ãƒƒã‚¯"

# 1. ãƒ©ã‚¤ãƒ–ãƒ¢ãƒ¼ãƒ‰è¨­å®šç¢ºèª
MODE_VALUE=$(gcloud run services describe crypto-bot-service-prod --region=asia-northeast1 --format="yaml" 2>/dev/null | grep -A 2 "name: MODE" | grep "value:" | awk '{print $2}')
DEPLOY_STAGE_VALUE=$(gcloud run services describe crypto-bot-service-prod --region=asia-northeast1 --format="yaml" 2>/dev/null | grep -A 2 "name: DEPLOY_STAGE" | grep "value:" | awk '{print $2}')

if [ "$MODE_VALUE" = "live" ] && [ "$DEPLOY_STAGE_VALUE" = "live" ]; then
    echo "âœ… ãƒ©ã‚¤ãƒ–ãƒ¢ãƒ¼ãƒ‰: æ­£å¸¸ (MODE=live, DEPLOY_STAGE=live)"
    NORMAL_CHECKS=$((NORMAL_CHECKS + 1))
else
    echo "âš ï¸ ãƒ©ã‚¤ãƒ–ãƒ¢ãƒ¼ãƒ‰: è¨­å®šç¢ºèªè¦ (MODE=$MODE_VALUE, DEPLOY_STAGE=$DEPLOY_STAGE_VALUE)"
    WARNING_ISSUES=$((WARNING_ISSUES + 1))
fi

# 2. APIæ®‹é«˜å–å¾—ç¢ºèªï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ vs å®ŸAPIåˆ¤å®šï¼‰
echo ""
echo "ğŸ’° APIæ®‹é«˜å–å¾—ç¢ºèª"
API_BALANCE_COUNT=$(count_logs_since_deploy "textPayload:\"10,000å††\"" 15)
FALLBACK_BALANCE_COUNT=$(count_logs_since_deploy "textPayload:\"11,000å††\"" 15)

echo "   APIæ®‹é«˜(10,000å††): $API_BALANCE_COUNTå›"
echo "   ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯(11,000å††): $FALLBACK_BALANCE_COUNTå›"

if [ $API_BALANCE_COUNT -gt 0 ] && [ $FALLBACK_BALANCE_COUNT -eq 0 ]; then
    echo "âœ… APIæ®‹é«˜å–å¾—: æ­£å¸¸ (å®ŸAPIä½¿ç”¨ä¸­)"
    NORMAL_CHECKS=$((NORMAL_CHECKS + 1))
elif [ $FALLBACK_BALANCE_COUNT -gt 0 ]; then
    echo "âš ï¸ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ®‹é«˜ä½¿ç”¨ä¸­ (APIèªè¨¼å•é¡Œã®å¯èƒ½æ€§)"
    WARNING_ISSUES=$((WARNING_ISSUES + 1))
else
    echo "âŒ æ®‹é«˜å–å¾—: å¤±æ•— (APIãƒ»ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ä¸¡æ–¹ã¨ã‚‚ç¢ºèªã§ããš)"
    CRITICAL_ISSUES=$((CRITICAL_ISSUES + 1))
fi

# 3. ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒç¢ºèªï¼ˆå–å¼•ã‚µã‚¤ã‚¯ãƒ«ï¼‰
echo ""
echo "âš™ï¸ ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒç¢ºèª"
LIVE_TRADING_COUNT=$(count_logs_since_deploy "textPayload:\"livetradingãƒ¢ãƒ¼ãƒ‰\" OR textPayload:\"å–å¼•ã‚µã‚¤ã‚¯ãƒ«é–‹å§‹\"" 12)
if [ $LIVE_TRADING_COUNT -gt 0 ]; then
    echo "âœ… ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒ: æ­£å¸¸ ($LIVE_TRADING_COUNTå›ã®å–å¼•ã‚µã‚¤ã‚¯ãƒ«ç¢ºèª)"
    NORMAL_CHECKS=$((NORMAL_CHECKS + 1))
else
    echo "âš ï¸ ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒ: å–å¼•ã‚µã‚¤ã‚¯ãƒ«æœªç¢ºèª"
    WARNING_ISSUES=$((WARNING_ISSUES + 1))
fi

# 3-2. Atomic Entry Patternå‹•ä½œç¢ºèªï¼ˆPhase 51.6ï¼‰
echo ""
echo "ğŸ¯ Atomic Entry Patternå‹•ä½œç¢ºèªï¼ˆPhase 51.6ï¼‰"
ATOMIC_ENTRY_SUCCESS=$(count_logs_since_deploy "textPayload:\"Phase 51.6: Atomic Entryå®Œäº†\"" 10)
ATOMIC_ROLLBACK_COUNT=$(count_logs_since_deploy "textPayload:\"Phase 51.6: ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè¡Œ\" OR textPayload:\"Atomic Entry rollback\"" 10)
TP_PLACEMENT_RETRY=$(count_logs_since_deploy "textPayload:\"TPé…ç½®ãƒªãƒˆãƒ©ã‚¤\" OR textPayload:\"_place_tp_with_retry\"" 10)
SL_PLACEMENT_RETRY=$(count_logs_since_deploy "textPayload:\"SLé…ç½®ãƒªãƒˆãƒ©ã‚¤\" OR textPayload:\"_place_sl_with_retry\"" 10)

echo "   Atomic EntryæˆåŠŸ: $ATOMIC_ENTRY_SUCCESSå›"
echo "   ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè¡Œ: $ATOMIC_ROLLBACK_COUNTå›"
echo "   TPé…ç½®ãƒªãƒˆãƒ©ã‚¤: $TP_PLACEMENT_RETRYå›"
echo "   SLé…ç½®ãƒªãƒˆãƒ©ã‚¤: $SL_PLACEMENT_RETRYå›"

if [ $ATOMIC_ENTRY_SUCCESS -gt 0 ] && [ $ATOMIC_ROLLBACK_COUNT -eq 0 ]; then
    echo "âœ… Atomic Entry Pattern: æ­£å¸¸ç¨¼åƒï¼ˆEntry/TP/SLä¸€ä½“æ€§ä¿è¨¼ãƒ»ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ä¸è¦ï¼‰"
    NORMAL_CHECKS=$((NORMAL_CHECKS + 1))
elif [ $ATOMIC_ENTRY_SUCCESS -gt 0 ] && [ $ATOMIC_ROLLBACK_COUNT -le 2 ]; then
    echo "âš ï¸ Atomic Entry Pattern: è»½å¾®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆ${ATOMIC_ROLLBACK_COUNT}å›ãƒ»ç›£è¦–æ¨å¥¨ï¼‰"
    WARNING_ISSUES=$((WARNING_ISSUES + 1))
    NORMAL_CHECKS=$((NORMAL_CHECKS + 1))
elif [ $ATOMIC_ROLLBACK_COUNT -gt 5 ]; then
    echo "âŒ Atomic Entry Pattern: é »ç¹ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆ${ATOMIC_ROLLBACK_COUNT}å›ãƒ»TP/SLé…ç½®å•é¡Œï¼‰"
    CRITICAL_ISSUES=$((CRITICAL_ISSUES + 1))
else
    echo "â„¹ï¸ Atomic Entry Pattern: æœªç¢ºèªï¼ˆã‚¨ãƒ³ãƒˆãƒªãƒ¼æœªå®Ÿè¡Œã®å¯èƒ½æ€§ï¼‰"
fi

# 3-3. Market Regime Classificationå‹•ä½œç¢ºèªï¼ˆPhase 51.1-51.4ï¼‰
echo ""
echo "ğŸ“Š Market Regime Classificationå‹•ä½œç¢ºèªï¼ˆPhase 51.1-51.4ï¼‰"
REGIME_CLASSIFICATION=$(count_logs_since_deploy "textPayload:\"å¸‚å ´çŠ¶æ³:\" OR textPayload:\"RegimeType\"" 10)
TIGHT_RANGE_COUNT=$(count_logs_since_deploy "textPayload:\"TIGHT_RANGE\"" 10)
NORMAL_RANGE_COUNT=$(count_logs_since_deploy "textPayload:\"NORMAL_RANGE\"" 10)
TRENDING_COUNT=$(count_logs_since_deploy "textPayload:\"TRENDING\"" 10)
HIGH_VOLATILITY_COUNT=$(count_logs_since_deploy "textPayload:\"HIGH_VOLATILITY\"" 10)

echo "   å¸‚å ´çŠ¶æ³åˆ†é¡å®Ÿè¡Œ: $REGIME_CLASSIFICATIONå›"
echo "   TIGHT_RANGEæ¤œå‡º: $TIGHT_RANGE_COUNTå›"
echo "   NORMAL_RANGEæ¤œå‡º: $NORMAL_RANGE_COUNTå›"
echo "   TRENDINGæ¤œå‡º: $TRENDING_COUNTå›"
echo "   HIGH_VOLATILITYæ¤œå‡º: $HIGH_VOLATILITY_COUNTå›"

TOTAL_REGIME_DETECTED=$((TIGHT_RANGE_COUNT + NORMAL_RANGE_COUNT + TRENDING_COUNT + HIGH_VOLATILITY_COUNT))

if [ $REGIME_CLASSIFICATION -gt 0 ] && [ $TOTAL_REGIME_DETECTED -gt 0 ]; then
    echo "âœ… Market Regime Classification: æ­£å¸¸ç¨¼åƒï¼ˆ4æ®µéšå¸‚å ´çŠ¶æ³åˆ†é¡å‹•ä½œä¸­ï¼‰"
    NORMAL_CHECKS=$((NORMAL_CHECKS + 1))
elif [ $REGIME_CLASSIFICATION -gt 0 ]; then
    echo "âš ï¸ Market Regime Classification: éƒ¨åˆ†ç¨¼åƒï¼ˆåˆ†é¡æœªç¢ºå®šçŠ¶æ…‹ã®å¯èƒ½æ€§ï¼‰"
    WARNING_ISSUES=$((WARNING_ISSUES + 1))
else
    echo "â„¹ï¸ Market Regime Classification: æœªç¢ºèªï¼ˆå–å¼•ã‚µã‚¤ã‚¯ãƒ«æœªå®Ÿè¡Œã®å¯èƒ½æ€§ï¼‰"
fi

# 4. ç¾åœ¨ã®ç¨¼åƒçŠ¶æ³è©³ç´°ç¢ºèª
echo ""
echo "ğŸ”„ ç¾åœ¨ã®ç¨¼åƒçŠ¶æ³è©³ç´°ç¢ºèª"
echo "æœ€æ–°ãƒªãƒ“ã‚¸ãƒ§ãƒ³çŠ¶æ³:"
TZ='Asia/Tokyo' gcloud run revisions list --service=crypto-bot-service-prod --region=asia-northeast1 --limit=3 --format="table(metadata.name,metadata.creationTimestamp.date(tz='Asia/Tokyo'),status.conditions[0].status)"

echo ""
echo "Cloud Run ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ³:"
gcloud run services describe crypto-bot-service-prod --region=asia-northeast1 --format="table(metadata.name,status.conditions.type,status.conditions.status)" | head -3

# 5. å–å¼•é˜»å®³ã‚¨ãƒ©ãƒ¼æ¤œå‡ºï¼ˆNoneTypeãƒ»APIå¿œç­”ç•°å¸¸ï¼‰
echo ""
echo "ğŸ›¡ï¸ å–å¼•é˜»å®³ã‚¨ãƒ©ãƒ¼æ¤œå‡º"

# NoneType ã‚¨ãƒ©ãƒ¼æ¤œå‡º
NONETYPE_ERROR_COUNT=$(count_logs_since_deploy "textPayload:\"NoneType\" OR textPayload:\"float().*argument\"" 20)
echo "   NoneType ã‚¨ãƒ©ãƒ¼: $NONETYPE_ERROR_COUNTå›"

if [ $NONETYPE_ERROR_COUNT -eq 0 ]; then
    echo "âœ… NoneType ã‚¨ãƒ©ãƒ¼: ãªã—"
    NORMAL_CHECKS=$((NORMAL_CHECKS + 1))
elif [ $NONETYPE_ERROR_COUNT -lt 5 ]; then
    echo "âš ï¸ NoneType ã‚¨ãƒ©ãƒ¼: è»½å¾® ($NONETYPE_ERROR_COUNTå›ãƒ»è¦ç›£è¦–)"
    WARNING_ISSUES=$((WARNING_ISSUES + 1))
else
    echo "âŒ NoneType ã‚¨ãƒ©ãƒ¼: å¤šç™º ($NONETYPE_ERROR_COUNTå›ãƒ»å¯¾ç­–å¿…è¦)"
    CRITICAL_ISSUES=$((CRITICAL_ISSUES + 1))
fi

# APIå¿œç­”ç•°å¸¸æ¤œå‡ºï¼ˆbitbank API ã‚¨ãƒ©ãƒ¼20003ç­‰ï¼‰
API_ERROR_COUNT=$(count_logs_since_deploy "textPayload:\"bitbank API ã‚¨ãƒ©ãƒ¼\" OR textPayload:\"API.*ã‚¨ãƒ©ãƒ¼.*20\"" 20)
echo "   bitbank APIç•°å¸¸: $API_ERROR_COUNTå›"

if [ $API_ERROR_COUNT -eq 0 ]; then
    echo "âœ… APIå¿œç­”: æ­£å¸¸"
    NORMAL_CHECKS=$((NORMAL_CHECKS + 1))
elif [ $API_ERROR_COUNT -lt 5 ]; then
    echo "âš ï¸ APIå¿œç­”: è»½å¾®ã‚¨ãƒ©ãƒ¼ ($API_ERROR_COUNTå›)"
    WARNING_ISSUES=$((WARNING_ISSUES + 1))
else
    echo "âŒ APIå¿œç­”: ç•°å¸¸å¤šç™º ($API_ERROR_COUNTå›)"
    CRITICAL_ISSUES=$((CRITICAL_ISSUES + 1))
fi

# å–å¼•å®Ÿè¡Œã‚¨ãƒ©ãƒ¼æ¤œå‡ºï¼ˆæ³¨æ–‡ä½œæˆæˆåŠŸå¾Œã®ã‚¨ãƒ©ãƒ¼ï¼‰
TRADE_EXECUTION_ERROR_COUNT=$(count_logs_since_deploy "textPayload:\"å–å¼•å®Ÿè¡Œã‚¨ãƒ©ãƒ¼\" OR textPayload:\"ãƒ©ã‚¤ãƒ–å–å¼•å®Ÿè¡Œå¤±æ•—\"" 20)
echo "   å–å¼•å®Ÿè¡Œã‚¨ãƒ©ãƒ¼: $TRADE_EXECUTION_ERROR_COUNTå›"

if [ $TRADE_EXECUTION_ERROR_COUNT -eq 0 ]; then
    echo "âœ… å–å¼•å®Ÿè¡Œ: ã‚¨ãƒ©ãƒ¼ãªã—"
    NORMAL_CHECKS=$((NORMAL_CHECKS + 1))
elif [ $TRADE_EXECUTION_ERROR_COUNT -lt 3 ]; then
    echo "âš ï¸ å–å¼•å®Ÿè¡Œ: è»½å¾®ã‚¨ãƒ©ãƒ¼ ($TRADE_EXECUTION_ERROR_COUNTå›)"
    WARNING_ISSUES=$((WARNING_ISSUES + 1))
else
    echo "âŒ å–å¼•å®Ÿè¡Œ: é˜»å®³ã‚¨ãƒ©ãƒ¼å¤šç™º ($TRADE_EXECUTION_ERROR_COUNTå›ãƒ»å–å¼•ã«å½±éŸ¿ã‚ã‚Š)"
    CRITICAL_ISSUES=$((CRITICAL_ISSUES + 2))
fi
```

### C. æœ€çµ‚åˆ¤å®šï¼ˆåŸºç›¤ã‚·ã‚¹ãƒ†ãƒ ï¼‰

```bash
echo ""
echo "=============================================================="
echo "ğŸ“Š åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ è¨ºæ–­çµæœ"
echo "âœ… æ­£å¸¸é …ç›®: $NORMAL_CHECKS"
echo "âš ï¸ è­¦å‘Šé …ç›®: $WARNING_ISSUES"
echo "âŒ è‡´å‘½çš„å•é¡Œ: $CRITICAL_ISSUES"

# ç‰¹åˆ¥ãªè‡´å‘½çš„å•é¡Œãƒ•ãƒ©ã‚°ï¼ˆå³åº§å¯¾å¿œå¿…é ˆï¼‰
FATAL_ISSUES=false
FATAL_REASONS=""

if [ "$BITBANK_KEY_ACCESS" != "OK" ] || [ "$BITBANK_SECRET_ACCESS" != "OK" ] || [ "$DISCORD_ACCESS" != "OK" ]; then
    FATAL_ISSUES=true
    FATAL_REASONS="$FATAL_REASONS Secret Manageræ¨©é™æ¬ å¦‚"
fi

if [ $DISCORD_ERROR_COUNT -gt 0 ]; then
    FATAL_ISSUES=true
    FATAL_REASONS="$FATAL_REASONS Discordç›£è¦–åœæ­¢"
fi

# macOSå¯¾å¿œã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆé‡è¦åº¦é‡ã¿ä»˜ã‘ï¼‰
TOTAL_SCORE=$((NORMAL_CHECKS * 10 - WARNING_ISSUES * 3 - CRITICAL_ISSUES * 20))
echo "ğŸ† ç·åˆã‚¹ã‚³ã‚¢: $TOTAL_SCOREç‚¹"

# æœ€çµ‚åˆ¤å®š
echo ""
echo "ğŸ¯ åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ æœ€çµ‚åˆ¤å®š"

if [ "$FATAL_ISSUES" = "true" ]; then
    echo "ğŸ’€ å³åº§å¯¾å¿œå¿…é ˆ - è‡´å‘½çš„ã‚·ã‚¹ãƒ†ãƒ éšœå®³æ¤œå‡º"
    echo "   ğŸš¨ æ¤œå‡ºå•é¡Œ:$FATAL_REASONS"
    echo "   â†’ 03_ç·Šæ€¥å¯¾å¿œãƒãƒ‹ãƒ¥ã‚¢ãƒ«.md ã‚’å³åº§å®Ÿè¡Œ"
    exit 1
elif [ $CRITICAL_ISSUES -ge 3 ]; then
    echo "ğŸ”´ ç·Šæ€¥å¯¾å¿œå¿…è¦ - å¤šæ•°ã®è‡´å‘½çš„å•é¡Œ ($CRITICAL_ISSUESä»¶)"
    echo "   â†’ ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®å®‰å®šæ€§ã«æ·±åˆ»ãªå½±éŸ¿"
    echo "   â†’ 03_ç·Šæ€¥å¯¾å¿œãƒãƒ‹ãƒ¥ã‚¢ãƒ«.md å®Ÿè¡Œ"
    exit 1
elif [ $CRITICAL_ISSUES -ge 1 ]; then
    echo "ğŸŸ  è¦æ³¨æ„ - è‡´å‘½çš„å•é¡Œæ¤œå‡º ($CRITICAL_ISSUESä»¶)"
    echo "   â†’ åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ ã®ä¸€éƒ¨ã«æ·±åˆ»ãªå•é¡Œ"
    echo "   â†’ è©³ç´°è¨ºæ–­æ¨å¥¨"
    exit 2
elif [ $WARNING_ISSUES -ge 4 ]; then
    echo "ğŸŸ¡ ç›£è¦–ç¶™ç¶š - è­¦å‘Šå¤šæ•° ($WARNING_ISSUESä»¶)"
    echo "   â†’ åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ å“è³ªä½ä¸‹ãƒ»äºˆé˜²çš„å¯¾å¿œæ¨å¥¨"
    exit 3
else
    echo "ğŸŸ¢ åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸ - ã‚¤ãƒ³ãƒ•ãƒ©åŸºç›¤è‰¯å¥½ç¨¼åƒ"
    echo "   âœ¨ Cloud Runãƒ»Secret Managerãƒ»Discordãƒ»Container ã™ã¹ã¦æ­£å¸¸"
    echo "   ğŸ“Š æ­£å¸¸: $NORMAL_CHECKSä»¶, è­¦å‘Š: $WARNING_ISSUESä»¶, è‡´å‘½çš„: $CRITICAL_ISSUESä»¶"
    echo "   ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: 02_Botæ©Ÿèƒ½è¨ºæ–­.md ã§Botæ©Ÿèƒ½ãƒã‚§ãƒƒã‚¯æ¨å¥¨"
    exit 0
fi
```

---

## ğŸ” è©³ç´°è¨ºæ–­ï¼ˆåŸºç›¤ã‚·ã‚¹ãƒ†ãƒ å•é¡Œæ™‚ï¼‰

### ğŸ” Secret Managerãƒ»æ¨©é™å•é¡Œè©³ç´°è¨ºæ–­

**ã„ã¤ä½¿ç”¨**: ã‚¯ã‚¤ãƒƒã‚¯è¨ºæ–­ã§Secret Manageræ¨©é™å•é¡ŒãŒæ¤œå‡ºã•ã‚ŒãŸæ™‚

```bash
echo "=== Secret Managerãƒ»æ¨©é™å•é¡Œè©³ç´°è¨ºæ–­ï¼ˆmacOSå¯¾å¿œï¼‰ ==="

# 1. ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå­˜åœ¨ãƒ»ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
echo "1. ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå­˜åœ¨ãƒ»ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª:"
echo "   bitbank-api-key:"
gcloud secrets versions list bitbank-api-key --limit=3 --format="table(name,state,createTime.date('%Y-%m-%d %H:%M:%S'))"
echo "   bitbank-api-secret:"
gcloud secrets versions list bitbank-api-secret --limit=3 --format="table(name,state,createTime.date('%Y-%m-%d %H:%M:%S'))"
echo "   discord-webhook-url:"
gcloud secrets versions list discord-webhook-url --limit=3 --format="table(name,state,createTime.date('%Y-%m-%d %H:%M:%S'))"

# 2. è©³ç´°æ¨©é™ç¢ºèª
echo ""
echo "2. è©³ç´°IAMæ¨©é™ç¢ºèª:"
SERVICE_ACCOUNT=$(gcloud run services describe crypto-bot-service-prod --region=asia-northeast1 --format="value(spec.template.spec.serviceAccountName)")
echo "   ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ: $SERVICE_ACCOUNT"

for secret in bitbank-api-key bitbank-api-secret discord-webhook-url; do
    echo "   $secret æ¨©é™:"
    gcloud secrets get-iam-policy $secret --format="table(bindings[].role,bindings[].members[])" 2>/dev/null || echo "     âŒ æ¨©é™ç¢ºèªå¤±æ•—"
done

# 3. ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè©³ç´°æƒ…å ±
echo ""
echo "3. ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè©³ç´°:"
gcloud iam service-accounts describe $SERVICE_ACCOUNT 2>/dev/null || echo "âŒ SAæƒ…å ±å–å¾—å¤±æ•—"

# 4. Cloud Runç’°å¢ƒå¤‰æ•°ç¢ºèª
echo ""
echo "4. Cloud Runç’°å¢ƒå¤‰æ•°ç¢ºèª:"
gcloud run services describe crypto-bot-service-prod --region=asia-northeast1 --format="table(spec.template.spec.containers[0].env[].name,spec.template.spec.containers[0].env[].value)"

# 5. Secretå–å¾—ãƒ†ã‚¹ãƒˆï¼ˆå®‰å…¨ãªæ–¹æ³•ï¼‰
echo ""
echo "5. Secretå–å¾—ãƒ†ã‚¹ãƒˆï¼ˆæ¨©é™ç¢ºèªç”¨ï¼‰:"
for secret in bitbank-api-key bitbank-api-secret discord-webhook-url; do
    if gcloud secrets versions access latest --secret="$secret" --format="value(payload.data)" | base64 -d | head -c 10 >/dev/null 2>&1; then
        echo "   $secret: âœ… ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½"
    else
        echo "   $secret: âŒ ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯"
    fi
done

echo ""
echo "6. ğŸš¨ ç·Šæ€¥ä¿®æ­£ã‚³ãƒãƒ³ãƒ‰ï¼ˆå¿…è¦æ™‚ã¯ 03_ç·Šæ€¥å¯¾å¿œãƒãƒ‹ãƒ¥ã‚¢ãƒ«.md å‚ç…§ï¼‰"
```

### ğŸ”¥ Containerå®‰å®šæ€§ãƒ»éåŒæœŸå‡¦ç†è©³ç´°è¨ºæ–­

**ã„ã¤ä½¿ç”¨**: Container exit(1)ã‚„RuntimeWarningãŒå¤šç™ºã—ã¦ã„ã‚‹æ™‚

```bash
echo "=== Containerå®‰å®šæ€§ãƒ»éåŒæœŸå‡¦ç†è©³ç´°è¨ºæ–­ï¼ˆmacOSå¯¾å¿œï¼‰ ==="

# 1. Containerå•é¡Œãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ
echo "1. Containerå•é¡Œãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ:"
echo "   exit(1) è©³ç´°ãƒ­ã‚°:"
show_logs_since_deploy "textPayload:\"Container called exit(1)\"" 15

echo "   RuntimeWarningè©³ç´°ãƒ­ã‚°:"
show_logs_since_deploy "textPayload:\"RuntimeWarning\" AND textPayload:\"never awaited\"" 15

# 2. async/awaitå•é¡Œç‰¹å®š
echo ""
echo "2. async/awaitå•é¡Œç‰¹å®š:"
echo "   check_stop_conditionséåŒæœŸå•é¡Œ:"
show_logs_since_deploy "textPayload:\"check_stop_conditions\"" 8

echo "   trading_cycle_manager.pyå•é¡Œ:"
show_logs_since_deploy "textPayload:\"trading_cycle_manager.py\"" 5

echo "   persistence asyncå•é¡Œ:"
show_logs_since_deploy "textPayload:\"persistence\" AND textPayload:\"async\"" 8

# 3. ãƒ¡ãƒ¢ãƒªãƒ»ãƒªã‚½ãƒ¼ã‚¹å•é¡Œç¢ºèª
echo ""
echo "3. ãƒ¡ãƒ¢ãƒªãƒ»ãƒªã‚½ãƒ¼ã‚¹å•é¡Œç¢ºèª:"
MEMORY_HIGH_COUNT=$(count_logs_since_deploy "textPayload:\"ãƒ¡ãƒ¢ãƒª.*9[0-9]%\" OR textPayload:\"memory.*9[0-9]%\"" 15)
OOM_ERROR_COUNT=$(count_logs_since_deploy "textPayload:\"OutOfMemoryError\" OR textPayload:\"MemoryError\" OR textPayload:\"OOM\"" 10)

echo "   ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡90%ä»¥ä¸Š: $MEMORY_HIGH_COUNTå›"
echo "   OOMã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: $OOM_ERROR_COUNTå›"

if [ $MEMORY_HIGH_COUNT -gt 5 ] || [ $OOM_ERROR_COUNT -gt 0 ]; then
    echo "   âŒ ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡å•é¡Œï¼ˆè¦å¯¾å¿œï¼‰"
    echo "     - Cloud Runãƒ¡ãƒ¢ãƒªåˆ¶é™å¢—åŠ æ¨å¥¨"
    echo "     - 03_ç·Šæ€¥å¯¾å¿œãƒãƒ‹ãƒ¥ã‚¢ãƒ«.md Containerå•é¡Œå¯¾å¿œå‚ç…§"
else
    echo "   âœ… ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡æ­£å¸¸"
fi

# 4. Containerå†èµ·å‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ç¢ºèª
echo ""
echo "4. Containerå†èµ·å‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ç¢ºèª:"
echo "   æœ€æ–°Containerèµ·å‹•ãƒ»çµ‚äº†ãƒ­ã‚°:"
show_logs_since_deploy "textPayload:\"Container\" AND (textPayload:\"starting\" OR textPayload:\"stopping\" OR textPayload:\"exit\")" 20
```

### ğŸ’° APIæ¥ç¶šãƒ»ãƒ‡ãƒ¼ã‚¿å–å¾—è©³ç´°è¨ºæ–­

**ã„ã¤ä½¿ç”¨**: APIæ®‹é«˜å–å¾—ã«å•é¡ŒãŒã‚ã‚‹ã€ã¾ãŸã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹æ™‚

```bash
echo "=== APIæ¥ç¶šãƒ»ãƒ‡ãƒ¼ã‚¿å–å¾—è©³ç´°è¨ºæ–­ï¼ˆmacOSå¯¾å¿œï¼‰ ==="

# 1. bitbank APIèªè¨¼ãƒ»æ®‹é«˜å–å¾—è©³ç´°ç¢ºèª
echo "1. bitbank APIèªè¨¼ãƒ»æ®‹é«˜å–å¾—è©³ç´°ç¢ºèª:"
echo "   APIèªè¨¼æƒ…å ±èª­ã¿è¾¼ã¿ç¢ºèª:"
show_logs_since_deploy "textPayload:\"BITBANK_API_KEYèª­ã¿è¾¼ã¿\" OR textPayload:\"BITBANK_API_SECRETèª­ã¿è¾¼ã¿\"" 8

API_10K_COUNT=$(count_logs_since_deploy "textPayload:\"10,000å††\"" 20)
FALLBACK_11K_COUNT=$(count_logs_since_deploy "textPayload:\"11,000å††\"" 20)
ZERO_YEN_COUNT=$(count_logs_since_deploy "textPayload:\"0å††\" OR textPayload:\"æ®‹é«˜ä¸è¶³\"" 10)

echo "   å®ŸAPIæ®‹é«˜å–å¾—(10,000å††): $API_10K_COUNTå›"
echo "   ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ®‹é«˜(11,000å††): $FALLBACK_11K_COUNTå›"
echo "   0å††ãƒ»æ®‹é«˜ä¸è¶³ã‚¨ãƒ©ãƒ¼: $ZERO_YEN_COUNTå›"

# API vs ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯åˆ¤å®š
if [ $API_10K_COUNT -gt 0 ] && [ $FALLBACK_11K_COUNT -eq 0 ]; then
    echo "   âœ… å®ŸAPIä½¿ç”¨ä¸­ï¼ˆæ­£å¸¸ï¼‰"
elif [ $FALLBACK_11K_COUNT -gt 0 ]; then
    echo "   âš ï¸ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ä½¿ç”¨ä¸­ï¼ˆAPIèªè¨¼å•é¡Œã®å¯èƒ½æ€§ï¼‰"

    # macOSå¯¾å¿œ: ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç‡è¨ˆç®—
    TOTAL_BALANCE_CHECKS=$((API_10K_COUNT + FALLBACK_11K_COUNT))
    if [ $TOTAL_BALANCE_CHECKS -gt 0 ]; then
        FALLBACK_BALANCE_RATE=$(python3 -c "print(f'{($FALLBACK_11K_COUNT / $TOTAL_BALANCE_CHECKS) * 100:.1f}')" 2>/dev/null || echo "0.0")
        echo "   ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ä½¿ç”¨ç‡: ${FALLBACK_BALANCE_RATE}%"
    fi
else
    echo "   âŒ æ®‹é«˜å–å¾—å®Œå…¨å¤±æ•—"
fi

# 2. Secret Managerå–å¾—ã‚¨ãƒ©ãƒ¼è©³ç´°ç¢ºèª
echo ""
echo "2. Secret Managerå–å¾—ã‚¨ãƒ©ãƒ¼è©³ç´°ç¢ºèª:"
echo "   æ¨©é™ãƒ»ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼:"
show_logs_since_deploy "textPayload:\"permission\" OR textPayload:\"Secret\" OR textPayload:\"401\" OR textPayload:\"403\"" 10

echo "   Secret Manageræ¥ç¶šå•é¡Œ:"
show_logs_since_deploy "textPayload:\"Secret Manager\" AND (textPayload:\"ã‚¨ãƒ©ãƒ¼\" OR textPayload:\"timeout\" OR textPayload:\"connection\")" 8

echo "   å…·ä½“çš„ãªSecretå–å¾—å¤±æ•—:"
show_logs_since_deploy "textPayload:\"bitbank-api-key\" OR textPayload:\"bitbank-api-secret\" AND textPayload:\"å–å¾—å¤±æ•—\"" 5

# 3. APIæ¥ç¶šãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å•é¡Œç¢ºèª
echo ""
echo "3. APIæ¥ç¶šãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å•é¡Œç¢ºèª:"
echo "   APIæ¥ç¶šã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãƒ»ã‚¨ãƒ©ãƒ¼:"
show_logs_since_deploy "textPayload:\"API timeout\" OR textPayload:\"connection\" OR textPayload:\"network\"" 10

echo "   bitbank APIç‰¹æœ‰ã‚¨ãƒ©ãƒ¼:"
show_logs_since_deploy "textPayload:\"bitbank\" AND (textPayload:\"rate.*limit\" OR textPayload:\"API.*limit\" OR textPayload:\"maintenance\")" 8

echo "   HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¨ãƒ©ãƒ¼:"
show_logs_since_deploy "textPayload:\"HTTP\" AND (textPayload:\"500\" OR textPayload:\"502\" OR textPayload:\"503\" OR textPayload:\"504\")" 8
```

---

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬å®Ÿè¡Œï¼ˆæ¨å¥¨ï¼‰

```bash
# åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ è¨ºæ–­å®Ÿè¡Œ
bash 01_ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒè¨ºæ–­.sh

# çµæœã«å¿œã˜ã¦æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
# çµ‚äº†ã‚³ãƒ¼ãƒ‰ 0: 02_Botæ©Ÿèƒ½è¨ºæ–­.md ã¸é€²ã‚€
# çµ‚äº†ã‚³ãƒ¼ãƒ‰ 1-2: 03_ç·Šæ€¥å¯¾å¿œãƒãƒ‹ãƒ¥ã‚¢ãƒ«.md ã§ä¿®æ­£
# çµ‚äº†ã‚³ãƒ¼ãƒ‰ 3: ç›£è¦–ç¶™ç¶š
```

### 2. è©³ç´°è¨ºæ–­å®Ÿè¡Œï¼ˆå•é¡Œç™ºç”Ÿæ™‚ï¼‰

```bash
# Secret Managerå•é¡Œæ™‚
bash 01_ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒè¨ºæ–­.sh --detail-secret

# Containerå•é¡Œæ™‚
bash 01_ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒè¨ºæ–­.sh --detail-container

# APIæ¥ç¶šå•é¡Œæ™‚
bash 01_ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒè¨ºæ–­.sh --detail-api
```

### 3. å®Ÿè¡Œé †åºï¼ˆæ¨å¥¨ãƒ•ãƒ­ãƒ¼ï¼‰

1. **01_ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒè¨ºæ–­.md** â† **ã“ã“ã‹ã‚‰é–‹å§‹**
2. **02_Botæ©Ÿèƒ½è¨ºæ–­.md** ï¼ˆåŸºç›¤æ­£å¸¸æ™‚ï¼‰
3. **03_ç·Šæ€¥å¯¾å¿œãƒãƒ‹ãƒ¥ã‚¢ãƒ«.md** ï¼ˆå•é¡Œç™ºç”Ÿæ™‚ï¼‰

---

## ğŸ“Š åˆ¤å®šåŸºæº–

- **çµ‚äº†ã‚³ãƒ¼ãƒ‰ 0**: ğŸŸ¢ åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸ - Botæ©Ÿèƒ½è¨ºæ–­ã¸
- **çµ‚äº†ã‚³ãƒ¼ãƒ‰ 1**: ğŸ’€ å³åº§å¯¾å¿œå¿…é ˆ - Secret Managerãƒ»Discordéšœå®³
- **çµ‚äº†ã‚³ãƒ¼ãƒ‰ 2**: ğŸŸ  è¦æ³¨æ„ - Containerå•é¡Œãƒ»APIæ¥ç¶šå•é¡Œ
- **çµ‚äº†ã‚³ãƒ¼ãƒ‰ 3**: ğŸŸ¡ ç›£è¦–ç¶™ç¶š - è»½å¾®ãªå•é¡Œãƒ»äºˆé˜²çš„å¯¾å¿œ

---

**ğŸ¯ é‡è¦**: ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ ã®ã¿ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚Botå›ºæœ‰ã®æ©Ÿèƒ½ï¼ˆ55ç‰¹å¾´é‡ãƒ»6æˆ¦ç•¥ãƒ»MLçµ±åˆï¼‰ã«ã¤ã„ã¦ã¯ **02_Botæ©Ÿèƒ½è¨ºæ–­.md** ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

**æœ€çµ‚æ›´æ–°**: 2025å¹´11æœˆ15æ—¥ - Phase 52.4å®Œäº†å¯¾å¿œï¼ˆè¨­å®šä¸€å…ƒåŒ–ãƒ»ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰æ’²æ»…ï¼‰