{
  "version": "1.0.0",
  "description": "crypto-bot å®Œç’§ç¨¼åƒçŠ¶æ³ç¢ºèªã‚·ã‚¹ãƒ†ãƒ è¨­å®š",
  "updated": "2025-08-12",
  
  "check_phases": {
    "phase1": {
      "name": "ã‚¤ãƒ³ãƒ•ãƒ©ãƒ»åŸºç›¤ç¢ºèª",
      "weight": 25,
      "checks": [
        "gcp_cloud_run_status",
        "api_connectivity", 
        "system_health",
        "resource_usage"
      ]
    },
    "phase2": {
      "name": "ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‹•ä½œç¢ºèª", 
      "weight": 30,
      "checks": [
        "log_analysis",
        "data_fetching_efficiency",
        "signal_generation_health",
        "main_loop_status"
      ]
    },
    "phase3": {
      "name": "éš ã‚ŒãŸå•é¡Œæ¤œå‡º",
      "weight": 30,
      "checks": [
        "hidden_error_patterns",
        "performance_anomalies", 
        "future_data_leaks",
        "config_integrity"
      ]
    },
    "phase4": {
      "name": "ç·åˆåˆ¤å®šãƒ»ãƒ¬ãƒãƒ¼ãƒˆ",
      "weight": 15,
      "checks": [
        "overall_scoring",
        "risk_assessment",
        "action_recommendations",
        "report_generation"
      ]
    }
  },

  "thresholds": {
    "critical_score": 70,
    "warning_score": 85,
    "healthy_score": 95,
    
    "max_response_time_seconds": 5.0,
    "max_silence_hours": 1.0,
    "max_consecutive_holds": 30,
    "min_confidence": 0.1,
    "max_confidence": 0.9,
    
    "max_empty_batch_ratio": 0.5,
    "max_data_fetch_attempts": 15,
    "max_api_error_rate": 0.1,
    "max_memory_usage_percent": 90
  },

  "hidden_error_patterns": {
    "description": "éå»ã«ç™ºç”Ÿã—ãŸè¦‹ã¤ã‘ã«ãã„ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³",
    "patterns": [
      {
        "id": "data_fetch_stagnation",
        "name": "ãƒ‡ãƒ¼ã‚¿å–å¾—åœæ»ï¼ˆ48/300å•é¡Œï¼‰", 
        "severity": "CRITICAL",
        "detection": {
          "log_patterns": [
            "current=48/300",
            "âš ï¸ Empty batch [0-9]+/8",
            "ğŸ”„ Attempt [1-9][0-9]+/20.*current=48/300"
          ],
          "conditions": [
            "empty_batch_count >= 8",
            "fetch_progress_stalled >= 1800" 
          ]
        },
        "description": "APIåˆ¶é™ã¾ãŸã¯æ¥ç¶šå•é¡Œã«ã‚ˆã‚Š48ä»¶ã§åœæ»ã€Empty batché€£ç¶šç™ºç”Ÿ",
        "past_solutions": [
          "APIæ¥ç¶šç¢ºèªãƒ»èªè¨¼æƒ…å ±ãƒã‚§ãƒƒã‚¯",
          "ãƒ¬ãƒ¼ãƒˆåˆ¶é™å›é¿ãƒ»ãƒãƒƒã‚¯ã‚ªãƒ•èª¿æ•´",
          "ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½å®Ÿè£…"
        ]
      },
      {
        "id": "ci_workflow_stuck", 
        "name": "CI/CDãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é•·æ™‚é–“ã‚¹ã‚¿ãƒƒã‚¯",
        "severity": "HIGH",
        "detection": {
          "github_patterns": [
            "in_progress.*[5-9] hour",
            "Run quality checks.*in_progress.*>3600"
          ],
          "conditions": [
            "ci_duration_seconds > 3600",
            "ci_status == 'in_progress'"
          ]
        },
        "description": "GitHub ActionsãŒæ•°æ™‚é–“ã‚¹ã‚¿ãƒƒã‚¯ã€æ–°ãƒ‡ãƒ—ãƒ­ã‚¤æœªå®Ÿè¡Œ",
        "past_solutions": [
          "ã‚¹ã‚¿ãƒƒã‚¯CIã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒ»å†å®Ÿè¡Œ",
          "ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®ãƒ­ãƒ¼ã‚«ãƒ«æ¤œè¨¼",
          "CI/CDã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šã®è¦‹ç›´ã—"
        ]
      },
      {
        "id": "surface_healthy_actually_stopped",
        "name": "è¡¨é¢ç¨¼åƒãƒ»å®Ÿéš›åœæ­¢å•é¡Œ",
        "severity": "CRITICAL", 
        "detection": {
          "health_patterns": [
            "status.*healthy.*timestamp.*[5-9] hour"
          ],
          "conditions": [
            "health_timestamp_age_hours >= 4",
            "latest_log_age_hours >= 2",
            "no_recent_activity == true"
          ]
        },
        "description": "ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã¯200ã ãŒã€å®Ÿéš›ã¯æ•°æ™‚é–“å‰ã‹ã‚‰åœæ­¢",
        "past_solutions": [
          "Cloud Runå¼·åˆ¶å†èµ·å‹•",
          "ãƒªãƒ“ã‚¸ãƒ§ãƒ³åˆ‡æ›¿ç¢ºèª", 
          "ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«è¨ºæ–­"
        ]
      },
      {
        "id": "timezone_confusion",
        "name": "UTC/JSTæ™‚åˆ»æ··åœ¨ã«ã‚ˆã‚‹çŠ¶æ³èª¤èª",
        "severity": "MEDIUM",
        "detection": {
          "patterns": [
            "mixed_timezone_display",
            "time_interpretation_error"
          ],
          "conditions": [
            "timezone_consistency_check == false"
          ]
        },
        "description": "UTCãƒ»JSTæ™‚åˆ»æ··åœ¨ã«ã‚ˆã‚ŠçŠ¶æ³åˆ¤æ–­ã‚’èª¤ã‚‹",
        "past_solutions": [
          "å…¨æ™‚åˆ»è¡¨ç¤ºã‚’JSTçµ±ä¸€",
          "çµ±åˆæ™‚åˆ»ç®¡ç†ãƒ„ãƒ¼ãƒ«ä½¿ç”¨",
          "æ™‚åˆ»å¤‰æ›è‡ªå‹•åŒ–"
        ]
      },
      {
        "id": "import_error_hidden",
        "name": "éš ã‚ŒãŸã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ä¸åœ¨ã‚¨ãƒ©ãƒ¼",
        "severity": "HIGH",
        "detection": {
          "log_patterns": [
            "ImportError.*BitbankCoreExecutor",
            "AttributeError.*fetch_ticker",
            "cannot import name.*from"
          ],
          "test_patterns": [
            "test.*failed.*import",
            "ModuleNotFoundError"
          ]
        },
        "description": "ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚ã‚„ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§ç™ºè¦šã™ã‚‹ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ã‚¨ãƒ©ãƒ¼",
        "past_solutions": [
          "ä¸è¶³ã‚¯ãƒ©ã‚¹ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…",
          "ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹ä¿®æ­£",
          "å‹å®šç¾©çµ±åˆ"
        ]
      },
      {
        "id": "main_loop_not_reached",
        "name": "åˆæœŸåŒ–æ®µéšã§ã®åœæ­¢ï¼ˆãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—æœªåˆ°é”ï¼‰",
        "severity": "CRITICAL",
        "detection": {
          "log_patterns": [
            "INIT-[1-5].*ã§åœæ­¢",
            "ATR calculation.*å®Œäº†å¾Œåœæ­¢"
          ],
          "conditions": [
            "main_loop_entries == 0",
            "init_phase_stuck >= 1800"
          ]
        },
        "description": "INITæ®µéšã§åœæ­¢ã€ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—ã«åˆ°é”ã—ãªã„",
        "past_solutions": [
          "åˆæœŸåŒ–å‡¦ç†ã®ç°¡ç´ åŒ–",
          "INITæ®µéšã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–",
          "ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šé©æ­£åŒ–"
        ]
      },
      {
        "id": "revision_switch_failure",
        "name": "ãƒªãƒ“ã‚¸ãƒ§ãƒ³åˆ‡æ›¿å¤±æ•—ãƒ»å¤ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¨¼åƒ",
        "severity": "HIGH",
        "detection": {
          "gcp_patterns": [
            "æ–°ãƒªãƒ“ã‚¸ãƒ§ãƒ³ä½œæˆ.*ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯0%",
            "ACTIVE.*å¤ã„ä½œæˆæ™‚åˆ»"
          ],
          "conditions": [
            "active_revision_age_hours >= 24",
            "latest_revision_traffic_percent < 50"
          ]
        },
        "description": "æ–°ãƒªãƒ“ã‚¸ãƒ§ãƒ³ä½œæˆã•ã‚Œã‚‹ãŒã€å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒACTIVEç¶™ç¶š",
        "past_solutions": [
          "ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯æ‰‹å‹•åˆ‡æ›¿",
          "å¤ãƒªãƒ“ã‚¸ãƒ§ãƒ³å‰Šé™¤ãƒ»ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—",
          "ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ—ãƒ­ã‚»ã‚¹è¦‹ç›´ã—"
        ]
      },
      {
        "id": "infinite_retry_loop",
        "name": "ç„¡é™ãƒªãƒˆãƒ©ã‚¤ãƒ«ãƒ¼ãƒ—ãƒ»ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ç•°å¸¸",
        "severity": "HIGH",
        "detection": {
          "log_patterns": [
            "ğŸ”„ Attempt [1-9][0-9]+/20",
            "Smart backoff.*[3-9][0-9]\\.[0-9]+s"
          ],
          "conditions": [
            "retry_attempts >= 15",
            "backoff_duration_seconds >= 30"
          ]
        },
        "description": "ãƒªãƒˆãƒ©ã‚¤å›æ•°ç•°å¸¸å¢—åŠ ã€ãƒãƒƒã‚¯ã‚ªãƒ•æ™‚é–“å»¶é•·",
        "past_solutions": [
          "ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯è¦‹ç›´ã—",
          "ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æ¤œè¨¼å¼·åŒ–",
          "ç•°å¸¸æ¤œå‡ºãƒ»æ—©æœŸè„±å‡ºå®Ÿè£…"
        ]
      },
      {
        "id": "model_prediction_anomaly",
        "name": "äºˆæ¸¬å€¤ç•°å¸¸ï¼ˆconfidenceå›ºå®šãƒ»ç•°å¸¸å€¤ï¼‰",
        "severity": "MEDIUM",
        "detection": {
          "signal_patterns": [
            "confidence.*0\\.0{3,}",
            "confidence.*1\\.0{3,}",
            "é€£ç¶š[3-9][0-9].*HOLD"
          ],
          "conditions": [
            "confidence_variance < 0.01",
            "consecutive_holds >= 30"
          ]
        },
        "description": "äºˆæ¸¬confidenceãŒå›ºå®šå€¤ãƒ»ãƒ¢ãƒ‡ãƒ«äºˆæ¸¬ç•°å¸¸",
        "past_solutions": [
          "ãƒ¢ãƒ‡ãƒ«å†å­¦ç¿’ãƒ»æ¤œè¨¼",
          "ç‰¹å¾´é‡æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯",
          "äºˆæ¸¬ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨ºæ–­"
        ]
      },
      {
        "id": "memory_leak_gradual",
        "name": "ç·©ã‚„ã‹ãªãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ£åŒ–",
        "severity": "MEDIUM",
        "detection": {
          "resource_patterns": [
            "memory.*usage.*increasing",
            "response.*time.*degradation"
          ],
          "conditions": [
            "memory_growth_rate_mb_per_hour >= 10",
            "response_time_trend_increasing == true"
          ]
        },
        "description": "æ™‚é–“ã¨ã¨ã‚‚ã«ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡å¢—åŠ ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹åŠ£åŒ–",
        "past_solutions": [
          "ãƒ¡ãƒ¢ãƒªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°å®Ÿè¡Œ",
          "ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Ÿè£…", 
          "ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å®šæœŸå†èµ·å‹•"
        ]
      },
      {
        "id": "model_compatibility_error",
        "name": "ãƒ¢ãƒ‡ãƒ«äº’æ›æ€§ã‚¨ãƒ©ãƒ¼ï¼ˆmonotonic_cstå±æ€§ï¼‰",
        "severity": "CRITICAL",
        "detection": {
          "log_patterns": [
            "DecisionTreeClassifier.*has no attribute.*monotonic_cst",
            "Trading prediction failed for base model",
            "sklearn.*version.*mismatch"
          ],
          "conditions": [
            "model_prediction_failures >= 1",
            "no_trade_signals_generated == true"
          ]
        },
        "description": "scikit-learnãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¸æ•´åˆã«ã‚ˆã‚‹ãƒ¢ãƒ‡ãƒ«äºˆæ¸¬å¤±æ•—ã€ãƒˆãƒ¬ãƒ¼ãƒ‰ä¸èƒ½",
        "past_solutions": [
          "scripts/model_tools/retrain_97_features_model.py --fix-compatibility-onlyå®Ÿè¡Œ",
          "ãƒ¢ãƒ‡ãƒ«å†å­¦ç¿’ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³çµ±ä¸€",
          "crypto_bot/ml/ensemble.pyã«ãƒ‘ãƒƒãƒé©ç”¨"
        ]
      },
      {
        "id": "frequent_instance_restart",
        "name": "é »ç¹ãªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å†èµ·å‹•ï¼ˆSIGTERMï¼‰",
        "severity": "HIGH",
        "detection": {
          "log_patterns": [
            "Received signal 15",
            "SIGTERM",
            "Shutting down gracefully",
            "Shutting down user disabled instance"
          ],
          "conditions": [
            "restart_frequency_per_hour >= 1",
            "min_instances_setting == 0"
          ]
        },
        "description": "Cloud Runã®min-instances=0ã«ã‚ˆã‚‹ã‚¢ã‚¤ãƒ‰ãƒ«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ",
        "past_solutions": [
          "gcloud run services update --min-instances=1",
          "CPU throttlingç„¡åŠ¹åŒ–",
          "ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå»¶é•·ï¼ˆ--timeout=3600ï¼‰"
        ]
      },
      {
        "id": "confidence_below_threshold_chronic",
        "name": "confidenceå€¤æ…¢æ€§çš„é–¾å€¤æœªé”",
        "severity": "MEDIUM",
        "detection": {
          "log_patterns": [
            "confidence=0\\.[0-2][0-9][0-9][0-9], threshold=0\\.[3-9]",
            "Entry order details: side=None, price=None, lot=0\\.0"
          ],
          "conditions": [
            "avg_confidence_last_10 < threshold",
            "no_entry_signals_hours >= 2"
          ]
        },
        "description": "äºˆæ¸¬confidenceãŒå¸¸ã«é–¾å€¤ã‚’ä¸‹å›ã‚Šã€ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚·ã‚°ãƒŠãƒ«ç”Ÿæˆã•ã‚Œãš",
        "past_solutions": [
          "confidence_thresholdå¼•ãä¸‹ã’ï¼ˆ0.35â†’0.25ï¼‰",
          "ãƒ¢ãƒ‡ãƒ«æ€§èƒ½æ”¹å–„ãƒ»å†å­¦ç¿’",
          "ãƒ‡ãƒ¼ã‚¿å“è³ªå‘ä¸Šãƒ»å–å¾—é‡å¢—åŠ "
        ]
      },
      {
        "id": "data_fetch_insufficient_volume",
        "name": "ãƒ‡ãƒ¼ã‚¿å–å¾—é‡ä¸è¶³ï¼ˆ50%æœªæº€ï¼‰",
        "severity": "HIGH",
        "detection": {
          "log_patterns": [
            "current=[0-9]{1,2}/150",
            "current=1[0-2][0-9]/150"
          ],
          "conditions": [
            "data_fetch_completion_rate < 0.5",
            "data_fetch_attempts >= 10"
          ]
        },
        "description": "ç›®æ¨™ãƒ‡ãƒ¼ã‚¿é‡ã®50%æœªæº€ã—ã‹å–å¾—ã§ããšã€äºˆæ¸¬ç²¾åº¦ã«æ‚ªå½±éŸ¿",
        "past_solutions": [
          "APIåˆ¶é™è¨­å®šç·©å’Œï¼ˆrateLimitå¼•ãä¸‹ã’ï¼‰",
          "max_consecutive_emptyä¸Šé™æ‹¡å¤§",
          "backoffæ™‚é–“å»¶é•·ãƒ»ãƒªãƒˆãƒ©ã‚¤å¢—åŠ "
        ]
      },
      {
        "id": "ensemble_model_degraded",
        "name": "ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ãƒ¢ãƒ‡ãƒ«åŠ£åŒ–ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¤šç”¨ï¼‰",
        "severity": "MEDIUM",
        "detection": {
          "log_patterns": [
            "Base model [0-9] failed \\(using fallback\\)",
            "Trading prediction failed for base model"
          ],
          "conditions": [
            "model_fallback_rate > 0.3",
            "base_model_failures >= 5"
          ]
        },
        "description": "ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«å†…ã®è¤‡æ•°ãƒ¢ãƒ‡ãƒ«ãŒå¤±æ•—ã€äºˆæ¸¬å“è³ªä½ä¸‹",
        "past_solutions": [
          "ãƒ¢ãƒ‡ãƒ«äº’æ›æ€§ä¿®æ­£ãƒ»å†å­¦ç¿’",
          "sklearn versionçµ±ä¸€",
          "ensemble.py ãƒ‘ãƒƒãƒå¼·åŒ–"
        ]
      }
    ]
  },

  "detection_rules": {
    "data_quality": {
      "empty_batch_threshold": 5,
      "stalled_progress_seconds": 1800,
      "api_error_rate_threshold": 0.2
    },
    "system_health": {
      "max_memory_usage": 0.9,
      "max_cpu_usage": 0.8,
      "max_response_time": 10.0,
      "min_uptime_hours": 1.0
    },
    "trading_signals": {
      "max_silence_hours": 2.0,
      "min_signal_diversity": 0.1,
      "confidence_range": [0.05, 0.95],
      "max_consecutive_same": 50
    }
  },

  "reporting": {
    "output_formats": ["console", "html", "json"],
    "timezone": "Asia/Tokyo",
    "score_weights": {
      "infrastructure": 0.25,
      "application": 0.30, 
      "hidden_issues": 0.30,
      "overall_health": 0.15
    },
    "action_priority_levels": ["IMMEDIATE", "HIGH", "MEDIUM", "LOW", "INFO"]
  },

  "integration": {
    "existing_tools": {
      "signal_monitor": "scripts/monitoring/signal_monitor.py",
      "error_analyzer": "scripts/monitoring/error_analyzer.py", 
      "system_health": "scripts/system_tools/system_health_check.py",
      "leak_detector": "scripts/monitoring/future_leak_detector.py",
      "gcp_log_viewer": "scripts/utilities/unified_status_checker.py"
    },
    "log_sources": {
      "gcp_logs": "gcloud logging read",
      "local_logs": "logs/",
      "signal_csv": "logs/trading_signals.csv",
      "health_endpoint": "/health"
    }
  }
}